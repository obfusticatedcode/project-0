"use strict";$(function(){function e(){var e=$(event.target).position();return m=o(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(f+h)+"px",left:e*(f+h)+"px"}}function o(e,a){return{x:a/(f+h),y:e/(f+h)}}function n(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var n=$(a).position(),i=o(n.top,n.left),s=8*i.y+i.x;t[s]=$(a)});var n=o(e.position().top,e.position().left),i=[{x:1,y:1},{x:-1,y:1}],s=[{x:1,y:-1},{x:-1,y:-1}],l=i.concat(s),r=void 0;r=e.hasClass("king")?l:e.hasClass("light")?i:s;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},d=$();return function o(n,i,s){if(!c(n)){var l=a.eq(8*n.y+n.x);$.each(i,function(i,r){var v={x:r.x+n.x,y:r.y+n.y};if(!c(v)){var u=8*v.y+v.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var f={x:2*r.x+n.x,y:2*r.y+n.y};if(c(f))return;var h=8*f.y+f.x;if(!t[h]){var p=a.eq(h);if(!p.is(d)){d=d.add(p);var g=t[u];l.data("jumpedPieces")&&(g=g.add(l.data("jumpedPieces"))),p.data("jumpedPieces",g),o(f,r,!0)}}}else if(!s){var C=a.eq(u);C.data("jumpedPieces",$()),d=d.add(C)}}})}}(n,r,!1),d}function i(e,a,t){e.css("top",a),e.css("left",t)}function s(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function l(){x.html(parseInt(x.html())+1)}function r(e){var a="";a="light"===e?"#lightMoveCount":"#darkMoveCount";var t=parseInt($(a).html());t++,$(a).html(t),console.log(t),t%2==1?(console.log("Hello odd number"),console.log(q)):t%2==0&&(console.log("Hello even number"),console.log(k))}function c(e){e.data("jumpedPieces").remove()}function d(e,a){for(var t=0;t<64;t++)(a<8||a>=56)&&e.addClass("king")}function v(){var e=q.length,a=k.length;return 0===e?console.log("Player 1 wins"):0===a?console.log("Player 2 wins"):1===a&&1===e?console.log("It's a draw"):void 0}function u(){location.reload()}var f=46,h=2,p=$("div#board"),g=$("div#pieces"),C=$("#reset-button"),m=null;!function(){function e(e){return e%8%2^Math.floor(e/8)%2}for(var a=0;a<64;a++)p.append($("<div/>").addClass("square"));for(var t=0;t<24;t++)g.append($("<div/>").addClass("piece"));$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}(),function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),function(){$("div.piece.dark").each(function(e,a){var o=Math.floor(e/4)+5,n=e%4*2+(1-o%2),s=t(n,o);i($(a),s.top,s.left)})}(),function(){var e=$("div.piece.light");e.each(function(a,o){console.log(e.length);var n=Math.floor(a/4),s=a%4*2+(1-n%2),l=t(s,n);i($(o),l.top,l.left)})}(),$("div.square").on("click",function(o){e();var n=$(o.target);if(n.hasClass("movable")){var s=$("div.piece.selected");if(1===s.length){var u=n.prevAll().length,f=u%8,h=Math.floor(u/8),p=t(f,h);i(s,p.top,p.left),c(n),d(s,n.prevAll().length),s.removeClass("selected"),$("div.square").removeClass("movable"),v(),l();var g="";g=!0===s.hasClass("light")?"light":"dark",r(g),a()}}});var x=$("#moveCounter"),y=!0;!function(){!0===y&&(console.log(y),$("div.piece").on("click",function(e){var t=$(e.target);s(t),a(),t.hasClass("selected")&&n(t).addClass("movable")}))}();var k=$("div.piece.light"),q=$("div.piece.dark");C.on("click",function(){u()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiY29vcmRzIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsImdldENvb3JkcyIsInRvcCIsImxlZnQiLCJyZXNldE1vdmFibGVzIiwicmVtb3ZlRGF0YSIsInJlbW92ZUNsYXNzIiwiZ2V0UGl4ZWxzIiwieCIsInkiLCJ3aWR0aCIsImJvcmRlciIsIiRzcXVhcmVzIiwiZ2V0TW92YWJsZVNxdWFyZXMiLCIkcGllY2UiLCJwaWVjZSIsInRha2VuU3F1YXJlcyIsImxpZ2h0RGlyZWN0aW9uIiwiZGFya0RpcmVjdGlvbiIsInNxdWFyZUluZGV4IiwiZGlyZWN0aW9uIiwib3V0T2ZCb3VuZHMiLCIkbGVnYWxTcXVhcmVzIiwiY29uY2F0IiwiaGFzQ2xhc3MiLCIkY3VycmVudFNxdWFyZSIsIm5ld0Nvb3JkcyIsImJ1aWxkTW92ZXMiLCJqdW1wc09ubHkiLCJuZXdTcXVhcmVJbmRleCIsImVhY2giLCJpbmRleCIsImp1bXBDb29yZHMiLCJqdW1wU3F1YXJlSW5kZXgiLCIkbmV3U3F1YXJlIiwiaXMiLCIkanVtcGVkUGllY2VzIiwiZGF0YSIsImFkZCIsImFkZENsYXNzIiwiZXEiLCJtb3ZlUGllY2VUbyIsIm5ld1RvcCIsIm5ld0xlZnQiLCJjc3MiLCJpIiwidG9nZ2xlU2VsZWN0IiwicGllY2VTZWxlY3RFbmFibGVkIiwicGllY2VTZWxlY3QiLCJpbmNyZW1lbnRNb3ZlQ291bnQiLCJ3aGljaENvdW50ZXIiLCJjb25zb2xlIiwiaHRtbCIsIiRkYXJrUGllY2VzIiwiJG1vdmVDb3VudGVyIiwiJGxpZ2h0UGllY2VzIiwiY29sb3IiLCIkbW92ZXMiLCJyZW1vdmVDYXB0dXJlZFBpZWNlcyIsIiRzcXVhcmUiLCJsb2ciLCJjaGVja0tpbmciLCJyZW1vdmUiLCIkcmVzZXRCdXR0b24iLCJyZXNldCIsInBpZWNlc0xlZnQiLCJkYXJrUGllY2VzIiwibGVuZ3RoIiwibGlnaHRQaWVjZXMiLCJsb2NhdGlvbiIsInJlbG9hZCIsIiRib2FyZCIsImxpZ2h0T3JEYXJrIiwiTWF0aCIsImZsb29yIiwiJGVhY2hTcXVhcmUiLCJhcHBlbmQiLCIkcGllY2VzIiwidGhpcyIsInBpeGVsUG9zaXRpb24iLCIkcGllY2VUb01vdmUiLCJjdXJyZW50UG9zaXRpb24iLCJlIiwiJHNlbGVjdGVkUGllY2UiLCJwcmV2QWxsIiwicGl4ZWxzIiwiaW5jcmVtZW50TW92ZUNvdW50ZXIiLCJvbiIsIiR0aGlzUGllY2UiXSwibWFwcGluZ3MiOiJZQUNBQSxHQUFFLFdBc0ZFQyxRQUFBQSxLQUNBLEdBQUFDLEdBQUFGLEVBQUFHLE1BQUFDLFFBQUFGLFVBQUEsT0FFREQsR0FBQUksRUFBQUgsRUFBQUksSUFBQUosRUFBQUssTUF5RUcsUUFBQUMsS0FDQVIsRUFBQSxjQUFBUyxXQUFBLGdCQUFBQyxZQUFBLFdBT0osUUFBQUMsR0FBQUMsRUFBQUMsR0FHQSxPQUNJUCxJQUFBTyxHQUFBQyxFQUFBQyxHQUFBLEtBQ0FSLEtBQUFLLEdBQUFFLEVBQUFDLEdBQUEsTUFPSixRQUFBVixHQUFBQyxFQUFBQyxHQU5FLE9BVUFLLEVBQUFMLEdBQUFPLEVBQUFDLEdBQ0FGLEVBQU1HLEdBQUFBLEVBQWFELElBTW5CZixRQUFFaUIsR0FBa0JDLEdBR2xCLEdBQU1oQixHQUFXRixFQUFFbUIsY0FKakJDLElBVUpwQixHQUFBLGFBQWVLLEtBQUFBLFNBQVVhLEVBQU9oQixHQUdoQyxHQUFNbUIsR0FBQUEsRUFBaUJGLEdBQ25CakIsV0FHSkQsRUFBQUksRUFBQUgsRUFBQUksSUFBQUosRUFBQUssTUFDTWUsRUFDUSxFQUFWckIsRUFBTVksRUFEWVosRUFFYlcsQ0FFVFEsR0FBQUcsR0FBQXZCLEVBQUFtQixJQUdBLElBQUlLLEdBQUFBLEVBQUpOLEVBQUFoQixXQUFBSSxJQUFBWSxFQUFBaEIsV0FBQUssTUFDQWMsSUFHRUcsRUFBQUEsRUFBQUEsRUFBQUEsSUFES1osR0FFQSxFQUFBQyxFQUFBLElBWkRTLElBZ0JBRyxFQUFBQSxFQUFBQSxHQUFBQSxJQUNKYixHQUFP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QUdnQkEsSUFBWkksSUFDQXZELFFBQUVnRSxJQUFBYixHQUNBbkQsRUFBQSxhQUFBMkYsR0FBQSxRQUFBLFNBQUF4RixHQUdBLEdBQUF5RixHQUFBNUYsRUFBQUcsRUFBQUMsT0FHQUksR0FBQUEsR0FDQUEsSUFFRVMsRUFBQUEsU0FBa0IyRSxhQUNuQjNFLEVBQUEyRSxHQUFBakQsU0FBQSxnQkF3V1QsSUFBQWdCLEdBQUEzRCxFQUFBLG1CQUNFeUQsRUFBQXpELEVBQXFCLGlCQWNyQm1FLEdBQWF3QixHQUFHLFFBQVMsV0FDdkJ2QiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2xvYWRpbmcgSlNcbiQoKCk9PntcblxuICAvL0dMT0JBTCBWQVJJQUJMRVNcbiAgY29uc3Qgd2lkdGggPSA0NjtcbiAgY29uc3QgYm9yZGVyID0gMjtcbiAgY29uc3QgJGJvYXJkID0gJCgnZGl2I2JvYXJkJyk7XG4gIGNvbnN0ICRwaWVjZXMgPSAkKCdkaXYjcGllY2VzJyk7XG4gIGNvbnN0ICRyZXNldEJ1dHRvbiA9ICQoJyNyZXNldC1idXR0b24nKTtcblxuXG4gIGxldCBjb29yZHMgPSBudWxsOy8vc2V0dGluZyBjb29yZHMgZ2xvYmFsbHkgc28gaXQncyBjb25zdGFudGx5IHVwZGF0aW5nXG5cbiAgLy9zZXQgdXAgdGhlIGJvYXJkIHdpdGggdGhlIGNvcnJlY3QgY2xhc3NlcyBmb3IgdGhlIGxpZ2h0IGFuZCBkYXJrIHNxdWFyZXNcbiAgc2V0VXBCb2FyZCgpO1xuICAvL3NldHMgdXAgdGhlIGNsYXNzZXMgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgcGllY2VcbiAgc2V0VXBQaWVjZXMoKTtcbiAgLy9zZXR0aW5nIHVwIHRoZSBkYXJrUGllY2VzXG4gIGRhcmtQaWVjZXMoKTtcbiAgLy8gc2V0dGluZyB1cCB0aGUgbGlnaHRQaWVjZXNcbiAgbGlnaHRQaWVjZXMoKTtcblxuXG4gIC8vTElHSFQgUElFQ0VTXG4gIGZ1bmN0aW9uIGxpZ2h0UGllY2VzKCl7XG4gICAgY29uc3QgJGxpZ2h0UGllY2VzID0gJCgnZGl2LnBpZWNlLmxpZ2h0Jyk7XG4gICAgLy90aGlzIGxvb3AgbW92ZXMgYWxsIHRoZSBsaWdodCBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgICAkbGlnaHRQaWVjZXMuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuICAgICAgLy8gVEVTVCBjaGVja2luZyB0aGUgbGVuZ3RoXG4gICAgICBjb25zb2xlLmxvZygkbGlnaHRQaWVjZXMubGVuZ3RoKTtcbiAgICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgICAgLy9pbnRvIGEgeCx5IHNxdWFyZSBjb29yZGluYXRlIHVzaW5nIG1hdGhcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gNCk7XG4gICAgICBjb25zdCB4ID0gKGluZGV4ICUgNCkgKiAyICsgKDEgLSB5JTIpO1xuXG4gICAgICAvL3R1cm5pbmcgdGhlIHgseSBjb29yZGluYXRlIGludG8gYSBwaXhlbCBwb3NpdGlvblxuICAgICAgY29uc3QgcGl4ZWxQb3NpdGlvbiA9IGdldFBpeGVscyh4LHkpO1xuICAgICAgLy9hY3R1YWxseSBtb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgICBtb3ZlUGllY2VUbygkKHBpZWNlKSxwaXhlbFBvc2l0aW9uLnRvcCxwaXhlbFBvc2l0aW9uLmxlZnQpO1xuICAgIH0pO1xuICB9Ly9lbmQgb2YgbGlnaHRQaWVjZXMgZnVuY3Rpb25cblxuXG4gIC8vREFSSyBQSUVDRVNcbiAgZnVuY3Rpb24gZGFya1BpZWNlcygpe1xuICAgIGNvbnN0ICRkYXJrUGllY2VzID0gICAkKCdkaXYucGllY2UuZGFyaycpO1xuICAgICAgICAvL3RoaXMgbG9vcCBtb3ZlcyBhbGwgdGhlIGRhcmsgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICAgJGRhcmtQaWVjZXMuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuICAgICAgICAvL3R1cm5pbmcgdGhlIGluZGV4IChmcm9tIDAgLSAxMSlcbiAgICAgICAgLy9pbnRvIGEgeCx5IHNxdWFyZSBjb29yZGluYXRlIHVzaW5nIG1hdGhcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4LzQpICsgNTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMS15JTIpO1xuXG4gICAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgICAgIC8vbW92aW5nIHRoZSBwaWVjZSB0byBpdHMgaW5pdGlhbCBwb3NpdGlvblxuICAgICAgbW92ZVBpZWNlVG8oJChwaWVjZSkscGl4ZWxQb3NpdGlvbi50b3AscGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgICB9KTtcbiAgfS8vZW5kIG9mIGRhcmtQaWVjZXMgZnVuY3Rpb25cblxuXG5cbiAgLy9FVkVOVFNcbiAgZnVuY3Rpb24gcGllY2VTZWxlY3QoKXtcblxuICAgIGlmKHBpZWNlU2VsZWN0RW5hYmxlZCA9PT0gdHJ1ZSl7XG4gICAgICBjb25zb2xlLmxvZyhwaWVjZVNlbGVjdEVuYWJsZWQpO1xuICAgICAgJCgnZGl2LnBpZWNlJykub24oJ2NsaWNrJywoZXZlbnQpPT57XG4gICAgICAgIC8vc2VsZWN0ZWQgdmFyaWFibGVcbiAgICAgICAgLy90dXJuIGB0aGlzYCBpbnRvIGEgalF1ZXJ5IG9iamVjdFxuICAgICAgICBjb25zdCAkdGhpc1BpZWNlID0gJChldmVudC50YXJnZXQpO1xuICAgICAgICAvL3RvZ2dsaW5nIHRoZSAnc2VsZWN0ZWQnIGNsYXNzIG9mIHRoaXMgcGllY2VcbiAgICAgICAgLy9hbmQgcG9zc2libGUgZGVzZWxlY3Rpbmcgb3RoZXIgcGllY2VzXG4gICAgICAgIHRvZ2dsZVNlbGVjdCgkdGhpc1BpZWNlKTtcbiAgICAgICAgcmVzZXRNb3ZhYmxlcygpO1xuICAgICAgICAvL2dldCB0aGUgbGVnYWwgbW92ZXMgZm9yIHRoaXNcbiAgICAgICAgaWYgKCR0aGlzUGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpIHtcbiAgICAgICAgICBnZXRNb3ZhYmxlU3F1YXJlcygkdGhpc1BpZWNlKS5hZGRDbGFzcygnbW92YWJsZScpO1xuICAgICAgICB9XG4gICAgICB9KTsvL2VuZCBvZiBwaWVjZSBjbGljayBldmVudFxuICAgIH1cbiAgfVxuXG5cbiAgLy9jaGVja3MgdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgY2xpY2tlZCBvciBzZWxlY3RlZCBkaXYgYW5kIHJldHVybnMgdGhlIGNvb3Jkcy5cbiAgZnVuY3Rpb24gY3VycmVudFBvc2l0aW9uKCl7XG4gICAgY29uc3QgcG9zaXRpb24gPSAkKGV2ZW50LnRhcmdldCkucG9zaXRpb24oKTtcbiAgICBjb29yZHMgPSBnZXRDb29yZHMocG9zaXRpb24udG9wLHBvc2l0aW9uLmxlZnQpO1xuICAgIHJldHVybiBjb29yZHM7XG5cbiAgfVxuXG5cbiAgJCgnZGl2LnNxdWFyZScpLm9uKCdjbGljaycsIChlKT0+e1xuXG4gICAgY3VycmVudFBvc2l0aW9uKCk7Ly90aGUgY3VycmVudFBvc2l0aW9uIG9mIHRoZSBzcXVhcmU7IGNvb3Jkc1xuICAgIC8vdHVybiBgZSBvciBldmVudGAgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICBjb25zdCAkcGllY2VUb01vdmUgPSAkKGUudGFyZ2V0KTtcblxuXG4gICAgLy9pZiAkKHRoaXMpIGlzIGEgbGVnYWwgc3F1YXJlIHRvIG1vdmUgdG8uLi5cbiAgICBpZiAoJHBpZWNlVG9Nb3ZlLmhhc0NsYXNzKCdtb3ZhYmxlJykpIHtcblxuICAgICAgICAgIC8vZ2V0IHRoZSBwaWVjZSB3aXRoIHRoZSBjbGFzcyAnc2VsZWN0ZWQnXG4gICAgICBjb25zdCAkc2VsZWN0ZWRQaWVjZSA9ICQoJ2Rpdi5waWVjZS5zZWxlY3RlZCcpO1xuICAgICAgICAgIC8vb25seSBtb3ZlIGlmIHRoZXJlIGlzIGV4YWN0bHkgb25lIHNlbGVjdGVkIHBpZWNlXG4gICAgICBpZiAoJHNlbGVjdGVkUGllY2UubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvL2dldCB0aGUgaW5kZXggb2YgdGhlIHNxdWFyZVxuICAgICAgICAgICAgLy9hbmQgdHJhbnNsYXRlIGl0IHRvIHBpeGVsIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IGluZGV4ID0gJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IGdldFBpeGVscyh4LHkpO1xuICAgICAgICAgICAgLy9hY3R1YWxseSBkbyB0aGUgbW92aW5nXG4gICAgICAgIG1vdmVQaWVjZVRvKCRzZWxlY3RlZFBpZWNlLHBpeGVscy50b3AscGl4ZWxzLmxlZnQpO1xuICAgICAgICAgIC8vcmVtb3ZlQ2FwdHVyZWRQaWVjZXNcbiAgICAgICAgcmVtb3ZlQ2FwdHVyZWRQaWVjZXMoJHBpZWNlVG9Nb3ZlKTtcbiAgICAgICAgLy8ucHJldkFsbCgpLmxlbmd0aCBpcyB1c2VkIHRvIGdldCB0aGUgaW5kZXhcbiAgICAgICAgLy9vZiB0aGUgc2VsZWN0ZWQgcGllY2VcbiAgICAgICAgY2hlY2tLaW5nKCRzZWxlY3RlZFBpZWNlLCRwaWVjZVRvTW92ZS5wcmV2QWxsKCkubGVuZ3RoKTtcbiAgICAgICAgLy9kZS1zZWxlY3QgdGhlIHBpZWNlIHRvIGVuZCB0aGUgbW92ZVxuICAgICAgICAkc2VsZWN0ZWRQaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAvL3NldCB0aGUgbmV3IGxlZ2FsIG1vdmVzXG4gICAgICAgICQoJ2Rpdi5zcXVhcmUnKS5yZW1vdmVDbGFzcygnbW92YWJsZScpO1xuXG4gICAgICAgIC8vIFRFU1QuIHRlc3RpbmcgdGhlIHdpbm5pbmcgY29uZGl0aW9ucyBieSBjaGVja2luZyB0aGUgbnVtYmVyIG9mIHBpZWNlcyBsZWZ0IG9uIHRoZSBib2FyZFxuICAgICAgICBwaWVjZXNMZWZ0KCk7XG5cbiAgICAgICAgLy9pbmNyZW1lbnQgdGhlIG1vdmUgY291bnRlclxuICAgICAgICBpbmNyZW1lbnRNb3ZlQ291bnRlcigpO1xuXG4gICAgICAgIGxldCBjb2xvciA9ICcnO1xuICAgICAgICBpZiAoJHNlbGVjdGVkUGllY2UuaGFzQ2xhc3MoJ2xpZ2h0JykgPT09IHRydWUpIHtcbiAgICAgICAgICBjb2xvciA9ICdsaWdodCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29sb3IgPSAnZGFyayc7XG4gICAgICAgIH1cblxuICAgICAgICBpbmNyZW1lbnRNb3ZlQ291bnQoY29sb3IpO1xuXG4gICAgICAgIC8vcmVzZXQgdGhlIHNxdWFyZXMgdG8gYWxsb3cgbW92ZXNcbiAgICAgICAgcmVzZXRNb3ZhYmxlcygpO1xuXG4gICAgICB9XG5cbiAgICB9XG5cbiAgfSk7XG5cblxuLy8gTU9SRSBGVU5DVElPTlNcbi8vdGhpcyBmdW5jdGlvbiByZW1vdmVzIHRoZSBkYXRhIGl0ZW0gd2l0aCBrZXkgJ2p1bXBlZFBpZWNlcycgZnJvbSBldmVyeSBkaXYuc3F1YXJlXG4vLyBhbmQgcmVtb3ZlcyB0aGUgY2xhc3MgJ21vdmFibGUnIGZyb20gZXZlcnkgc3F1YXJlXG4gIGZ1bmN0aW9uIHJlc2V0TW92YWJsZXMoKSB7XG4gICAgJCgnZGl2LnNxdWFyZScpLnJlbW92ZURhdGEoJ2p1bXBlZFBpZWNlcycpLnJlbW92ZUNsYXNzKCdtb3ZhYmxlJyk7XG4gIH1cblxuICAvL2Z1bmN0aW9uIGZvciB0cmFuc2xhdGluZyBhbiB4LHkgY29vcmRpbmF0ZXMgdG8gYSBwaXhlbCBwb3NpdGlvblxuICAvL3RoZSBjb252ZW50aW9uIGlzIHRoYXQgdGhlIHNxdWFyZSBpbiB0aGUgdXBwZXIgbGVmdCBjb3JuZXIgaXMgYXQgcG9zaXRpb24gMCwwXG4gIC8vdGhlIHNxdWFyZSBpbiB0aGUgdXBwZXIgcmlnaHQsIGF0IDcsMCBhbmQgdGhlIGxvd2VyXG4gIC8vcmlnaHQgYXQgNyw3XG4gIGZ1bmN0aW9uIGdldFBpeGVscyh4LHkpIHtcbiAgICAgIC8vdGFrZXMgYW4geCx5IHBvc2l0aW9uLCByZXR1cm5zXG4gICAgICAvL3BpeGVscyBmcm9tIHRoZSBsZWZ0LCByaWdodFxuICAgIHJldHVybiB7XG4gICAgICAndG9wJzogKHkgKiAod2lkdGgrYm9yZGVyKSkrJ3B4JyxcbiAgICAgICdsZWZ0JzogKHggKiAod2lkdGgrYm9yZGVyKSkrJ3B4J1xuICAgIH07XG4gIH1cblxuICAvL2Z1bmN0aW9uIGZvciB0dXJuaW5nIGEgcGl4ZWwgcG9zaXRpb25cbiAgLy9pbnRvIHRoZSB4LHkgY29vcmRpbmF0ZSBvZiBhIHNxdWFyZSBvbiB0aGUgYm9hcmRcbiAgLy9pdCBmb2xsb3dzIHRoZSBzYW1lIGNvb3JkaW5hdGUgY29udmVudGlvbiBhcyBnZXRQaXhlbHNcbiAgZnVuY3Rpb24gZ2V0Q29vcmRzKHRvcCxsZWZ0KSB7XG4gICAgICAvL3JldHVybnMgYW4geCBhbmQgYSB5XG4gICAgICAvL2dpdmVuIGEgdG9wIGFuZCBsZWZ0IHBpeGVsc1xuICAgIHJldHVybiB7XG4gICAgICAneCc6IGxlZnQgLyAod2lkdGggKyBib3JkZXIpLFxuICAgICAgJ3knOiB0b3AgLyAod2lkdGggKyBib3JkZXIpXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHJldHVybmluZyB0aGUgc2V0IG9mIGxlZ2FsIG1vdmVzIGdpdmVuIGEgcGllY2Vcbi8vIHRoaXMgYWxzbyBzdG9yZXMganVtcGVkIHBpZWNlcyBpbiBhIGRhdGEgZWxlbWVudCBvZiBlYWNoIHNxdWFyZSB0aGF0IGNhbiBiZSBtb3ZlZCB0b1xuICBmdW5jdGlvbiBnZXRNb3ZhYmxlU3F1YXJlcygkcGllY2UpIHtcblxuICAgIC8vc2VsZWN0IGFsbCBvZiB0aGUgc3F1YXJlc1xuICAgIGNvbnN0ICRzcXVhcmVzID0gJCgnZGl2LnNxdWFyZScpO1xuXG4gICAgLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgICAvL21hcCBjcmVhdGVzIGEgbmV3IG9iamVjdCBmcm9tIGFuIGV4aXN0aW5nIG9uZVxuICAgIC8vdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAgIHZhciB0YWtlblNxdWFyZXMgPSB7fTtcbiAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG5cbiAgICAgICAgICAgIC8vdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGEgcGllY2VcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gJChwaWVjZSkucG9zaXRpb24oKTtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AscG9zaXRpb24ubGVmdCk7XG4gICAgICBjb25zdCBzcXVhcmVJbmRleCA9IGNvb3Jkcy55ICogOCArIGNvb3Jkcy54O1xuICAgICAgdGFrZW5TcXVhcmVzW3NxdWFyZUluZGV4XSA9ICQocGllY2UpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKCRwaWVjZS5wb3NpdGlvbigpLnRvcCwkcGllY2UucG9zaXRpb24oKS5sZWZ0KTtcblxuICAgIC8vbGlnaHRzIG1vdmUgZG93biB0aGUgYm9hcmRcbiAgICBjb25zdCBsaWdodERpcmVjdGlvbiA9IFtcbiAgICAgICAge3g6IDEseTogMX0sXG4gICAgICAgIHt4OiAtMSx5OiAxfVxuICAgIF07XG4gICAgLy9kYXJrcyBtb3ZlIHVwIHRoZSBib2FyZFxuICAgIGNvbnN0IGRhcmtEaXJlY3Rpb24gPSBbXG4gICAgICAgIHt4OiAxLHk6IC0xfSxcbiAgICAgICAge3g6IC0xLHk6IC0xfVxuICAgIF07XG4gICAgLy9raW5ncyBtb3ZlIGluIGFueSBkaXJlY3Rpb25cbiAgICBjb25zdCBraW5nRGlyZWN0aW9uID0gbGlnaHREaXJlY3Rpb24uY29uY2F0KGRhcmtEaXJlY3Rpb24pO1xuXG4gICAgbGV0IGRpcmVjdGlvbjtcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdraW5nJykpIHtcbiAgICAgIGRpcmVjdGlvbiA9IGtpbmdEaXJlY3Rpb247XG4gICAgfSBlbHNlIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2xpZ2h0JykpIHtcbiAgICAgIGRpcmVjdGlvbiA9IGxpZ2h0RGlyZWN0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXJlY3Rpb24gPSBkYXJrRGlyZWN0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0IG91dE9mQm91bmRzID0gZnVuY3Rpb24oY29vcmRzKSB7XG4gICAgICByZXR1cm4gIShjb29yZHMueCA+PSAwICYmIGNvb3Jkcy54IDwgOCAmJiBjb29yZHMueSA+PSAwICYmIGNvb3Jkcy55IDwgOCk7XG4gICAgfTtcblxuICAgIGxldCAkbGVnYWxTcXVhcmVzID0gJCgpO1xuICAgIGNvbnN0IGJ1aWxkTW92ZXMgPSBmdW5jdGlvbihjb29yZHMsZGlyZWN0aW9uLGp1bXBzT25seSkge1xuICAgICAgaWYgKG91dE9mQm91bmRzKGNvb3JkcykpIHJldHVybjtcbiAgICAgICAgLy9jdXJyZW50IHNxdWFyZSBpcyBhdCBjb29yZHNcbiAgICAgIGNvbnN0ICRjdXJyZW50U3F1YXJlID0gJHNxdWFyZXMuZXEoY29vcmRzLnkqOCArIGNvb3Jkcy54KTtcbiAgICAgICQuZWFjaChkaXJlY3Rpb24sZnVuY3Rpb24oaW5kZXgsZGlyZWN0aW9uKSB7XG5cbiAgICAgICAgY29uc3QgbmV3Q29vcmRzID0ge1xuICAgICAgICAgIHg6IGRpcmVjdGlvbi54ICsgY29vcmRzLngsXG4gICAgICAgICAgeTogZGlyZWN0aW9uLnkgKyBjb29yZHMueVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChvdXRPZkJvdW5kcyhuZXdDb29yZHMpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG5ld1NxdWFyZUluZGV4ID0gOCpuZXdDb29yZHMueSArIG5ld0Nvb3Jkcy54O1xuICAgICAgICAgICAgLy9pZiB0aGUgc3F1YXJlIGlzIHRha2VuLFxuICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XSkge1xuXG4gICAgICAgICAgICAgICAgLy9DYW4gb25seSBqdW1wIGlmIHBpZWNlIGlzIGRpZmZlcmVudFxuICAgICAgICAgIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2RhcmsnKSkge1xuICAgICAgICAgICAgaWYgKHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF0uaGFzQ2xhc3MoJ2RhcmsnKSkgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnbGlnaHQnKSkgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGp1bXBDb29yZHMgPSB7XG4gICAgICAgICAgICB4OiBkaXJlY3Rpb24ueCoyICsgY29vcmRzLngsXG4gICAgICAgICAgICB5OiBkaXJlY3Rpb24ueSoyICsgY29vcmRzLnlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvdXRPZkJvdW5kcyhqdW1wQ29vcmRzKSkgcmV0dXJuO1xuXG4gICAgICAgICAgY29uc3QganVtcFNxdWFyZUluZGV4ID0ganVtcENvb3Jkcy55KjggKyBqdW1wQ29vcmRzLng7XG4gICAgICAgICAgICAgICAgLy9pZiB0aGUganVtcCBzcXVhcmUgaXMgZnJlZS4uLlxuICAgICAgICAgICAgICAgIC8vYWRkIGl0IGFuZCB0aGUgZGF0YS1qdW1wZWQtcGllY2VzXG4gICAgICAgICAgaWYgKCF0YWtlblNxdWFyZXNbanVtcFNxdWFyZUluZGV4XSkge1xuICAgICAgICAgICAgY29uc3QgJG5ld1NxdWFyZSA9ICRzcXVhcmVzLmVxKGp1bXBTcXVhcmVJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIC8vaWYgd2UgaGF2ZW4ndCBhbHJlYWR5IHNlZW4gaXRcbiAgICAgICAgICAgIGlmICghJG5ld1NxdWFyZS5pcygkbGVnYWxTcXVhcmVzKSkge1xuXG4gICAgICAgICAgICAgIC8vYWRkIHRoZSBwYXNzZWQgb3ZlciBzcXVhcmUgdG8gaXRcbiAgICAgICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuXG4gICAgICAgICAgICAgIC8vYW5kIHRoZSBqdW1wZWQgc3F1YXJlcyBmcm9tIGhvdyB3ZSBnb3QgaGVyZVxuICAgICAgICAgICAgICBsZXQgJGp1bXBlZFBpZWNlcyA9IHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF07XG4gICAgICAgICAgICAgIGlmICgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSkge1xuICAgICAgICAgICAgICAgICRqdW1wZWRQaWVjZXMgPSAkanVtcGVkUGllY2VzLmFkZCgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCRqdW1wZWRQaWVjZXMpO1xuXG4gICAgICAgICAgICAgIC8vYW5kIHJlY3Vyc2UsIHdpdGgganVtcHNPbmx5IHNldCB0byB0cnVlXG4gICAgICAgICAgICAgIGJ1aWxkTW92ZXMoanVtcENvb3JkcyxkaXJlY3Rpb24sdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFqdW1wc09ubHkpIHtcbiAgICAgICAgICBjb25zdCAkbmV3U3F1YXJlID0gJHNxdWFyZXMuZXEobmV3U3F1YXJlSW5kZXgpO1xuICAgICAgICAgICRuZXdTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJywkKCkpO1xuICAgICAgICAgICRsZWdhbFNxdWFyZXMgPSAkbGVnYWxTcXVhcmVzLmFkZCgkbmV3U3F1YXJlKTtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcbiAgICB9O1xuICAgIGJ1aWxkTW92ZXMoY29vcmRzLGRpcmVjdGlvbixmYWxzZSk7XG4gICAgcmV0dXJuICRsZWdhbFNxdWFyZXM7XG5cbiAgfS8vZW5kIG9mIGdldE1vdmFibGVTcXVhcmVzXG5cbiAgZnVuY3Rpb24gc2V0VXBQaWVjZXMoKSB7XG4gICAgICAvL3NlbGVjdCBhbGwgdGhlIGRpdnMgd2l0aCBjbGFzcyAncGllY2UnXG4gICAgJCgncGllY2UnKTtcbi8vYWRkIHRoZSAnbGlnaHQnIGNsYXNzIHRvIGhhbGYgb2YgdGhlbVxuICAgICQoJ2Rpdi5waWVjZTpldmVuJykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4vL2pRdWVyeSdzIGV2ZW4gYW5kIG9kZCBzZWxlY3RvciBtZXRob2RzIHRvIGFzc2lnbiB0aGUgY2xhc3NlcyAubGlnaHQgYW5kIC5kYXJrLlxuLy9hZGQgdGhlICdkYXJrJyB0byB0aGUgb3RoZXIgaGFsZlxuICAgICQoJ2Rpdi5waWVjZTpvZGQnKS5hZGRDbGFzcygnZGFyaycpO1xuICB9XG5cbiAgLy9hY3R1YWxseSBtb3ZpbmcgdGhlIHBpZWNlXG4gIGZ1bmN0aW9uIG1vdmVQaWVjZVRvKCRwaWVjZSxuZXdUb3AsbmV3TGVmdCkge1xuICAgICAgLy9zZXQgdGhlIGNzcyAndG9wJyBhbmQgJ2xlZnQnXG4gICAgICAvL2F0dHJpYnV0ZXMgb2YgdGhlIHBhc3NlZCBwaWVjZVxuICAgICAgLy90byB0aGUgYXJndW1lbnRzIG5ld1RvcCBhbmQgbmV3TGVmdFxuICAgICRwaWVjZS5jc3MoJ3RvcCcsIG5ld1RvcCk7XG4gICAgJHBpZWNlLmNzcygnbGVmdCcsIG5ld0xlZnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0VXBCb2FyZCgpIHtcblxuICAgIC8vQ3JlYXRpbmcgdGhlIDY0IHNxdWFyZXMgYW5kIGFkZGluZyB0aGVtIHRvIHRoZSBET01cbiAgICBjb25zdCBzcXVhcmVDb3VudCA9IDgqODsgLy84IHJvd3MgYnkgOCBjb2x1bW5zOyB6ZXJvIGJhc2VkIGluZGV4XG4gICAgZm9yIChsZXQgaSA9IDA7aTxzcXVhcmVDb3VudDtpKyspIHtcbiAgICAvL3RoaXMgbGluZSBjcmVhdGVzIGEgbmV3IGRpdiB3aXRoIHRoZSBjbGFzcyAnc3F1YXJlJ1xuICAgIC8vYW5kIGFwcGVuZHMgaXQgdG8gdGhlIGRpdiB3aXRoIGlkICdib2FyZCdcbiAgICAgICRib2FyZC5hcHBlbmQoJCgnPGRpdi8+JykuYWRkQ2xhc3MoJ3NxdWFyZScpKTtcbiAgICB9XG5cbiAgICAvL2NyZWF0aW5nIHRoZSAyNCBwaWVjZXMgYW5kIGFkZGluZyB0aGVtIHRvIHRoZSBET01cbiAgICBjb25zdCBwaWVjZUNvdW50ID0gMjQ7XG5cbiAgICBmb3IgKGxldCBpPTA7aTxwaWVjZUNvdW50O2krKykge1xuICAgICAgLy90aGlzIGxpbmUgYXBwZW5kcyBhbiBlbXB0eSBkaXYgd2l0aCB0aGUgY2xhc3MgJ3BpZWNlJyB0byB0aGUgZGl2IHdpdGggaWQgJ3BpZWNlcydcbiAgICAgICRwaWVjZXMuYXBwZW5kKCQoJzxkaXYvPicpLmFkZENsYXNzKCdwaWVjZScpKTtcbiAgICB9XG4gICAgICAvL2l0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGRpdnMgd2l0aCBjbGFzcyBgc3F1YXJlYFxuICAgICAgLy9maWd1cmUgb3V0IHdoZXRoZXIgZWFjaCBvbmUgc2hvdWxkIGJlXG4gICAgICAvL2xpZ2h0IG9yIGRhcmssIGFuZCBhc3NpZ24gdGhlIHByb3BlciBjbGFzc1xuICAgIGNvbnN0ICRlYWNoU3F1YXJlID0gJCgnZGl2LnNxdWFyZScpO1xuICAgICRlYWNoU3F1YXJlLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xuICAgICAgaWYobGlnaHRPckRhcmsoaW5kZXgpPT09IDApe1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdsaWdodCcpO1xuICAgICAgfWVsc2V7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2RhcmsnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAgIC8vaW5uZXIgaGVscGVyIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBudW1iZXIgYmV0d2VlblxuICAgICAgLy8wIGFuZCA2MyAoaW5jbHVzaXZlKSBhbmQgcmV0dXJucyAxIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlXG4gICAgICAvL2RhcmssIGFuZCAwIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlIGxpZ2h0XG4gICAgZnVuY3Rpb24gbGlnaHRPckRhcmsoaW5kZXgpIHtcbiAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgY29uc3Qgb2RkWCA9IHggJSAyO1xuICAgICAgY29uc3Qgb2RkWSA9IHkgJSAyO1xuICAgICAgcmV0dXJuIChvZGRYIF4gb2RkWSk7XG4gICAgfVxuXG4gIH0vL2VuZCBvZiBzZXRVcEJvYXJkKClcblxuICBmdW5jdGlvbiB0b2dnbGVTZWxlY3QoJHBpZWNlKSB7XG4gICAgICAvL2lmICRwaWVjZSBoYXMgdGhlIGNsYXNzICdzZWxlY3RlZCcscmVtb3ZlIGl0XG4gICAgICAvL2lmICRwaWVjZSBkb2VzIG5vdCBoYXZlIHRoZSBjbGFzcyAnc2VsZWN0ZWQnXG4gICAgICAvL21ha2Ugc3VyZSBubyBvdGhlciBkaXZzIHdpdGggdGhlIGNsYXNzICdwaWVjZSdcbiAgICAgIC8vaGF2ZSB0aGF0IGNsYXNzLCB0aGVuIHNldCAkcGllY2UgdG8gaGF2ZSB0aGUgY2xhc3NcbiAgICBpZigkcGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAkcGllY2UucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgZWxzZSB7XG4gICAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAgIGlmKCQocGllY2UpLmhhc0NsYXNzKCdzZWxlY3RlZCcpKVxuICAgICAgICAgICQocGllY2UpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgfSk7XG4gICAgICAkcGllY2UuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgfVxuXG4gIH0vL2VuZCBvZiB0b2dnbGVTZWxlY3QgZnVuY3Rpb25cblxuICBjb25zdCAkbW92ZUNvdW50ZXIgPSAkKCcjbW92ZUNvdW50ZXInKTtcbiAgZnVuY3Rpb24gaW5jcmVtZW50TW92ZUNvdW50ZXIoKSB7XG4gICAgICAvL2dldHMgdGhlIGh0bWwgb2YgdGhlIHNwYW4gd2l0aCBpZCBtb3ZlQ291bnRlciB0dXJucyBpdCBpbnRvIGEgbnVtYmVyXG4gICAgICAvL2luY3JlbWVudHMgaXQgYnkgb25lXG4gICAgICAvL3NldHMgdGhlIGh0bWwgb2YgdGhlIHNwYW4gd2l0aCBpZCBtb3ZlQ291bnRlclxuICAgICAgLy90byB0aGUgbmV3IG1vdmUgY291bnRcbiAgICAkbW92ZUNvdW50ZXIuaHRtbChwYXJzZUludCgkbW92ZUNvdW50ZXIuaHRtbCgpKSsxKTtcblxuICB9XG5cbiAgLy8gVEVTVCBwaWVjZVNlbGVjdCgpXG4gIGxldCBwaWVjZVNlbGVjdEVuYWJsZWQgPSB0cnVlOyAvL3RydWUgaXMgc3dpdGNoZWQgb24gc3RhdGVcbiAgcGllY2VTZWxlY3QoKTsvLyBwbGF5ZXIgdG8gc2VsZWN0IGEgcGllY2VcbiAgLy8gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyXG4gICAgLy90aGlzIGZ1bmN0aW9uIGFsbG93cyB0aGUgcGxheWVycyB0byBiZSBjaGFuZ2VkLlxuICBmdW5jdGlvbiBpbmNyZW1lbnRNb3ZlQ291bnQoY29sb3IpIHtcbiAgICAgIC8vZ2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIGxpZ2h0TW92ZUNvdW50IG9yIGRhcmtNb3ZlQ291bnRcbiAgICAgIC8vdHVybnMgaXQgaW50byBhIG51bWJlciBpbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbGlnaHRNb3ZlQ291bnQgb3IgZGFya01vdmVDb3VudCB0byB0aGUgbmV3IG1vdmUgY291bnRcbiAgICBsZXQgd2hpY2hDb3VudGVyID0gJyc7XG4gICAgY29sb3IgPT09ICdsaWdodCcgPyB3aGljaENvdW50ZXIgPSAnI2xpZ2h0TW92ZUNvdW50JyA6IHdoaWNoQ291bnRlciA9ICcjZGFya01vdmVDb3VudCc7XG4gICAgbGV0ICRtb3ZlcyA9IHBhcnNlSW50KCQod2hpY2hDb3VudGVyKS5odG1sKCkpO1xuICAgICRtb3ZlcysrO1xuXG4gICAgJCh3aGljaENvdW50ZXIpLmh0bWwoJG1vdmVzKTtcbiAgICBjb25zb2xlLmxvZygkbW92ZXMpO1xuICAgIC8vaWYgdGhlIG51bWJlciBpcyBldmVuIHRoZW4gaXQncyBsaWdodCdzIG1vdmUgYW5kIG9kZCBpdCdzIGRhcmsncyBtb3ZlLlxuICAgIGlmICgkbW92ZXMgJSAyICA9PT0gMSkge1xuICAgICAgY29uc29sZS5sb2coYEhlbGxvIG9kZCBudW1iZXJgKTtcbiAgICAgIGNvbnNvbGUubG9nKCRkYXJrUGllY2VzKTtcbiAgICB9IGVsc2UgaWYoJG1vdmVzICUgMiA9PT0gMCl7XG4gICAgICBjb25zb2xlLmxvZyhgSGVsbG8gZXZlbiBudW1iZXJgKTtcbiAgICAgIGNvbnNvbGUubG9nKCRsaWdodFBpZWNlcyk7XG4gICAgfVxuICB9Ly9lbmQgb2YgaW5jcmVtZW50TW92ZUNvdW50KClcblxuICAvL1BMQVlFUiBPTkUgQU5EIFBMQVlFUiBUV09cbiAgLy9JZiB0aGUgbW92ZSBjb3VudCBpcyBldmVuLCB0aGVuIHBsYXllciBvbmUncyB0dXJuIG90aGVyd2lzZSBwbGF5ZXIgdHdvJ3MgdHVyblxuICBjb25zdCAkbGlnaHRQaWVjZXMgPSAkKCdkaXYucGllY2UubGlnaHQnKTtcbiAgY29uc3QgJGRhcmtQaWVjZXMgPSAkKCdkaXYucGllY2UuZGFyaycpO1xuXG4vLyB0aGlzIGZ1bmN0aW9uIGdldHMgdGhlIGpRdWVyeSBvYmplY3Qgc3RvcmVkIGluXG4vLyB0aGUgZGF0YSBvYmplY3Qgb2YgJHNxdWFyZSB1bmRlciB0aGUga2V5ICdqdW1wZWRQaWVjZXMnXG4vLyBhbmQgcmVtb3ZlcyBldmVyeSBlbGVtZW50IGluIHRoYXQgalF1ZXJ5IHNlbGVjdGlvblxuICBmdW5jdGlvbiByZW1vdmVDYXB0dXJlZFBpZWNlcygkc3F1YXJlKSB7XG4gICAgJHNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKS5yZW1vdmUoKTtcbiAgfVxuXG4vLyBUaGlzIGZ1bmN0aW9uIHRha2VzIGEgJHBpZWNlIGFuZCB0aGUgaW5kZXggb2YgYSBzcXVhcmVcbi8vc3F1YXJlSW5kZXggd2lsbCBiZSBiZXR3ZWVuIDAgLSA2MyAoaW5jbHVzaXZlKS5cbi8vIGlmIHRoZSBpbmRleCByZWZlcnMgdG8gYW4gZWxlbWVudCBpbiB0aGUgZmlyc3Qgcm93IG9yIGxhc3Qgcm93LFxuLy8gdGhlIGNsYXNzICdraW5nJyBzaG91bGQgYmUgYWRkZWQgdG8gdGhlICRwaWVjZVxuICBmdW5jdGlvbiBjaGVja0tpbmcoJHBpZWNlLHNxdWFyZUluZGV4KSB7XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IDY0OyBpKyspe1xuICAgICAgaWYgKHNxdWFyZUluZGV4IDwgOCB8fCBzcXVhcmVJbmRleCA+PSA1Nil7XG4gICAgICAgICRwaWVjZS5hZGRDbGFzcygna2luZycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG5cblxuXG5cbi8vd2lubmluZyBjb25kaXRpb25zOiBJZiBvbmUgcGxheWVyIG9ubHkgaGFzIHRoZWlyIHBpZWNlcyBvbiB0aGUgYm9hcmQgbGVmdFxuLy90aGV5IHdpbi5cbiAgZnVuY3Rpb24gcGllY2VzTGVmdCgpe1xuICAgIGNvbnN0IGRhcmtQaWVjZXMgPSAkZGFya1BpZWNlcy5sZW5ndGg7XG4gICAgY29uc3QgbGlnaHRQaWVjZXMgPSAkbGlnaHRQaWVjZXMubGVuZ3RoO1xuICAgIGlmIChkYXJrUGllY2VzID09PSAwKSB7XG4gICAgICByZXR1cm4gY29uc29sZS5sb2coYFBsYXllciAxIHdpbnNgKTtcbiAgICB9IGVsc2UgaWYobGlnaHRQaWVjZXMgPT09IDApIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhgUGxheWVyIDIgd2luc2ApO1xuICAgIH0gZWxzZSBpZiAobGlnaHRQaWVjZXMgPT09IDEgJiYgZGFya1BpZWNlcyA9PT0gMSl7Ly9hbmQgNDAgbW92ZXMgYXJlIHBsYXllZCBhZnRlcndhcmRzXG4gICAgICAvL3lldCB0byBjb2RlIHRoaXMgZnVuY3Rpb25cbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhgSXQncyBhIGRyYXdgKTtcbiAgICB9XG4gIH1cblxuICAvL3Jlc2V0dGluZyB0aGUgZ2FtZS5cbiAgJHJlc2V0QnV0dG9uLm9uKCdjbGljaycsICgpPT57XG4gICAgcmVzZXQoKTtcbiAgICAvLyBzZXR0aW5nIHVwIHRoZSBwaWVjZXMgYWZ0ZXIgZW1wdHlpbmcgdGhlbS5cbiAgfSk7XG5cbiAgLy90aGlzIHJlc2V0cyB0aGUgZ2FtZSBieSBlZmZlY3RpdmVseSByZWxvYWRpbmcgdGhlIHBhZ2UgZnJvbSBjYWNoZVxuICBmdW5jdGlvbiByZXNldCgpe1xuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICB9XG5cbn0pOy8vZW5kIG9mIEpTIGxvYWRcblxuXG4vKlxuXG5UT0RPOlxuMS4gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyXG4yLiBSZXNldCB0aGUgZ2FtZSBieSBwdXR0aW5nIHRoZSBwaWVjZXMgdG8gdGhlIG9yaWdpbmFsIHBvc2l0aW9uXG4zLiBXaW4gY29uZGl0aW9ucywgaWYgZWl0aGVyIHBsYXllciBoYXMgcGllY2VzIGxlZnQgb24gdGhlIGJvYXJkIHdoaWxlIHRoZSBvdGhlciBkb2Vzbid0XG4gIHRoZW4gaXQncyBhIHdpbi5cbjQuXG5cblxuKi9cbiJdfQ==
