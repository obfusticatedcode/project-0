"use strict";$(function(){function e(){var e=$(event.target).position();return h=i(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(l+v)+"px",left:e*(l+v)+"px"}}function i(e,a){return{x:a/(l+v),y:e/(l+v)}}function s(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var s=$(a).position(),n=i(s.top,s.left),o=8*n.y+n.x;t[o]=$(a)});var s=i(e.position().top,e.position().left),n=[{x:1,y:1},{x:-1,y:1}],o=[{x:1,y:-1},{x:-1,y:-1}],r=n.concat(o),d=void 0;d=e.hasClass("king")?r:e.hasClass("light")?n:o;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},l=$();return function i(s,n,o){if(!c(s)){var r=a.eq(8*s.y+s.x);$.each(n,function(d,v){var f={x:v.x+s.x,y:v.y+s.y};if(!c(f)){var u=8*f.y+f.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var p={x:2*v.x+s.x,y:2*v.y+s.y};if(c(p))return;var h=8*p.y+p.x;if(!t[h]){var C=a.eq(h);if(!C.is(l)){l=l.add(C);var m=t[u];r.data("jumpedPieces")&&(m=m.add(r.data("jumpedPieces"))),C.data("jumpedPieces",m),i(p,n,!0)}}}else if(!o){var x=a.eq(u);x.data("jumpedPieces",$()),l=l.add(x)}}})}}(s,d,!1),l}function n(e,a,t){e.css("top",a),e.css("left",t)}function o(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function r(){$("#moveCounter").html(parseInt($("#moveCounter").html(),10)+1)}function d(e){e.data("jumpedPieces").remove()}function c(){location.reload()}for(var l=46,v=2,f=$("div#board"),u=$("div#pieces"),p=$("#reset-button"),h=null,C=0;C<64;C++)f.append($("<div/>").addClass("square"));!function(){function e(e){return e%8%2^Math.floor(e/8)%2}$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}();for(var m=0;m<24;m++)u.append($("<div/>").addClass("piece"));!function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),$("div.piece.light").each(function(e,a){var i=Math.floor(e/4),s=e%4*2+(1-i%2),o=t(s,i);n($(a),o.top,o.left)}),$("div.piece.dark").each(function(e,a){var i=Math.floor(e/4)+5,s=e%4*2+(1-i%2),o=t(s,i);n($(a),o.top,o.left)}),p.on("click",function(){c()}),$("div.piece").on("click",function(e){var t=$(e.target);o(t),a(),t.hasClass("selected")&&s(t).addClass("movable")}),$("div.square").on("click",function(i){e();var s=$(i.target);if(s.hasClass("movable")){var o=$("div.piece.selected");if(1===o.length){var c=s.prevAll().length,l=c%8,v=Math.floor(c/8),f=t(l,v);n(o,f.top,f.left),d(s),r(),o.removeClass("selected"),$("div.square").removeClass("movable"),a()}}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiY3VycmVudFBvc2l0aW9uIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsImNvb3JkcyIsImdldENvb3JkcyIsInRvcCIsImxlZnQiLCJyZXNldE1vdmFibGVzIiwicmVtb3ZlRGF0YSIsInJlbW92ZUNsYXNzIiwiZ2V0UGl4ZWxzIiwieCIsInkiLCJ3aWR0aCIsImJvcmRlciIsIiRzcXVhcmVzIiwiJHBpZWNlIiwidGFrZW5TcXVhcmVzIiwic3F1YXJlSW5kZXgiLCJsaWdodFZlY3RvcnMiLCJwaWVjZSIsImtpbmdWZWN0b3JzIiwiY29uY2F0IiwiZGFya1ZlY3RvcnMiLCJ2ZWN0b3JzIiwiaGFzQ2xhc3MiLCIkbGVnYWxTcXVhcmVzIiwib3V0T2ZCb3VuZHMiLCJuZXdDb29yZHMiLCJ2ZWN0b3IiLCJuZXdTcXVhcmVJbmRleCIsImJ1aWxkTW92ZXMiLCJqdW1wc09ubHkiLCIkY3VycmVudFNxdWFyZSIsImVxIiwiZWFjaCIsImp1bXBDb29yZHMiLCJpbmRleCIsImp1bXBTcXVhcmVJbmRleCIsIiRuZXdTcXVhcmUiLCJhZGQiLCIkanVtcGVkUGllY2VzIiwiZGF0YSIsIm5ld1RvcCIsIm5ld0xlZnQiLCJvZGRYIiwiY3NzIiwidG9nZ2xlU2VsZWN0IiwiYWRkQ2xhc3MiLCJpbmNyZW1lbnRtb3ZlQ291bnRlciIsImh0bWwiLCJwYXJzZUludCIsInJlbW92ZUNhcHR1cmVkUGllY2VzIiwiJHNxdWFyZSIsInJlbW92ZSIsInJlc2V0IiwibG9jYXRpb24iLCJyZWxvYWQiLCJzcXVhcmVDb3VudCIsIiRib2FyZCIsIiRwaWVjZXMiLCJpIiwiYXBwZW5kIiwibGlnaHRPckRhcmsiLCJNYXRoIiwiZmxvb3IiLCJ0aGlzIiwicGl4ZWxQb3NpdGlvbiIsIm1vdmVQaWVjZVRvIiwib24iLCJnZXRNb3ZhYmxlU3F1YXJlcyIsIiR0aGlzUGllY2UiLCJlIiwiJHNlbGVjdGVkUGllY2UiLCIkcGllY2VUb01vdmUiLCJsZW5n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QUMsRUFBQUMsRUFMSndELEdBQVlLLEVBQWVHLEVBQU92RSxJQUFJdUUsRUFBT3RFLE1BUzdDUixFQUFnQlcsR0FFaEJ3QyxJQUdId0IsRUFBQWhFLFlBQUEsWUFLSFgsRUFBQSxjQUFBVyxZQUFBLFdBQ0FGIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vbG9hZGluZyBKU1xuJCgoKT0+e1xuXG4gIC8vR0xPQkFMIFZBUklBQkxFU1xuICBjb25zdCB3aWR0aCA9IDQ2O1xuICBjb25zdCBib3JkZXIgPSAyO1xuICBjb25zdCAkYm9hcmQgPSAkKCdkaXYjYm9hcmQnKTtcbiAgY29uc3QgJHBpZWNlcyA9ICQoJ2RpdiNwaWVjZXMnKTtcbiAgY29uc3QgJHJlc2V0QnV0dG9uID0gJCgnI3Jlc2V0LWJ1dHRvbicpO1xuICBsZXQgY29vcmRzID0gbnVsbDsvL3NldHRpbmcgY29vcmRzIGdsb2JhbGx5IHNvIGNvbnN0YW50bHkgdXBkYXRpbmdcblxuXG5cbiAgLy9DcmVhdGluZyB0aGUgNjQgc3F1YXJlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICBjb25zdCBzcXVhcmVDb3VudCA9IDgqODsgLy84IHJvd3MgYnkgOCBjb2x1bW5zOyB6ZXJvIGJhc2VkIGluZGV4XG4gIGZvciAobGV0IGkgPSAwO2k8c3F1YXJlQ291bnQ7aSsrKSB7XG5cbiAgLy90aGlzIGxpbmUgY3JlYXRlcyBhIG5ldyBkaXYgd2l0aCB0aGUgY2xhc3MgJ3NxdWFyZSdcbiAgLy9hbmQgYXBwZW5kcyBpdCB0byB0aGUgZGl2IHdpdGggaWQgJ2JvYXJkJ1xuICAgICRib2FyZC5hcHBlbmQoJCgnPGRpdi8+JykuYWRkQ2xhc3MoJ3NxdWFyZScpKTtcbiAgfVxuXG5cbiAgLy9zZXQgdXAgdGhlIGJvYXJkIHdpdGggdGhlIGNvcnJlY3QgY2xhc3NlcyBmb3IgdGhlIGxpZ2h0IGFuZCBkYXJrIHNxdWFyZXNcbiAgc2V0VXBCb2FyZCgpO1xuXG5cbiAgICAgIC8vY3JlYXRpbmcgdGhlIDI0IHBpZWNlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICBjb25zdCBwaWVjZUNvdW50ID0gMjQ7XG4gIGZvciAobGV0IGk9MDtpPHBpZWNlQ291bnQ7aSsrKSB7XG5cbiAgICAvL3RoaXMgbGluZSBhcHBlbmRzIGFuIGVtcHR5IGRpdiB3aXRoIHRoZSBjbGFzcyAncGllY2UnIHRvIHRoZSBkaXYgd2l0aCBpZCAncGllY2VzJ1xuICAgICRwaWVjZXMuYXBwZW5kKCQoJzxkaXYvPicpLmFkZENsYXNzKCdwaWVjZScpKTtcblxuICB9XG5cblxuICAvL3NldHMgdXAgdGhlIGNsYXNzZXMgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgcGllY2VcbiAgc2V0VXBQaWVjZXMoKTtcblxuLy9MSUdIVCBQSUVDRVNcbiAgLy90aGlzIGxvb3AgbW92ZXMgYWxsIHRoZSBsaWdodCBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgJCgnZGl2LnBpZWNlLmxpZ2h0JykuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuXG4gICAgLy90dXJuaW5nIHRoZSBpbmRleCAoZnJvbSAwIC0gMTEpXG4gICAgLy9pbnRvIGEgeCx5IHNxdWFyZSBjb29yZGluYXRlIHVzaW5nIG1hdGhcbiAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDQpO1xuICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHklMik7XG5cbiAgICAvL3R1cm5pbmcgdGhlIHgseSBjb29yZGluZ2F0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgLy9hY3R1YWxseSBtb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgbW92ZVBpZWNlVG8oJChwaWVjZSkscGl4ZWxQb3NpdGlvbi50b3AscGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgfSk7XG5cbi8vREFSSyBQSUVDRVNcbiAgICAvL3RoaXMgbG9vcCBtb3ZlcyBhbGwgdGhlIGRhcmsgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICQoJ2Rpdi5waWVjZS5kYXJrJykuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgIC8vaW50byBhIHgseSBzcXVhcmUgY29vcmRpbmF0ZSB1c2luZyBtYXRoXG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXgvNCkgKyA1O1xuICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMS15JTIpO1xuXG4gICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmF0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgLy9tb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgbW92ZVBpZWNlVG8oJChwaWVjZSkscGl4ZWxQb3NpdGlvbi50b3AscGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgfSk7XG5cblxuICAvL0VWRU5UU1xuXG4gICAgLy9yZXNldHRpbmcgdGhlIGdhbWUuXG4gICRyZXNldEJ1dHRvbi5vbignY2xpY2snLCAoKT0+e1xuICAgIHJlc2V0KCk7XG4gIH0pO1xuXG4gICQoJ2Rpdi5waWVjZScpLm9uKCdjbGljaycsKGV2ZW50KT0+e1xuICAgIC8vdHVybiBgdGhpc2AgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICBjb25zdCAkdGhpc1BpZWNlID0gJChldmVudC50YXJnZXQpO1xuICAgIC8vdG9nZ2xpbmcgdGhlICdzZWxlY3RlZCcgY2xhc3Mgb2YgdGhpcyBwaWVjZVxuICAgIC8vYW5kIHBvc3NpYmxlIGRlc2VsZWN0aW5nIG90aGVyIHBpZWNlc1xuICAgIHRvZ2dsZVNlbGVjdCgkdGhpc1BpZWNlKTtcbiAgICByZXNldE1vdmFibGVzKCk7XG4gICAgLy9nZXQgdGhlIGxlZ2FsIG1vdmVzIGZvciB0aGlzXG4gICAgaWYgKCR0aGlzUGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpIHtcbiAgICAgIGdldE1vdmFibGVTcXVhcmVzKCR0aGlzUGllY2UpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG4gICAgfVxuXG4gIH0pOy8vZW5kIG9mIHBpZWNlIGNsaWNrIGV2ZW50XG5cbiAgLy9jaGVja3MgdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgY2xpY2tlZCBvciBzZWxlY3RlZCBkaXYgYW5kIHJldHVybnMgdGhlIGNvb3Jkcy5cbiAgZnVuY3Rpb24gY3VycmVudFBvc2l0aW9uKCl7XG4gICAgY29uc3QgcG9zaXRpb24gPSAkKGV2ZW50LnRhcmdldCkucG9zaXRpb24oKTtcbiAgICBjb29yZHMgPSBnZXRDb29yZHMocG9zaXRpb24udG9wLHBvc2l0aW9uLmxlZnQpO1xuICAgIC8vIGNvbnNvbGUubG9nKGNvb3Jkcyk7Ly9nZXR0aW5nIHRoZSBsb2NhdGlvbiBvZiB0aGUgcGllY2VcbiAgICByZXR1cm4gY29vcmRzO1xuXG4gIH1cblxuICAkKCdkaXYuc3F1YXJlJykub24oJ2NsaWNrJywgKGUpPT57XG4gICAgY3VycmVudFBvc2l0aW9uKCk7Ly90aGUgY3VycmVudFBvc2l0aW9uIG9mIHRoZSBzcXVhcmU7IGNvb3Jkc1xuICAgIC8vIGNvbnNvbGUubG9nKCdjb29yZHMnLCBjb29yZHMpO1xuICAgIC8vdHVybiBgZSBvciBldmVudGAgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICBjb25zdCAkcGllY2VUb01vdmUgPSAkKGUudGFyZ2V0KTtcblxuXG4gICAgLy9pZiAkdGhpcyBpcyBhIGxlZ2FsIHNxdWFyZSB0byBtb3ZlIHRvLi4uXG4gICAgaWYgKCRwaWVjZVRvTW92ZS5oYXNDbGFzcygnbW92YWJsZScpKSB7XG5cbiAgICAgICAgICAvL2dldCB0aGUgcGllY2Ugd2l0aCB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgICAgY29uc3QgJHNlbGVjdGVkUGllY2UgPSAkKCdkaXYucGllY2Uuc2VsZWN0ZWQnKTtcblxuICAgICAgICAgIC8vb25seSBtb3ZlIGlmIHRoZXJlIGlzIGV4YWN0bHkgb25lIHNlbGVjdGVkIHBpZWNlXG4gICAgICBpZiAoJHNlbGVjdGVkUGllY2UubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvL2dldCB0aGUgaW5kZXggb2YgdGhlIHNxdWFyZVxuICAgICAgICAgICAgLy9hbmQgdHJhbnNsYXRlIGl0IHRvIHBpeGVsIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IGluZGV4ID0gJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IGdldFBpeGVscyh4LHkpO1xuICAgICAgICAgICAgLy9hY3R1YWxseSBkbyB0aGUgbW92aW5nXG4gICAgICAgIG1vdmVQaWVjZVRvKCRzZWxlY3RlZFBpZWNlLHBpeGVscy50b3AscGl4ZWxzLmxlZnQpO1xuICAgICAgICAgIC8vcmVtb3ZlQ2FwdHVyZWRQaWVjZXNcbiAgICAgICAgcmVtb3ZlQ2FwdHVyZWRQaWVjZXMoJHBpZWNlVG9Nb3ZlKTsgXG4gICAgICAgICAgICAvL2luY3JlbWVudCB0aGUgbW92ZSBjb3VudGVyXG4gICAgICAgIGluY3JlbWVudG1vdmVDb3VudGVyKCk7XG4gICAgICAgICAgICAvL3VuLXNlbGVjdCB0aGUgcGllY2VcbiAgICAgICAgJHNlbGVjdGVkUGllY2UucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cbiAgICAgICAgICAgIC8vc2V0IHRoZSBuZXcgbGVnYWwgbW92ZXNcbiAgICAgICAgJCgnZGl2LnNxdWFyZScpLnJlbW92ZUNsYXNzKCdtb3ZhYmxlJyk7XG4gICAgICAgIHJlc2V0TW92YWJsZXMoKTtcbiAgICAgICAgLy8gZ2V0TW92YWJsZVNxdWFyZXMoKS5hZGRDbGFzcygnbW92YWJsZScpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gIH0pO1xuXG5cbiAgLy8gTU9SRSBGVU5DVElPTlNcbiAgLy90aGlzIGZ1bmN0aW9uIHJlbW92ZXMgdGhlIGRhdGEgaXRlbSB3aXRoIGtleSAnanVtcGVkUGllY2VzJyBmcm9tIGV2ZXJ5IGRpdi5zcXVhcmVcbi8vIGFuZCByZW1vdmVzIHRoZSBjbGFzcyAnbW92YWJsZScgZnJvbSBldmVyeSBzcXVhcmVcbiAgZnVuY3Rpb24gcmVzZXRNb3ZhYmxlcygpIHtcbiAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlRGF0YSgnanVtcGVkUGllY2VzJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHRyYW5zbGF0aW5nIGFuIHgseSBjb29yZGluYXRlcyB0byBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vdGhlIGNvbnZlbnRpb24gaXMgdGhhdCB0aGUgc3F1YXJlIGluIHRoZSB1cHBlciBsZWZ0IGNvcm5lciBpcyBhdCBwb3NpdGlvbiAwLDBcbiAgLy90aGUgc3F1YXJlIGluIHRoZSB1cHBlciByaWdodCwgYXQgNywwIGFuZCB0aGUgbG93ZXJcbiAgLy9yaWdodCBhdCA3LDdcbiAgZnVuY3Rpb24gZ2V0UGl4ZWxzKHgseSkge1xuICAgICAgLy90YWtlcyBhbiB4LHkgcG9zaXRpb24sIHJldHVybnNcbiAgICAgIC8vcGl4ZWxzIGZyb20gdGhlIGxlZnQsIHJpZ2h0XG4gICAgcmV0dXJuIHtcbiAgICAgICd0b3AnOiAoeSAqICh3aWR0aCtib3JkZXIpKSsncHgnLFxuICAgICAgJ2xlZnQnOiAoeCAqICh3aWR0aCtib3JkZXIpKSsncHgnXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHR1cm5pbmcgYSBwaXhlbCBwb3NpdGlvblxuICAvL2ludG8gdGhlIHgseSBjb29yZGluYXRlIG9mIGEgc3F1YXJlIG9uIHRoZSBib2FyZFxuICAvL2l0IGZvbGxvd3MgdGhlIHNhbWUgY29vcmRpbmF0ZSBjb252ZW50aW9uIGFzIGdldFBpeGVsc1xuICBmdW5jdGlvbiBnZXRDb29yZHModG9wLGxlZnQpIHtcbiAgICAgIC8vcmV0dXJucyBhbiB4IGFuZCBhIHlcbiAgICAgIC8vZ2l2ZW4gYSB0b3AgYW5kIGxlZnQgcGl4ZWxzXG4gICAgcmV0dXJuIHtcbiAgICAgICd4JzogbGVmdCAvICh3aWR0aCArIGJvcmRlciksXG4gICAgICAneSc6IHRvcCAvICh3aWR0aCArIGJvcmRlcilcbiAgICB9O1xuICB9XG5cblxuXG4gIC8vZnVuY3Rpb24gZm9yIHJldHVybmluZ1xuLy90aGUgc2V0IG9mIGxlZ2FsIG1vdmVzIGdpdmVuIGEgcGllY2Vcbi8vIHRoaXMgYWxzbyBzdG9yZXMganVtcGVkIHBpZWNlcyBpbiBhIGRhdGEgZWxlbWVudCBvZiBlYWNoIHNxdWFyZSB0aGF0IGNhbiBiZSBtb3ZlZCB0b1xuICBmdW5jdGlvbiBnZXRNb3ZhYmxlU3F1YXJlcygkcGllY2UpIHtcblxuICAgIC8vc2VsZWN0IGFsbCBvZiB0aGUgc3F1YXJlc1xuICAgIGNvbnN0ICRzcXVhcmVzID0gJCgnZGl2LnNxdWFyZScpO1xuXG4gICAgLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgICAvL21hcCBjcmVhdGVzIGEgbmV3IG9iamVjdCBmcm9tIGFuIGV4aXN0aW5nIG9uZVxuICAgIC8vdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAgIHZhciB0YWtlblNxdWFyZXMgPSB7fTtcbiAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG5cbiAgICAgICAgICAgIC8vdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGEgcGllY2VcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gJChwaWVjZSkucG9zaXRpb24oKTtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AscG9zaXRpb24ubGVmdCk7XG4gICAgICBjb25zdCBzcXVhcmVJbmRleCA9IGNvb3Jkcy55ICogOCArIGNvb3Jkcy54O1xuICAgICAgdGFrZW5TcXVhcmVzW3NxdWFyZUluZGV4XSA9ICQocGllY2UpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKCRwaWVjZS5wb3NpdGlvbigpLnRvcCwkcGllY2UucG9zaXRpb24oKS5sZWZ0KTtcblxuICAgIC8vbGlnaHRzIG1vdmUgZG93blxuICAgIGNvbnN0IGxpZ2h0VmVjdG9ycyA9IFtcbiAgICAgICAge3g6IDEseTogMX0sXG4gICAgICAgIHt4OiAtMSx5OiAxfVxuICAgIF07XG4gICAgLy9kYXJrcyBtb3ZlIHVwXG4gICAgY29uc3QgZGFya1ZlY3RvcnMgPSBbXG4gICAgICAgIHt4OiAxLHk6IC0xfSxcbiAgICAgICAge3g6IC0xLHk6IC0xfVxuICAgIF07XG4gICAgLy9raW5ncyBtb3ZlIGFueSB3aGljaCB3YXlcbiAgICBjb25zdCBraW5nVmVjdG9ycyA9IGxpZ2h0VmVjdG9ycy5jb25jYXQoZGFya1ZlY3RvcnMpO1xuXG5cbiAgICBsZXQgdmVjdG9ycztcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdraW5nJykpIHtcbiAgICAgIHZlY3RvcnMgPSBraW5nVmVjdG9ycztcbiAgICB9IGVsc2UgaWYgKCRwaWVjZS5oYXNDbGFzcygnbGlnaHQnKSkge1xuICAgICAgdmVjdG9ycyA9IGxpZ2h0VmVjdG9ycztcbiAgICB9IGVsc2Uge1xuICAgICAgdmVjdG9ycyA9IGRhcmtWZWN0b3JzO1xuICAgIH1cblxuICAgIGNvbnN0IG91dE9mQm91bmRzID0gZnVuY3Rpb24oY29vcmRzKSB7XG4gICAgICByZXR1cm4gIShjb29yZHMueCA+PSAwICYmIGNvb3Jkcy54IDwgOCAmJiBjb29yZHMueSA+PSAwICYmIGNvb3Jkcy55IDwgOCk7XG4gICAgfTtcblxuICAgIGxldCAkbGVnYWxTcXVhcmVzID0gJCgpO1xuICAgIGNvbnN0IGJ1aWxkTW92ZXMgPSBmdW5jdGlvbihjb29yZHMsdmVjdG9ycyxqdW1wc09ubHkpIHtcblxuXG4gICAgICBpZiAob3V0T2ZCb3VuZHMoY29vcmRzKSkgcmV0dXJuO1xuXG4gICAgICAgIC8vb3VyIGN1cnJlbnQgc3F1YXJlIGlzIGF0IGNvb3Jkc1xuICAgICAgY29uc3QgJGN1cnJlbnRTcXVhcmUgPSAkc3F1YXJlcy5lcShjb29yZHMueSo4ICsgY29vcmRzLngpO1xuXG4gICAgICAkLmVhY2godmVjdG9ycyxmdW5jdGlvbihpbmRleCx2ZWN0b3IpIHtcblxuXG4gICAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IHtcbiAgICAgICAgICB4OiB2ZWN0b3IueCArIGNvb3Jkcy54LFxuICAgICAgICAgIHk6IHZlY3Rvci55ICsgY29vcmRzLnlcbiAgICAgICAgfTtcblxuXG4gICAgICAgIGlmIChvdXRPZkJvdW5kcyhuZXdDb29yZHMpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG5ld1NxdWFyZUluZGV4ID0gOCpuZXdDb29yZHMueSArIG5ld0Nvb3Jkcy54O1xuICAgICAgICAgICAgLy9pZiB0aGUgc3F1YXJlIGlzIHRha2VuLFxuICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XSkge1xuICAgICAgICAgICAgICAgIC8vaXQgZ2V0cyBpbnRlcmVzdGluZ1xuICAgICAgICAgICAgICAgIC8vb2sgLSBzbyB3ZSBjYW4gb25seSBqdW1wIGlmIHRoZWlyXG4gICAgICAgICAgICAgICAgLy9waWVjZSBpcyBkaWZmZXJlbnQgZnJvbSBvdXJzXG4gICAgICAgICAgaWYgKCRwaWVjZS5oYXNDbGFzcygnZGFyaycpKSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnZGFyaycpKSByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdLmhhc0NsYXNzKCdsaWdodCcpKSByZXR1cm47XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgICBjb25zdCBqdW1wQ29vcmRzID0ge1xuICAgICAgICAgICAgeDogdmVjdG9yLngqMiArIGNvb3Jkcy54LFxuICAgICAgICAgICAgeTogdmVjdG9yLnkqMiArIGNvb3Jkcy55XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAob3V0T2ZCb3VuZHMoanVtcENvb3JkcykpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGp1bXBTcXVhcmVJbmRleCA9IGp1bXBDb29yZHMueSo4ICsganVtcENvb3Jkcy54O1xuICAgICAgICAgICAgICAgIC8vaWYgdGhlIGp1bXAgc3F1YXJlIGlzIGZyZWUuLi5cbiAgICAgICAgICAgICAgICAvL2FkZCBpdCBhbmQgdGhlIGRhdGEtanVtcGVkLXBpZWNlc1xuICAgICAgICAgIGlmICghdGFrZW5TcXVhcmVzW2p1bXBTcXVhcmVJbmRleF0pIHtcbiAgICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShqdW1wU3F1YXJlSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAvL2lmIHdlIGhhdmVuJ3QgYWxyZWFkeSBzZWVuIGl0XG4gICAgICAgICAgICBpZiAoISRuZXdTcXVhcmUuaXMoJGxlZ2FsU3F1YXJlcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hZGQgdGhlIHBhc3NlZCBvdmVyIHNxdWFyZSB0byBpdFxuICAgICAgICAgICAgICAkbGVnYWxTcXVhcmVzID0gJGxlZ2FsU3F1YXJlcy5hZGQoJG5ld1NxdWFyZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5kIHRoZSBqdW1wZWQgc3F1YXJlcyBmcm9tIGhvdyB3ZSBnb3QgaGVyZVxuICAgICAgICAgICAgICBsZXQgJGp1bXBlZFBpZWNlcyA9IHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF07XG4gICAgICAgICAgICAgIGlmICgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSkge1xuICAgICAgICAgICAgICAgICRqdW1wZWRQaWVjZXMgPSAkanVtcGVkUGllY2VzLmFkZCgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCRqdW1wZWRQaWVjZXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FuZCByZWN1cnNlLCB3aXRoIGp1bXBzT25seSBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgICBidWlsZE1vdmVzKGp1bXBDb29yZHMsdmVjdG9ycyx0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWp1bXBzT25seSkge1xuICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShuZXdTcXVhcmVJbmRleCk7XG4gICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCQoKSk7XG4gICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH07XG4gICAgYnVpbGRNb3Zlcyhjb29yZHMsdmVjdG9ycyxmYWxzZSk7XG4gICAgcmV0dXJuICRsZWdhbFNxdWFyZXM7XG5cbiAgfS8vZW5kIG9mIGdldE1vdmFibGVTcXVhcmVzXG5cbiAgZnVuY3Rpb24gc2V0VXBQaWVjZXMoKSB7XG4gICAgICAvL3NlbGVjdCBhbGwgdGhlIGRpdnMgd2l0aCBjbGFzcyAncGllY2UnXG4gICAgJCgncGllY2UnKTtcbi8vYWRkIHRoZSAnbGlnaHQnIGNsYXNzIHRvIGhhbGYgb2YgdGhlbVxuICAgICQoJ2Rpdi5waWVjZTpldmVuJykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4vL2pRdWVyeSdzIGV2ZW4gYW5kIG9kZCBzZWxlY3RvciBtZXRob2RzIHRvIGFzc2lnbiB0aGUgY2xhc3NlcyAubGlnaHQgYW5kIC5kYXJrLlxuLy9hZGQgdGhlICdkYXJrJyB0byB0aGUgb3RoZXIgaGFsZlxuICAgICQoJ2Rpdi5waWVjZTpvZGQnKS5hZGRDbGFzcygnZGFyaycpO1xuXG4gIH1cblxuICBmdW5jdGlvbiBtb3ZlUGllY2VUbygkcGllY2UsbmV3VG9wLG5ld0xlZnQpIHtcbiAgICAgIC8vc2V0IHRoZSBjc3MgJ3RvcCcgYW5kICdsZWZ0J1xuICAgICAgLy9hdHRyaWJ1dGVzIG9mIHRoZSBwYXNzZWQgcGllY2VcbiAgICAgIC8vdG8gdGhlIGFyZ3VtZW50cyBuZXdUb3AgYW5kIG5ld0xlZnRcbiAgICAkcGllY2UuY3NzKCd0b3AnLCBuZXdUb3ApO1xuICAgICRwaWVjZS5jc3MoJ2xlZnQnLCBuZXdMZWZ0KTtcblxuICB9XG5cbiAgZnVuY3Rpb24gc2V0VXBCb2FyZCgpIHtcbiAgICAgIC8vaXRlcmF0ZSB0aHJvdWdoIGFsbCBvZiB0aGUgZGl2cyB3aXRoIGNsYXNzIGBzcXVhcmVgXG4gICAgICAvL2ZpZ3VyZSBvdXQgd2hldGhlciBlYWNoIG9uZSBzaG91bGQgYmVcbiAgICAgIC8vbGlnaHQgb3IgZGFyaywgYW5kIGFzc2lnbiB0aGUgcHJvcGVyIGNsYXNzXG4gICAgY29uc3QgJGVhY2hTcXVhcmUgPSAkKCdkaXYuc3F1YXJlJyk7XG4gICAgJGVhY2hTcXVhcmUuZWFjaChmdW5jdGlvbihpbmRleCl7XG4gICAgICBpZihsaWdodE9yRGFyayhpbmRleCk9PT0gMCl7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnZGFyaycpO1xuICAgICAgfVxuICAgIH0pO1xuICAgICAgLy9pbm5lciBoZWxwZXIgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIG51bWJlciBiZXR3ZWVuXG4gICAgICAvLzAgYW5kIDYzIChpbmNsdXNpdmUpIGFuZCByZXR1cm5zIDEgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmVcbiAgICAgIC8vZGFyaywgYW5kIDAgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmUgbGlnaHRcbiAgICBmdW5jdGlvbiBsaWdodE9yRGFyayhpbmRleCkge1xuICAgICAgY29uc3QgeCA9IGluZGV4ICUgODtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICBjb25zdCBvZGRYID0geCAlIDI7XG4gICAgICBjb25zdCBvZGRZID0geSAlIDI7XG4gICAgICByZXR1cm4gKG9kZFggXiBvZGRZKTtcbiAgICB9XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZVNlbGVjdCgkcGllY2UpIHtcbiAgICAgIC8vaWYgJHBpZWNlIGhhcyB0aGUgY2xhc3MgJ3NlbGVjdGVkJyxyZW1vdmUgaXRcbiAgICAgIC8vaWYgJHBpZWNlIGRvZXMgbm90IGhhdmUgdGhlIGNsYXNzICdzZWxlY3RlZCdcbiAgICAgIC8vbWFrZSBzdXJlIG5vIG90aGVyIGRpdnMgd2l0aCB0aGUgY2xhc3MgJ3BpZWNlJ1xuICAgICAgLy9oYXZlIHRoYXQgY2xhc3MsIHRoZW4gc2V0ICRwaWVjZSB0byBoYXZlIHRoZSBjbGFzc1xuICAgIGlmKCRwaWVjZS5oYXNDbGFzcygnc2VsZWN0ZWQnKSlcbiAgICAgICRwaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBlbHNlIHtcbiAgICAgICQoJ2Rpdi5waWVjZScpLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcbiAgICAgICAgaWYoJChwaWVjZSkuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAgICAgJChwaWVjZSkucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICB9KTtcbiAgICAgICRwaWVjZS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHRvZ2dsZVNlbGVjdCBmdW5jdGlvblxuXG4gIGZ1bmN0aW9uIGluY3JlbWVudG1vdmVDb3VudGVyKCkge1xuICAgICAgLy9nZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXJcbiAgICAgIC8vdHVybnMgaXQgaW50byBhIG51bWJlclxuICAgICAgLy9pbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXJcbiAgICAgIC8vdG8gdGhlIG5ldyBtb3ZlIGNvdW50XG4gICAgJCgnI21vdmVDb3VudGVyJykuaHRtbChwYXJzZUludCgkKCcjbW92ZUNvdW50ZXInKS5odG1sKCksMTApKzEpO1xuICB9XG5cbi8vIHRoaXMgZnVuY3Rpb24gZ2V0cyB0aGUgalF1ZXJ5IG9iamVjdCBzdG9yZWQgaW5cbi8vIHRoZSBkYXRhIG9iamVjdCBvZiAkc3F1YXJlIHVuZGVyIHRoZSBrZXkgJ2p1bXBlZFBpZWNlcydcbi8vIGFuZCByZW1vdmVzIGV2ZXJ5IGVsZW1lbnQgaW4gdGhhdCBqUXVlcnkgc2VsZWN0aW9uXG4gIGZ1bmN0aW9uIHJlbW92ZUNhcHR1cmVkUGllY2VzKCRzcXVhcmUpIHtcbiAgICAkc3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycpLnJlbW92ZSgpO1xuICB9XG5cbiAgLy90aGlzIHJlc2V0cyB0aGUgZ2FtZSBieSBlZmZlY3RpdmVseSByZWxvYWRpbmcgdGhlIHBhZ2UgZnJvbSBjYWNoZVxuICBmdW5jdGlvbiByZXNldCgpe1xuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICB9XG5cblxuXG5cbn0pOy8vZW5kIG9mIEpTIGxvYWRcblxuXG4vKlxuVE9ETzpcbjEuIFBsYXllciBjaGFuZ2UgZnJvbSBwbGF5ZXIgMSB0byBwbGF5ZXIgMlxuMi4gRmlndXJlIG91dCBob3cgdG8gc3RvcCBpbGxlZ2FsIG1vdmVzLlxuICAtb25seSBtYWtlIHR3byBwb3N0aXRpb25zIGF2YWlsYWJsZSBhdCBhbnkgZ2l2ZW4gdGltZVxuICAtb25jZSB0aGUgcGllY2UgaGFzIG1vdmVkIGludG8gYSBwb3NpdGlvbiBtYWtlXG5cbiAgLU9uIGNsaWNrIG9mIHNxYXVyZVxuICAtZ2V0IHBpZWNlIG9uIHNxYXVyZSAoZS50YXJnZXQpXG4gIC1jaGVjayBpZiBwaWVjZSBiZWxvbmdzIHRvIHAxIG9yIHAyXG4gIC1jaGVjayByZWxldmFudCBzcXVhcmVzXG4gICAgLmlmIGluZGV4IG9mIGN1cnJlbnRTcXVhcmVcbiAgICAuaWYgc3F1YXJlIGlzIG5vdCBpbiB0aGUgZmlyc3QgY29sdW1uXG4gICAgY2hlY2sgc3F1YXJlIGRpYWdvbmFsbHkgbGVmdCBhbmQgbW92YWJsZSBjbGFzcyBpZiBlbXB0eVxuICAgIC5pZiBzcXVhcmUgaXMgbm90IGluIHRoZSBsYXN0IGNvbHVtblxuICAgIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IHJpZ2h0IGFuZCBtb3ZhYmxlIGNsYXNzIGlmIGVtcHR5XG4gIC1vbmNlIHBpZWNlIGlzIG1vdmVkIG9yIGlmIHVuLXNlbGVjdGVkIHJlbW92ZSBtb3ZhYmxlIGNsYXNzIGZyb20gYWxsIHNxdWFyZXMuXG5cbmluZGV4IChwb3NpdGlvbiklIHdpZHRoID09PSAwIC4uLnJlcHJlc2VudHMgdGhlIGZpcnN0IGNvbHVtblxuaW5kZXggJSB3aWR0aCA9PT0gd2lkdGgtMSAuLi5yZXByZXNlbnRzIHRoZSBsYXN0IGNvbHVtblxuXG5pbmRleCArIHdpZHRoLTEgZm9yIHBsYXllcjEgaXMgZ29pbmcgbGVmdCBkaWFnb25hbGx5XG5pbmRleCArIHdpZHRoLTEgZm9yIHBsYXllcjEgaXMgZ29pbmcgcmlnaHQgZGlhZ29uYWxseVxuXG5pbmRleCAtIHdpZHRoKzEgZm9yIHBsYXllcjIgaXMgZ29pbmcgbGVmdCBkaWFnb25hbGx5XG5pbmRleCAtIHdpZHRoLTEgZm9yIHBsYXllcjIgaXMgZ29pbmcgcmlnaHQgZGlhZ29uYWxseVxuXG5cbjMuIEp1bXAgbW92ZXMgdG8gbWFrZSB0aGUgb3Bwb25lbnRzIHBpZWNlIGRpc2FwcGVhciBmcm9tIHRoZSBib2FyZCBhbmQgcmVzZXRcbiAgdGhlIHBvc2l0b25cbjQuIEtpbmcgbWFrZXIgZnVuY3Rpb25cbjUuIEhvdyB0byB0YWtlIGluIHRoZSB0b3AgcmlnaHQgcG9zaXRpb25cbjYuUmVzZXQgdGhlIGdhbWUgYmV0dGVyXG4vL1xuLy91c2luZyB4IGFuZCB5IHZhbHVlcy5cbi8veCB2YWx1ZSBvbiB0aGUgZmlyc3RDb2x1bW4gd2lsbCBhbHdheXMgYmUgemVybyBzaW5jZSB0aGUgc3RhcnRpbmcgaXMgYSB6ZXJvIGJhc2VkIGluZGV4XG4vL3kgdmFsdWUgb24gdGhlIGxhc3RDb2x1bW4gd2lsbCBhbHdheXMgYmUgc2V2ZW4gc2luY2UgdGhlIGxhc3QgaW5kZXggb24gYSA4KjggaXMgN1xuLy9kYXJrUGllY2UgbW92aW5nIHJpZ2h0IGlzIHggKyAxIGFuZCB5IC0gMVxuLy9kYXJrUGllY2UgbW92aW5nIGxlZnQgaXMgeCAtIDEgYW5kIHkgLSAxXG4vL2xpZ2h0UGllY2UgbW92aW5nIHJpZ2h0IGlzIHggLSAxIGFuZCB5ICsgMVxuLy9saWdodFBpZWNlIG1vdmluZyBsZWZ0IGlzIHggKyAxIGFuZCB5ICsgMVxuLy9BbmQgdG8ganVtcCB3aWxsIGJlICsyIHNpbmdsZSBtb3ZlbWVudHMuXG4vL2NoZWNrIGlmIGVtcHR5Li4uYnkgY2hlY2tpbmcgaWYgYSBzcXVhcmUgaXMgbW92YWJsZSBpLmUuIGdldE1vdmFibGVTcXVhcmVzKCkuYWRkQ2xhc3MoJ21vdmFibGUnKTtcbi8vaWYgZW1wdHlcbi8vIGNvbnN0IGRhcmtQaWVjZU1vdmVSaWdodCA9KGluZGV4LnggKyAoaW5kZXgueCArIDEpKSwgKGluZGV4LnkgKyAoaW5kZXgueSAtIDEpKTsgLy9JIG5lZWQgdG8gZ2V0IGEgc2V0IG9mIGNvb3JkcyBiYWNrIGFuZCBtYWtlIHRoYXQgYSBsZWdhbE1vdmVzXG5cblxuXG5cbi8vIGlmIChpbmRleCAlIHdpZHRoID09PSAwICYmICRkYXJrUGllY2Upe1xuLy8gICBpbmRleCArIHdpZHRoICsgMVxuLy8gfVxuLy8gdGFrZSB0aGUgaW5kZXggeCBhbmQgeSB2YWx1ZSBhcyBpbmRleCBhbmQgY2hlY2tcbi8vaWYgaW5kZXggJSB3aWR0aCA9PT0gMCB0aGUgZmlyc3QgY29sdW1uIG9yXG4vL2lmIGluZGV4ICUgd2lkdGggPT09IHdpZHRoLTEgdGhlIGxhc3QgY29sdW1uXG4vL2lmIGZpcnN0IGNvbHVtbiBpcyB0cnVlIHRoZW4gY2hlY2sgY29sb3IvcDEgb3IgcDJcbi8vcDFcbi8vaWYgcDEgY2hlY2sgc3F1YXJlIGRpYWdvbmFsbHkgbGVmdCBpZiBlbXB0eSB1c2luZ1xuLy9pbmRleCArIHdpZHRoICsgMSBhZGQgdGhlIGNsYXNzICdtb3ZhYmxlJ1xuLy9pZiBsYXN0IGNvbHVtbiBpcyB0cnVlIHRoZW4gY2hlY2sgY29sb3IvcDEgb3IgcDJcbi8vaWYgcDEgY2hlY2sgc3F1YXJlIGRpYWdvbmFsbHkgcmlnaHQgaWYgZW1wdHkgdXNpbmdcbi8vaW5kZXggKyB3aWR0aC0xIGFkZCB0aGUgY2xhc3MgJ21vdmFibGUnXG4vL3VzZSBDU1MgdG8gaGlnaGxpZ2h0IHRoZSBtb3ZhYmxlIHNxdWF1cmVzIChsZWdhbCBtb3Zlcylcbi8vcDJcbi8vZWxzZSBpdCdzIHAyXG5cbiovXG4iXX0=
