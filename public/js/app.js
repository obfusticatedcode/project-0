"use strict";$(function(){function e(){var e=$(event.target).position();return p=i(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(c+l)+"px",left:e*(c+l)+"px"}}function i(e,a){return{x:a/(c+l),y:e/(c+l)}}function s(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var s=$(a).position(),n=i(s.top,s.left),o=8*n.y+n.x;t[o]=$(a)});var s=i(e.position().top,e.position().left),n=[{x:1,y:1},{x:-1,y:1}],o=[{x:1,y:-1},{x:-1,y:-1}],r=n.concat(o),d=void 0;d=e.hasClass("king")?r:e.hasClass("light")?n:o;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},l=$();return function i(s,n,o){if(!c(s)){var r=a.eq(8*s.y+s.x);$.each(n,function(d,v){var f={x:v.x+s.x,y:v.y+s.y};if(!c(f)){var u=8*f.y+f.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var p={x:2*v.x+s.x,y:2*v.y+s.y};if(c(p))return;var h=8*p.y+p.x;if(!t[h]){var C=a.eq(h);if(!C.is(l)){l=l.add(C);var m=t[u];r.data("jumpedPieces")&&(m=m.add(r.data("jumpedPieces"))),C.data("jumpedPieces",m),i(p,n,!0)}}}else if(!o){var x=a.eq(u);x.data("jumpedPieces",$()),l=l.add(x)}}})}}(s,d,!1),l}function n(e,a,t){e.css("top",a),e.css("left",t)}function o(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function r(){$("#moveCounter").html(parseInt($("#moveCounter").html(),10)+1)}function d(){location.reload()}for(var c=46,l=2,v=$("div#board"),f=$("div#pieces"),u=$("#reset-button"),p=null,h=0;h<64;h++)v.append($("<div/>").addClass("square"));!function(){function e(e){return e%8%2^Math.floor(e/8)%2}$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}();for(var C=0;C<24;C++)f.append($("<div/>").addClass("piece"));!function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),$("div.piece.light").each(function(e,a){var i=Math.floor(e/4),s=e%4*2+(1-i%2),o=t(s,i);n($(a),o.top,o.left)}),$("div.piece.dark").each(function(e,a){var i=Math.floor(e/4)+5,s=e%4*2+(1-i%2),o=t(s,i);n($(a),o.top,o.left)}),u.on("click",function(){d()}),$("div.piece").on("click",function(e){var t=$(e.target);o(t),a(),t.hasClass("selected")&&s(t).addClass("movable")}),$("div.square").on("click",function(i){e();var s=$(i.target);if(s.hasClass("movable")){var o=$("div.piece.selected");if(1===o.length){var d=s.prevAll().length,c=d%8,l=Math.floor(d/8),v=t(c,l);n(o,v.top,v.left),r(),o.removeClass("selected"),$("div.square").removeClass("movable"),a()}}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiY3VycmVudFBvc2l0aW9uIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsImNvb3JkcyIsIiRwaWVjZVRvTW92ZSIsImhhc0NsYXNzIiwidG9wIiwibGVmdCIsInJlc2V0TW92YWJsZXMiLCJyZW1vdmVEYXRhIiwicmVtb3ZlQ2xhc3MiLCJ3aWR0aCIsInkiLCJib3JkZXIiLCJ4IiwiZ2V0Q29vcmRzIiwiZ2V0TW92YWJsZVNxdWFyZXMiLCIkcGllY2UiLCIkc3F1YXJlcyIsImtpbmdWZWN0b3JzIiwiZWFjaCIsImluZGV4IiwicGllY2UiLCJ2ZWN0b3JzIiwibGlnaHRWZWN0b3JzIiwidGFrZW5TcXVhcmVzIiwic3F1YXJlSW5kZXgiLCIkbGVnYWxTcXVhcmVzIiwib3V0T2ZCb3VuZHMiLCJjb25jYXQiLCJ2ZWN0b3IiLCJkYXJrVmVjdG9ycyIsImJ1aWxkTW92ZXMiLCJuZXdTcXVhcmVJbmRleCIsImp1bXBDb29yZHMiLCIkY3VycmVudFNxdWFyZSIsImVxIiwibmV3Q29vcmRzIiwianVtcFNxdWFyZUluZGV4IiwiJG5ld1NxdWFyZSIsIiRqdW1wZWRQaWVjZXMiLCJkYXRhIiwiaXMiLCJhZGRDbGFzcyIsImFkZCIsIm5ld1RvcCIsImp1bXBzT25seSIsInNldFVwQm9hcmQiLCJtb3ZlUGllY2VUbyIsIm5ld0xlZnQiLCJjc3MiLCJ0b2dnbGVTZWxlY3QiLCJpbmNyZW1lbnRtb3ZlQ291bnRlciIsImh0bWwiLCJwYXJzZUludCIsInJlc2V0IiwibG9jYXRpb24iLCJyZWxvYWQiLCJzcXVhcmVDb3VudCIsIiRib2FyZCIsIiRwaWVjZXMiLCJpIiwiYXBwZW5kIiwiTWF0aCIsImZsb29yIiwibGlnaHRPckRhcmsiLCJ0aGlzIiwicGl4ZWxQb3NpdGlvbiIsImdldFBpeGVscyIsIiRyZXNldEJ1dHRvbiIsIm9uIiwiJHRoaXNQaWVjZSIsIiRzZWxlY3RlZFBpZWNlIiwibGVuZ3RoIiwiZSIsInBpeGVscyIsInBy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NkMsSUFFRW9CLEVBQVNoRSxZQUFnQixZQWRuQlYsRUFBRSxjQUFjWSxZQUFZLFdBa0JsQ0YiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9sb2FkaW5nIEpTXG4kKCgpPT57XG5cbiAgLy9HTE9CQUwgVkFSSUFCTEVTXG4gIGNvbnN0IHdpZHRoID0gNDY7XG4gIGNvbnN0IGJvcmRlciA9IDI7XG4gIGNvbnN0ICRib2FyZCA9ICQoJ2RpdiNib2FyZCcpO1xuICBjb25zdCAkcGllY2VzID0gJCgnZGl2I3BpZWNlcycpO1xuICBjb25zdCAkcmVzZXRCdXR0b24gPSAkKCcjcmVzZXQtYnV0dG9uJyk7XG4gIGxldCBjb29yZHMgPSBudWxsOy8vc2V0dGluZyBjb29yZHMgZ2xvYmFsbHkgc28gY29uc3RhbnRseSB1cGRhdGluZ1xuXG5cblxuICAvL0NyZWF0aW5nIHRoZSA2NCBzcXVhcmVzIGFuZCBhZGRpbmcgdGhlbSB0byB0aGUgRE9NXG4gIGNvbnN0IHNxdWFyZUNvdW50ID0gOCo4OyAvLzggcm93cyBieSA4IGNvbHVtbnM7IHplcm8gYmFzZWQgaW5kZXhcbiAgZm9yIChsZXQgaSA9IDA7aTxzcXVhcmVDb3VudDtpKyspIHtcblxuICAvL3RoaXMgbGluZSBjcmVhdGVzIGEgbmV3IGRpdiB3aXRoIHRoZSBjbGFzcyAnc3F1YXJlJ1xuICAvL2FuZCBhcHBlbmRzIGl0IHRvIHRoZSBkaXYgd2l0aCBpZCAnYm9hcmQnXG4gICAgJGJvYXJkLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygnc3F1YXJlJykpO1xuICB9XG5cblxuICAvL3NldCB1cCB0aGUgYm9hcmQgd2l0aCB0aGUgY29ycmVjdCBjbGFzc2VzIGZvciB0aGUgbGlnaHQgYW5kIGRhcmsgc3F1YXJlc1xuICBzZXRVcEJvYXJkKCk7XG5cblxuICAgICAgLy9jcmVhdGluZyB0aGUgMjQgcGllY2VzIGFuZCBhZGRpbmcgdGhlbSB0byB0aGUgRE9NXG4gIGNvbnN0IHBpZWNlQ291bnQgPSAyNDtcbiAgZm9yIChsZXQgaT0wO2k8cGllY2VDb3VudDtpKyspIHtcblxuICAgIC8vdGhpcyBsaW5lIGFwcGVuZHMgYW4gZW1wdHkgZGl2IHdpdGggdGhlIGNsYXNzICdwaWVjZScgdG8gdGhlIGRpdiB3aXRoIGlkICdwaWVjZXMnXG4gICAgJHBpZWNlcy5hcHBlbmQoJCgnPGRpdi8+JykuYWRkQ2xhc3MoJ3BpZWNlJykpO1xuXG4gIH1cblxuXG4gIC8vc2V0cyB1cCB0aGUgY2xhc3NlcyBmb3IgdGhlIGRpZmZlcmVudCB0eXBlcyBvZiBwaWVjZVxuICBzZXRVcFBpZWNlcygpO1xuXG4gIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgbGlnaHQgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICQoJ2Rpdi5waWVjZS5saWdodCcpLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcblxuICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgIC8vaW50byBhIHgseSBzcXVhcmUgY29vcmRpbmF0ZSB1c2luZyBtYXRoXG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA0KTtcbiAgICBjb25zdCB4ID0gKGluZGV4ICUgNCkgKiAyICsgKDEgLSB5JTIpO1xuXG4gICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmdhdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgY29uc3QgcGl4ZWxQb3NpdGlvbiA9IGdldFBpeGVscyh4LHkpO1xuICAgIC8vYWN0dWFsbHkgbW92aW5nIHRoZSBwaWVjZSB0byBpdHMgaW5pdGlhbCBwb3NpdGlvblxuICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLHBpeGVsUG9zaXRpb24udG9wLHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gIH0pO1xuXG4gICAgLy90aGlzIGxvb3AgbW92ZXMgYWxsIHRoZSBkYXJrIHBpZWNlcyB0byB0aGVpciBpbml0aWFsIHBvc2l0aW9uc1xuICAkKCdkaXYucGllY2UuZGFyaycpLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcbiAgICAvL3R1cm5pbmcgdGhlIGluZGV4IChmcm9tIDAgLSAxMSlcbiAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aFxuICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4LzQpICsgNTtcbiAgICBjb25zdCB4ID0gKGluZGV4ICUgNCkgKiAyICsgKDEteSUyKTtcblxuICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgY29uc3QgcGl4ZWxQb3NpdGlvbiA9IGdldFBpeGVscyh4LHkpO1xuICAgIC8vbW92aW5nIHRoZSBwaWVjZSB0byBpdHMgaW5pdGlhbCBwb3NpdGlvblxuICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLHBpeGVsUG9zaXRpb24udG9wLHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gIH0pO1xuXG4gICAgLy9zZXQgdXAgaW5pdGlhbCBzcXVhcmVzIHRoZSBjbGFzcyAnbW92YWJsZScgcmVwcmVzZW50cyBhIHNxdWFyZVxuICAgIC8vdGhhdCBpcyB1bm9jY3VwaWVkIGFuZCB0aGlzIGFsbG93cyBhbGwgc3F1YXJlcyBkYXJrIHNxdWFyZXMgdG8gYmUgbW92YWJsZVxuICAvLyBnZXRNb3ZhYmxlU3F1YXJlcygpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG5cbiAgICAgIC8vRVZFTlRTXG5cbiAgICAvL3Jlc2V0dGluZyB0aGUgZ2FtZS5cbiAgJHJlc2V0QnV0dG9uLm9uKCdjbGljaycsICgpPT57XG4gICAgcmVzZXQoKTtcbiAgfSk7XG5cbiAgJCgnZGl2LnBpZWNlJykub24oJ2NsaWNrJywoZXZlbnQpPT57XG4gICAgLy90dXJuIGB0aGlzYCBpbnRvIGEgalF1ZXJ5IG9iamVjdFxuICAgIGNvbnN0ICR0aGlzUGllY2UgPSAkKGV2ZW50LnRhcmdldCk7XG5cblxuXG4gICAgLy9cbiAgICAvL3VzaW5nIHggYW5kIHkgdmFsdWVzLlxuICAgIC8veCB2YWx1ZSBvbiB0aGUgZmlyc3RDb2x1bW4gd2lsbCBhbHdheXMgYmUgemVybyBzaW5jZSB0aGUgc3RhcnRpbmcgaXMgYSB6ZXJvIGJhc2VkIGluZGV4XG4gICAgLy95IHZhbHVlIG9uIHRoZSBsYXN0Q29sdW1uIHdpbGwgYWx3YXlzIGJlIHNldmVuIHNpbmNlIHRoZSBsYXN0IGluZGV4IG9uIGEgOCo4IGlzIDdcbiAgICAvL2RhcmtQaWVjZSBtb3ZpbmcgcmlnaHQgaXMgeCArIDEgYW5kIHkgLSAxXG4gICAgLy9kYXJrUGllY2UgbW92aW5nIGxlZnQgaXMgeCAtIDEgYW5kIHkgLSAxXG4gICAgLy9saWdodFBpZWNlIG1vdmluZyByaWdodCBpcyB4IC0gMSBhbmQgeSArIDFcbiAgICAvL2xpZ2h0UGllY2UgbW92aW5nIGxlZnQgaXMgeCArIDEgYW5kIHkgKyAxXG4gICAgLy9BbmQgdG8ganVtcCB3aWxsIGJlICsyIHNpbmdsZSBtb3ZlbWVudHMuXG4gICAgLy9jaGVjayBpZiBlbXB0eS4uLmJ5IGNoZWNraW5nIGlmIGEgc3F1YXJlIGlzIG1vdmFibGUgaS5lLiBnZXRNb3ZhYmxlU3F1YXJlcygpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG4gICAgLy9pZiBlbXB0eVxuICAgIC8vIGNvbnN0IGRhcmtQaWVjZU1vdmVSaWdodCA9KGluZGV4LnggKyAoaW5kZXgueCArIDEpKSwgKGluZGV4LnkgKyAoaW5kZXgueSAtIDEpKTsgLy9JIG5lZWQgdG8gZ2V0IGEgc2V0IG9mIGNvb3JkcyBiYWNrIGFuZCBtYWtlIHRoYXQgYSBsZWdhbE1vdmVzXG5cblxuXG5cbiAgICAvLyBpZiAoaW5kZXggJSB3aWR0aCA9PT0gMCAmJiAkZGFya1BpZWNlKXtcbiAgICAvLyAgIGluZGV4ICsgd2lkdGggKyAxXG4gICAgLy8gfVxuICAgIC8vIHRha2UgdGhlIGluZGV4IHggYW5kIHkgdmFsdWUgYXMgaW5kZXggYW5kIGNoZWNrXG4gICAgLy9pZiBpbmRleCAlIHdpZHRoID09PSAwIHRoZSBmaXJzdCBjb2x1bW4gb3JcbiAgICAvL2lmIGluZGV4ICUgd2lkdGggPT09IHdpZHRoLTEgdGhlIGxhc3QgY29sdW1uXG4gICAgLy9pZiBmaXJzdCBjb2x1bW4gaXMgdHJ1ZSB0aGVuIGNoZWNrIGNvbG9yL3AxIG9yIHAyXG4gICAgLy9wMVxuICAgIC8vaWYgcDEgY2hlY2sgc3F1YXJlIGRpYWdvbmFsbHkgbGVmdCBpZiBlbXB0eSB1c2luZ1xuICAgIC8vaW5kZXggKyB3aWR0aCArIDEgYWRkIHRoZSBjbGFzcyAnbW92YWJsZSdcbiAgICAvL2lmIGxhc3QgY29sdW1uIGlzIHRydWUgdGhlbiBjaGVjayBjb2xvci9wMSBvciBwMlxuICAgIC8vaWYgcDEgY2hlY2sgc3F1YXJlIGRpYWdvbmFsbHkgcmlnaHQgaWYgZW1wdHkgdXNpbmdcbiAgICAvL2luZGV4ICsgd2lkdGgtMSBhZGQgdGhlIGNsYXNzICdtb3ZhYmxlJ1xuICAgIC8vdXNlIENTUyB0byBoaWdobGlnaHQgdGhlIG1vdmFibGUgc3F1YXVyZXMgKGxlZ2FsIG1vdmVzKVxuICAgIC8vcDJcbiAgICAvL2Vsc2UgaXQncyBwMlxuXG5cblxuXG5cblxuICAgIC8vdG9nZ2xpbmcgdGhlICdzZWxlY3RlZCcgY2xhc3Mgb2YgdGhpcyBwaWVjZVxuICAgIC8vYW5kIHBvc3NpYmxlIGRlc2VsZWN0aW5nIG90aGVyIHBpZWNlc1xuICAgIHRvZ2dsZVNlbGVjdCgkdGhpc1BpZWNlKTtcbiAgICByZXNldE1vdmFibGVzKCk7XG4gICAgLy9nZXQgdGhlIGxlZ2FsIG1vdmVzIGZvciB0aGlzXG4gICAgaWYgKCR0aGlzUGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpIHtcbiAgICAgIGdldE1vdmFibGVTcXVhcmVzKCR0aGlzUGllY2UpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG4gICAgfVxuXG4gIH0pOy8vZW5kIG9mIHBpZWNlIGNsaWNrIGV2ZW50XG5cbiAgLy9jaGVja3MgdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgY2xpY2tlZCBvciBzZWxlY3RlZCBkaXYgYW5kIHJldHVybnMgdGhlIGNvb3Jkcy5cbiAgZnVuY3Rpb24gY3VycmVudFBvc2l0aW9uKCl7XG4gICAgY29uc3QgcG9zaXRpb24gPSAkKGV2ZW50LnRhcmdldCkucG9zaXRpb24oKTtcbiAgICBjb29yZHMgPSBnZXRDb29yZHMocG9zaXRpb24udG9wLHBvc2l0aW9uLmxlZnQpO1xuICAgIC8vIGNvbnNvbGUubG9nKGNvb3Jkcyk7Ly9nZXR0aW5nIHRoZSBsb2NhdGlvbiBvZiB0aGUgcGllY2VcbiAgICByZXR1cm4gY29vcmRzO1xuXG4gIH1cblxuICAkKCdkaXYuc3F1YXJlJykub24oJ2NsaWNrJywgKGUpPT57XG4gICAgY3VycmVudFBvc2l0aW9uKCk7Ly90aGUgY3VycmVudFBvc2l0aW9uIG9mIHRoZSBzcXVhcmU7IGNvb3Jkc1xuICAgIC8vIGNvbnNvbGUubG9nKCdjb29yZHMnLCBjb29yZHMpO1xuICAgIC8vdHVybiBgZSBvciBldmVudGAgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICBjb25zdCAkcGllY2VUb01vdmUgPSAkKGUudGFyZ2V0KTtcblxuXG4gICAgLy9pZiAkdGhpcyBpcyBhIGxlZ2FsIHNxdWFyZSB0byBtb3ZlIHRvLi4uXG4gICAgaWYgKCRwaWVjZVRvTW92ZS5oYXNDbGFzcygnbW92YWJsZScpKSB7XG5cbiAgICAgICAgICAvL2dldCB0aGUgcGllY2Ugd2l0aCB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgICAgY29uc3QgJHNlbGVjdGVkUGllY2UgPSAkKCdkaXYucGllY2Uuc2VsZWN0ZWQnKTtcblxuICAgICAgICAgIC8vb25seSBtb3ZlIGlmIHRoZXJlIGlzIGV4YWN0bHkgb25lIHNlbGVjdGVkIHBpZWNlXG4gICAgICBpZiAoJHNlbGVjdGVkUGllY2UubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvL2dldCB0aGUgaW5kZXggb2YgdGhlIHNxdWFyZVxuICAgICAgICAgICAgLy9hbmQgdHJhbnNsYXRlIGl0IHRvIHBpeGVsIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IGluZGV4ID0gJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IGdldFBpeGVscyh4LHkpO1xuICAgICAgICAgICAgLy9hY3R1YWxseSBkbyB0aGUgbW92aW5nXG4gICAgICAgIG1vdmVQaWVjZVRvKCRzZWxlY3RlZFBpZWNlLHBpeGVscy50b3AscGl4ZWxzLmxlZnQpO1xuICAgICAgICAgICAgLy9pbmNyZW1lbnQgdGhlIG1vdmUgY291bnRlclxuICAgICAgICBpbmNyZW1lbnRtb3ZlQ291bnRlcigpO1xuICAgICAgICAgICAgLy91bi1zZWxlY3QgdGhlIHBpZWNlXG4gICAgICAgICRzZWxlY3RlZFBpZWNlLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXG4gICAgICAgICAgICAvL3NldCB0aGUgbmV3IGxlZ2FsIG1vdmVzXG4gICAgICAgICQoJ2Rpdi5zcXVhcmUnKS5yZW1vdmVDbGFzcygnbW92YWJsZScpO1xuICAgICAgICByZXNldE1vdmFibGVzKCk7XG4gICAgICAgIC8vIGdldE1vdmFibGVTcXVhcmVzKCkuYWRkQ2xhc3MoJ21vdmFibGUnKTtcbiAgICAgIH1cblxuICAgIH1cblxuICB9KTtcblxuXG4gIC8vIE1PUkUgRlVOQ1RJT05TXG4gIC8vdGhpcyBmdW5jdGlvbiBzaG91bGQgZG8gdHdvIHRoaW5nc1xuLy8gMS4gcmVtb3ZlIHRoZSBkYXRhIGl0ZW0gd2l0aCBrZXkgJ2p1bXBlZFBpZWNlcycgZnJvbSBldmVyeSBkaXYuc3F1YXJlXG4vLyAyLiByZW1vdmUgdGhlIGNsYXNzICdtb3ZhYmxlJyBmcm9tIGV2ZXJ5IHNxdWFyZVxuICBmdW5jdGlvbiByZXNldE1vdmFibGVzKCkge1xuICAgICQoJ2Rpdi5zcXVhcmUnKS5yZW1vdmVEYXRhKCdqdW1wZWRQaWVjZXMnKS5yZW1vdmVDbGFzcygnbW92YWJsZScpO1xuICB9XG5cbiAgLy9mdW5jdGlvbiBmb3IgdHJhbnNsYXRpbmcgYW4geCx5IGNvb3JkaW5hdGVzIHRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgLy90aGUgY29udmVudGlvbiBpcyB0aGF0IHRoZSBzcXVhcmUgaW4gdGhlIHVwcGVyIGxlZnQgY29ybmVyIGlzIGF0IHBvc2l0aW9uIDAsMFxuICAvL3RoZSBzcXVhcmUgaW4gdGhlIHVwcGVyIHJpZ2h0LCBhdCA3LDAgYW5kIHRoZSBsb3dlclxuICAvL3JpZ2h0IGF0IDcsN1xuICBmdW5jdGlvbiBnZXRQaXhlbHMoeCx5KSB7XG4gICAgICAvL3Rha2VzIGFuIHgseSBwb3NpdGlvbiwgcmV0dXJuc1xuICAgICAgLy9waXhlbHMgZnJvbSB0aGUgbGVmdCwgcmlnaHRcbiAgICByZXR1cm4ge1xuICAgICAgJ3RvcCc6ICh5ICogKHdpZHRoK2JvcmRlcikpKydweCcsXG4gICAgICAnbGVmdCc6ICh4ICogKHdpZHRoK2JvcmRlcikpKydweCdcbiAgICB9O1xuICB9XG5cbiAgLy9mdW5jdGlvbiBmb3IgdHVybmluZyBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vaW50byB0aGUgeCx5IGNvb3JkaW5hdGUgb2YgYSBzcXVhcmUgb24gdGhlIGJvYXJkXG4gIC8vaXQgZm9sbG93cyB0aGUgc2FtZSBjb29yZGluYXRlIGNvbnZlbnRpb24gYXMgZ2V0UGl4ZWxzXG4gIGZ1bmN0aW9uIGdldENvb3Jkcyh0b3AsbGVmdCkge1xuICAgICAgLy9yZXR1cm5zIGFuIHggYW5kIGEgeVxuICAgICAgLy9naXZlbiBhIHRvcCBhbmQgbGVmdCBwaXhlbHNcbiAgICByZXR1cm4ge1xuICAgICAgJ3gnOiBsZWZ0IC8gKHdpZHRoICsgYm9yZGVyKSxcbiAgICAgICd5JzogdG9wIC8gKHdpZHRoICsgYm9yZGVyKVxuICAgIH07XG4gIH1cblxuICAvL3V0aWxpdHkgZnVuY3Rpb24gZm9yIHJldHVybmluZ1xuICAvL3RoZSBzZXQgb2YgdW5vY2N1cGllZCBkYXJrIHNxdWFyZXNcbiAgLy8ocG9zc2libGUgcGxhY2VzIHRvIG1vdmUgYSBwaWVjZSlcbiAgLy8gZnVuY3Rpb24gZ2V0TW92YWJsZVNxdWFyZXMoJHBpZWNlKSB7XG4gIC8vICAgICAvL3NlbGVjdCBhbGwgb2YgdGhlIHNxdWFyZXNcbiAgLy8gICBjb25zdCAkc3F1YXJlcyA9ICQoJ2Rpdi5zcXVhcmUnKTtcbiAgLy9cbiAgLy8gLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgLy8gLy9tYXAgY3JlYXRlcyBhIG5ldyBvYmplY3QgZnJvbSBhbiBleGlzdGluZyBvbmUgdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAvLyAgIGNvbnN0ICR0YWtlblNxdWFyZXMgPVxuICAvLyAgICAgICAgICQoJ2Rpdi5waWVjZScpLm1hcChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuICAvLyAgICAgICAgICAgLy90aGlzIGZ1bmN0aW9uIHRyYW5zbGF0ZXMgYSBwaWVjZVxuICAvLyAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSAkKHBpZWNlKS5wb3NpdGlvbigpO1xuICAvLyAgICAgICAgICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKHBvc2l0aW9uLnRvcCxwb3NpdGlvbi5sZWZ0KTtcbiAgLy8gICAgICAgICAgIGNvbnN0IHNxdWFyZUluZGV4ID0gY29vcmRzLnkgKiA4ICsgY29vcmRzLng7XG4gIC8vICAgICAgICAgICByZXR1cm4gJHNxdWFyZXNbc3F1YXJlSW5kZXhdO1xuICAvLyAgICAgICAgIH0pO1xuICAvLyAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3JkcygkcGllY2UucG9zaXRpb24oKS50b3AsJHBpZWNlLnBvc2l0aW9uKCkubGVmdCk7XG4gIC8vICAgY29uc3QgJG91dCA9ICQoJ2Rpdi5zcXVhcmUuZGFyaycpLm5vdCgkdGFrZW5TcXVhcmVzKTtcbiAgLy8gICByZXR1cm4gJG91dDtcbiAgLy8gfS8vZW5kIG9mIG9sZCBnZXRNb3ZhYmxlU3F1YXJlc1xuXG4gIC8vdXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0dXJuaW5nXG4vL3RoZSBzZXQgb2YgbGVnYWwgbW92ZXMgZ2l2ZW4gYSBwaWVjZVxuLy8gU0lERSBFRkZFQ1Q6IHN0b3JlcyBqdW1wZWQgcGllY2VzIGluIGEgZGF0YSBlbGVtZW50XG4vLyBvZiBlYWNoIHNxdWFyZSB0aGF0IGNhbiBiZSBtb3ZlZCB0b1xuICBmdW5jdGlvbiBnZXRNb3ZhYmxlU3F1YXJlcygkcGllY2UpIHtcblxuICAgIC8vc2VsZWN0IGFsbCBvZiB0aGUgc3F1YXJlc1xuICAgIGNvbnN0ICRzcXVhcmVzID0gJCgnZGl2LnNxdWFyZScpO1xuXG4gICAgLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgICAvL21hcCBjcmVhdGVzIGEgbmV3IG9iamVjdCBmcm9tIGFuIGV4aXN0aW5nIG9uZVxuICAgIC8vdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAgIHZhciB0YWtlblNxdWFyZXMgPSB7fTtcbiAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG5cbiAgICAgICAgICAgIC8vdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGEgcGllY2VcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gJChwaWVjZSkucG9zaXRpb24oKTtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AscG9zaXRpb24ubGVmdCk7XG4gICAgICBjb25zdCBzcXVhcmVJbmRleCA9IGNvb3Jkcy55ICogOCArIGNvb3Jkcy54O1xuICAgICAgdGFrZW5TcXVhcmVzW3NxdWFyZUluZGV4XSA9ICQocGllY2UpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKCRwaWVjZS5wb3NpdGlvbigpLnRvcCwkcGllY2UucG9zaXRpb24oKS5sZWZ0KTtcblxuICAgIC8vbGlnaHRzIG1vdmUgZG93blxuICAgIGNvbnN0IGxpZ2h0VmVjdG9ycyA9IFtcbiAgICAgICAge3g6IDEseTogMX0sXG4gICAgICAgIHt4OiAtMSx5OiAxfVxuICAgIF07XG4gICAgLy9kYXJrcyBtb3ZlIHVwXG4gICAgY29uc3QgZGFya1ZlY3RvcnMgPSBbXG4gICAgICAgIHt4OiAxLHk6IC0xfSxcbiAgICAgICAge3g6IC0xLHk6IC0xfVxuICAgIF07XG4gICAgLy9raW5ncyBtb3ZlIGFueSB3aGljaCB3YXlcbiAgICBjb25zdCBraW5nVmVjdG9ycyA9IGxpZ2h0VmVjdG9ycy5jb25jYXQoZGFya1ZlY3RvcnMpO1xuXG5cbiAgICBsZXQgdmVjdG9ycztcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdraW5nJykpIHtcbiAgICAgIHZlY3RvcnMgPSBraW5nVmVjdG9ycztcbiAgICB9IGVsc2UgaWYgKCRwaWVjZS5oYXNDbGFzcygnbGlnaHQnKSkge1xuICAgICAgdmVjdG9ycyA9IGxpZ2h0VmVjdG9ycztcbiAgICB9IGVsc2Uge1xuICAgICAgdmVjdG9ycyA9IGRhcmtWZWN0b3JzO1xuICAgIH1cblxuICAgIGNvbnN0IG91dE9mQm91bmRzID0gZnVuY3Rpb24oY29vcmRzKSB7XG4gICAgICByZXR1cm4gIShjb29yZHMueCA+PSAwICYmIGNvb3Jkcy54IDwgOCAmJiBjb29yZHMueSA+PSAwICYmIGNvb3Jkcy55IDwgOCk7XG4gICAgfTtcblxuICAgIGxldCAkbGVnYWxTcXVhcmVzID0gJCgpO1xuICAgIGNvbnN0IGJ1aWxkTW92ZXMgPSBmdW5jdGlvbihjb29yZHMsdmVjdG9ycyxqdW1wc09ubHkpIHtcblxuXG4gICAgICBpZiAob3V0T2ZCb3VuZHMoY29vcmRzKSkgcmV0dXJuO1xuXG4gICAgICAgIC8vb3VyIGN1cnJlbnQgc3F1YXJlIGlzIGF0IGNvb3Jkc1xuICAgICAgY29uc3QgJGN1cnJlbnRTcXVhcmUgPSAkc3F1YXJlcy5lcShjb29yZHMueSo4ICsgY29vcmRzLngpO1xuXG4gICAgICAkLmVhY2godmVjdG9ycyxmdW5jdGlvbihpbmRleCx2ZWN0b3IpIHtcblxuXG4gICAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IHtcbiAgICAgICAgICB4OiB2ZWN0b3IueCArIGNvb3Jkcy54LFxuICAgICAgICAgIHk6IHZlY3Rvci55ICsgY29vcmRzLnlcbiAgICAgICAgfTtcblxuXG4gICAgICAgIGlmIChvdXRPZkJvdW5kcyhuZXdDb29yZHMpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG5ld1NxdWFyZUluZGV4ID0gOCpuZXdDb29yZHMueSArIG5ld0Nvb3Jkcy54O1xuICAgICAgICAgICAgLy9pZiB0aGUgc3F1YXJlIGlzIHRha2VuLFxuICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XSkge1xuICAgICAgICAgICAgICAgIC8vaXQgZ2V0cyBpbnRlcmVzdGluZ1xuICAgICAgICAgICAgICAgIC8vb2sgLSBzbyB3ZSBjYW4gb25seSBqdW1wIGlmIHRoZWlyXG4gICAgICAgICAgICAgICAgLy9waWVjZSBpcyBkaWZmZXJlbnQgZnJvbSBvdXJzXG4gICAgICAgICAgaWYgKCRwaWVjZS5oYXNDbGFzcygnZGFyaycpKSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnZGFyaycpKSByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdLmhhc0NsYXNzKCdsaWdodCcpKSByZXR1cm47XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgICBjb25zdCBqdW1wQ29vcmRzID0ge1xuICAgICAgICAgICAgeDogdmVjdG9yLngqMiArIGNvb3Jkcy54LFxuICAgICAgICAgICAgeTogdmVjdG9yLnkqMiArIGNvb3Jkcy55XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAob3V0T2ZCb3VuZHMoanVtcENvb3JkcykpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGp1bXBTcXVhcmVJbmRleCA9IGp1bXBDb29yZHMueSo4ICsganVtcENvb3Jkcy54O1xuICAgICAgICAgICAgICAgIC8vaWYgdGhlIGp1bXAgc3F1YXJlIGlzIGZyZWUuLi5cbiAgICAgICAgICAgICAgICAvL2FkZCBpdCBhbmQgdGhlIGRhdGEtanVtcGVkLXBpZWNlc1xuICAgICAgICAgIGlmICghdGFrZW5TcXVhcmVzW2p1bXBTcXVhcmVJbmRleF0pIHtcbiAgICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShqdW1wU3F1YXJlSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAvL2lmIHdlIGhhdmVuJ3QgYWxyZWFkeSBzZWVuIGl0XG4gICAgICAgICAgICBpZiAoISRuZXdTcXVhcmUuaXMoJGxlZ2FsU3F1YXJlcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hZGQgdGhlIHBhc3NlZCBvdmVyIHNxdWFyZSB0byBpdFxuICAgICAgICAgICAgICAkbGVnYWxTcXVhcmVzID0gJGxlZ2FsU3F1YXJlcy5hZGQoJG5ld1NxdWFyZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5kIHRoZSBqdW1wZWQgc3F1YXJlcyBmcm9tIGhvdyB3ZSBnb3QgaGVyZVxuICAgICAgICAgICAgICBsZXQgJGp1bXBlZFBpZWNlcyA9IHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF07XG4gICAgICAgICAgICAgIGlmICgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSkge1xuICAgICAgICAgICAgICAgICRqdW1wZWRQaWVjZXMgPSAkanVtcGVkUGllY2VzLmFkZCgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCRqdW1wZWRQaWVjZXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FuZCByZWN1cnNlLCB3aXRoIGp1bXBzT25seSBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgICBidWlsZE1vdmVzKGp1bXBDb29yZHMsdmVjdG9ycyx0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWp1bXBzT25seSkge1xuICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShuZXdTcXVhcmVJbmRleCk7XG4gICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCQoKSk7XG4gICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH07XG4gICAgYnVpbGRNb3Zlcyhjb29yZHMsdmVjdG9ycyxmYWxzZSk7XG4gICAgcmV0dXJuICRsZWdhbFNxdWFyZXM7XG5cbiAgfS8vZW5kIG9mIG5ldyBnZXRNb3ZhYmxlU3F1YXJlc1xuXG4gIGZ1bmN0aW9uIHNldFVwUGllY2VzKCkge1xuICAgICAgLy9zZWxlY3QgYWxsIHRoZSBkaXZzIHdpdGggY2xhc3MgJ3BpZWNlJ1xuICAgICQoJ3BpZWNlJyk7XG4vL2FkZCB0aGUgJ2xpZ2h0JyBjbGFzcyB0byBoYWxmIG9mIHRoZW1cbiAgICAkKCdkaXYucGllY2U6ZXZlbicpLmFkZENsYXNzKCdsaWdodCcpO1xuLy9qUXVlcnkncyBldmVuIGFuZCBvZGQgc2VsZWN0b3IgbWV0aG9kcyB0byBhc3NpZ24gdGhlIGNsYXNzZXMgLmxpZ2h0IGFuZCAuZGFyay5cbi8vYWRkIHRoZSAnZGFyaycgdG8gdGhlIG90aGVyIGhhbGZcbiAgICAkKCdkaXYucGllY2U6b2RkJykuYWRkQ2xhc3MoJ2RhcmsnKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gbW92ZVBpZWNlVG8oJHBpZWNlLG5ld1RvcCxuZXdMZWZ0KSB7XG4gICAgICAvL3NldCB0aGUgY3NzICd0b3AnIGFuZCAnbGVmdCdcbiAgICAgIC8vYXR0cmlidXRlcyBvZiB0aGUgcGFzc2VkIHBpZWNlXG4gICAgICAvL3RvIHRoZSBhcmd1bWVudHMgbmV3VG9wIGFuZCBuZXdMZWZ0XG4gICAgJHBpZWNlLmNzcygndG9wJywgbmV3VG9wKTtcbiAgICAkcGllY2UuY3NzKCdsZWZ0JywgbmV3TGVmdCk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFVwQm9hcmQoKSB7XG4gICAgICAvL2l0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGRpdnMgd2l0aCBjbGFzcyBgc3F1YXJlYFxuICAgICAgLy9maWd1cmUgb3V0IHdoZXRoZXIgZWFjaCBvbmUgc2hvdWxkIGJlXG4gICAgICAvL2xpZ2h0IG9yIGRhcmssIGFuZCBhc3NpZ24gdGhlIHByb3BlciBjbGFzc1xuICAgIGNvbnN0ICRlYWNoU3F1YXJlID0gJCgnZGl2LnNxdWFyZScpO1xuICAgICRlYWNoU3F1YXJlLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xuICAgICAgaWYobGlnaHRPckRhcmsoaW5kZXgpPT09IDApe1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdsaWdodCcpO1xuICAgICAgfWVsc2V7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2RhcmsnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAgIC8vaW5uZXIgaGVscGVyIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBudW1iZXIgYmV0d2VlblxuICAgICAgLy8wIGFuZCA2MyAoaW5jbHVzaXZlKSBhbmQgcmV0dXJucyAxIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlXG4gICAgICAvL2RhcmssIGFuZCAwIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlIGxpZ2h0XG4gICAgZnVuY3Rpb24gbGlnaHRPckRhcmsoaW5kZXgpIHtcbiAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgY29uc3Qgb2RkWCA9IHggJSAyO1xuICAgICAgY29uc3Qgb2RkWSA9IHkgJSAyO1xuICAgICAgcmV0dXJuIChvZGRYIF4gb2RkWSk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVTZWxlY3QoJHBpZWNlKSB7XG4gICAgICAvL2lmICRwaWVjZSBoYXMgdGhlIGNsYXNzICdzZWxlY3RlZCcscmVtb3ZlIGl0XG4gICAgICAvL2lmICRwaWVjZSBkb2VzIG5vdCBoYXZlIHRoZSBjbGFzcyAnc2VsZWN0ZWQnXG4gICAgICAvL21ha2Ugc3VyZSBubyBvdGhlciBkaXZzIHdpdGggdGhlIGNsYXNzICdwaWVjZSdcbiAgICAgIC8vaGF2ZSB0aGF0IGNsYXNzLCB0aGVuIHNldCAkcGllY2UgdG8gaGF2ZSB0aGUgY2xhc3NcbiAgICBpZigkcGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAkcGllY2UucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgZWxzZSB7XG4gICAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAgIGlmKCQocGllY2UpLmhhc0NsYXNzKCdzZWxlY3RlZCcpKVxuICAgICAgICAgICQocGllY2UpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgfSk7XG4gICAgICAkcGllY2UuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgfVxuXG4gIH0vL2VuZCBvZiB0b2dnbGVTZWxlY3QgZnVuY3Rpb25cblxuICBmdW5jdGlvbiBpbmNyZW1lbnRtb3ZlQ291bnRlcigpIHtcbiAgICAgIC8vZ2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIG1vdmVDb3VudGVyXG4gICAgICAvL3R1cm5zIGl0IGludG8gYSBudW1iZXJcbiAgICAgIC8vaW5jcmVtZW50cyBpdCBieSBvbmVcbiAgICAgIC8vc2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIG1vdmVDb3VudGVyXG4gICAgICAvL3RvIHRoZSBuZXcgbW92ZSBjb3VudFxuICAgICQoJyNtb3ZlQ291bnRlcicpLmh0bWwocGFyc2VJbnQoJCgnI21vdmVDb3VudGVyJykuaHRtbCgpLDEwKSsxKTtcbiAgfVxuXG4gIC8vdGhpcyByZXNldHMgdGhlIGdhbWUgYnkgZWZmZWN0aXZlbHkgcmVsb2FkaW5nIHRoZSBwYWdlIGZyb20gY2FjaGVcbiAgZnVuY3Rpb24gcmVzZXQoKXtcbiAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgfVxuXG5cblxuXG59KTsvL2VuZCBvZiBKUyBsb2FkXG5cblxuLypcblRPRE86XG4xLiBQbGF5ZXIgY2hhbmdlIGZyb20gcGxheWVyIDEgdG8gcGxheWVyIDJcbjIuIEZpZ3VyZSBvdXQgaG93IHRvIHN0b3AgaWxsZWdhbCBtb3Zlcy5cbiAgLW9ubHkgbWFrZSB0d28gcG9zdGl0aW9ucyBhdmFpbGFibGUgYXQgYW55IGdpdmVuIHRpbWVcbiAgLW9uY2UgdGhlIHBpZWNlIGhhcyBtb3ZlZCBpbnRvIGEgcG9zaXRpb24gbWFrZVxuXG4gIC1PbiBjbGljayBvZiBzcWF1cmVcbiAgLWdldCBwaWVjZSBvbiBzcWF1cmUgKGUudGFyZ2V0KVxuICAtY2hlY2sgaWYgcGllY2UgYmVsb25ncyB0byBwMSBvciBwMlxuICAtY2hlY2sgcmVsZXZhbnQgc3F1YXJlc1xuICAgIC5pZiBpbmRleCBvZiBjdXJyZW50U3F1YXJlXG4gICAgLmlmIHNxdWFyZSBpcyBub3QgaW4gdGhlIGZpcnN0IGNvbHVtblxuICAgIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IGxlZnQgYW5kIG1vdmFibGUgY2xhc3MgaWYgZW1wdHlcbiAgICAuaWYgc3F1YXJlIGlzIG5vdCBpbiB0aGUgbGFzdCBjb2x1bW5cbiAgICBjaGVjayBzcXVhcmUgZGlhZ29uYWxseSByaWdodCBhbmQgbW92YWJsZSBjbGFzcyBpZiBlbXB0eVxuICAtb25jZSBwaWVjZSBpcyBtb3ZlZCBvciBpZiB1bi1zZWxlY3RlZCByZW1vdmUgbW92YWJsZSBjbGFzcyBmcm9tIGFsbCBzcXVhcmVzLlxuXG5pbmRleCAocG9zaXRpb24pJSB3aWR0aCA9PT0gMCAuLi5yZXByZXNlbnRzIHRoZSBmaXJzdCBjb2x1bW5cbmluZGV4ICUgd2lkdGggPT09IHdpZHRoLTEgLi4ucmVwcmVzZW50cyB0aGUgbGFzdCBjb2x1bW5cblxuaW5kZXggKyB3aWR0aC0xIGZvciBwbGF5ZXIxIGlzIGdvaW5nIGxlZnQgZGlhZ29uYWxseVxuaW5kZXggKyB3aWR0aC0xIGZvciBwbGF5ZXIxIGlzIGdvaW5nIHJpZ2h0IGRpYWdvbmFsbHlcblxuaW5kZXggLSB3aWR0aCsxIGZvciBwbGF5ZXIyIGlzIGdvaW5nIGxlZnQgZGlhZ29uYWxseVxuaW5kZXggLSB3aWR0aC0xIGZvciBwbGF5ZXIyIGlzIGdvaW5nIHJpZ2h0IGRpYWdvbmFsbHlcblxuXG4zLiBKdW1wIG1vdmVzIHRvIG1ha2UgdGhlIG9wcG9uZW50cyBwaWVjZSBkaXNhcHBlYXIgZnJvbSB0aGUgYm9hcmQgYW5kIHJlc2V0XG4gIHRoZSBwb3NpdG9uXG40LiBLaW5nIG1ha2VyIGZ1bmN0aW9uXG41LiBIb3cgdG8gdGFrZSBpbiB0aGUgdG9wIHJpZ2h0IHBvc2l0aW9uXG42LlJlc2V0IHRoZSBnYW1lIGJldHRlclxuXG5cbiovXG4iXX0=
