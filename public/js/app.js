"use strict";$(function(){function e(){var e=$(event.target).position();return k=n(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(f+h)+"px",left:e*(f+h)+"px"}}function n(e,a){return{x:a/(f+h),y:e/(f+h)}}function o(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var o=$(a).position(),i=n(o.top,o.left),s=8*i.y+i.x;t[s]=$(a)});var o=n(e.position().top,e.position().left),i=[{x:1,y:1},{x:-1,y:1}],s=[{x:1,y:-1},{x:-1,y:-1}],l=i.concat(s),r=void 0;r=e.hasClass("king")?l:e.hasClass("light")?i:s;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},d=$();return function n(o,i,s){if(!c(o)){var l=a.eq(8*o.y+o.x);$.each(i,function(i,r){var v={x:r.x+o.x,y:r.y+o.y};if(!c(v)){var u=8*v.y+v.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var f={x:2*r.x+o.x,y:2*r.y+o.y};if(c(f))return;var h=8*f.y+f.x;if(!t[h]){var p=a.eq(h);if(!p.is(d)){d=d.add(p);var g=t[u];l.data("jumpedPieces")&&(g=g.add(l.data("jumpedPieces"))),p.data("jumpedPieces",g),n(f,r,!0)}}}else if(!s){var C=a.eq(u);C.data("jumpedPieces",$()),d=d.add(C)}}})}}(o,r,!1),d}function i(e,a,t){e.css("top",a),e.css("left",t)}function s(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function l(){P.html(parseInt(P.html())+1)}function r(e){var a="";a="light"===e?"#lightMoveCount":"#darkMoveCount";var t=parseInt($(a).html());t++,$(a).html(t),console.log(t),t%2==1?(console.log("Hello odd number"),console.log(q)):t%2==0&&(console.log("Hello even number"),console.log(b))}function c(e){e.data("jumpedPieces").remove()}function d(e,a){for(var t=0;t<64;t++)(a<8||a>=56)&&e.addClass("king")}function v(){var e=q.length,a=b.length;return 0===e?(y.text("Player 1 Wins"),y.slideDown("Player 1 Wins")):0===a?(console.log("Player 2 wins"),y.text("Player 2 Wins")):1===a&&1===e?(console.log("It's a draw"),y.text("It's a draw")):void 0}function u(){location.reload()}var f=46,h=2,p=$("div#board"),g=$("div#pieces"),C=$("#reset-button"),m=$("#rules-button"),x=$(".instructions"),y=$("#winner"),k=null;!function(){function e(e){return e%8%2^Math.floor(e/8)%2}for(var a=0;a<64;a++)p.append($("<div/>").addClass("square"));for(var t=0;t<24;t++)g.append($("<div/>").addClass("piece"));$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}(),function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),function(){$("div.piece.dark").each(function(e,a){var n=Math.floor(e/4)+5,o=e%4*2+(1-n%2),s=t(o,n);i($(a),s.top,s.left)})}(),function(){var e=$("div.piece.light");e.each(function(a,n){console.log(e.length);var o=Math.floor(a/4),s=a%4*2+(1-o%2),l=t(s,o);i($(n),l.top,l.left)})}(),C.on("click",function(){u()}),m.on("click",function(){x.toggle("slow"),console.log("Clicking here works")}),$("div.square").on("click",function(n){e();var o=$(n.target);if(o.hasClass("movable")){var s=$("div.piece.selected");if(1===s.length){var u=o.prevAll().length,f=u%8,h=Math.floor(u/8),p=t(f,h);i(s,p.top,p.left),c(o),d(s,o.prevAll().length),s.removeClass("selected"),$("div.square").removeClass("movable"),v(),l();r(!0===s.hasClass("light")?"light":"dark"),a()}}});var P=$("#moveCounter");!function(){$("div.piece").on("click",function(e){var t=$(e.target);s(t),a(),t.hasClass("selected")&&o(t).addClass("movable")})}();var b=$("div.piece.light"),q=$("div.piece.dark")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiY3VycmVudFBvc2l0aW9uIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsImNvb3JkcyIsImdldENvb3JkcyIsInRvcCIsImxlZnQiLCJnZXRQaXhlbHMiLCJyZW1vdmVEYXRhIiwicmVtb3ZlQ2xhc3MiLCJ4IiwieSIsImJvcmRlciIsIndpZHRoIiwidGFrZW5TcXVhcmVzIiwiJHBpZWNlIiwiJHNxdWFyZXMiLCJlYWNoIiwiaW5kZXgiLCJwaWVjZSIsImxpZ2h0RGlyZWN0aW9uIiwic3F1YXJlSW5kZXgiLCJkYXJrRGlyZWN0aW9uIiwiZGlyZWN0aW9uIiwib3V0T2ZCb3VuZHMiLCJraW5nRGlyZWN0aW9uIiwiY29uY2F0IiwiYnVpbGRNb3ZlcyIsIiRjdXJyZW50U3F1YXJlIiwibmV3Q29vcmRzIiwiJGxlZ2FsU3F1YXJlcyIsIm5ld1NxdWFyZUluZGV4IiwianVtcHNPbmx5IiwiZXEiLCJoYXNDbGFzcyIsImp1bXBTcXVhcmVJbmRleCIsImp1bXBDb29yZHMiLCIkanVtcGVkUGllY2VzIiwiYWRkIiwiJG5ld1NxdWFyZSIsImlzIiwiZGF0YSIsInNldFVwUGllY2VzIiwiYWRkQ2xhc3MiLCJtb3ZlUGllY2VUbyIsIm5ld1RvcCIsIm5ld0xlZnQiLCJjc3MiLCJpIiwidG9nZ2xlU2VsZWN0IiwicGllY2VTZWxlY3QiLCJpbmNyZW1lbnRNb3ZlQ291bnQiLCJ3aGljaENvdW50ZXIiLCJjb25zb2xlIiwiJG1vdmVDb3VudGVyIiwiJG1vdmVzIiwiaHRtbCIsIiRsaWdodFBpZWNlcyIsImNvbG9yIiwicmVtb3ZlQ2FwdHVyZWRQaWVjZXMiLCIkc3F1YXJlIiwibG9nIiwiY2hlY2tLaW5nIiwiJHdpbm5lciIsInJlbW92ZSIsInRleHQiLCJwaWVjZXNMZWZ0IiwiZGFya1BpZWNlcyIsIiRkYXJrUGllY2VzIiwibGVuZ3RoIiwibGlnaHRQaWVjZXMiLCJzbGlkZURvd24iLCJyZXNldCIsImxvY2F0aW9uIiwicmVsb2FkIiwiJGJvYXJkIiwiJHBpZWNlcyIsIiRyZXNldEJ1dHRvbiIsIiRydWxlc0J1dHRvbiIsImZsb29yIiwiJGVhY2hTcXVhcmUiLCJhcHBlbmQiLCJsaWdodE9yRGFyayIsInRoaXMiLCJzcXVhcmVDb3VudCIsIk1hdGgiLCJwaXhlbFBvc2l0aW9uIiwib24iLCIkaW5zdHJ1Y3Rpb25zIiwidG9nZ2xlIiwiJHBpZWNlVG9Nb3ZlIiwiZSIsIiRzZWxlY3RlZFBpZWNlIiwicHJldkFsbCIsInBpeGVscyIsImluY3JlbWVudE1vdmVDb3VudGVyIiwicmVzZXRNb3ZhYmxlcyIsIiR0aGlzUGllY2UiLCJnZXRNb3ZhYmxlU3F1YXJlcyJdLCJtYXBwaW5ncyI6IllBQ0FBLEdBQUUsV0ErSkMsUUFBQUMsS0FQQyxHQUFNQyxHQUFXRixFQUFFRyxNQUFNQyxRQUFRRixVQVVuQyxPQURBRyxHQUFBQyxFQUFBSixFQUFBSyxJQUFBTCxFQUFBTSxNQUlBLFFBQVNDLEtBQ0xULEVBQUEsY0FBQVUsV0FBQSxnQkFBQUMsWUFBQSxXQURKLFFBQVNGLEdBQVVHLEVBQUVDLEdBV3JCLE9BQ0FOLElBQVNELEdBQUFBLEVBQVRRLEdBQTZCLEtBQ3pCTixLQUFBSSxHQUFBRyxFQUFBRCxHQUFBLE1BREosUUFBU1IsR0FBVUMsRUFBSUMsR0FXdkIsT0FQSUksRUFBS0osR0FBUU8sRUFBUUQsR0FTdkJELEVBQUFOLEdBQUFRLEVBQUFELElBTUEsUUFBTUUsR0FBTkMsR0FHUSxHQUFBQyxHQUFBbEIsRUFBQSxjQUZSZ0IsSUFBQWhCLEdBQUUsYUFBYW1CLEtBQUssU0FBU0MsRUFBTUMsR0FXbkMsR0FBQW5CLEdBQUFGLEVBQUFxQixHQUFBbkIsV0FDTW9CLEVBQUFBLEVBQ0VwQixFQURlSyxJQUVsQkssRUFBTUMsTUFFWFUsRUFBQSxFQUFBbEIsRUFBQVEsRUFBQVIsRUFBQU8sQ0FDQUksR0FBTVEsR0FDSVgsRUFBR1EsSUFUYixJQUFNaEIsR0FBU0MsRUFBVVcsRUFBT2YsV0FBV0ssSUFBSVUsRUFBT2YsV0FBV00sTUFpQi9E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SSxFQUFBdkYsRUFBQUcsRUFBQUMsRUFFQW1ELEdBQVU4QixFQUFlRixFQUFBQSxJQUFBQSxFQUFhRyxNQUV0Q0QsRUFBZW5GLEdBR2ZYLEVBQUU4RixFQUFjbkYsRUFBaEJvRixVQUFBeEIsUUFFQXVCLEVBQUFuRixZQUFBLFlBR0FYLEVBQUEsY0FBQVcsWUFBQSxXQUdBeUQsSUFHQTZCLEdBMUNONUMsSUE2Q0ssSUFBQXlDLEVBQUExRCxTQUFBLFNBQUEsUUFBQSxRQU1QOEQsT0E0UElsRyxJQUFFc0QsR0FBY0ksRUFBS0QsaUJBOVVyQnpELFdBQ0lBLEVBQUEsYUFBQXlGLEdBQUEsUUFBQSxTQUFBdEYsR0FHQSxHQUFBZ0csR0FBQW5HLEVBQUFHLEVBQUFDLE9BR0Y4RixHQUFBQSxHQUNFQSxJQUVBRSxFQUFBQSxTQUFrQkQsYUFDbkJDLEVBQUFELEdBQUF0RCxTQUFBLGVBd1dQLElBQUFjLEdBQUEzRCxFQUFBLG1CQUNBc0UsRUFBQXRFLEVBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9sb2FkaW5nIEpTXG4kKCgpPT57XG5cbiAgLy9HTE9CQUwgVkFSSUFCTEVTXG4gIGNvbnN0IHdpZHRoID0gNDY7XG4gIGNvbnN0IGJvcmRlciA9IDI7XG4gIGNvbnN0ICRib2FyZCA9ICQoJ2RpdiNib2FyZCcpO1xuICBjb25zdCAkcGllY2VzID0gJCgnZGl2I3BpZWNlcycpO1xuICBjb25zdCAkcmVzZXRCdXR0b24gPSAkKCcjcmVzZXQtYnV0dG9uJyk7XG4gIGNvbnN0ICRydWxlc0J1dHRvbiA9ICQoJyNydWxlcy1idXR0b24nKTtcbiAgY29uc3QgJGluc3RydWN0aW9ucyA9ICQoJy5pbnN0cnVjdGlvbnMnKTtcbiAgY29uc3QgJHdpbm5lciA9ICQoJyN3aW5uZXInKTtcblxuXG4gIGxldCBjb29yZHMgPSBudWxsOy8vc2V0dGluZyBjb29yZHMgZ2xvYmFsbHkgc28gaXQncyBjb25zdGFudGx5IHVwZGF0aW5nXG4gIC8vc2V0IHVwIHRoZSBib2FyZCB3aXRoIHRoZSBjb3JyZWN0IGNsYXNzZXMgZm9yIHRoZSBsaWdodCBhbmQgZGFyayBzcXVhcmVzXG4gIHNldFVwQm9hcmQoKTtcbiAgLy9zZXRzIHVwIHRoZSBjbGFzc2VzIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzIG9mIHBpZWNlXG4gIHNldFVwUGllY2VzKCk7XG4gIC8vc2V0dGluZyB1cCB0aGUgZGFya1BpZWNlc1xuICBkYXJrUGllY2VzKCk7XG4gIC8vIHNldHRpbmcgdXAgdGhlIGxpZ2h0UGllY2VzXG4gIGxpZ2h0UGllY2VzKCk7XG5cblxuICAvL0xJR0hUIFBJRUNFU1xuICBmdW5jdGlvbiBsaWdodFBpZWNlcygpe1xuICAgIGNvbnN0ICRsaWdodFBpZWNlcyA9ICQoJ2Rpdi5waWVjZS5saWdodCcpO1xuICAgIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgbGlnaHQgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICAgJGxpZ2h0UGllY2VzLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcbiAgICAgIC8vIFRFU1QgY2hlY2tpbmcgdGhlIGxlbmd0aFxuICAgICAgY29uc29sZS5sb2coJGxpZ2h0UGllY2VzLmxlbmd0aCk7XG4gICAgICAvL3R1cm5pbmcgdGhlIGluZGV4IChmcm9tIDAgLSAxMSlcbiAgICAgIC8vaW50byBhIHgseSBzcXVhcmUgY29vcmRpbmF0ZSB1c2luZyBtYXRoc1xuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA0KTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHklMik7XG5cbiAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgICAvL2FjdHVhbGx5IG1vdmluZyB0aGUgcGllY2UgdG8gaXRzIGluaXRpYWwgcG9zaXRpb25cbiAgICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLHBpeGVsUG9zaXRpb24udG9wLHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gICAgfSk7XG4gIH0vL2VuZCBvZiBsaWdodFBpZWNlcyBmdW5jdGlvblxuXG5cbiAgLy9EQVJLIFBJRUNFU1xuICBmdW5jdGlvbiBkYXJrUGllY2VzKCl7XG4gICAgY29uc3QgJGRhcmtQaWVjZXMgPSAgICQoJ2Rpdi5waWVjZS5kYXJrJyk7XG4gICAgICAgIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgZGFyayBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgICAkZGFya1BpZWNlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgICAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aHNcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4LzQpICsgNTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMS15JTIpO1xuXG4gICAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgICAgIC8vbW92aW5nIHRoZSBwaWVjZSB0byBpdHMgaW5pdGlhbCBwb3NpdGlvblxuICAgICAgbW92ZVBpZWNlVG8oJChwaWVjZSkscGl4ZWxQb3NpdGlvbi50b3AscGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgICB9KTtcbiAgfS8vZW5kIG9mIGRhcmtQaWVjZXMgZnVuY3Rpb25cblxuXG5cbiAgLy9FVkVOVFNcbiAgZnVuY3Rpb24gcGllY2VTZWxlY3QoKXtcbiAgICAkKCdkaXYucGllY2UnKS5vbignY2xpY2snLChldmVudCk9PntcbiAgICAgICAgLy9zZWxlY3RlZCB2YXJpYWJsZVxuICAgICAgICAvL3R1cm4gYHRoaXNgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgICBjb25zdCAkdGhpc1BpZWNlID0gJChldmVudC50YXJnZXQpO1xuICAgICAgICAvL3RvZ2dsaW5nIHRoZSAnc2VsZWN0ZWQnIGNsYXNzIG9mIHRoaXMgcGllY2VcbiAgICAgICAgLy9hbmQgcG9zc2libGUgZGVzZWxlY3Rpbmcgb3RoZXIgcGllY2VzXG4gICAgICB0b2dnbGVTZWxlY3QoJHRoaXNQaWVjZSk7XG4gICAgICByZXNldE1vdmFibGVzKCk7XG4gICAgICAgIC8vZ2V0IHRoZSBsZWdhbCBtb3ZlcyBmb3IgdGhpc1xuICAgICAgaWYgKCR0aGlzUGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpIHtcbiAgICAgICAgZ2V0TW92YWJsZVNxdWFyZXMoJHRoaXNQaWVjZSkuYWRkQ2xhc3MoJ21vdmFibGUnKTtcbiAgICAgIH1cbiAgICB9KTsvL2VuZCBvZiBwaWVjZSBjbGljayBldmVudFxuXG4gIH1cblxuICAvLyBCVVRUT05TXG4gIC8vcmVzZXR0aW5nIHRoZSBnYW1lLlxuICAkcmVzZXRCdXR0b24ub24oJ2NsaWNrJywgKCk9PntcbiAgICByZXNldCgpO1xuICAgIC8vIHNldHRpbmcgdXAgdGhlIHBpZWNlcyBhZnRlciBlbXB0eWluZyB0aGVtLlxuICB9KTtcblxuICAvL2hpZGluZyBhbmQgc2hvd2luZyB0aGUgcnVsZXMuXG4gICRydWxlc0J1dHRvbi5vbignY2xpY2snLCAoKT0+e1xuICAgICRpbnN0cnVjdGlvbnMudG9nZ2xlKCdzbG93Jyk7XG4gICAgY29uc29sZS5sb2coYENsaWNraW5nIGhlcmUgd29ya3NgKTtcbiAgfSk7XG5cblxuXG4gICQoJ2Rpdi5zcXVhcmUnKS5vbignY2xpY2snLCAoZSk9PntcblxuICAgIGN1cnJlbnRQb3NpdGlvbigpOy8vdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgc3F1YXJlOyBjb29yZHNcbiAgICAvL3R1cm4gYGUgb3IgZXZlbnRgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgY29uc3QgJHBpZWNlVG9Nb3ZlID0gJChlLnRhcmdldCk7XG5cblxuICAgIC8vaWYgJCh0aGlzKSBpcyBhIGxlZ2FsIHNxdWFyZSB0byBtb3ZlIHRvLi4uXG4gICAgaWYgKCRwaWVjZVRvTW92ZS5oYXNDbGFzcygnbW92YWJsZScpKSB7XG5cbiAgICAgICAgICAvL2dldCB0aGUgcGllY2Ugd2l0aCB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgICAgY29uc3QgJHNlbGVjdGVkUGllY2UgPSAkKCdkaXYucGllY2Uuc2VsZWN0ZWQnKTtcbiAgICAgICAgICAvL29ubHkgbW92ZSBpZiB0aGVyZSBpcyBleGFjdGx5IG9uZSBzZWxlY3RlZCBwaWVjZVxuICAgICAgaWYgKCRzZWxlY3RlZFBpZWNlLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgLy9nZXQgdGhlIGluZGV4IG9mIHRoZSBzcXVhcmVcbiAgICAgICAgICAgIC8vYW5kIHRyYW5zbGF0ZSBpdCB0byBwaXhlbCBwb3NpdGlvblxuICAgICAgICBjb25zdCBpbmRleCA9ICRwaWVjZVRvTW92ZS5wcmV2QWxsKCkubGVuZ3RoO1xuICAgICAgICBjb25zdCB4ID0gaW5kZXggJSA4O1xuICAgICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgICBjb25zdCBwaXhlbHMgPSBnZXRQaXhlbHMoeCx5KTtcbiAgICAgICAgICAgIC8vYWN0dWFsbHkgZG8gdGhlIG1vdmluZ1xuICAgICAgICBtb3ZlUGllY2VUbygkc2VsZWN0ZWRQaWVjZSxwaXhlbHMudG9wLHBpeGVscy5sZWZ0KTtcbiAgICAgICAgICAvL3JlbW92ZUNhcHR1cmVkUGllY2VzXG4gICAgICAgIHJlbW92ZUNhcHR1cmVkUGllY2VzKCRwaWVjZVRvTW92ZSk7XG4gICAgICAgIC8vLnByZXZBbGwoKS5sZW5ndGggaXMgdXNlZCB0byBnZXQgdGhlIGluZGV4XG4gICAgICAgIC8vb2YgdGhlIHNlbGVjdGVkIHBpZWNlXG4gICAgICAgIGNoZWNrS2luZygkc2VsZWN0ZWRQaWVjZSwkcGllY2VUb01vdmUucHJldkFsbCgpLmxlbmd0aCk7XG4gICAgICAgIC8vZGUtc2VsZWN0IHRoZSBwaWVjZSB0byBlbmQgdGhlIG1vdmVcbiAgICAgICAgJHNlbGVjdGVkUGllY2UucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cbiAgICAgICAgLy9zZXQgdGhlIG5ldyBsZWdhbCBtb3Zlc1xuICAgICAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcblxuICAgICAgICAvLyBURVNULiB0ZXN0aW5nIHRoZSB3aW5uaW5nIGNvbmRpdGlvbnMgYnkgY2hlY2tpbmcgdGhlIG51bWJlciBvZiBwaWVjZXMgbGVmdCBvbiB0aGUgYm9hcmRcbiAgICAgICAgcGllY2VzTGVmdCgpO1xuXG4gICAgICAgIC8vaW5jcmVtZW50IHRoZSBtb3ZlIGNvdW50ZXJcbiAgICAgICAgaW5jcmVtZW50TW92ZUNvdW50ZXIoKTtcblxuICAgICAgICBjb25zdCBjb2xvciA9ICRzZWxlY3RlZFBpZWNlLmhhc0NsYXNzKCdsaWdodCcpID09PSB0cnVlID8gJ2xpZ2h0JyA6ICdkYXJrJztcblxuICAgICAgICBpbmNyZW1lbnRNb3ZlQ291bnQoY29sb3IpO1xuICAgICAgICAvL3Jlc2V0IHRoZSBzcXVhcmVzIHRvIGFsbG93IG1vdmVzXG4gICAgICAgIHJlc2V0TW92YWJsZXMoKTtcblxuICAgICAgfVxuICAgIH1cblxuICB9KTtcblxuXG4vLyBNT1JFIEZVTkNUSU9OU1xuLy90aGlzIGZ1bmN0aW9uIHJlbW92ZXMgdGhlIGRhdGEgaXRlbSB3aXRoIGtleSAnanVtcGVkUGllY2VzJyBmcm9tIGV2ZXJ5IGRpdi5zcXVhcmVcbi8vIGFuZCByZW1vdmVzIHRoZSBjbGFzcyAnbW92YWJsZScgZnJvbSBldmVyeSBzcXVhcmVcbi8vY2hlY2tzIHRoZSBjdXJyZW50UG9zaXRpb24gb2YgdGhlIGNsaWNrZWQgb3Igc2VsZWN0ZWQgZGl2IGFuZCByZXR1cm5zIHRoZSBjb29yZHMuXG4gIGZ1bmN0aW9uIGN1cnJlbnRQb3NpdGlvbigpe1xuICAgIGNvbnN0IHBvc2l0aW9uID0gJChldmVudC50YXJnZXQpLnBvc2l0aW9uKCk7XG4gICAgY29vcmRzID0gZ2V0Q29vcmRzKHBvc2l0aW9uLnRvcCxwb3NpdGlvbi5sZWZ0KTtcbiAgICByZXR1cm4gY29vcmRzO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRNb3ZhYmxlcygpIHtcbiAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlRGF0YSgnanVtcGVkUGllY2VzJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHRyYW5zbGF0aW5nIGFuIHgseSBjb29yZGluYXRlcyB0byBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vdGhlIGNvbnZlbnRpb24gaXMgdGhhdCB0aGUgc3F1YXJlIGluIHRoZSB1cHBlciBsZWZ0IGNvcm5lciBpcyBhdCBwb3NpdGlvbiAwLDBcbiAgLy90aGUgc3F1YXJlIGluIHRoZSB1cHBlciByaWdodCwgYXQgNywwIGFuZCB0aGUgbG93ZXJcbiAgLy9yaWdodCBhdCA3LDdcbiAgZnVuY3Rpb24gZ2V0UGl4ZWxzKHgseSkge1xuICAgICAgLy90YWtlcyBhbiB4LHkgcG9zaXRpb24sIHJldHVybnNcbiAgICAgIC8vcGl4ZWxzIGZyb20gdGhlIGxlZnQsIHJpZ2h0XG4gICAgcmV0dXJuIHtcbiAgICAgICd0b3AnOiAoeSAqICh3aWR0aCtib3JkZXIpKSsncHgnLFxuICAgICAgJ2xlZnQnOiAoeCAqICh3aWR0aCtib3JkZXIpKSsncHgnXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHR1cm5pbmcgYSBwaXhlbCBwb3NpdGlvblxuICAvL2ludG8gdGhlIHgseSBjb29yZGluYXRlIG9mIGEgc3F1YXJlIG9uIHRoZSBib2FyZFxuICAvL2l0IGZvbGxvd3MgdGhlIHNhbWUgY29vcmRpbmF0ZSBjb252ZW50aW9uIGFzIGdldFBpeGVsc1xuICBmdW5jdGlvbiBnZXRDb29yZHModG9wLGxlZnQpIHtcbiAgICAgIC8vcmV0dXJucyBhbiB4IGFuZCBhIHlcbiAgICAgIC8vZ2l2ZW4gYSB0b3AgYW5kIGxlZnQgcGl4ZWxzXG4gICAgcmV0dXJuIHtcbiAgICAgICd4JzogbGVmdCAvICh3aWR0aCArIGJvcmRlciksXG4gICAgICAneSc6IHRvcCAvICh3aWR0aCArIGJvcmRlcilcbiAgICB9O1xuICB9XG5cbiAgLy9mdW5jdGlvbiBmb3IgcmV0dXJuaW5nIHRoZSBzZXQgb2YgbGVnYWwgbW92ZXMgZ2l2ZW4gYSBwaWVjZVxuLy8gdGhpcyBhbHNvIHN0b3JlcyBqdW1wZWQgcGllY2VzIGluIGEgZGF0YSBlbGVtZW50IG9mIGVhY2ggc3F1YXJlIHRoYXQgY2FuIGJlIG1vdmVkIHRvXG4gIGZ1bmN0aW9uIGdldE1vdmFibGVTcXVhcmVzKCRwaWVjZSkge1xuXG4gICAgLy9zZWxlY3QgYWxsIG9mIHRoZSBzcXVhcmVzXG4gICAgY29uc3QgJHNxdWFyZXMgPSAkKCdkaXYuc3F1YXJlJyk7XG5cbiAgICAvL3NlbGVjdCB0aGUgb2NjdXBpZWQgb25lcyB1c2luZyB0aGUgalF1ZXJ5IG1hcCgpIG1ldGhvZFxuICAgIC8vbWFwIGNyZWF0ZXMgYSBuZXcgb2JqZWN0IGZyb20gYW4gZXhpc3Rpbmcgb25lXG4gICAgLy91c2luZyBhIHRyYW5zbGF0aW9uIGZ1bmN0aW9uXG4gICAgY29uc3QgdGFrZW5TcXVhcmVzID0ge307XG4gICAgJCgnZGl2LnBpZWNlJykuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuXG4gICAgICAgICAgICAvL3RoaXMgZnVuY3Rpb24gdHJhbnNsYXRlcyBhIHBpZWNlXG4gICAgICBjb25zdCBwb3NpdGlvbiA9ICQocGllY2UpLnBvc2l0aW9uKCk7XG4gICAgICBjb25zdCBjb29yZHMgPSBnZXRDb29yZHMocG9zaXRpb24udG9wLHBvc2l0aW9uLmxlZnQpO1xuICAgICAgY29uc3Qgc3F1YXJlSW5kZXggPSBjb29yZHMueSAqIDggKyBjb29yZHMueDtcbiAgICAgIHRha2VuU3F1YXJlc1tzcXVhcmVJbmRleF0gPSAkKHBpZWNlKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3JkcygkcGllY2UucG9zaXRpb24oKS50b3AsJHBpZWNlLnBvc2l0aW9uKCkubGVmdCk7XG5cbiAgICAvL2xpZ2h0cyBtb3ZlIGRvd24gdGhlIGJvYXJkXG4gICAgY29uc3QgbGlnaHREaXJlY3Rpb24gPSBbXG4gICAgICAgIHt4OiAxLHk6IDF9LFxuICAgICAgICB7eDogLTEseTogMX1cbiAgICBdO1xuICAgIC8vZGFya3MgbW92ZSB1cCB0aGUgYm9hcmRcbiAgICBjb25zdCBkYXJrRGlyZWN0aW9uID0gW1xuICAgICAgICB7eDogMSx5OiAtMX0sXG4gICAgICAgIHt4OiAtMSx5OiAtMX1cbiAgICBdO1xuICAgIC8va2luZ3MgbW92ZSBpbiBhbnkgZGlyZWN0aW9uXG4gICAgY29uc3Qga2luZ0RpcmVjdGlvbiA9IGxpZ2h0RGlyZWN0aW9uLmNvbmNhdChkYXJrRGlyZWN0aW9uKTtcblxuICAgIGxldCBkaXJlY3Rpb247XG4gICAgaWYgKCRwaWVjZS5oYXNDbGFzcygna2luZycpKSB7XG4gICAgICBkaXJlY3Rpb24gPSBraW5nRGlyZWN0aW9uO1xuICAgIH0gZWxzZSBpZiAoJHBpZWNlLmhhc0NsYXNzKCdsaWdodCcpKSB7XG4gICAgICBkaXJlY3Rpb24gPSBsaWdodERpcmVjdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlyZWN0aW9uID0gZGFya0RpcmVjdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdCBvdXRPZkJvdW5kcyA9IGZ1bmN0aW9uKGNvb3Jkcykge1xuICAgICAgcmV0dXJuICEoY29vcmRzLnggPj0gMCAmJiBjb29yZHMueCA8IDggJiYgY29vcmRzLnkgPj0gMCAmJiBjb29yZHMueSA8IDgpO1xuICAgIH07XG5cbiAgICBsZXQgJGxlZ2FsU3F1YXJlcyA9ICQoKTtcbiAgICBjb25zdCBidWlsZE1vdmVzID0gZnVuY3Rpb24oY29vcmRzLGRpcmVjdGlvbixqdW1wc09ubHkpIHtcbiAgICAgIGlmIChvdXRPZkJvdW5kcyhjb29yZHMpKSByZXR1cm47XG4gICAgICAgIC8vY3VycmVudCBzcXVhcmUgaXMgYXQgY29vcmRzXG4gICAgICBjb25zdCAkY3VycmVudFNxdWFyZSA9ICRzcXVhcmVzLmVxKGNvb3Jkcy55KjggKyBjb29yZHMueCk7XG4gICAgICAkLmVhY2goZGlyZWN0aW9uLGZ1bmN0aW9uKGluZGV4LGRpcmVjdGlvbikge1xuXG4gICAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IHtcbiAgICAgICAgICB4OiBkaXJlY3Rpb24ueCArIGNvb3Jkcy54LFxuICAgICAgICAgIHk6IGRpcmVjdGlvbi55ICsgY29vcmRzLnlcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAob3V0T2ZCb3VuZHMobmV3Q29vcmRzKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBuZXdTcXVhcmVJbmRleCA9IDgqbmV3Q29vcmRzLnkgKyBuZXdDb29yZHMueDtcbiAgICAgICAgICAgIC8vaWYgdGhlIHNxdWFyZSBpcyB0YWtlbixcbiAgICAgICAgaWYgKHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF0pIHtcblxuICAgICAgICAgICAgICAgIC8vQ2FuIG9ubHkganVtcCBpZiBwaWVjZSBpcyBkaWZmZXJlbnRcbiAgICAgICAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdkYXJrJykpIHtcbiAgICAgICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdLmhhc0NsYXNzKCdkYXJrJykpIHJldHVybjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF0uaGFzQ2xhc3MoJ2xpZ2h0JykpIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBqdW1wQ29vcmRzID0ge1xuICAgICAgICAgICAgeDogZGlyZWN0aW9uLngqMiArIGNvb3Jkcy54LFxuICAgICAgICAgICAgeTogZGlyZWN0aW9uLnkqMiArIGNvb3Jkcy55XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAob3V0T2ZCb3VuZHMoanVtcENvb3JkcykpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGp1bXBTcXVhcmVJbmRleCA9IGp1bXBDb29yZHMueSo4ICsganVtcENvb3Jkcy54O1xuICAgICAgICAgICAgICAgIC8vaWYgdGhlIGp1bXAgc3F1YXJlIGlzIGZyZWUuLi5cbiAgICAgICAgICAgICAgICAvL2FkZCBpdCBhbmQgdGhlIGRhdGEtanVtcGVkLXBpZWNlc1xuICAgICAgICAgIGlmICghdGFrZW5TcXVhcmVzW2p1bXBTcXVhcmVJbmRleF0pIHtcbiAgICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShqdW1wU3F1YXJlSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAvL2lmIHdlIGhhdmVuJ3QgYWxyZWFkeSBzZWVuIGl0XG4gICAgICAgICAgICBpZiAoISRuZXdTcXVhcmUuaXMoJGxlZ2FsU3F1YXJlcykpIHtcblxuICAgICAgICAgICAgICAvL2FkZCB0aGUgcGFzc2VkIG92ZXIgc3F1YXJlIHRvIGl0XG4gICAgICAgICAgICAgICRsZWdhbFNxdWFyZXMgPSAkbGVnYWxTcXVhcmVzLmFkZCgkbmV3U3F1YXJlKTtcblxuICAgICAgICAgICAgICAvL2FuZCB0aGUganVtcGVkIHNxdWFyZXMgZnJvbSBob3cgd2UgZ290IGhlcmVcbiAgICAgICAgICAgICAgbGV0ICRqdW1wZWRQaWVjZXMgPSB0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdO1xuICAgICAgICAgICAgICBpZiAoJGN1cnJlbnRTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJykpIHtcbiAgICAgICAgICAgICAgICAkanVtcGVkUGllY2VzID0gJGp1bXBlZFBpZWNlcy5hZGQoJGN1cnJlbnRTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJykpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICRuZXdTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJywkanVtcGVkUGllY2VzKTtcblxuICAgICAgICAgICAgICAvL2FuZCByZWN1cnNlLCB3aXRoIGp1bXBzT25seSBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgICBidWlsZE1vdmVzKGp1bXBDb29yZHMsZGlyZWN0aW9uLHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghanVtcHNPbmx5KSB7XG4gICAgICAgICAgY29uc3QgJG5ld1NxdWFyZSA9ICRzcXVhcmVzLmVxKG5ld1NxdWFyZUluZGV4KTtcbiAgICAgICAgICAkbmV3U3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycsJCgpKTtcbiAgICAgICAgICAkbGVnYWxTcXVhcmVzID0gJGxlZ2FsU3F1YXJlcy5hZGQoJG5ld1NxdWFyZSk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgfTtcbiAgICBidWlsZE1vdmVzKGNvb3JkcyxkaXJlY3Rpb24sZmFsc2UpO1xuICAgIHJldHVybiAkbGVnYWxTcXVhcmVzO1xuXG4gIH0vL2VuZCBvZiBnZXRNb3ZhYmxlU3F1YXJlc1xuXG4gIGZ1bmN0aW9uIHNldFVwUGllY2VzKCkge1xuICAgICAgLy9zZWxlY3QgYWxsIHRoZSBkaXZzIHdpdGggY2xhc3MgJ3BpZWNlJ1xuICAgICQoJ3BpZWNlJyk7XG4vL2FkZCB0aGUgJ2xpZ2h0JyBjbGFzcyB0byBoYWxmIG9mIHRoZW1cbiAgICAkKCdkaXYucGllY2U6ZXZlbicpLmFkZENsYXNzKCdsaWdodCcpO1xuLy9qUXVlcnkncyBldmVuIGFuZCBvZGQgc2VsZWN0b3IgbWV0aG9kcyB0byBhc3NpZ24gdGhlIGNsYXNzZXMgLmxpZ2h0IGFuZCAuZGFyay5cbi8vYWRkIHRoZSAnZGFyaycgdG8gdGhlIG90aGVyIGhhbGZcbiAgICAkKCdkaXYucGllY2U6b2RkJykuYWRkQ2xhc3MoJ2RhcmsnKTtcbiAgfVxuXG4gIC8vYWN0dWFsbHkgbW92aW5nIHRoZSBwaWVjZVxuICBmdW5jdGlvbiBtb3ZlUGllY2VUbygkcGllY2UsbmV3VG9wLG5ld0xlZnQpIHtcbiAgICAgIC8vc2V0IHRoZSBjc3MgJ3RvcCcgYW5kICdsZWZ0J1xuICAgICAgLy9hdHRyaWJ1dGVzIG9mIHRoZSBwYXNzZWQgcGllY2VcbiAgICAgIC8vdG8gdGhlIGFyZ3VtZW50cyBuZXdUb3AgYW5kIG5ld0xlZnRcbiAgICAkcGllY2UuY3NzKCd0b3AnLCBuZXdUb3ApO1xuICAgICRwaWVjZS5jc3MoJ2xlZnQnLCBuZXdMZWZ0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFVwQm9hcmQoKSB7XG5cbiAgICAvL0NyZWF0aW5nIHRoZSA2NCBzcXVhcmVzIGFuZCBhZGRpbmcgdGhlbSB0byB0aGUgRE9NXG4gICAgY29uc3Qgc3F1YXJlQ291bnQgPSA4Kjg7IC8vOCByb3dzIGJ5IDggY29sdW1uczsgemVybyBiYXNlZCBpbmRleFxuICAgIGZvciAobGV0IGkgPSAwO2k8c3F1YXJlQ291bnQ7aSsrKSB7XG4gICAgLy90aGlzIGxpbmUgY3JlYXRlcyBhIG5ldyBkaXYgd2l0aCB0aGUgY2xhc3MgJ3NxdWFyZSdcbiAgICAvL2FuZCBhcHBlbmRzIGl0IHRvIHRoZSBkaXYgd2l0aCBpZCAnYm9hcmQnXG4gICAgICAkYm9hcmQuYXBwZW5kKCQoJzxkaXYvPicpLmFkZENsYXNzKCdzcXVhcmUnKSk7XG4gICAgfVxuXG4gICAgLy9jcmVhdGluZyB0aGUgMjQgcGllY2VzIGFuZCBhZGRpbmcgdGhlbSB0byB0aGUgRE9NXG4gICAgY29uc3QgcGllY2VDb3VudCA9IDI0O1xuXG4gICAgZm9yIChsZXQgaT0wO2k8cGllY2VDb3VudDtpKyspIHtcbiAgICAgIC8vdGhpcyBsaW5lIGFwcGVuZHMgYW4gZW1wdHkgZGl2IHdpdGggdGhlIGNsYXNzICdwaWVjZScgdG8gdGhlIGRpdiB3aXRoIGlkICdwaWVjZXMnXG4gICAgICAkcGllY2VzLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygncGllY2UnKSk7XG4gICAgfVxuICAgICAgLy9pdGVyYXRlIHRocm91Z2ggYWxsIG9mIHRoZSBkaXZzIHdpdGggY2xhc3MgYHNxdWFyZWBcbiAgICAgIC8vZmlndXJlIG91dCB3aGV0aGVyIGVhY2ggb25lIHNob3VsZCBiZVxuICAgICAgLy9saWdodCBvciBkYXJrLCBhbmQgYXNzaWduIHRoZSBwcm9wZXIgY2xhc3NcbiAgICBjb25zdCAkZWFjaFNxdWFyZSA9ICQoJ2Rpdi5zcXVhcmUnKTtcbiAgICAkZWFjaFNxdWFyZS5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcbiAgICAgIGlmKGxpZ2h0T3JEYXJrKGluZGV4KT09PSAwKXtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnbGlnaHQnKTtcbiAgICAgIH1lbHNle1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdkYXJrJyk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgICAvL2lubmVyIGhlbHBlciBmdW5jdGlvbiB0aGF0IHRha2VzIGEgbnVtYmVyIGJldHdlZW5cbiAgICAgIC8vMCBhbmQgNjMgKGluY2x1c2l2ZSkgYW5kIHJldHVybnMgMSBpZiB0aGUgc3F1YXJlIHNob3VsZCBiZVxuICAgICAgLy9kYXJrLCBhbmQgMCBpZiB0aGUgc3F1YXJlIHNob3VsZCBiZSBsaWdodFxuICAgIGZ1bmN0aW9uIGxpZ2h0T3JEYXJrKGluZGV4KSB7XG4gICAgICBjb25zdCB4ID0gaW5kZXggJSA4O1xuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA4KTtcbiAgICAgIGNvbnN0IG9kZFggPSB4ICUgMjtcbiAgICAgIGNvbnN0IG9kZFkgPSB5ICUgMjtcbiAgICAgIHJldHVybiAob2RkWCBeIG9kZFkpO1xuICAgIH1cblxuICB9Ly9lbmQgb2Ygc2V0VXBCb2FyZCgpXG5cbiAgZnVuY3Rpb24gdG9nZ2xlU2VsZWN0KCRwaWVjZSkge1xuICAgICAgLy9pZiAkcGllY2UgaGFzIHRoZSBjbGFzcyAnc2VsZWN0ZWQnLHJlbW92ZSBpdFxuICAgICAgLy9pZiAkcGllY2UgZG9lcyBub3QgaGF2ZSB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgICAgLy9tYWtlIHN1cmUgbm8gb3RoZXIgZGl2cyB3aXRoIHRoZSBjbGFzcyAncGllY2UnXG4gICAgICAvL2hhdmUgdGhhdCBjbGFzcywgdGhlbiBzZXQgJHBpZWNlIHRvIGhhdmUgdGhlIGNsYXNzXG4gICAgaWYoJHBpZWNlLmhhc0NsYXNzKCdzZWxlY3RlZCcpKVxuICAgICAgJHBpZWNlLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgIGVsc2Uge1xuICAgICAgJCgnZGl2LnBpZWNlJykuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuICAgICAgICBpZigkKHBpZWNlKS5oYXNDbGFzcygnc2VsZWN0ZWQnKSlcbiAgICAgICAgICAkKHBpZWNlKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgIH0pO1xuICAgICAgJHBpZWNlLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgIH1cblxuICB9Ly9lbmQgb2YgdG9nZ2xlU2VsZWN0IGZ1bmN0aW9uXG5cbiAgY29uc3QgJG1vdmVDb3VudGVyID0gJCgnI21vdmVDb3VudGVyJyk7XG4gIGZ1bmN0aW9uIGluY3JlbWVudE1vdmVDb3VudGVyKCkge1xuICAgICAgLy9nZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXIgdHVybnMgaXQgaW50byBhIG51bWJlclxuICAgICAgLy9pbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXJcbiAgICAgIC8vdG8gdGhlIG5ldyBtb3ZlIGNvdW50XG4gICAgJG1vdmVDb3VudGVyLmh0bWwocGFyc2VJbnQoJG1vdmVDb3VudGVyLmh0bWwoKSkrMSk7XG5cbiAgfVxuXG5cbiAgcGllY2VTZWxlY3QoKTsvLyBwbGF5ZXIgdG8gc2VsZWN0IGEgcGllY2VcbiAgLy8gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyXG4gICAgLy90aGlzIGZ1bmN0aW9uIGFsbG93cyB0aGUgcGxheWVycyB0byBiZSBjaGFuZ2VkLlxuICBmdW5jdGlvbiBpbmNyZW1lbnRNb3ZlQ291bnQoY29sb3IpIHtcbiAgICAgIC8vZ2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIGxpZ2h0TW92ZUNvdW50IG9yIGRhcmtNb3ZlQ291bnRcbiAgICAgIC8vdHVybnMgaXQgaW50byBhIG51bWJlciBpbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbGlnaHRNb3ZlQ291bnQgb3IgZGFya01vdmVDb3VudCB0byB0aGUgbmV3IG1vdmUgY291bnRcbiAgICBsZXQgd2hpY2hDb3VudGVyID0gJyc7XG4gICAgY29sb3IgPT09ICdsaWdodCcgPyB3aGljaENvdW50ZXIgPSAnI2xpZ2h0TW92ZUNvdW50JyA6IHdoaWNoQ291bnRlciA9ICcjZGFya01vdmVDb3VudCc7XG4gICAgbGV0ICRtb3ZlcyA9IHBhcnNlSW50KCQod2hpY2hDb3VudGVyKS5odG1sKCkpO1xuICAgICRtb3ZlcysrO1xuXG4gICAgJCh3aGljaENvdW50ZXIpLmh0bWwoJG1vdmVzKTtcbiAgICBjb25zb2xlLmxvZygkbW92ZXMpO1xuICAgIC8vaWYgdGhlIG51bWJlciBpcyBldmVuIHRoZW4gaXQncyBsaWdodCdzIG1vdmUgYW5kIG9kZCBpdCdzIGRhcmsncyBtb3ZlLlxuICAgIGlmICgkbW92ZXMgJSAyICA9PT0gMSkge1xuICAgICAgY29uc29sZS5sb2coYEhlbGxvIG9kZCBudW1iZXJgKTtcbiAgICAgIGNvbnNvbGUubG9nKCRkYXJrUGllY2VzKTtcbiAgICB9IGVsc2UgaWYoJG1vdmVzICUgMiA9PT0gMCl7XG4gICAgICBjb25zb2xlLmxvZyhgSGVsbG8gZXZlbiBudW1iZXJgKTtcbiAgICAgIGNvbnNvbGUubG9nKCRsaWdodFBpZWNlcyk7XG4gICAgfVxuICB9Ly9lbmQgb2YgaW5jcmVtZW50TW92ZUNvdW50KClcblxuICAvL1BMQVlFUiBPTkUgQU5EIFBMQVlFUiBUV09cbiAgLy9JZiB0aGUgbW92ZSBjb3VudCBpcyBldmVuLCB0aGVuIHBsYXllciBvbmUncyB0dXJuIG90aGVyd2lzZSBwbGF5ZXIgdHdvJ3MgdHVyblxuICBjb25zdCAkbGlnaHRQaWVjZXMgPSAkKCdkaXYucGllY2UubGlnaHQnKTtcbiAgY29uc3QgJGRhcmtQaWVjZXMgPSAkKCdkaXYucGllY2UuZGFyaycpO1xuXG4vLyB0aGlzIGZ1bmN0aW9uIGdldHMgdGhlIGpRdWVyeSBvYmplY3Qgc3RvcmVkIGluXG4vLyB0aGUgZGF0YSBvYmplY3Qgb2YgJHNxdWFyZSB1bmRlciB0aGUga2V5ICdqdW1wZWRQaWVjZXMnXG4vLyBhbmQgcmVtb3ZlcyBldmVyeSBlbGVtZW50IGluIHRoYXQgalF1ZXJ5IHNlbGVjdGlvblxuICBmdW5jdGlvbiByZW1vdmVDYXB0dXJlZFBpZWNlcygkc3F1YXJlKSB7XG4gICAgJHNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKS5yZW1vdmUoKTtcbiAgfVxuXG4vLyBUaGlzIGZ1bmN0aW9uIHRha2VzIGEgJHBpZWNlIGFuZCB0aGUgaW5kZXggb2YgYSBzcXVhcmVcbi8vc3F1YXJlSW5kZXggd2lsbCBiZSBiZXR3ZWVuIDAgLSA2MyAoaW5jbHVzaXZlKS5cbi8vIGlmIHRoZSBpbmRleCByZWZlcnMgdG8gYW4gZWxlbWVudCBpbiB0aGUgZmlyc3Qgcm93IG9yIGxhc3Qgcm93LFxuLy8gdGhlIGNsYXNzICdraW5nJyBzaG91bGQgYmUgYWRkZWQgdG8gdGhlICRwaWVjZVxuICBmdW5jdGlvbiBjaGVja0tpbmcoJHBpZWNlLHNxdWFyZUluZGV4KSB7XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IDY0OyBpKyspe1xuICAgICAgaWYgKHNxdWFyZUluZGV4IDwgOCB8fCBzcXVhcmVJbmRleCA+PSA1Nil7XG4gICAgICAgICRwaWVjZS5hZGRDbGFzcygna2luZycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4vLyBXSU5OSU5HXG4vL3dpbm5pbmcgY29uZGl0aW9uczogSWYgb25lIHBsYXllciBvbmx5IGhhcyB0aGVpciBwaWVjZXMgb24gdGhlIGJvYXJkIGxlZnRcbi8vdGhleSB3aW4uXG4gIGZ1bmN0aW9uIHBpZWNlc0xlZnQoKXtcbiAgICBjb25zdCBkYXJrUGllY2VzID0gJGRhcmtQaWVjZXMubGVuZ3RoO1xuICAgIGNvbnN0IGxpZ2h0UGllY2VzID0gJGxpZ2h0UGllY2VzLmxlbmd0aDtcbiAgICBpZiAoZGFya1BpZWNlcyA9PT0gMCkge1xuICAgICAgJHdpbm5lci50ZXh0KGBQbGF5ZXIgMSBXaW5zYCk7XG4gICAgICByZXR1cm4gJHdpbm5lci5zbGlkZURvd24oYFBsYXllciAxIFdpbnNgKTtcbiAgICB9IGVsc2UgaWYobGlnaHRQaWVjZXMgPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKGBQbGF5ZXIgMiB3aW5zYCk7XG4gICAgICByZXR1cm4gJHdpbm5lci50ZXh0KGBQbGF5ZXIgMiBXaW5zYCk7XG5cbiAgICB9IGVsc2UgaWYgKGxpZ2h0UGllY2VzID09PSAxICYmIGRhcmtQaWVjZXMgPT09IDEpey8vYW5kIDQwIG1vdmVzIGFyZSBwbGF5ZWQgYWZ0ZXJ3YXJkc1xuICAgICAgLy95ZXQgdG8gY29kZSB0aGlzIGZ1bmN0aW9uXG4gICAgICBjb25zb2xlLmxvZyhgSXQncyBhIGRyYXdgKTtcbiAgICAgIHJldHVybiAkd2lubmVyLnRleHQoYEl0J3MgYSBkcmF3YCk7XG4gICAgfVxuICB9XG5cbiAgLy90aGlzIHJlc2V0cyB0aGUgZ2FtZSBieSBlZmZlY3RpdmVseSByZWxvYWRpbmcgdGhlIHBhZ2UgZnJvbSBjYWNoZVxuICBmdW5jdGlvbiByZXNldCgpe1xuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICB9XG5cbn0pOy8vZW5kIG9mIEpTIGxvYWRcblxuXG4vKlxuXG5UT0RPOlxuMS4gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyIGZlYXR1cmUgcmVxdWVzdFxuMi4gUmVzZXQgdGhlIGdhbWUgYnkgcHV0dGluZyB0aGUgcGllY2VzIHRvIHRoZSBvcmlnaW5hbCBwb3NpdGlvbiBmZWF0dXJlIHJlcXVlc3RmXG4zLiBXaW4gY29uZGl0aW9ucywgaWYgZWl0aGVyIHBsYXllciBoYXMgcGllY2VzIGxlZnQgb24gdGhlIGJvYXJkIHdoaWxlIHRoZSBvdGhlciBkb2Vzbid0XG4gIHRoZW4gaXQncyBhIHdpbi5cbjQuIENvdWxkIGRvIG1vcmUgc3R5bGluZyB0byBtYWtlIHRoZSBnYW1lIGhhdmUgYSBzbW9vdGhlciBmZWVsLiAoYml0IHZhZ3VlKVxuNS4gUmVmYWN0b3IgbXkgY29kZS5cbiovXG4iXX0=
