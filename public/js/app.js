"use strict";$(function(){function e(e){var a="";a="light"===e?"#lightMoveCount":"#darkMoveCount";var t=parseInt($(a).html());t++,$(a).html(t),console.log(t)}function a(){var e=$(event.target).position();return x=n(e.top,e.left)}function t(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function i(e,a){return{top:a*(f+h)+"px",left:e*(f+h)+"px"}}function n(e,a){return{x:a/(f+h),y:e/(f+h)}}function o(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var i=$(a).position(),o=n(i.top,i.left),s=8*o.y+o.x;t[s]=$(a)});var i=n(e.position().top,e.position().left),o=[{x:1,y:1},{x:-1,y:1}],s=[{x:1,y:-1},{x:-1,y:-1}],l=o.concat(s),r=void 0;r=e.hasClass("king")?l:e.hasClass("light")?o:s;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},d=$();return function i(n,o,s){if(!c(n)){var l=a.eq(8*n.y+n.x);$.each(o,function(o,r){var v={x:r.x+n.x,y:r.y+n.y};if(!c(v)){var u=8*v.y+v.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var f={x:2*r.x+n.x,y:2*r.y+n.y};if(c(f))return;var h=8*f.y+f.x;if(!t[h]){var p=a.eq(h);if(!p.is(d)){d=d.add(p);var C=t[u];l.data("jumpedPieces")&&(C=C.add(l.data("jumpedPieces"))),p.data("jumpedPieces",C),i(f,r,!0)}}}else if(!s){var g=a.eq(u);g.data("jumpedPieces",$()),d=d.add(g)}}})}}(i,r,!1),d}function s(e,a,t){e.css("top",a),e.css("left",t)}function l(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function r(){return m.html(parseInt($("#moveCounter").html(),10)+1)}function c(e){e.data("jumpedPieces").remove()}function d(e,a){for(var t=0;t<64;t++)(a<8||a>=56)&&e.addClass("king")}function v(){var e=$("div.piece.light"),a=$("div.piece.dark"),t=a.length,i=e.length;return 0===t?console.log("Player 1 wins"):0===i?console.log("Player 2 wins"):1===i&&1===t?console.log("It's a draw"):void 0}function u(){location.reload()}var f=46,h=2,p=$("div#board"),C=$("div#pieces"),g=$("#reset-button"),m=$("#moveCounter"),x=null;!function(){function e(e){return e%8%2^Math.floor(e/8)%2}for(var a=0;a<64;a++)p.append($("<div/>").addClass("square"));for(var t=0;t<24;t++)C.append($("<div/>").addClass("piece"));$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}(),function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),function(){$("div.piece.dark").each(function(e,a){var t=Math.floor(e/4)+5,n=e%4*2+(1-t%2),o=i(n,t);s($(a),o.top,o.left)})}(),function(){var e=$("div.piece.light");e.each(function(a,t){console.log(e.length);var n=Math.floor(a/4),o=a%4*2+(1-n%2),l=i(o,n);s($(t),l.top,l.left)})}();var y=!0;!function(){!0===y&&(console.log(y),$("div.piece").on("click",function(e){var a=$(e.target);l(a),t(),a.hasClass("selected")&&o(a).addClass("movable")}))}(),$("div.square").on("click",function(n){a();var o=$(n.target);if(o.hasClass("movable")){var l=$("div.piece.selected");if(1===l.length){var u=o.prevAll().length,f=u%8,h=Math.floor(u/8),p=i(f,h);s(l,p.top,p.left),c(o),d(l,o.prevAll().length),l.removeClass("selected"),$("div.square").removeClass("movable"),v(),r();var C="";C=!0===l.hasClass("light")?"light":"dark",e(C),t()}}}),g.on("click",function(){u()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiaW5jcmVtZW50TW92ZUNvdW50IiwiY29sb3IiLCJwYXJzZUludCIsIiRtb3ZlcyIsIndoaWNoQ291bnRlciIsImNvbnNvbGUiLCJsb2ciLCJwb3NpdGlvbiIsImNvb3JkcyIsImdldENvb3JkcyIsInRvcCIsImxlZnQiLCJyZXNldE1vdmFibGVzIiwicmVtb3ZlRGF0YSIsInJlbW92ZUNsYXNzIiwiZ2V0UGl4ZWxzIiwieCIsInkiLCJ3aWR0aCIsImJvcmRlciIsIiRzcXVhcmVzIiwiZ2V0TW92YWJsZVNxdWFyZXMiLCIkcGllY2UiLCJlYWNoIiwiaW5kZXgiLCJwaWVjZSIsImRhcmtEaXJlY3Rpb24iLCJzcXVhcmVJbmRleCIsInRha2VuU3F1YXJlcyIsImtpbmdEaXJlY3Rpb24iLCJsaWdodERpcmVjdGlvbiIsImhhc0NsYXNzIiwiZGlyZWN0aW9uIiwib3V0T2ZCb3VuZHMiLCJidWlsZE1vdmVzIiwiJGN1cnJlbnRTcXVhcmUiLCJuZXdDb29yZHMiLCJuZXdTcXVhcmVJbmRleCIsIiRsZWdhbFNxdWFyZXMiLCJqdW1wc09ubHkiLCJlcSIsImp1bXBDb29yZHMiLCIkbmV3U3F1YXJlIiwiJGp1bXBlZFBpZWNlcyIsImp1bXBTcXVhcmVJbmRleCIsImRhdGEiLCJhZGQiLCJhZGRDbGFzcyIsIm1vdmVQaWVjZVRvIiwibmV3VG9wIiwibmV3TGVmdCIsImNzcyIsIiRwaWVjZXMiLCJhcHBlbmQiLCJ0b2dnbGVTZWxlY3QiLCJyZW1vdmVDYXB0dXJlZFBpZWNlcyIsIiRzcXVhcmUiLCJpbmNyZW1lbnRtb3ZlQ291bnRlciIsIiRtb3ZlQ291bnRlciIsImh0bWwiLCJsaWdodFBpZWNlcyIsInJlbW92ZSIsImNoZWNrS2luZyIsImkiLCIkcmVzZXRCdXR0b24iLCJvbiIsImxvY2F0aW9uIiwiJGxpZ2h0UGllY2VzIiwiJGRhcmtQaWVjZXMiLCJkYXJrUGllY2VzIiwibGVuZ3RoIiwicmVzZXQiLCJyZWxvYWQiLCIkYm9hcmQiLCJNYXRoIiwiZmxvb3IiLCJsaWdodE9yRGFyayIsInRoaXMiLCJwaXhlbFBvc2l0aW9uIiwicGllY2VTZWxlY3QiLCJwaWVjZVNlbGVjdEVuYWJsZWQiLCJldmVudCIsIiR0aGlzUGllY2UiLCJ0YXJnZXQiLCIkcGllY2VUb01vdmUiLCJjdXJyZW50UG9zaXRpb24iLCJlIiwiJHNlbGVjdGVkUGllY2UiLCJwcmV2QWxsIiwicGl4ZWxzIiwicGllY2VzTGVmdCJdLCJtYXBwaW5ncyI6IllBQ0FBLEdBQUUsV0E2RkksUUFBQUMsR0FBQUMsR0FJRkEsR0FBQUEsR0FBQSxFQUNhQyxHQUFUQyxVQUFKRixFQUF3Qkcsa0JBQXhCLGdCQUNBRCxJQUFBQSxHQUFBQSxTQUFBQSxFQUFBQSxHQUFBQSxPQUFBQSxLQUdBRSxFQUFBQSxHQUFZRixLQUFaQSxHQUNBRSxRQUFBQyxJQUFBSCxHQUtBLFFBQU1JLEtBQ05DLEdBQUFBLEdBQVNDLEVBQVVGLE1BQUFBLFFBQWFBLFVBSWpDLE9BSENDLEdBQUFDLEVBQUFGLEVBQUFHLElBQUFILEVBQUFJLE1BK0VFLFFBQUFDLEtBQ0ZiLEVBQUEsY0FBT2MsV0FBQSxnQkFBQUMsWUFBQSxXQU9ULFFBQUFDLEdBQUFDLEVBQUFDLEdBR0ksT0FDQVAsSUFBQU8sR0FBQUMsRUFBQUMsR0FBQSxLQUNGUixLQUFPSyxHQUFBRSxFQUFBQyxHQUFBLE1BT1gsUUFBQVYsR0FBQUMsRUFBQUMsR0FHSSxPQUNBSyxFQUFNSSxHQUFXckIsRUFBRW9CLEdBVGpCRixFQUFLUCxHQUFPUSxFQUFRQyxJQU14QixRQUFTRSxHQUFrQkMsR0FhdkIsR0FBTWQsR0FBU0MsRUFBQUEsY0FLWEQsSUFUTlQsR0FBRSxhQUFhd0IsS0FBSyxTQUFTQyxFQUFNQyxHQWdCbkMsR0FBQWxCLEdBQUFSLEVBQUEwQixHQUFBbEIsV0FDTW1CLEVBQUFBLEVBQ0ZuQixFQURrQkcsSUFFakJNLEVBQU1DLE1BRVhVLEVBQUEsRUFBQW5CLEVBQUFTLEVBQUFULEVBQUFRLENBQ0FZLEdBQU1DLEdBQWdCQyxFQUFB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QSxjQUFBZSxZQUFBLFdBSUE0RSxJQUdDakMsR0FHRHpELElBQUFBLEdBQUFBLEVBRUFDLElBUHlDLElBQXJDc0YsRUFBZXhELFNBQVMsU0FPNUIsUUFHRCxPQXBETC9CLEVBQUFDLEdBNERGVyxRQTRRRW9ELEVBQWFDLEdBQUcsUUFBUyxXQUN2Qk0iLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9sb2FkaW5nIEpTXG4kKCgpPT57XG5cbiAgLy9HTE9CQUwgVkFSSUFCTEVTXG4gIGNvbnN0IHdpZHRoID0gNDY7XG4gIGNvbnN0IGJvcmRlciA9IDI7XG4gIGNvbnN0ICRib2FyZCA9ICQoJ2RpdiNib2FyZCcpO1xuICBjb25zdCAkcGllY2VzID0gJCgnZGl2I3BpZWNlcycpO1xuICBjb25zdCAkcmVzZXRCdXR0b24gPSAkKCcjcmVzZXQtYnV0dG9uJyk7XG4gIGNvbnN0ICRtb3ZlQ291bnRlciA9ICQoJyNtb3ZlQ291bnRlcicpO1xuXG4gIGxldCBjb29yZHMgPSBudWxsOy8vc2V0dGluZyBjb29yZHMgZ2xvYmFsbHkgc28gaXQncyBjb25zdGFudGx5IHVwZGF0aW5nXG5cbiAgLy9zZXQgdXAgdGhlIGJvYXJkIHdpdGggdGhlIGNvcnJlY3QgY2xhc3NlcyBmb3IgdGhlIGxpZ2h0IGFuZCBkYXJrIHNxdWFyZXNcbiAgc2V0VXBCb2FyZCgpO1xuICAvL3NldHMgdXAgdGhlIGNsYXNzZXMgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgcGllY2VcbiAgc2V0VXBQaWVjZXMoKTtcbiAgLy9zZXR0aW5nIHVwIHRoZSBkYXJrUGllY2VzXG4gIGRhcmtQaWVjZXMoKTtcbiAgLy9MSUdIVCBQSUVDRVNcbiAgLy8gc2V0dGluZyB1cCB0aGUgbGlnaHRQaWVjZXNcbiAgbGlnaHRQaWVjZXMoKTtcblxuXG5cbiAgZnVuY3Rpb24gbGlnaHRQaWVjZXMoKXtcbiAgICBjb25zdCAkbGlnaHRQaWVjZXMgPSAkKCdkaXYucGllY2UubGlnaHQnKTtcbiAgICAvL3RoaXMgbG9vcCBtb3ZlcyBhbGwgdGhlIGxpZ2h0IHBpZWNlcyB0byB0aGVpciBpbml0aWFsIHBvc2l0aW9uc1xuICAgICRsaWdodFBpZWNlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAvLyBURVNUIGNoZWNraW5nIHRoZSBsZW5ndGhcbiAgICAgIGNvbnNvbGUubG9nKCRsaWdodFBpZWNlcy5sZW5ndGgpO1xuICAgICAgLy90dXJuaW5nIHRoZSBpbmRleCAoZnJvbSAwIC0gMTEpXG4gICAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aFxuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA0KTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHklMik7XG5cbiAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgICAvL2FjdHVhbGx5IG1vdmluZyB0aGUgcGllY2UgdG8gaXRzIGluaXRpYWwgcG9zaXRpb25cbiAgICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLHBpeGVsUG9zaXRpb24udG9wLHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gICAgfSk7XG4gIH0vL2VuZCBvZiBsaWdodFBpZWNlcyBmdW5jdGlvblxuXG5cbiAgLy9EQVJLIFBJRUNFU1xuICBmdW5jdGlvbiBkYXJrUGllY2VzKCl7XG4gICAgY29uc3QgJGRhcmtQaWVjZXMgPSAgICQoJ2Rpdi5waWVjZS5kYXJrJyk7XG4gICAgICAgIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgZGFyayBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgICAkZGFya1BpZWNlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgICAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aFxuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXgvNCkgKyA1O1xuICAgICAgY29uc3QgeCA9IChpbmRleCAlIDQpICogMiArICgxLXklMik7XG5cbiAgICAgICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmF0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICAgIGNvbnN0IHBpeGVsUG9zaXRpb24gPSBnZXRQaXhlbHMoeCx5KTtcbiAgICAgICAgLy9tb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgICBtb3ZlUGllY2VUbygkKHBpZWNlKSxwaXhlbFBvc2l0aW9uLnRvcCxwaXhlbFBvc2l0aW9uLmxlZnQpO1xuICAgIH0pO1xuICB9Ly9lbmQgb2YgZGFya1BpZWNlcyBmdW5jdGlvblxuXG5cblxuICAvL0VWRU5UU1xuXG5cbiAgZnVuY3Rpb24gcGllY2VTZWxlY3QoKXtcbiAgICBpZihwaWVjZVNlbGVjdEVuYWJsZWQgPT09IHRydWUpe1xuICAgICAgY29uc29sZS5sb2cocGllY2VTZWxlY3RFbmFibGVkKTtcbiAgICAgICQoJ2Rpdi5waWVjZScpLm9uKCdjbGljaycsKGV2ZW50KT0+e1xuICAgICAgICAvL3NlbGVjdGVkIHZhcmlhYmxlXG4gICAgICAgIC8vdHVybiBgdGhpc2AgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICAgICAgY29uc3QgJHRoaXNQaWVjZSA9ICQoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgLy90b2dnbGluZyB0aGUgJ3NlbGVjdGVkJyBjbGFzcyBvZiB0aGlzIHBpZWNlXG4gICAgICAgIC8vYW5kIHBvc3NpYmxlIGRlc2VsZWN0aW5nIG90aGVyIHBpZWNlc1xuICAgICAgICB0b2dnbGVTZWxlY3QoJHRoaXNQaWVjZSk7XG4gICAgICAgIHJlc2V0TW92YWJsZXMoKTtcbiAgICAgICAgLy9nZXQgdGhlIGxlZ2FsIG1vdmVzIGZvciB0aGlzXG4gICAgICAgIGlmICgkdGhpc1BpZWNlLmhhc0NsYXNzKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgICAgZ2V0TW92YWJsZVNxdWFyZXMoJHRoaXNQaWVjZSkuYWRkQ2xhc3MoJ21vdmFibGUnKTtcbiAgICAgICAgfVxuICAgICAgfSk7Ly9lbmQgb2YgcGllY2UgY2xpY2sgZXZlbnRcbiAgICB9XG4gIH1cblxuICAvLyBURVNUIGNoYW5naW5nIHBsYXllcnNcblxuXG4gIC8vIFRFU1QgcGllY2VTZWxlY3QoKVxuICBsZXQgcGllY2VTZWxlY3RFbmFibGVkID0gdHJ1ZTsgLy90cnVlIGlzIHN3aXRjaGVkIG9uIHN0YXRlXG4gIHBpZWNlU2VsZWN0KCk7Ly8gcGxheWVyIHRvIHNlbGVjdCBhIHBpZWNlXG4gIC8vIFBsYXllciBjaGFuZ2UgZnJvbSBwbGF5ZXIgMSB0byBwbGF5ZXIgMlxuICAgIC8vdGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHBsYXllcnMgdG8gYmUgY2hhbmdlZC5cbiAgZnVuY3Rpb24gaW5jcmVtZW50TW92ZUNvdW50KGNvbG9yKSB7XG4gICAgICAvL2dldHMgdGhlIGh0bWwgb2YgdGhlIHNwYW4gd2l0aCBpZCBsaWdodE1vdmVDb3VudCBvciBkYXJrTW92ZUNvdW50XG4gICAgICAvL3R1cm5zIGl0IGludG8gYSBudW1iZXIgaW5jcmVtZW50cyBpdCBieSBvbmVcbiAgICAgIC8vc2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIGxpZ2h0TW92ZUNvdW50IG9yIGRhcmtNb3ZlQ291bnQgdG8gdGhlIG5ldyBtb3ZlIGNvdW50XG4gICAgbGV0IHdoaWNoQ291bnRlciA9ICcnO1xuICAgIGNvbG9yID09PSAnbGlnaHQnID8gd2hpY2hDb3VudGVyID0gJyNsaWdodE1vdmVDb3VudCcgOiB3aGljaENvdW50ZXIgPSAnI2RhcmtNb3ZlQ291bnQnO1xuICAgIGxldCAkbW92ZXMgPSBwYXJzZUludCgkKHdoaWNoQ291bnRlcikuaHRtbCgpKTtcbiAgICAkbW92ZXMrKztcblxuICAgICQod2hpY2hDb3VudGVyKS5odG1sKCRtb3Zlcyk7XG4gICAgY29uc29sZS5sb2coJG1vdmVzKTtcbiAgICAvL2lmIHRoZSBudW1iZXIgaXMgZXZlbiB0aGVuIGl0J3MgbGlnaHQncyBtb3ZlIGFuZCBvZGQgaXQncyBkYXJrJ3MgbW92ZS5cbiAgfS8vZW5kIG9mIGluY3JlbWVudE1vdmVDb3VudCgpXG5cbiAgLy9jaGVja3MgdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgY2xpY2tlZCBvciBzZWxlY3RlZCBkaXYgYW5kIHJldHVybnMgdGhlIGNvb3Jkcy5cbiAgZnVuY3Rpb24gY3VycmVudFBvc2l0aW9uKCl7XG4gICAgY29uc3QgcG9zaXRpb24gPSAkKGV2ZW50LnRhcmdldCkucG9zaXRpb24oKTtcbiAgICBjb29yZHMgPSBnZXRDb29yZHMocG9zaXRpb24udG9wLHBvc2l0aW9uLmxlZnQpO1xuICAgIC8vIGNvbnNvbGUubG9nKGNvb3Jkcyk7Ly9nZXR0aW5nIHRoZSBsb2NhdGlvbiBvZiB0aGUgcGllY2VcbiAgICByZXR1cm4gY29vcmRzO1xuXG4gIH1cblxuXG5cbiAgJCgnZGl2LnNxdWFyZScpLm9uKCdjbGljaycsIChlKT0+e1xuICAgIGN1cnJlbnRQb3NpdGlvbigpOy8vdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgc3F1YXJlOyBjb29yZHNcbiAgICAvLyBjb25zb2xlLmxvZygnY29vcmRzJywgY29vcmRzKTtcbiAgICAvL3R1cm4gYGUgb3IgZXZlbnRgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgY29uc3QgJHBpZWNlVG9Nb3ZlID0gJChlLnRhcmdldCk7XG5cblxuICAgIC8vaWYgJCh0aGlzKSBpcyBhIGxlZ2FsIHNxdWFyZSB0byBtb3ZlIHRvLi4uXG4gICAgaWYgKCRwaWVjZVRvTW92ZS5oYXNDbGFzcygnbW92YWJsZScpKSB7XG5cbiAgICAgICAgICAvL2dldCB0aGUgcGllY2Ugd2l0aCB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgICAgY29uc3QgJHNlbGVjdGVkUGllY2UgPSAkKCdkaXYucGllY2Uuc2VsZWN0ZWQnKTtcblxuICAgICAgICAgIC8vb25seSBtb3ZlIGlmIHRoZXJlIGlzIGV4YWN0bHkgb25lIHNlbGVjdGVkIHBpZWNlXG4gICAgICBpZiAoJHNlbGVjdGVkUGllY2UubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvL2dldCB0aGUgaW5kZXggb2YgdGhlIHNxdWFyZVxuICAgICAgICAgICAgLy9hbmQgdHJhbnNsYXRlIGl0IHRvIHBpeGVsIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IGluZGV4ID0gJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IGdldFBpeGVscyh4LHkpO1xuICAgICAgICAgICAgLy9hY3R1YWxseSBkbyB0aGUgbW92aW5nXG4gICAgICAgIG1vdmVQaWVjZVRvKCRzZWxlY3RlZFBpZWNlLHBpeGVscy50b3AscGl4ZWxzLmxlZnQpO1xuICAgICAgICAgIC8vcmVtb3ZlQ2FwdHVyZWRQaWVjZXNcbiAgICAgICAgcmVtb3ZlQ2FwdHVyZWRQaWVjZXMoJHBpZWNlVG9Nb3ZlKTtcbiAgICAgICAgLy8ucHJldkFsbCgpLmxlbmd0aCBpcyB1c2VkIHRvIGdldCB0aGUgaW5kZXhcbiAgICAgICAgLy9vZiB0aGUgc2VsZWN0ZWQgcGllY2VcbiAgICAgICAgY2hlY2tLaW5nKCRzZWxlY3RlZFBpZWNlLCRwaWVjZVRvTW92ZS5wcmV2QWxsKCkubGVuZ3RoKTtcbiAgICAgICAgLy9kZS1zZWxlY3QgdGhlIHBpZWNlIHRvIGVuZCB0aGUgbW92ZVxuICAgICAgICAkc2VsZWN0ZWRQaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAvL3NldCB0aGUgbmV3IGxlZ2FsIG1vdmVzXG4gICAgICAgICQoJ2Rpdi5zcXVhcmUnKS5yZW1vdmVDbGFzcygnbW92YWJsZScpO1xuXG4gICAgICAgIC8vIFRFU1QuIHRlc3RpbmcgdGhlIHdpbm5pbmcgY29uZGl0aW9ucyBieSBjaGVja2luZyB0aGUgbnVtYmVyIG9mIHBpZWNlcyBsZWZ0IG9uIHRoZSBib2FyZFxuICAgICAgICBwaWVjZXNMZWZ0KCk7XG4gICAgICAgIFxuICAgICAgICAvL2luY3JlbWVudCB0aGUgbW92ZSBjb3VudGVyXG4gICAgICAgIGluY3JlbWVudG1vdmVDb3VudGVyKCk7XG5cblxuICAgICAgICBsZXQgY29sb3IgPSAnJztcbiAgICAgICAgaWYgKCRzZWxlY3RlZFBpZWNlLmhhc0NsYXNzKCdsaWdodCcpID09PSB0cnVlKSB7XG4gICAgICAgICAgY29sb3IgPSAnbGlnaHQnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbG9yID0gJ2RhcmsnO1xuICAgICAgICB9XG4gICAgICAgIGluY3JlbWVudE1vdmVDb3VudChjb2xvcik7XG5cbiAgICAgICAgLy9yZXNldCB0aGUgc3F1YXJlcyB0byBhbGxvdyBtb3Zlc1xuICAgICAgICByZXNldE1vdmFibGVzKCk7XG5cbiAgICAgIH1cblxuICAgIH1cblxuICB9KTtcblxuXG4vLyBNT1JFIEZVTkNUSU9OU1xuLy90aGlzIGZ1bmN0aW9uIHJlbW92ZXMgdGhlIGRhdGEgaXRlbSB3aXRoIGtleSAnanVtcGVkUGllY2VzJyBmcm9tIGV2ZXJ5IGRpdi5zcXVhcmVcbi8vIGFuZCByZW1vdmVzIHRoZSBjbGFzcyAnbW92YWJsZScgZnJvbSBldmVyeSBzcXVhcmVcbiAgZnVuY3Rpb24gcmVzZXRNb3ZhYmxlcygpIHtcbiAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlRGF0YSgnanVtcGVkUGllY2VzJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHRyYW5zbGF0aW5nIGFuIHgseSBjb29yZGluYXRlcyB0byBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vdGhlIGNvbnZlbnRpb24gaXMgdGhhdCB0aGUgc3F1YXJlIGluIHRoZSB1cHBlciBsZWZ0IGNvcm5lciBpcyBhdCBwb3NpdGlvbiAwLDBcbiAgLy90aGUgc3F1YXJlIGluIHRoZSB1cHBlciByaWdodCwgYXQgNywwIGFuZCB0aGUgbG93ZXJcbiAgLy9yaWdodCBhdCA3LDdcbiAgZnVuY3Rpb24gZ2V0UGl4ZWxzKHgseSkge1xuICAgICAgLy90YWtlcyBhbiB4LHkgcG9zaXRpb24sIHJldHVybnNcbiAgICAgIC8vcGl4ZWxzIGZyb20gdGhlIGxlZnQsIHJpZ2h0XG4gICAgcmV0dXJuIHtcbiAgICAgICd0b3AnOiAoeSAqICh3aWR0aCtib3JkZXIpKSsncHgnLFxuICAgICAgJ2xlZnQnOiAoeCAqICh3aWR0aCtib3JkZXIpKSsncHgnXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHR1cm5pbmcgYSBwaXhlbCBwb3NpdGlvblxuICAvL2ludG8gdGhlIHgseSBjb29yZGluYXRlIG9mIGEgc3F1YXJlIG9uIHRoZSBib2FyZFxuICAvL2l0IGZvbGxvd3MgdGhlIHNhbWUgY29vcmRpbmF0ZSBjb252ZW50aW9uIGFzIGdldFBpeGVsc1xuICBmdW5jdGlvbiBnZXRDb29yZHModG9wLGxlZnQpIHtcbiAgICAgIC8vcmV0dXJucyBhbiB4IGFuZCBhIHlcbiAgICAgIC8vZ2l2ZW4gYSB0b3AgYW5kIGxlZnQgcGl4ZWxzXG4gICAgcmV0dXJuIHtcbiAgICAgICd4JzogbGVmdCAvICh3aWR0aCArIGJvcmRlciksXG4gICAgICAneSc6IHRvcCAvICh3aWR0aCArIGJvcmRlcilcbiAgICB9O1xuICB9XG5cbiAgLy9mdW5jdGlvbiBmb3IgcmV0dXJuaW5nIHRoZSBzZXQgb2YgbGVnYWwgbW92ZXMgZ2l2ZW4gYSBwaWVjZVxuLy8gdGhpcyBhbHNvIHN0b3JlcyBqdW1wZWQgcGllY2VzIGluIGEgZGF0YSBlbGVtZW50IG9mIGVhY2ggc3F1YXJlIHRoYXQgY2FuIGJlIG1vdmVkIHRvXG4gIGZ1bmN0aW9uIGdldE1vdmFibGVTcXVhcmVzKCRwaWVjZSkge1xuXG4gICAgLy9zZWxlY3QgYWxsIG9mIHRoZSBzcXVhcmVzXG4gICAgY29uc3QgJHNxdWFyZXMgPSAkKCdkaXYuc3F1YXJlJyk7XG5cbiAgICAvL3NlbGVjdCB0aGUgb2NjdXBpZWQgb25lcyB1c2luZyB0aGUgalF1ZXJ5IG1hcCgpIG1ldGhvZFxuICAgIC8vbWFwIGNyZWF0ZXMgYSBuZXcgb2JqZWN0IGZyb20gYW4gZXhpc3Rpbmcgb25lXG4gICAgLy91c2luZyBhIHRyYW5zbGF0aW9uIGZ1bmN0aW9uXG4gICAgdmFyIHRha2VuU3F1YXJlcyA9IHt9O1xuICAgICQoJ2Rpdi5waWVjZScpLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcblxuICAgICAgICAgICAgLy90aGlzIGZ1bmN0aW9uIHRyYW5zbGF0ZXMgYSBwaWVjZVxuICAgICAgY29uc3QgcG9zaXRpb24gPSAkKHBpZWNlKS5wb3NpdGlvbigpO1xuICAgICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKHBvc2l0aW9uLnRvcCxwb3NpdGlvbi5sZWZ0KTtcbiAgICAgIGNvbnN0IHNxdWFyZUluZGV4ID0gY29vcmRzLnkgKiA4ICsgY29vcmRzLng7XG4gICAgICB0YWtlblNxdWFyZXNbc3F1YXJlSW5kZXhdID0gJChwaWVjZSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjb29yZHMgPSBnZXRDb29yZHMoJHBpZWNlLnBvc2l0aW9uKCkudG9wLCRwaWVjZS5wb3NpdGlvbigpLmxlZnQpO1xuXG4gICAgLy9saWdodHMgbW92ZSBkb3duIHRoZSBib2FyZFxuICAgIGNvbnN0IGxpZ2h0RGlyZWN0aW9uID0gW1xuICAgICAgICB7eDogMSx5OiAxfSxcbiAgICAgICAge3g6IC0xLHk6IDF9XG4gICAgXTtcbiAgICAvL2RhcmtzIG1vdmUgdXAgdGhlIGJvYXJkXG4gICAgY29uc3QgZGFya0RpcmVjdGlvbiA9IFtcbiAgICAgICAge3g6IDEseTogLTF9LFxuICAgICAgICB7eDogLTEseTogLTF9XG4gICAgXTtcbiAgICAvL2tpbmdzIG1vdmUgaW4gYW55IGRpcmVjdGlvblxuICAgIGNvbnN0IGtpbmdEaXJlY3Rpb24gPSBsaWdodERpcmVjdGlvbi5jb25jYXQoZGFya0RpcmVjdGlvbik7XG5cbiAgICBsZXQgZGlyZWN0aW9uO1xuICAgIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2tpbmcnKSkge1xuICAgICAgZGlyZWN0aW9uID0ga2luZ0RpcmVjdGlvbjtcbiAgICB9IGVsc2UgaWYgKCRwaWVjZS5oYXNDbGFzcygnbGlnaHQnKSkge1xuICAgICAgZGlyZWN0aW9uID0gbGlnaHREaXJlY3Rpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpcmVjdGlvbiA9IGRhcmtEaXJlY3Rpb247XG4gICAgfVxuXG4gICAgY29uc3Qgb3V0T2ZCb3VuZHMgPSBmdW5jdGlvbihjb29yZHMpIHtcbiAgICAgIHJldHVybiAhKGNvb3Jkcy54ID49IDAgJiYgY29vcmRzLnggPCA4ICYmIGNvb3Jkcy55ID49IDAgJiYgY29vcmRzLnkgPCA4KTtcbiAgICB9O1xuXG4gICAgbGV0ICRsZWdhbFNxdWFyZXMgPSAkKCk7XG4gICAgY29uc3QgYnVpbGRNb3ZlcyA9IGZ1bmN0aW9uKGNvb3JkcyxkaXJlY3Rpb24sanVtcHNPbmx5KSB7XG4gICAgICBpZiAob3V0T2ZCb3VuZHMoY29vcmRzKSkgcmV0dXJuO1xuICAgICAgICAvL2N1cnJlbnQgc3F1YXJlIGlzIGF0IGNvb3Jkc1xuICAgICAgY29uc3QgJGN1cnJlbnRTcXVhcmUgPSAkc3F1YXJlcy5lcShjb29yZHMueSo4ICsgY29vcmRzLngpO1xuICAgICAgJC5lYWNoKGRpcmVjdGlvbixmdW5jdGlvbihpbmRleCxkaXJlY3Rpb24pIHtcblxuICAgICAgICBjb25zdCBuZXdDb29yZHMgPSB7XG4gICAgICAgICAgeDogZGlyZWN0aW9uLnggKyBjb29yZHMueCxcbiAgICAgICAgICB5OiBkaXJlY3Rpb24ueSArIGNvb3Jkcy55XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG91dE9mQm91bmRzKG5ld0Nvb3JkcykpIHJldHVybjtcbiAgICAgICAgY29uc3QgbmV3U3F1YXJlSW5kZXggPSA4Km5ld0Nvb3Jkcy55ICsgbmV3Q29vcmRzLng7XG4gICAgICAgICAgICAvL2lmIHRoZSBzcXVhcmUgaXMgdGFrZW4sXG4gICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdKSB7XG5cbiAgICAgICAgICAgICAgICAvL0NhbiBvbmx5IGp1bXAgaWYgcGllY2UgaXMgZGlmZmVyZW50XG4gICAgICAgICAgaWYgKCRwaWVjZS5oYXNDbGFzcygnZGFyaycpKSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnZGFyaycpKSByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdLmhhc0NsYXNzKCdsaWdodCcpKSByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QganVtcENvb3JkcyA9IHtcbiAgICAgICAgICAgIHg6IGRpcmVjdGlvbi54KjIgKyBjb29yZHMueCxcbiAgICAgICAgICAgIHk6IGRpcmVjdGlvbi55KjIgKyBjb29yZHMueVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKG91dE9mQm91bmRzKGp1bXBDb29yZHMpKSByZXR1cm47XG5cbiAgICAgICAgICBjb25zdCBqdW1wU3F1YXJlSW5kZXggPSBqdW1wQ29vcmRzLnkqOCArIGp1bXBDb29yZHMueDtcbiAgICAgICAgICAgICAgICAvL2lmIHRoZSBqdW1wIHNxdWFyZSBpcyBmcmVlLi4uXG4gICAgICAgICAgICAgICAgLy9hZGQgaXQgYW5kIHRoZSBkYXRhLWp1bXBlZC1waWVjZXNcbiAgICAgICAgICBpZiAoIXRha2VuU3F1YXJlc1tqdW1wU3F1YXJlSW5kZXhdKSB7XG4gICAgICAgICAgICBjb25zdCAkbmV3U3F1YXJlID0gJHNxdWFyZXMuZXEoanVtcFNxdWFyZUluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgLy9pZiB3ZSBoYXZlbid0IGFscmVhZHkgc2VlbiBpdFxuICAgICAgICAgICAgaWYgKCEkbmV3U3F1YXJlLmlzKCRsZWdhbFNxdWFyZXMpKSB7XG5cbiAgICAgICAgICAgICAgLy9hZGQgdGhlIHBhc3NlZCBvdmVyIHNxdWFyZSB0byBpdFxuICAgICAgICAgICAgICAkbGVnYWxTcXVhcmVzID0gJGxlZ2FsU3F1YXJlcy5hZGQoJG5ld1NxdWFyZSk7XG5cbiAgICAgICAgICAgICAgLy9hbmQgdGhlIGp1bXBlZCBzcXVhcmVzIGZyb20gaG93IHdlIGdvdCBoZXJlXG4gICAgICAgICAgICAgIGxldCAkanVtcGVkUGllY2VzID0gdGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XTtcbiAgICAgICAgICAgICAgaWYgKCRjdXJyZW50U3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycpKSB7XG4gICAgICAgICAgICAgICAgJGp1bXBlZFBpZWNlcyA9ICRqdW1wZWRQaWVjZXMuYWRkKCRjdXJyZW50U3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAkbmV3U3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycsJGp1bXBlZFBpZWNlcyk7XG5cbiAgICAgICAgICAgICAgLy9hbmQgcmVjdXJzZSwgd2l0aCBqdW1wc09ubHkgc2V0IHRvIHRydWVcbiAgICAgICAgICAgICAgYnVpbGRNb3ZlcyhqdW1wQ29vcmRzLGRpcmVjdGlvbix0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWp1bXBzT25seSkge1xuICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShuZXdTcXVhcmVJbmRleCk7XG4gICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCQoKSk7XG4gICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH07XG4gICAgYnVpbGRNb3Zlcyhjb29yZHMsZGlyZWN0aW9uLGZhbHNlKTtcbiAgICByZXR1cm4gJGxlZ2FsU3F1YXJlcztcblxuICB9Ly9lbmQgb2YgZ2V0TW92YWJsZVNxdWFyZXNcblxuICBmdW5jdGlvbiBzZXRVcFBpZWNlcygpIHtcbiAgICAgIC8vc2VsZWN0IGFsbCB0aGUgZGl2cyB3aXRoIGNsYXNzICdwaWVjZSdcbiAgICAkKCdwaWVjZScpO1xuLy9hZGQgdGhlICdsaWdodCcgY2xhc3MgdG8gaGFsZiBvZiB0aGVtXG4gICAgJCgnZGl2LnBpZWNlOmV2ZW4nKS5hZGRDbGFzcygnbGlnaHQnKTtcbi8valF1ZXJ5J3MgZXZlbiBhbmQgb2RkIHNlbGVjdG9yIG1ldGhvZHMgdG8gYXNzaWduIHRoZSBjbGFzc2VzIC5saWdodCBhbmQgLmRhcmsuXG4vL2FkZCB0aGUgJ2RhcmsnIHRvIHRoZSBvdGhlciBoYWxmXG4gICAgJCgnZGl2LnBpZWNlOm9kZCcpLmFkZENsYXNzKCdkYXJrJyk7XG4gIH1cblxuICAvL2FjdHVhbGx5IG1vdmluZyB0aGUgcGllY2VcbiAgZnVuY3Rpb24gbW92ZVBpZWNlVG8oJHBpZWNlLG5ld1RvcCxuZXdMZWZ0KSB7XG4gICAgICAvL3NldCB0aGUgY3NzICd0b3AnIGFuZCAnbGVmdCdcbiAgICAgIC8vYXR0cmlidXRlcyBvZiB0aGUgcGFzc2VkIHBpZWNlXG4gICAgICAvL3RvIHRoZSBhcmd1bWVudHMgbmV3VG9wIGFuZCBuZXdMZWZ0XG4gICAgJHBpZWNlLmNzcygndG9wJywgbmV3VG9wKTtcbiAgICAkcGllY2UuY3NzKCdsZWZ0JywgbmV3TGVmdCk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRVcEJvYXJkKCkge1xuXG4gICAgLy9DcmVhdGluZyB0aGUgNjQgc3F1YXJlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICAgIGNvbnN0IHNxdWFyZUNvdW50ID0gOCo4OyAvLzggcm93cyBieSA4IGNvbHVtbnM7IHplcm8gYmFzZWQgaW5kZXhcbiAgICBmb3IgKGxldCBpID0gMDtpPHNxdWFyZUNvdW50O2krKykge1xuICAgIC8vdGhpcyBsaW5lIGNyZWF0ZXMgYSBuZXcgZGl2IHdpdGggdGhlIGNsYXNzICdzcXVhcmUnXG4gICAgLy9hbmQgYXBwZW5kcyBpdCB0byB0aGUgZGl2IHdpdGggaWQgJ2JvYXJkJ1xuICAgICAgJGJvYXJkLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygnc3F1YXJlJykpO1xuICAgIH1cblxuICAgIC8vY3JlYXRpbmcgdGhlIDI0IHBpZWNlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICAgIGNvbnN0IHBpZWNlQ291bnQgPSAyNDtcblxuICAgIGZvciAobGV0IGk9MDtpPHBpZWNlQ291bnQ7aSsrKSB7XG4gICAgICAvL3RoaXMgbGluZSBhcHBlbmRzIGFuIGVtcHR5IGRpdiB3aXRoIHRoZSBjbGFzcyAncGllY2UnIHRvIHRoZSBkaXYgd2l0aCBpZCAncGllY2VzJ1xuICAgICAgJHBpZWNlcy5hcHBlbmQoJCgnPGRpdi8+JykuYWRkQ2xhc3MoJ3BpZWNlJykpO1xuICAgIH1cbiAgICAgIC8vaXRlcmF0ZSB0aHJvdWdoIGFsbCBvZiB0aGUgZGl2cyB3aXRoIGNsYXNzIGBzcXVhcmVgXG4gICAgICAvL2ZpZ3VyZSBvdXQgd2hldGhlciBlYWNoIG9uZSBzaG91bGQgYmVcbiAgICAgIC8vbGlnaHQgb3IgZGFyaywgYW5kIGFzc2lnbiB0aGUgcHJvcGVyIGNsYXNzXG4gICAgY29uc3QgJGVhY2hTcXVhcmUgPSAkKCdkaXYuc3F1YXJlJyk7XG4gICAgJGVhY2hTcXVhcmUuZWFjaChmdW5jdGlvbihpbmRleCl7XG4gICAgICBpZihsaWdodE9yRGFyayhpbmRleCk9PT0gMCl7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnZGFyaycpO1xuICAgICAgfVxuICAgIH0pO1xuICAgICAgLy9pbm5lciBoZWxwZXIgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIG51bWJlciBiZXR3ZWVuXG4gICAgICAvLzAgYW5kIDYzIChpbmNsdXNpdmUpIGFuZCByZXR1cm5zIDEgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmVcbiAgICAgIC8vZGFyaywgYW5kIDAgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmUgbGlnaHRcbiAgICBmdW5jdGlvbiBsaWdodE9yRGFyayhpbmRleCkge1xuICAgICAgY29uc3QgeCA9IGluZGV4ICUgODtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICBjb25zdCBvZGRYID0geCAlIDI7XG4gICAgICBjb25zdCBvZGRZID0geSAlIDI7XG4gICAgICByZXR1cm4gKG9kZFggXiBvZGRZKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHNldFVwQm9hcmQoKVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZVNlbGVjdCgkcGllY2UpIHtcbiAgICAgIC8vaWYgJHBpZWNlIGhhcyB0aGUgY2xhc3MgJ3NlbGVjdGVkJyxyZW1vdmUgaXRcbiAgICAgIC8vaWYgJHBpZWNlIGRvZXMgbm90IGhhdmUgdGhlIGNsYXNzICdzZWxlY3RlZCdcbiAgICAgIC8vbWFrZSBzdXJlIG5vIG90aGVyIGRpdnMgd2l0aCB0aGUgY2xhc3MgJ3BpZWNlJ1xuICAgICAgLy9oYXZlIHRoYXQgY2xhc3MsIHRoZW4gc2V0ICRwaWVjZSB0byBoYXZlIHRoZSBjbGFzc1xuICAgIGlmKCRwaWVjZS5oYXNDbGFzcygnc2VsZWN0ZWQnKSlcbiAgICAgICRwaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBlbHNlIHtcbiAgICAgICQoJ2Rpdi5waWVjZScpLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcbiAgICAgICAgaWYoJChwaWVjZSkuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAgICAgJChwaWVjZSkucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICB9KTtcbiAgICAgICRwaWVjZS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHRvZ2dsZVNlbGVjdCBmdW5jdGlvblxuXG4gIGZ1bmN0aW9uIGluY3JlbWVudG1vdmVDb3VudGVyKCkge1xuICAgICAgLy9nZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXIgdHVybnMgaXQgaW50byBhIG51bWJlclxuICAgICAgLy9pbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXJcbiAgICAgIC8vdG8gdGhlIG5ldyBtb3ZlIGNvdW50XG4gICAgcmV0dXJuICAkbW92ZUNvdW50ZXIuaHRtbChwYXJzZUludCgkKCcjbW92ZUNvdW50ZXInKS5odG1sKCksMTApKzEpO1xuXG4gIH1cblxuLy8gdGhpcyBmdW5jdGlvbiBnZXRzIHRoZSBqUXVlcnkgb2JqZWN0IHN0b3JlZCBpblxuLy8gdGhlIGRhdGEgb2JqZWN0IG9mICRzcXVhcmUgdW5kZXIgdGhlIGtleSAnanVtcGVkUGllY2VzJ1xuLy8gYW5kIHJlbW92ZXMgZXZlcnkgZWxlbWVudCBpbiB0aGF0IGpRdWVyeSBzZWxlY3Rpb25cbiAgZnVuY3Rpb24gcmVtb3ZlQ2FwdHVyZWRQaWVjZXMoJHNxdWFyZSkge1xuICAgICRzcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJykucmVtb3ZlKCk7XG4gIH1cblxuLy8gVGhpcyBmdW5jdGlvbiB0YWtlcyBhICRwaWVjZSBhbmQgdGhlIGluZGV4IG9mIGEgc3F1YXJlXG4vL3NxdWFyZUluZGV4IHdpbGwgYmUgYmV0d2VlbiAwIC0gNjMgKGluY2x1c2l2ZSkuXG4vLyBpZiB0aGUgaW5kZXggcmVmZXJzIHRvIGFuIGVsZW1lbnQgaW4gdGhlIGZpcnN0IHJvdyBvciBsYXN0IHJvdyxcbi8vIHRoZSBjbGFzcyAna2luZycgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSAkcGllY2VcbiAgZnVuY3Rpb24gY2hlY2tLaW5nKCRwaWVjZSxzcXVhcmVJbmRleCkge1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCA2NDsgaSsrKXtcbiAgICAgIGlmIChzcXVhcmVJbmRleCA8IDggfHwgc3F1YXJlSW5kZXggPj0gNTYpe1xuICAgICAgICAkcGllY2UuYWRkQ2xhc3MoJ2tpbmcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuLy93aW5uaW5nIGNvbmRpdGlvbnM6IElmIG9uZSBwbGF5ZXIgb25seSBoYXMgdGhlaXIgcGllY2VzIG9uIHRoZSBib2FyZCBsZWZ0XG4vL3RoZXkgd2luLlxuICBmdW5jdGlvbiBwaWVjZXNMZWZ0KCl7XG4gICAgY29uc3QgJGxpZ2h0UGllY2VzID0gJCgnZGl2LnBpZWNlLmxpZ2h0Jyk7XG4gICAgY29uc3QgJGRhcmtQaWVjZXMgPSAkKCdkaXYucGllY2UuZGFyaycpO1xuICAgIGNvbnN0IGRhcmtQaWVjZXMgPSAkZGFya1BpZWNlcy5sZW5ndGg7XG4gICAgY29uc3QgbGlnaHRQaWVjZXMgPSAkbGlnaHRQaWVjZXMubGVuZ3RoO1xuICAgIGlmIChkYXJrUGllY2VzID09PSAwKSB7XG4gICAgICByZXR1cm4gY29uc29sZS5sb2coYFBsYXllciAxIHdpbnNgKTtcbiAgICB9IGVsc2UgaWYobGlnaHRQaWVjZXMgPT09IDApIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhgUGxheWVyIDIgd2luc2ApO1xuICAgIH0gZWxzZSBpZiAobGlnaHRQaWVjZXMgPT09IDEgJiYgZGFya1BpZWNlcyA9PT0gMSl7Ly9hbmQgNDAgbW92ZXMgYXJlIHBsYXllZCBhZnRlcndhcmRzXG4gICAgICAvL3lldCB0byBjb2RlIHRoaXMgZnVuY3Rpb25cbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhgSXQncyBhIGRyYXdgKTtcbiAgICB9XG5cbiAgfVxuXG4gIC8vcmVzZXR0aW5nIHRoZSBnYW1lLlxuICAkcmVzZXRCdXR0b24ub24oJ2NsaWNrJywgKCk9PntcbiAgICByZXNldCgpO1xuICAgIC8vIHNldHRpbmcgdXAgdGhlIHBpZWNlcyBhZnRlciBlbXB0eWluZyB0aGVtLlxuICB9KTtcblxuICAvL3RoaXMgcmVzZXRzIHRoZSBnYW1lIGJ5IGVmZmVjdGl2ZWx5IHJlbG9hZGluZyB0aGUgcGFnZSBmcm9tIGNhY2hlXG4gIGZ1bmN0aW9uIHJlc2V0KCl7XG4gICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gIH1cblxufSk7Ly9lbmQgb2YgSlMgbG9hZFxuXG5cbi8qXG5cblRPRE86XG4xLiBQbGF5ZXIgY2hhbmdlIGZyb20gcGxheWVyIDEgdG8gcGxheWVyIDJcbjIuIFJlc2V0IHRoZSBnYW1lIGJ5IHB1dHRpbmcgdGhlIHBpZWNlcyB0byB0aGUgb3JpZ2luYWwgcG9zaXRpb25cbjMuIFdpbiBjb25kaXRpb25zLCBpZiBlaXRoZXIgcGxheWVyIGhhcyBwaWVjZXMgbGVmdCBvbiB0aGUgYm9hcmQgd2hpbGUgdGhlIG90aGVyIGRvZXNuJ3RcbiAgdGhlbiBpdCdzIGEgd2luLlxuNC5cblxuXG4qL1xuIl19
