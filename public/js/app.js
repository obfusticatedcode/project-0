"use strict";$(function(){function e(){var e=$(event.target).position();return k=n(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(f+h)+"px",left:e*(f+h)+"px"}}function n(e,a){return{x:a/(f+h),y:e/(f+h)}}function i(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var i=$(a).position(),o=n(i.top,i.left),s=8*o.y+o.x;t[s]=$(a)});var i,o=n(e.position().top,e.position().left),s=[{x:1,y:1},{x:-1,y:1}],l=[{x:1,y:-1},{x:-1,y:-1}],r=s.concat(l);i=e.hasClass("king")?r:e.hasClass("light")?s:l;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},d=$();return function n(i,o,s){if(!c(i)){var l=a.eq(8*i.y+i.x);$.each(o,function(o,r){var v={x:r.x+i.x,y:r.y+i.y};if(!c(v)){var u=8*v.y+v.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var f={x:2*r.x+i.x,y:2*r.y+i.y};if(c(f))return;var h=8*f.y+f.x;if(!t[h]){var p=a.eq(h);if(!p.is(d)){d=d.add(p);var g=t[u];l.data("jumpedPieces")&&(g=g.add(l.data("jumpedPieces"))),p.data("jumpedPieces",g),n(f,r,!0)}}}else if(!s){var C=a.eq(u);C.data("jumpedPieces",$()),d=d.add(C)}}})}}(o,i,!1),d}function o(e,a,t){e.css("top",a),e.css("left",t)}function s(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function l(){P.html(parseInt(P.html())+1)}function r(e){var a="";a="light"===e?"#lightMoveCount":"#darkMoveCount";var t=parseInt($(a).html());t++,$(a).html(t),console.log(t),t%2==1?(console.log("Hello odd number"),console.log(q)):t%2==0&&(console.log("Hello even number"),console.log(b))}function c(e){e.data("jumpedPieces").remove()}function d(e,a){for(var t=0;t<64;t++)(a<8||a>=56)&&e.addClass("king")}function v(){var e=q.length,a=b.length;return 0===e?(y.text("Player 1 Wins"),y.slideDown("Player 1 Wins")):0===a?(console.log("Player 2 wins"),y.text("Player 2 Wins")):1===a&&1===e?(console.log("It's a draw"),y.text("It's a draw")):void 0}function u(){location.reload()}var f=46,h=2,p=$("div#board"),g=$("div#pieces"),C=$("#reset-button"),m=$("#rules-button"),x=$(".instructions"),y=$("#winner"),k=null;!function(){function e(e){return e%8%2^Math.floor(e/8)%2}for(var a=0;a<64;a++)p.append($("<div/>").addClass("square"));for(var t=0;t<24;t++)g.append($("<div/>").addClass("piece"));$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}(),function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),function(){$("div.piece.dark").each(function(e,a){var n=Math.floor(e/4)+5,i=e%4*2+(1-n%2),s=t(i,n);o($(a),s.top,s.left)})}(),function(){$("div.piece.light").each(function(e,a){var n=Math.floor(e/4),i=e%4*2+(1-n%2),s=t(i,n);o($(a),s.top,s.left)})}(),C.on("click",function(){u()}),m.on("click",function(){x.toggle("slow"),console.log("Clicking here works")}),$("div.square").on("click",function(n){e();var i=$(n.target);if(i.hasClass("movable")){var s=$("div.piece.selected");if(1===s.length){var u=i.prevAll().length,f=u%8,h=Math.floor(u/8),p=t(f,h);o(s,p.top,p.left),c(i),d(s,i.prevAll().length),s.removeClass("selected"),$("div.square").removeClass("movable"),v(),l();r(!0===s.hasClass("light")?"light":"dark"),a()}}});var P=$("#moveCounter");!function(){$("div.piece").on("click",function(e){var t=$(e.target);s(t),a(),t.hasClass("selected")&&i(t).addClass("movable")})}();var b=$("div.piece.light"),q=$("div.piece.dark")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiY3VycmVudFBvc2l0aW9uIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsImNvb3JkcyIsImdldENvb3JkcyIsInRvcCIsImxlZnQiLCJyZXNldE1vdmFibGVzIiwicmVtb3ZlRGF0YSIsInJlbW92ZUNsYXNzIiwidGFrZW5TcXVhcmVzIiwieCIsInkiLCJzcXVhcmVJbmRleCIsIndpZHRoIiwiYm9yZGVyIiwiZ2V0TW92YWJsZVNxdWFyZXMiLCIkcGllY2UiLCJraW5nRGlyZWN0aW9uIiwiZGlyZWN0aW9uIiwibGlnaHREaXJlY3Rpb24iLCJpbmRleCIsInBpZWNlIiwib3V0T2ZCb3VuZHMiLCIkbGVnYWxTcXVhcmVzIiwiJGN1cnJlbnRTcXVhcmUiLCJjb25jYXQiLCJkYXJrRGlyZWN0aW9uIiwiaGFzQ2xhc3MiLCIkYm9hcmQiLCJidWlsZE1vdmVzIiwianVtcHNPbmx5IiwiJHNxdWFyZXMiLCJlcSIsImVhY2giLCIkbmV3U3F1YXJlIiwiJGp1bXBlZFBpZWNlcyIsIm5ld1NxdWFyZUluZGV4IiwibmV3Q29vcmRzIiwiZGF0YSIsImp1bXBDb29yZHMiLCJhZGQiLCJqdW1wU3F1YXJlSW5kZXgiLCJpcyIsImFkZENsYXNzIiwibW92ZVBpZWNlVG8iLCIkZWFjaFNxdWFyZSIsIm5ld0xlZnQiLCJjc3MiLCJ0b2dnbGVTZWxlY3QiLCIkbW92ZXMiLCJwYXJzZUludCIsImNvbnNvbGUiLCIkZGFya1BpZWNlcyIsImluY3JlbWVudE1vdmVDb3VudGVyIiwiJG1vdmVDb3VudGVyIiwiaHRtbCIsImluY3JlbWVudE1vdmVDb3VudCIsImNvbG9yIiwid2hpY2hDb3VudGVyIiwibG9nIiwicGllY2VzTGVmdCIsImRhcmtQaWVjZXMiLCJsaWdodFBpZWNlcyIsInJlbW92ZUNhcHR1cmVkUGllY2VzIiwiJHNxdWFyZSIsInJlbW92ZSIsImNoZWNrS2luZyIsImkiLCJsZW5ndGgiLCIkbGlnaHRQaWVjZXMiLCIkd2lubmVyIiwidGV4dCIsInNsaWRlRG93biIsInJlc2V0IiwibG9jYXRpb24iLCJyZWxvYWQiLCIkcGllY2VzIiwiJHJlc2V0QnV0dG9uIiwiJHJ1bGVzQnV0dG9uIiwiJGluc3RydWN0aW9ucyIsInNldFVwUGllY2VzIiwibGlnaHRPckRhcmsiLCJwaWVjZVNlbGVjdCIsIk1hdGgiLCJmbG9vciIsIm9kZFgiLCJvZGRZIiwiYXBwZW5kIiwidGhpcyIsImdldFBpeGVscyIsInBpeGVsUG9zaXRpb24iLCJvbiIsIiRzZWxlY3RlZFBpZWNlIiwidG9nZ2xlIiwiJHBpZWNlVG9Nb3ZlIiwiZSIsInByZXZBbGwiLCJwaXhlbHMiLCIkdGhpc1BpZWNlIl0sIm1hcHBpbmdzIjoiWUFxQkVBLEdBQUEsV0ErS0UsUUFBQUMsS0FDQSxHQUFBQyxHQUFBRixFQUFBRyxNQUFBQyxRQUFBRixVQUVFLE9BREZHLEdBQU9DLEVBQUFKLEVBQUFLLElBQUFMLEVBQUFNLE1BT1QsUUFBQUMsS0E5QkVULEVBQUUsY0FBY1UsV0FBVyxnQkFBZ0JDLFlBQVksV0F1Q3ZELFFBQU1DLEdBQVlDLEVBQUdDLEdBSW5CLE9BQ0FQLElBQU1GLEdBQVNDLEVBQUFBLEdBQW1CQyxLQUNsQ0MsS0FBTU8sR0FBQUEsRUFBY1YsR0FBZUEsTUFRM0JTLFFBQUdSLEdBQUFDLEVBQUFDLEdBQ0ZNLE9BRlhELEVBSUFMLEdBQUFRLEVBQUFDLEdBL0JFSCxFQUFLUCxHQUFPUyxFQUFRQyxJQWtDWEgsUUFBSUksR0FBQUMsR0FHZixHQUFNQyxHQUFhcEIsRUFBQSxjQUduQlksSUFHRVMsR0FBQUEsYUFBWUMsS0FBQUEsU0FBWkMsRUFBQUMsR0FHRCxHQUFBdEIsR0FBQUYsRUFBQXdCLEdBQUF0QixXQTNCT0csRUFBU0MsRUFBVUosRUFBU0ssSUFBS0wsRUFBU00sTUE2QjVDaUIsRUFBQUEsRUFBY3BCLEVBQWRvQixFQUFBQSxFQUF3QnBCLENBQzVCTyxHQUFTUCxHQUFpQkEsRUFBQUEsSUFHNUIsSUFpQk1nQixHQWpCRkssRUFBQUEsRUFBSlAsRUFBQWpCLFdB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QyxFQUFTUixFQUFVL0UsRUFBR0MsRUEwQjdCaUMsR0FBQWdELEVBQUFLLEVBQUE3RixJQUFBNkYsRUFBQTVGLE1BTUwwRCxFQUFBK0IsR0FHQTVCLEVBQUEwQixFQUFBRSxFQUFBRSxVQUFBNUIsUUFDQXdCLEVBQVM5RixZQUFrQixZQUd6QkQsRUFBQSxjQUFBVyxZQUFBLFdBSUZvRCxJQU1BUCxHQTNCTUcsSUE2Qk4sSUFBQW9DLEVBQUFqRSxTQUFBLFNBQUEsUUFBQSxRQUVFckIsT0FtUEQsSUFBQWdELEdBQUF6RCxFQUFBLGlCQTNWRCxXQVVJQSxFQUFBLGFBQUlxRyxHQUFXdkUsUUFBUyxTQUFBM0IsR0FUMUIsR0FZR2tHLEdBQUFyRyxFQUFBRyxFQUFBQyxPQU5EK0MsR0FBYWtELEdBQ2I1RixJQVlHNEYsRUFDTHZFLFNBQUEsYUFHRlosRUFBQW1GLEdBQUF2RCxTQUFBLGVBdVdJUSxJQUFBQSxHQUFBdEQsRUFBQSxtQkFDQXVELEVBQWVtQixFQUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUT0RPOiBcbi8vIDEuIGNvbnZlcnQgdGhpcyBwcm9qZWN0IGludG8gUmVhY3QgYW5kIFR5cGVzY3JpcHRcbi8vIDIuIFVuaXQgdGVzdHNcbi8vIDMuIEZpeCBidWdzXG4vLyA0LiBJbXBsZW1lbnQgdGhlIG1pc3NpbmcgZmVhdHVyZXMuIFxuLy8gNS4gUmVkZXNpZ24gdGhlIGFwcFxuLy8gNi4gRGVwbG95IHRoZSBhcHBcblxuLy8gc3RhcnQgd2l0aCB0aGUgYm9hcmRcbi8vIGFkZCBwaWVjZXMgLSBlYWNoIHBpZWNlIHdpbGwga25vdyBob3cgdG8gbW92ZSBhcm91bmQgdGhlIGJvYXJkXG4vLyBub3JtYWwgcGllY2UgYW5kIGtpbmcgcGllY2Vcbi8vIHBsYXllcnMgMSBhbmQgMlxuLy8gZXh0cmFzOiB0aW1lIGNvbnRyb2xzXG5cbi8vIGZvdW5kIDIxIHZ1bG5lcmFiaWxpdGllcyAoNSBsb3csIDExIG1vZGVyYXRlLCA1IGhpZ2gpXG5cblxuLy9sb2FkaW5nIEpTXG4kKCgpID0+IHtcblxuICAvL0dMT0JBTCBWQVJJQUJMRVNcbiAgY29uc3Qgd2lkdGggPSA0NjtcbiAgY29uc3QgYm9yZGVyID0gMjtcbiAgY29uc3QgJGJvYXJkID0gJCgnZGl2I2JvYXJkJyk7XG4gIGNvbnN0ICRwaWVjZXMgPSAkKCdkaXYjcGllY2VzJyk7XG4gIGNvbnN0ICRyZXNldEJ1dHRvbiA9ICQoJyNyZXNldC1idXR0b24nKTtcbiAgY29uc3QgJHJ1bGVzQnV0dG9uID0gJCgnI3J1bGVzLWJ1dHRvbicpO1xuICBjb25zdCAkaW5zdHJ1Y3Rpb25zID0gJCgnLmluc3RydWN0aW9ucycpO1xuICBjb25zdCAkd2lubmVyID0gJCgnI3dpbm5lcicpO1xuXG5cbiAgbGV0IGNvb3JkcyA9IG51bGw7Ly9zZXR0aW5nIGNvb3JkcyBnbG9iYWxseSBzbyBpdCdzIGNvbnN0YW50bHkgdXBkYXRpbmdcbiAgLy9zZXQgdXAgdGhlIGJvYXJkIHdpdGggdGhlIGNvcnJlY3QgY2xhc3NlcyBmb3IgdGhlIGxpZ2h0IGFuZCBkYXJrIHNxdWFyZXNcbiAgc2V0VXBCb2FyZCgpO1xuICAvL3NldHMgdXAgdGhlIGNsYXNzZXMgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgcGllY2VcbiAgc2V0VXBQaWVjZXMoKTtcbiAgLy9zZXR0aW5nIHVwIHRoZSBkYXJrUGllY2VzXG4gIGRhcmtQaWVjZXMoKTtcbiAgLy8gc2V0dGluZyB1cCB0aGUgbGlnaHRQaWVjZXNcbiAgbGlnaHRQaWVjZXMoKTtcblxuXG4gIC8vTElHSFQgUElFQ0VTXG4gIGZ1bmN0aW9uIGxpZ2h0UGllY2VzKCkge1xuICAgIGNvbnN0ICRsaWdodFBpZWNlcyA9ICQoJ2Rpdi5waWVjZS5saWdodCcpO1xuICAgIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgbGlnaHQgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICAgJGxpZ2h0UGllY2VzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwaWVjZSkge1xuICAgICAgLy90dXJuaW5nIHRoZSBpbmRleCAoZnJvbSAwIC0gMTEpXG4gICAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aHNcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gNCk7XG4gICAgICBjb25zdCB4ID0gKGluZGV4ICUgNCkgKiAyICsgKDEgLSB5ICUgMik7XG5cbiAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgsIHkpO1xuICAgICAgLy9hY3R1YWxseSBtb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgICBtb3ZlUGllY2VUbygkKHBpZWNlKSwgcGl4ZWxQb3NpdGlvbi50b3AsIHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gICAgfSk7XG4gIH0vL2VuZCBvZiBsaWdodFBpZWNlcyBmdW5jdGlvblxuXG5cbiAgLy9EQVJLIFBJRUNFU1xuICBmdW5jdGlvbiBkYXJrUGllY2VzKCkge1xuICAgIGNvbnN0ICRkYXJrUGllY2VzID0gJCgnZGl2LnBpZWNlLmRhcmsnKTtcbiAgICAvL3RoaXMgbG9vcCBtb3ZlcyBhbGwgdGhlIGRhcmsgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICAgJGRhcmtQaWVjZXMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBpZWNlKSB7XG4gICAgICAvL3R1cm5pbmcgdGhlIGluZGV4IChmcm9tIDAgLSAxMSlcbiAgICAgIC8vaW50byBhIHgseSBzcXVhcmUgY29vcmRpbmF0ZSB1c2luZyBtYXRoc1xuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA0KSArIDU7XG4gICAgICBjb25zdCB4ID0gKGluZGV4ICUgNCkgKiAyICsgKDEgLSB5ICUgMik7XG5cbiAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgsIHkpO1xuICAgICAgLy9tb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgICBtb3ZlUGllY2VUbygkKHBpZWNlKSwgcGl4ZWxQb3NpdGlvbi50b3AsIHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gICAgfSk7XG4gIH0vL2VuZCBvZiBkYXJrUGllY2VzIGZ1bmN0aW9uXG5cblxuXG4gIC8vRVZFTlRTXG4gIGZ1bmN0aW9uIHBpZWNlU2VsZWN0KCkge1xuICAgICQoJ2Rpdi5waWVjZScpLm9uKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgLy9zZWxlY3RlZCB2YXJpYWJsZVxuICAgICAgLy90dXJuIGB0aGlzYCBpbnRvIGEgalF1ZXJ5IG9iamVjdFxuICAgICAgY29uc3QgJHRoaXNQaWVjZSA9ICQoZXZlbnQudGFyZ2V0KTtcbiAgICAgIC8vdG9nZ2xpbmcgdGhlICdzZWxlY3RlZCcgY2xhc3Mgb2YgdGhpcyBwaWVjZVxuICAgICAgLy9hbmQgcG9zc2libGUgZGVzZWxlY3Rpbmcgb3RoZXIgcGllY2VzXG4gICAgICB0b2dnbGVTZWxlY3QoJHRoaXNQaWVjZSk7XG4gICAgICByZXNldE1vdmFibGVzKCk7XG4gICAgICAvL2dldCB0aGUgbGVnYWwgbW92ZXMgZm9yIHRoaXNcbiAgICAgIGlmICgkdGhpc1BpZWNlLmhhc0NsYXNzKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgIGdldE1vdmFibGVTcXVhcmVzKCR0aGlzUGllY2UpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG4gICAgICB9XG4gICAgfSk7Ly9lbmQgb2YgcGllY2UgY2xpY2sgZXZlbnRcblxuICB9XG5cbiAgLy8gQlVUVE9OU1xuICAvL3Jlc2V0dGluZyB0aGUgZ2FtZS5cbiAgJHJlc2V0QnV0dG9uLm9uKCdjbGljaycsICgpID0+IHtcbiAgICByZXNldCgpO1xuICAgIC8vIHNldHRpbmcgdXAgdGhlIHBpZWNlcyBhZnRlciBlbXB0eWluZyB0aGVtLlxuICB9KTtcblxuICAvL2hpZGluZyBhbmQgc2hvd2luZyB0aGUgcnVsZXMuXG4gICRydWxlc0J1dHRvbi5vbignY2xpY2snLCAoKSA9PiB7XG4gICAgJGluc3RydWN0aW9ucy50b2dnbGUoJ3Nsb3cnKTtcbiAgICBjb25zb2xlLmxvZyhgQ2xpY2tpbmcgaGVyZSB3b3Jrc2ApO1xuICB9KTtcblxuXG5cbiAgJCgnZGl2LnNxdWFyZScpLm9uKCdjbGljaycsIChlKSA9PiB7XG5cbiAgICBjdXJyZW50UG9zaXRpb24oKTsvL3RoZSBjdXJyZW50UG9zaXRpb24gb2YgdGhlIHNxdWFyZTsgY29vcmRzXG4gICAgLy90dXJuIGBlIG9yIGV2ZW50YCBpbnRvIGEgalF1ZXJ5IG9iamVjdFxuICAgIGNvbnN0ICRwaWVjZVRvTW92ZSA9ICQoZS50YXJnZXQpO1xuXG5cbiAgICAvL2lmICQodGhpcykgaXMgYSBsZWdhbCBzcXVhcmUgdG8gbW92ZSB0by4uLlxuICAgIGlmICgkcGllY2VUb01vdmUuaGFzQ2xhc3MoJ21vdmFibGUnKSkge1xuXG4gICAgICAvL2dldCB0aGUgcGllY2Ugd2l0aCB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgICAgY29uc3QgJHNlbGVjdGVkUGllY2UgPSAkKCdkaXYucGllY2Uuc2VsZWN0ZWQnKTtcbiAgICAgIC8vb25seSBtb3ZlIGlmIHRoZXJlIGlzIGV4YWN0bHkgb25lIHNlbGVjdGVkIHBpZWNlXG4gICAgICBpZiAoJHNlbGVjdGVkUGllY2UubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIC8vZ2V0IHRoZSBpbmRleCBvZiB0aGUgc3F1YXJlXG4gICAgICAgIC8vYW5kIHRyYW5zbGF0ZSBpdCB0byBwaXhlbCBwb3NpdGlvblxuICAgICAgICBjb25zdCBpbmRleCA9ICRwaWVjZVRvTW92ZS5wcmV2QWxsKCkubGVuZ3RoO1xuICAgICAgICBjb25zdCB4ID0gaW5kZXggJSA4O1xuICAgICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgICBjb25zdCBwaXhlbHMgPSBnZXRQaXhlbHMoeCwgeSk7XG4gICAgICAgIC8vYWN0dWFsbHkgZG8gdGhlIG1vdmluZ1xuICAgICAgICBtb3ZlUGllY2VUbygkc2VsZWN0ZWRQaWVjZSwgcGl4ZWxzLnRvcCwgcGl4ZWxzLmxlZnQpO1xuICAgICAgICAvL3JlbW92ZUNhcHR1cmVkUGllY2VzXG4gICAgICAgIHJlbW92ZUNhcHR1cmVkUGllY2VzKCRwaWVjZVRvTW92ZSk7XG4gICAgICAgIC8vLnByZXZBbGwoKS5sZW5ndGggaXMgdXNlZCB0byBnZXQgdGhlIGluZGV4XG4gICAgICAgIC8vb2YgdGhlIHNlbGVjdGVkIHBpZWNlXG4gICAgICAgIGNoZWNrS2luZygkc2VsZWN0ZWRQaWVjZSwgJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGgpO1xuICAgICAgICAvL2RlLXNlbGVjdCB0aGUgcGllY2UgdG8gZW5kIHRoZSBtb3ZlXG4gICAgICAgICRzZWxlY3RlZFBpZWNlLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXG4gICAgICAgIC8vc2V0IHRoZSBuZXcgbGVnYWwgbW92ZXNcbiAgICAgICAgJCgnZGl2LnNxdWFyZScpLnJlbW92ZUNsYXNzKCdtb3ZhYmxlJyk7XG5cbiAgICAgICAgLy8gVEVTVC4gdGVzdGluZyB0aGUgd2lubmluZyBjb25kaXRpb25zIGJ5IGNoZWNraW5nIHRoZSBudW1iZXIgb2YgcGllY2VzIGxlZnQgb24gdGhlIGJvYXJkXG4gICAgICAgIHBpZWNlc0xlZnQoKTtcblxuICAgICAgICAvL2luY3JlbWVudCB0aGUgbW92ZSBjb3VudGVyXG4gICAgICAgIGluY3JlbWVudE1vdmVDb3VudGVyKCk7XG5cbiAgICAgICAgY29uc3QgY29sb3IgPSAkc2VsZWN0ZWRQaWVjZS5oYXNDbGFzcygnbGlnaHQnKSA9PT0gdHJ1ZSA/ICdsaWdodCcgOiAnZGFyayc7XG5cbiAgICAgICAgaW5jcmVtZW50TW92ZUNvdW50KGNvbG9yKTtcbiAgICAgICAgLy9yZXNldCB0aGUgc3F1YXJlcyB0byBhbGxvdyBtb3Zlc1xuICAgICAgICByZXNldE1vdmFibGVzKCk7XG5cbiAgICAgIH1cbiAgICB9XG5cbiAgfSk7XG5cblxuICAvLyBNT1JFIEZVTkNUSU9OU1xuICAvL3RoaXMgZnVuY3Rpb24gcmVtb3ZlcyB0aGUgZGF0YSBpdGVtIHdpdGgga2V5ICdqdW1wZWRQaWVjZXMnIGZyb20gZXZlcnkgZGl2LnNxdWFyZVxuICAvLyBhbmQgcmVtb3ZlcyB0aGUgY2xhc3MgJ21vdmFibGUnIGZyb20gZXZlcnkgc3F1YXJlXG4gIC8vY2hlY2tzIHRoZSBjdXJyZW50UG9zaXRpb24gb2YgdGhlIGNsaWNrZWQgb3Igc2VsZWN0ZWQgZGl2IGFuZCByZXR1cm5zIHRoZSBjb29yZHMuXG4gIGZ1bmN0aW9uIGN1cnJlbnRQb3NpdGlvbigpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9ICQoZXZlbnQudGFyZ2V0KS5wb3NpdGlvbigpO1xuICAgIGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AsIHBvc2l0aW9uLmxlZnQpO1xuICAgIHJldHVybiBjb29yZHM7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHJlc2V0TW92YWJsZXMoKSB7XG4gICAgJCgnZGl2LnNxdWFyZScpLnJlbW92ZURhdGEoJ2p1bXBlZFBpZWNlcycpLnJlbW92ZUNsYXNzKCdtb3ZhYmxlJyk7XG4gIH1cblxuXG4gIC8vZnVuY3Rpb24gZm9yIHRyYW5zbGF0aW5nIGFuIHgseSBjb29yZGluYXRlcyB0byBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vdGhlIGNvbnZlbnRpb24gaXMgdGhhdCB0aGUgc3F1YXJlIGluIHRoZSB1cHBlciBsZWZ0IGNvcm5lciBpcyBhdCBwb3NpdGlvbiAwLDBcbiAgLy90aGUgc3F1YXJlIGluIHRoZSB1cHBlciByaWdodCwgYXQgNywwIGFuZCB0aGUgbG93ZXJcbiAgLy9yaWdodCBhdCA3LDdcbiAgZnVuY3Rpb24gZ2V0UGl4ZWxzKHgsIHkpIHtcbiAgICAvL3Rha2VzIGFuIHgseSBwb3NpdGlvbiwgcmV0dXJuc1xuICAgIC8vcGl4ZWxzIGZyb20gdGhlIGxlZnQsIHJpZ2h0XG4gICAgcmV0dXJuIHtcbiAgICAgICd0b3AnOiAoeSAqICh3aWR0aCArIGJvcmRlcikpICsgJ3B4JyxcbiAgICAgICdsZWZ0JzogKHggKiAod2lkdGggKyBib3JkZXIpKSArICdweCdcbiAgICB9O1xuICB9XG5cbiAgLy9mdW5jdGlvbiBmb3IgdHVybmluZyBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vaW50byB0aGUgeCx5IGNvb3JkaW5hdGUgb2YgYSBzcXVhcmUgb24gdGhlIGJvYXJkXG4gIC8vaXQgZm9sbG93cyB0aGUgc2FtZSBjb29yZGluYXRlIGNvbnZlbnRpb24gYXMgZ2V0UGl4ZWxzXG4gIGZ1bmN0aW9uIGdldENvb3Jkcyh0b3AsIGxlZnQpIHtcbiAgICAvL3JldHVybnMgYW4geCBhbmQgYSB5XG4gICAgLy9naXZlbiBhIHRvcCBhbmQgbGVmdCBwaXhlbHNcbiAgICByZXR1cm4ge1xuICAgICAgJ3gnOiBsZWZ0IC8gKHdpZHRoICsgYm9yZGVyKSxcbiAgICAgICd5JzogdG9wIC8gKHdpZHRoICsgYm9yZGVyKVxuICAgIH07XG4gIH1cblxuICAvL2Z1bmN0aW9uIGZvciByZXR1cm5pbmcgdGhlIHNldCBvZiBsZWdhbCBtb3ZlcyBnaXZlbiBhIHBpZWNlXG4gIC8vIHRoaXMgYWxzbyBzdG9yZXMganVtcGVkIHBpZWNlcyBpbiBhIGRhdGEgZWxlbWVudCBvZiBlYWNoIHNxdWFyZSB0aGF0IGNhbiBiZSBtb3ZlZCB0b1xuICBmdW5jdGlvbiBnZXRNb3ZhYmxlU3F1YXJlcygkcGllY2UpIHtcblxuICAgIC8vc2VsZWN0IGFsbCBvZiB0aGUgc3F1YXJlc1xuICAgIGNvbnN0ICRzcXVhcmVzID0gJCgnZGl2LnNxdWFyZScpO1xuXG4gICAgLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgICAvL21hcCBjcmVhdGVzIGEgbmV3IG9iamVjdCBmcm9tIGFuIGV4aXN0aW5nIG9uZVxuICAgIC8vdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAgIGNvbnN0IHRha2VuU3F1YXJlcyA9IHt9O1xuICAgICQoJ2Rpdi5waWVjZScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwaWVjZSkge1xuXG4gICAgICAvL3RoaXMgZnVuY3Rpb24gdHJhbnNsYXRlcyBhIHBpZWNlXG4gICAgICBjb25zdCBwb3NpdGlvbiA9ICQocGllY2UpLnBvc2l0aW9uKCk7XG4gICAgICBjb25zdCBjb29yZHMgPSBnZXRDb29yZHMocG9zaXRpb24udG9wLCBwb3NpdGlvbi5sZWZ0KTtcbiAgICAgIGNvbnN0IHNxdWFyZUluZGV4ID0gY29vcmRzLnkgKiA4ICsgY29vcmRzLng7XG4gICAgICB0YWtlblNxdWFyZXNbc3F1YXJlSW5kZXhdID0gJChwaWVjZSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjb29yZHMgPSBnZXRDb29yZHMoJHBpZWNlLnBvc2l0aW9uKCkudG9wLCAkcGllY2UucG9zaXRpb24oKS5sZWZ0KTtcblxuICAgIC8vbGlnaHRzIG1vdmUgZG93biB0aGUgYm9hcmRcbiAgICBjb25zdCBsaWdodERpcmVjdGlvbiA9IFtcbiAgICAgIHsgeDogMSwgeTogMSB9LFxuICAgICAgeyB4OiAtMSwgeTogMSB9XG4gICAgXTtcbiAgICAvL2RhcmtzIG1vdmUgdXAgdGhlIGJvYXJkXG4gICAgY29uc3QgZGFya0RpcmVjdGlvbiA9IFtcbiAgICAgIHsgeDogMSwgeTogLTEgfSxcbiAgICAgIHsgeDogLTEsIHk6IC0xIH1cbiAgICBdO1xuICAgIC8va2luZ3MgbW92ZSBpbiBhbnkgZGlyZWN0aW9uXG4gICAgY29uc3Qga2luZ0RpcmVjdGlvbiA9IGxpZ2h0RGlyZWN0aW9uLmNvbmNhdChkYXJrRGlyZWN0aW9uKTtcblxuICAgIGxldCBkaXJlY3Rpb247XG4gICAgaWYgKCRwaWVjZS5oYXNDbGFzcygna2luZycpKSB7XG4gICAgICBkaXJlY3Rpb24gPSBraW5nRGlyZWN0aW9uO1xuICAgIH0gZWxzZSBpZiAoJHBpZWNlLmhhc0NsYXNzKCdsaWdodCcpKSB7XG4gICAgICBkaXJlY3Rpb24gPSBsaWdodERpcmVjdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlyZWN0aW9uID0gZGFya0RpcmVjdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdCBvdXRPZkJvdW5kcyA9IGZ1bmN0aW9uIChjb29yZHMpIHtcbiAgICAgIHJldHVybiAhKGNvb3Jkcy54ID49IDAgJiYgY29vcmRzLnggPCA4ICYmIGNvb3Jkcy55ID49IDAgJiYgY29vcmRzLnkgPCA4KTtcbiAgICB9O1xuXG4gICAgbGV0ICRsZWdhbFNxdWFyZXMgPSAkKCk7XG4gICAgY29uc3QgYnVpbGRNb3ZlcyA9IGZ1bmN0aW9uIChjb29yZHMsIGRpcmVjdGlvbiwganVtcHNPbmx5KSB7XG4gICAgICBpZiAob3V0T2ZCb3VuZHMoY29vcmRzKSkgcmV0dXJuO1xuICAgICAgLy9jdXJyZW50IHNxdWFyZSBpcyBhdCBjb29yZHNcbiAgICAgIGNvbnN0ICRjdXJyZW50U3F1YXJlID0gJHNxdWFyZXMuZXEoY29vcmRzLnkgKiA4ICsgY29vcmRzLngpO1xuICAgICAgJC5lYWNoKGRpcmVjdGlvbiwgZnVuY3Rpb24gKGluZGV4LCBkaXJlY3Rpb24pIHtcblxuICAgICAgICBjb25zdCBuZXdDb29yZHMgPSB7XG4gICAgICAgICAgeDogZGlyZWN0aW9uLnggKyBjb29yZHMueCxcbiAgICAgICAgICB5OiBkaXJlY3Rpb24ueSArIGNvb3Jkcy55XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG91dE9mQm91bmRzKG5ld0Nvb3JkcykpIHJldHVybjtcbiAgICAgICAgY29uc3QgbmV3U3F1YXJlSW5kZXggPSA4ICogbmV3Q29vcmRzLnkgKyBuZXdDb29yZHMueDtcbiAgICAgICAgLy9pZiB0aGUgc3F1YXJlIGlzIHRha2VuLFxuICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XSkge1xuXG4gICAgICAgICAgLy9DYW4gb25seSBqdW1wIGlmIHBpZWNlIGlzIGRpZmZlcmVudFxuICAgICAgICAgIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2RhcmsnKSkge1xuICAgICAgICAgICAgaWYgKHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF0uaGFzQ2xhc3MoJ2RhcmsnKSkgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnbGlnaHQnKSkgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGp1bXBDb29yZHMgPSB7XG4gICAgICAgICAgICB4OiBkaXJlY3Rpb24ueCAqIDIgKyBjb29yZHMueCxcbiAgICAgICAgICAgIHk6IGRpcmVjdGlvbi55ICogMiArIGNvb3Jkcy55XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAob3V0T2ZCb3VuZHMoanVtcENvb3JkcykpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGp1bXBTcXVhcmVJbmRleCA9IGp1bXBDb29yZHMueSAqIDggKyBqdW1wQ29vcmRzLng7XG4gICAgICAgICAgLy9pZiB0aGUganVtcCBzcXVhcmUgaXMgZnJlZS4uLlxuICAgICAgICAgIC8vYWRkIGl0IGFuZCB0aGUgZGF0YS1qdW1wZWQtcGllY2VzXG4gICAgICAgICAgaWYgKCF0YWtlblNxdWFyZXNbanVtcFNxdWFyZUluZGV4XSkge1xuICAgICAgICAgICAgY29uc3QgJG5ld1NxdWFyZSA9ICRzcXVhcmVzLmVxKGp1bXBTcXVhcmVJbmRleCk7XG4gICAgICAgICAgICAvL2lmIHdlIGhhdmVuJ3QgYWxyZWFkeSBzZWVuIGl0XG4gICAgICAgICAgICBpZiAoISRuZXdTcXVhcmUuaXMoJGxlZ2FsU3F1YXJlcykpIHtcblxuICAgICAgICAgICAgICAvL2FkZCB0aGUgcGFzc2VkIG92ZXIgc3F1YXJlIHRvIGl0XG4gICAgICAgICAgICAgICRsZWdhbFNxdWFyZXMgPSAkbGVnYWxTcXVhcmVzLmFkZCgkbmV3U3F1YXJlKTtcblxuICAgICAgICAgICAgICAvL2FuZCB0aGUganVtcGVkIHNxdWFyZXMgZnJvbSBob3cgd2UgZ290IGhlcmVcbiAgICAgICAgICAgICAgbGV0ICRqdW1wZWRQaWVjZXMgPSB0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdO1xuICAgICAgICAgICAgICBpZiAoJGN1cnJlbnRTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJykpIHtcbiAgICAgICAgICAgICAgICAkanVtcGVkUGllY2VzID0gJGp1bXBlZFBpZWNlcy5hZGQoJGN1cnJlbnRTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJykpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICRuZXdTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJywgJGp1bXBlZFBpZWNlcyk7XG5cbiAgICAgICAgICAgICAgLy9hbmQgcmVjdXJzZSwgd2l0aCBqdW1wc09ubHkgc2V0IHRvIHRydWVcbiAgICAgICAgICAgICAgYnVpbGRNb3ZlcyhqdW1wQ29vcmRzLCBkaXJlY3Rpb24sIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghanVtcHNPbmx5KSB7XG4gICAgICAgICAgY29uc3QgJG5ld1NxdWFyZSA9ICRzcXVhcmVzLmVxKG5ld1NxdWFyZUluZGV4KTtcbiAgICAgICAgICAkbmV3U3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycsICQoKSk7XG4gICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH07XG4gICAgYnVpbGRNb3Zlcyhjb29yZHMsIGRpcmVjdGlvbiwgZmFsc2UpO1xuICAgIHJldHVybiAkbGVnYWxTcXVhcmVzO1xuXG4gIH0vL2VuZCBvZiBnZXRNb3ZhYmxlU3F1YXJlc1xuXG4gIGZ1bmN0aW9uIHNldFVwUGllY2VzKCkge1xuICAgIC8vc2VsZWN0IGFsbCB0aGUgZGl2cyB3aXRoIGNsYXNzICdwaWVjZSdcbiAgICAkKCdwaWVjZScpO1xuICAgIC8vYWRkIHRoZSAnbGlnaHQnIGNsYXNzIHRvIGhhbGYgb2YgdGhlbVxuICAgICQoJ2Rpdi5waWVjZTpldmVuJykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4gICAgLy9qUXVlcnkncyBldmVuIGFuZCBvZGQgc2VsZWN0b3IgbWV0aG9kcyB0byBhc3NpZ24gdGhlIGNsYXNzZXMgLmxpZ2h0IGFuZCAuZGFyay5cbiAgICAvL2FkZCB0aGUgJ2RhcmsnIHRvIHRoZSBvdGhlciBoYWxmXG4gICAgJCgnZGl2LnBpZWNlOm9kZCcpLmFkZENsYXNzKCdkYXJrJyk7XG4gIH1cblxuICAvL2FjdHVhbGx5IG1vdmluZyB0aGUgcGllY2VcbiAgZnVuY3Rpb24gbW92ZVBpZWNlVG8oJHBpZWNlLCBuZXdUb3AsIG5ld0xlZnQpIHtcbiAgICAvL3NldCB0aGUgY3NzICd0b3AnIGFuZCAnbGVmdCdcbiAgICAvL2F0dHJpYnV0ZXMgb2YgdGhlIHBhc3NlZCBwaWVjZVxuICAgIC8vdG8gdGhlIGFyZ3VtZW50cyBuZXdUb3AgYW5kIG5ld0xlZnRcbiAgICAkcGllY2UuY3NzKCd0b3AnLCBuZXdUb3ApO1xuICAgICRwaWVjZS5jc3MoJ2xlZnQnLCBuZXdMZWZ0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFVwQm9hcmQoKSB7XG5cbiAgICAvL0NyZWF0aW5nIHRoZSA2NCBzcXVhcmVzIGFuZCBhZGRpbmcgdGhlbSB0byB0aGUgRE9NXG4gICAgY29uc3Qgc3F1YXJlQ291bnQgPSA4ICogODsgLy84IHJvd3MgYnkgOCBjb2x1bW5zOyB6ZXJvIGJhc2VkIGluZGV4XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcXVhcmVDb3VudDsgaSsrKSB7XG4gICAgICAvL3RoaXMgbGluZSBjcmVhdGVzIGEgbmV3IGRpdiB3aXRoIHRoZSBjbGFzcyAnc3F1YXJlJ1xuICAgICAgLy9hbmQgYXBwZW5kcyBpdCB0byB0aGUgZGl2IHdpdGggaWQgJ2JvYXJkJ1xuICAgICAgJGJvYXJkLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygnc3F1YXJlJykpO1xuICAgIH1cblxuICAgIC8vY3JlYXRpbmcgdGhlIDI0IHBpZWNlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICAgIGNvbnN0IHBpZWNlQ291bnQgPSAyNDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGllY2VDb3VudDsgaSsrKSB7XG4gICAgICAvL3RoaXMgbGluZSBhcHBlbmRzIGFuIGVtcHR5IGRpdiB3aXRoIHRoZSBjbGFzcyAncGllY2UnIHRvIHRoZSBkaXYgd2l0aCBpZCAncGllY2VzJ1xuICAgICAgJHBpZWNlcy5hcHBlbmQoJCgnPGRpdi8+JykuYWRkQ2xhc3MoJ3BpZWNlJykpO1xuICAgIH1cbiAgICAvL2l0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGRpdnMgd2l0aCBjbGFzcyBgc3F1YXJlYFxuICAgIC8vZmlndXJlIG91dCB3aGV0aGVyIGVhY2ggb25lIHNob3VsZCBiZVxuICAgIC8vbGlnaHQgb3IgZGFyaywgYW5kIGFzc2lnbiB0aGUgcHJvcGVyIGNsYXNzXG4gICAgY29uc3QgJGVhY2hTcXVhcmUgPSAkKCdkaXYuc3F1YXJlJyk7XG4gICAgJGVhY2hTcXVhcmUuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgIGlmIChsaWdodE9yRGFyayhpbmRleCkgPT09IDApIHtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnbGlnaHQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2RhcmsnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvL2lubmVyIGhlbHBlciBmdW5jdGlvbiB0aGF0IHRha2VzIGEgbnVtYmVyIGJldHdlZW5cbiAgICAvLzAgYW5kIDYzIChpbmNsdXNpdmUpIGFuZCByZXR1cm5zIDEgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmVcbiAgICAvL2RhcmssIGFuZCAwIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlIGxpZ2h0XG4gICAgZnVuY3Rpb24gbGlnaHRPckRhcmsoaW5kZXgpIHtcbiAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgY29uc3Qgb2RkWCA9IHggJSAyO1xuICAgICAgY29uc3Qgb2RkWSA9IHkgJSAyO1xuICAgICAgcmV0dXJuIChvZGRYIF4gb2RkWSk7XG4gICAgfVxuXG4gIH0vL2VuZCBvZiBzZXRVcEJvYXJkKClcblxuICBmdW5jdGlvbiB0b2dnbGVTZWxlY3QoJHBpZWNlKSB7XG4gICAgLy9pZiAkcGllY2UgaGFzIHRoZSBjbGFzcyAnc2VsZWN0ZWQnLHJlbW92ZSBpdFxuICAgIC8vaWYgJHBpZWNlIGRvZXMgbm90IGhhdmUgdGhlIGNsYXNzICdzZWxlY3RlZCdcbiAgICAvL21ha2Ugc3VyZSBubyBvdGhlciBkaXZzIHdpdGggdGhlIGNsYXNzICdwaWVjZSdcbiAgICAvL2hhdmUgdGhhdCBjbGFzcywgdGhlbiBzZXQgJHBpZWNlIHRvIGhhdmUgdGhlIGNsYXNzXG4gICAgaWYgKCRwaWVjZS5oYXNDbGFzcygnc2VsZWN0ZWQnKSlcbiAgICAgICRwaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBlbHNlIHtcbiAgICAgICQoJ2Rpdi5waWVjZScpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBwaWVjZSkge1xuICAgICAgICBpZiAoJChwaWVjZSkuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAgICAgJChwaWVjZSkucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICB9KTtcbiAgICAgICRwaWVjZS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHRvZ2dsZVNlbGVjdCBmdW5jdGlvblxuXG4gIGNvbnN0ICRtb3ZlQ291bnRlciA9ICQoJyNtb3ZlQ291bnRlcicpO1xuICBmdW5jdGlvbiBpbmNyZW1lbnRNb3ZlQ291bnRlcigpIHtcbiAgICAvL2dldHMgdGhlIGh0bWwgb2YgdGhlIHNwYW4gd2l0aCBpZCBtb3ZlQ291bnRlciB0dXJucyBpdCBpbnRvIGEgbnVtYmVyXG4gICAgLy9pbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgIC8vc2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIG1vdmVDb3VudGVyXG4gICAgLy90byB0aGUgbmV3IG1vdmUgY291bnRcbiAgICAkbW92ZUNvdW50ZXIuaHRtbChwYXJzZUludCgkbW92ZUNvdW50ZXIuaHRtbCgpKSArIDEpO1xuXG4gIH1cblxuXG4gIHBpZWNlU2VsZWN0KCk7Ly8gcGxheWVyIHRvIHNlbGVjdCBhIHBpZWNlXG4gIC8vIFBsYXllciBjaGFuZ2UgZnJvbSBwbGF5ZXIgMSB0byBwbGF5ZXIgMlxuICAvL3RoaXMgZnVuY3Rpb24gYWxsb3dzIHRoZSBwbGF5ZXJzIHRvIGJlIGNoYW5nZWQuXG4gIGZ1bmN0aW9uIGluY3JlbWVudE1vdmVDb3VudChjb2xvcikge1xuICAgIC8vZ2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIGxpZ2h0TW92ZUNvdW50IG9yIGRhcmtNb3ZlQ291bnRcbiAgICAvL3R1cm5zIGl0IGludG8gYSBudW1iZXIgaW5jcmVtZW50cyBpdCBieSBvbmVcbiAgICAvL3NldHMgdGhlIGh0bWwgb2YgdGhlIHNwYW4gd2l0aCBpZCBsaWdodE1vdmVDb3VudCBvciBkYXJrTW92ZUNvdW50IHRvIHRoZSBuZXcgbW92ZSBjb3VudFxuICAgIGxldCB3aGljaENvdW50ZXIgPSAnJztcbiAgICBjb2xvciA9PT0gJ2xpZ2h0JyA/IHdoaWNoQ291bnRlciA9ICcjbGlnaHRNb3ZlQ291bnQnIDogd2hpY2hDb3VudGVyID0gJyNkYXJrTW92ZUNvdW50JztcbiAgICBsZXQgJG1vdmVzID0gcGFyc2VJbnQoJCh3aGljaENvdW50ZXIpLmh0bWwoKSk7XG4gICAgJG1vdmVzKys7XG5cbiAgICAkKHdoaWNoQ291bnRlcikuaHRtbCgkbW92ZXMpO1xuICAgIGNvbnNvbGUubG9nKCRtb3Zlcyk7XG4gICAgLy9pZiB0aGUgbnVtYmVyIGlzIGV2ZW4gdGhlbiBpdCdzIGxpZ2h0J3MgbW92ZSBhbmQgb2RkIGl0J3MgZGFyaydzIG1vdmUuXG4gICAgaWYgKCRtb3ZlcyAlIDIgPT09IDEpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBIZWxsbyBvZGQgbnVtYmVyYCk7XG4gICAgICBjb25zb2xlLmxvZygkZGFya1BpZWNlcyk7XG4gICAgfSBlbHNlIGlmICgkbW92ZXMgJSAyID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhgSGVsbG8gZXZlbiBudW1iZXJgKTtcbiAgICAgIGNvbnNvbGUubG9nKCRsaWdodFBpZWNlcyk7XG4gICAgfVxuICB9Ly9lbmQgb2YgaW5jcmVtZW50TW92ZUNvdW50KClcblxuICAvL1BMQVlFUiBPTkUgQU5EIFBMQVlFUiBUV09cbiAgLy9JZiB0aGUgbW92ZSBjb3VudCBpcyBldmVuLCB0aGVuIHBsYXllciBvbmUncyB0dXJuIG90aGVyd2lzZSBwbGF5ZXIgdHdvJ3MgdHVyblxuICBjb25zdCAkbGlnaHRQaWVjZXMgPSAkKCdkaXYucGllY2UubGlnaHQnKTtcbiAgY29uc3QgJGRhcmtQaWVjZXMgPSAkKCdkaXYucGllY2UuZGFyaycpO1xuXG4gIC8vIHRoaXMgZnVuY3Rpb24gZ2V0cyB0aGUgalF1ZXJ5IG9iamVjdCBzdG9yZWQgaW5cbiAgLy8gdGhlIGRhdGEgb2JqZWN0IG9mICRzcXVhcmUgdW5kZXIgdGhlIGtleSAnanVtcGVkUGllY2VzJ1xuICAvLyBhbmQgcmVtb3ZlcyBldmVyeSBlbGVtZW50IGluIHRoYXQgalF1ZXJ5IHNlbGVjdGlvblxuICBmdW5jdGlvbiByZW1vdmVDYXB0dXJlZFBpZWNlcygkc3F1YXJlKSB7XG4gICAgJHNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKS5yZW1vdmUoKTtcbiAgfVxuXG4gIC8vIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSAkcGllY2UgYW5kIHRoZSBpbmRleCBvZiBhIHNxdWFyZVxuICAvL3NxdWFyZUluZGV4IHdpbGwgYmUgYmV0d2VlbiAwIC0gNjMgKGluY2x1c2l2ZSkuXG4gIC8vIGlmIHRoZSBpbmRleCByZWZlcnMgdG8gYW4gZWxlbWVudCBpbiB0aGUgZmlyc3Qgcm93IG9yIGxhc3Qgcm93LFxuICAvLyB0aGUgY2xhc3MgJ2tpbmcnIHNob3VsZCBiZSBhZGRlZCB0byB0aGUgJHBpZWNlXG4gIGZ1bmN0aW9uIGNoZWNrS2luZygkcGllY2UsIHNxdWFyZUluZGV4KSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2NDsgaSsrKSB7XG4gICAgICBpZiAoc3F1YXJlSW5kZXggPCA4IHx8IHNxdWFyZUluZGV4ID49IDU2KSB7XG4gICAgICAgICRwaWVjZS5hZGRDbGFzcygna2luZycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIFdJTk5JTkdcbiAgLy93aW5uaW5nIGNvbmRpdGlvbnM6IElmIG9uZSBwbGF5ZXIgb25seSBoYXMgdGhlaXIgcGllY2VzIG9uIHRoZSBib2FyZCBsZWZ0XG4gIC8vdGhleSB3aW4uXG4gIGZ1bmN0aW9uIHBpZWNlc0xlZnQoKSB7XG4gICAgY29uc3QgZGFya1BpZWNlcyA9ICRkYXJrUGllY2VzLmxlbmd0aDtcbiAgICBjb25zdCBsaWdodFBpZWNlcyA9ICRsaWdodFBpZWNlcy5sZW5ndGg7XG4gICAgaWYgKGRhcmtQaWVjZXMgPT09IDApIHtcbiAgICAgICR3aW5uZXIudGV4dChgUGxheWVyIDEgV2luc2ApO1xuICAgICAgcmV0dXJuICR3aW5uZXIuc2xpZGVEb3duKGBQbGF5ZXIgMSBXaW5zYCk7XG4gICAgfSBlbHNlIGlmIChsaWdodFBpZWNlcyA9PT0gMCkge1xuICAgICAgY29uc29sZS5sb2coYFBsYXllciAyIHdpbnNgKTtcbiAgICAgIHJldHVybiAkd2lubmVyLnRleHQoYFBsYXllciAyIFdpbnNgKTtcblxuICAgIH0gZWxzZSBpZiAobGlnaHRQaWVjZXMgPT09IDEgJiYgZGFya1BpZWNlcyA9PT0gMSkgey8vYW5kIDQwIG1vdmVzIGFyZSBwbGF5ZWQgYWZ0ZXJ3YXJkc1xuICAgICAgLy95ZXQgdG8gY29kZSB0aGlzIGZ1bmN0aW9uXG4gICAgICBjb25zb2xlLmxvZyhgSXQncyBhIGRyYXdgKTtcbiAgICAgIHJldHVybiAkd2lubmVyLnRleHQoYEl0J3MgYSBkcmF3YCk7XG4gICAgfVxuICB9XG5cbiAgLy90aGlzIHJlc2V0cyB0aGUgZ2FtZSBieSBlZmZlY3RpdmVseSByZWxvYWRpbmcgdGhlIHBhZ2UgZnJvbSBjYWNoZVxuICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgfVxuXG59KTsvL2VuZCBvZiBKUyBsb2FkXG5cblxuLypcblxuVE9ETzpcbjEuIFBsYXllciBjaGFuZ2UgZnJvbSBwbGF5ZXIgMSB0byBwbGF5ZXIgMiBmZWF0dXJlIHJlcXVlc3RcbjIuIFJlc2V0IHRoZSBnYW1lIGJ5IHB1dHRpbmcgdGhlIHBpZWNlcyB0byB0aGUgb3JpZ2luYWwgcG9zaXRpb24gZmVhdHVyZSByZXF1ZXN0ZlxuMy4gV2luIGNvbmRpdGlvbnMsIGlmIGVpdGhlciBwbGF5ZXIgaGFzIHBpZWNlcyBsZWZ0IG9uIHRoZSBib2FyZCB3aGlsZSB0aGUgb3RoZXIgZG9lc24ndFxuICB0aGVuIGl0J3MgYSB3aW4uXG40LiBDb3VsZCBkbyBtb3JlIHN0eWxpbmcgdG8gbWFrZSB0aGUgZ2FtZSBoYXZlIGEgc21vb3RoZXIgZmVlbC4gKGJpdCB2YWd1ZSlcbjUuIFJlZmFjdG9yIG15IGNvZGUuXG4qL1xuIl19
