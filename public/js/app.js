"use strict";$(function(){function e(){var e=$(event.target).position();return p=i(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(c+l)+"px",left:e*(c+l)+"px"}}function i(e,a){return{x:a/(c+l),y:e/(c+l)}}function s(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var s=$(a).position(),n=i(s.top,s.left),o=8*n.y+n.x;t[o]=$(a)});var s=i(e.position().top,e.position().left),n=[{x:1,y:1},{x:-1,y:1}],o=[{x:1,y:-1},{x:-1,y:-1}],r=n.concat(o),d=void 0;d=e.hasClass("king")?r:e.hasClass("light")?n:o;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},l=$();return function i(s,n,o){if(!c(s)){var r=a.eq(8*s.y+s.x);$.each(n,function(d,v){var f={x:v.x+s.x,y:v.y+s.y};if(!c(f)){var u=8*f.y+f.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var p={x:2*v.x+s.x,y:2*v.y+s.y};if(c(p))return;var h=8*p.y+p.x;if(!t[h]){var C=a.eq(h);if(!C.is(l)){l=l.add(C);var m=t[u];r.data("jumpedPieces")&&(m=m.add(r.data("jumpedPieces"))),C.data("jumpedPieces",m),i(p,n,!0)}}}else if(!o){var x=a.eq(u);x.data("jumpedPieces",$()),l=l.add(x)}}})}}(s,d,!1),l}function n(e,a,t){e.css("top",a),e.css("left",t)}function o(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function r(){$("#moveCounter").html(parseInt($("#moveCounter").html(),10)+1)}function d(){location.reload()}for(var c=46,l=2,v=$("div#board"),f=$("div#pieces"),u=$("#reset-button"),p=null,h=0;h<64;h++)v.append($("<div/>").addClass("square"));!function(){function e(e){return e%8%2^Math.floor(e/8)%2}$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}();for(var C=0;C<24;C++)f.append($("<div/>").addClass("piece"));!function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),$("div.piece.light").each(function(e,a){var i=Math.floor(e/4),s=e%4*2+(1-i%2),o=t(s,i);n($(a),o.top,o.left)}),$("div.piece.dark").each(function(e,a){var i=Math.floor(e/4)+5,s=e%4*2+(1-i%2),o=t(s,i);n($(a),o.top,o.left)}),u.on("click",function(){d()}),$("div.piece").on("click",function(e){var t=$(e.target);o(t),a(),t.hasClass("selected")&&s(t).addClass("movable")}),$("div.square").on("click",function(i){e();var s=$(i.target);if(s.hasClass("movable")){var o=$("div.piece.selected");if(1===o.length){var d=s.prevAll().length,c=d%8,l=Math.floor(d/8),v=t(c,l);n(o,v.top,v.left),r(),o.removeClass("selected"),$("div.square").removeClass("movable"),a()}}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiY3VycmVudFBvc2l0aW9uIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsInRvcCIsImxlZnQiLCJyZXNldE1vdmFibGVzIiwid2lkdGgiLCJib3JkZXIiLCJyZW1vdmVDbGFzcyIsImdldFBpeGVscyIsIngiLCJ5IiwiZ2V0Q29vcmRzIiwiJHNxdWFyZXMiLCJjb29yZHMiLCJsaWdodFZlY3RvcnMiLCJlYWNoIiwiaW5kZXgiLCJwaWVjZSIsImtpbmdWZWN0b3JzIiwidmVjdG9ycyIsInRha2VuU3F1YXJlcyIsImhhc0NsYXNzIiwiJHBpZWNlIiwib3V0T2ZCb3VuZHMiLCJkYXJrVmVjdG9ycyIsIiRsZWdhbFNxdWFyZXMiLCJidWlsZE1vdmVzIiwiY29uY2F0IiwibmV3Q29vcmRzIiwidmVjdG9yIiwibmV3U3F1YXJlSW5kZXgiLCJqdW1wc09ubHkiLCIkY3VycmVudFNxdWFyZSIsImVxIiwianVtcFNxdWFyZUluZGV4IiwiJG5ld1NxdWFyZSIsIiRqdW1wZWRQaWVjZXMiLCJqdW1wQ29vcmRzIiwiaXMiLCJzZXRVcFBpZWNlcyIsImFkZCIsImRhdGEiLCJhZGRDbGFzcyIsIm1vdmVQaWVjZVRvIiwibmV3VG9wIiwibmV3TGVmdCIsIiRlYWNoU3F1YXJlIiwib2RkWSIsImNzcyIsInRvZ2dsZVNlbGVjdCIsImluY3JlbWVudG1vdmVDb3VudGVyIiwiaHRtbCIsInBhcnNlSW50IiwicmVzZXQiLCJsb2NhdGlvbiIsInJlbG9hZCIsInNxdWFyZUNvdW50IiwiJGJvYXJkIiwiJHBpZWNlcyIsImkiLCJhcHBlbmQiLCJsaWdodE9yRGFyayIsIk1hdGgiLCJmbG9vciIsInRoaXMiLCJwaXhlbFBvc2l0aW9uIiwiJHJlc2V0QnV0dG9uIiwib24iLCIkdGhpc1BpZWNlIiwiZ2V0TW92YWJsZVNxdWFyZXMiLCIkcGllY2VUb01vdmUiLCJlIiwicGl4ZWxzIiwiJHNlbGVjdGVkUGllY2UiLCJwcmV2QWxsIiwibGVuZ3Ro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RDhDLElBaENMdUIsRUFBQWxFLFlBQUEsWUF3Q0FWLEVBQUEsY0FBQVUsWUFBQSxXQUNGSCIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2xvYWRpbmcgSlNcbiQoKCk9PntcblxuICAvL0dMT0JBTCBWQVJJQUJMRVNcbiAgY29uc3Qgd2lkdGggPSA0NjtcbiAgY29uc3QgYm9yZGVyID0gMjtcbiAgY29uc3QgJGJvYXJkID0gJCgnZGl2I2JvYXJkJyk7XG4gIGNvbnN0ICRwaWVjZXMgPSAkKCdkaXYjcGllY2VzJyk7XG4gIGNvbnN0ICRyZXNldEJ1dHRvbiA9ICQoJyNyZXNldC1idXR0b24nKTtcbiAgbGV0IGNvb3JkcyA9IG51bGw7Ly9zZXR0aW5nIGNvb3JkcyBnbG9iYWxseSBzbyBjb25zdGFudGx5IHVwZGF0aW5nXG5cblxuXG4gIC8vQ3JlYXRpbmcgdGhlIDY0IHNxdWFyZXMgYW5kIGFkZGluZyB0aGVtIHRvIHRoZSBET01cbiAgY29uc3Qgc3F1YXJlQ291bnQgPSA4Kjg7IC8vOCByb3dzIGJ5IDggY29sdW1uczsgemVybyBiYXNlZCBpbmRleFxuICBmb3IgKGxldCBpID0gMDtpPHNxdWFyZUNvdW50O2krKykge1xuXG4gIC8vdGhpcyBsaW5lIGNyZWF0ZXMgYSBuZXcgZGl2IHdpdGggdGhlIGNsYXNzICdzcXVhcmUnXG4gIC8vYW5kIGFwcGVuZHMgaXQgdG8gdGhlIGRpdiB3aXRoIGlkICdib2FyZCdcbiAgICAkYm9hcmQuYXBwZW5kKCQoJzxkaXYvPicpLmFkZENsYXNzKCdzcXVhcmUnKSk7XG4gIH1cblxuXG4gIC8vc2V0IHVwIHRoZSBib2FyZCB3aXRoIHRoZSBjb3JyZWN0IGNsYXNzZXMgZm9yIHRoZSBsaWdodCBhbmQgZGFyayBzcXVhcmVzXG4gIHNldFVwQm9hcmQoKTtcblxuXG4gICAgICAvL2NyZWF0aW5nIHRoZSAyNCBwaWVjZXMgYW5kIGFkZGluZyB0aGVtIHRvIHRoZSBET01cbiAgY29uc3QgcGllY2VDb3VudCA9IDI0O1xuICBmb3IgKGxldCBpPTA7aTxwaWVjZUNvdW50O2krKykge1xuXG4gICAgLy90aGlzIGxpbmUgYXBwZW5kcyBhbiBlbXB0eSBkaXYgd2l0aCB0aGUgY2xhc3MgJ3BpZWNlJyB0byB0aGUgZGl2IHdpdGggaWQgJ3BpZWNlcydcbiAgICAkcGllY2VzLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygncGllY2UnKSk7XG5cbiAgfVxuXG5cbiAgLy9zZXRzIHVwIHRoZSBjbGFzc2VzIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzIG9mIHBpZWNlXG4gIHNldFVwUGllY2VzKCk7XG5cbiAgLy90aGlzIGxvb3AgbW92ZXMgYWxsIHRoZSBsaWdodCBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgJCgnZGl2LnBpZWNlLmxpZ2h0JykuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuXG4gICAgLy90dXJuaW5nIHRoZSBpbmRleCAoZnJvbSAwIC0gMTEpXG4gICAgLy9pbnRvIGEgeCx5IHNxdWFyZSBjb29yZGluYXRlIHVzaW5nIG1hdGhcbiAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDQpO1xuICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHklMik7XG5cbiAgICAvL3R1cm5pbmcgdGhlIHgseSBjb29yZGluZ2F0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgLy9hY3R1YWxseSBtb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgbW92ZVBpZWNlVG8oJChwaWVjZSkscGl4ZWxQb3NpdGlvbi50b3AscGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgfSk7XG5cbiAgICAvL3RoaXMgbG9vcCBtb3ZlcyBhbGwgdGhlIGRhcmsgcGllY2VzIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zXG4gICQoJ2Rpdi5waWVjZS5kYXJrJykuZWFjaChmdW5jdGlvbihpbmRleCxwaWVjZSkge1xuICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgIC8vaW50byBhIHgseSBzcXVhcmUgY29vcmRpbmF0ZSB1c2luZyBtYXRoXG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXgvNCkgKyA1O1xuICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMS15JTIpO1xuXG4gICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmF0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgLy9tb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgbW92ZVBpZWNlVG8oJChwaWVjZSkscGl4ZWxQb3NpdGlvbi50b3AscGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgfSk7XG5cbiAgICAvL3NldCB1cCBpbml0aWFsIHNxdWFyZXMgdGhlIGNsYXNzICdtb3ZhYmxlJyByZXByZXNlbnRzIGEgc3F1YXJlXG4gICAgLy90aGF0IGlzIHVub2NjdXBpZWQgYW5kIHRoaXMgYWxsb3dzIGFsbCBzcXVhcmVzIGRhcmsgc3F1YXJlcyB0byBiZSBtb3ZhYmxlXG4gIC8vIGdldE1vdmFibGVTcXVhcmVzKCkuYWRkQ2xhc3MoJ21vdmFibGUnKTtcblxuICAgICAgLy9FVkVOVFNcblxuICAgIC8vcmVzZXR0aW5nIHRoZSBnYW1lLlxuICAkcmVzZXRCdXR0b24ub24oJ2NsaWNrJywgKCk9PntcbiAgICByZXNldCgpO1xuICB9KTtcblxuICAkKCdkaXYucGllY2UnKS5vbignY2xpY2snLChldmVudCk9PntcbiAgICAvL3R1cm4gYHRoaXNgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgY29uc3QgJHRoaXNQaWVjZSA9ICQoZXZlbnQudGFyZ2V0KTtcblxuXG5cbiAgICAvL3RvZ2dsaW5nIHRoZSAnc2VsZWN0ZWQnIGNsYXNzIG9mIHRoaXMgcGllY2VcbiAgICAvL2FuZCBwb3NzaWJsZSBkZXNlbGVjdGluZyBvdGhlciBwaWVjZXNcbiAgICB0b2dnbGVTZWxlY3QoJHRoaXNQaWVjZSk7XG4gICAgcmVzZXRNb3ZhYmxlcygpO1xuICAgIC8vZ2V0IHRoZSBsZWdhbCBtb3ZlcyBmb3IgdGhpc1xuICAgIGlmICgkdGhpc1BpZWNlLmhhc0NsYXNzKCdzZWxlY3RlZCcpKSB7XG4gICAgICBnZXRNb3ZhYmxlU3F1YXJlcygkdGhpc1BpZWNlKS5hZGRDbGFzcygnbW92YWJsZScpO1xuICAgIH1cblxuICB9KTsvL2VuZCBvZiBwaWVjZSBjbGljayBldmVudFxuXG4gIC8vY2hlY2tzIHRoZSBjdXJyZW50UG9zaXRpb24gb2YgdGhlIGNsaWNrZWQgb3Igc2VsZWN0ZWQgZGl2IGFuZCByZXR1cm5zIHRoZSBjb29yZHMuXG4gIGZ1bmN0aW9uIGN1cnJlbnRQb3NpdGlvbigpe1xuICAgIGNvbnN0IHBvc2l0aW9uID0gJChldmVudC50YXJnZXQpLnBvc2l0aW9uKCk7XG4gICAgY29vcmRzID0gZ2V0Q29vcmRzKHBvc2l0aW9uLnRvcCxwb3NpdGlvbi5sZWZ0KTtcbiAgICAvLyBjb25zb2xlLmxvZyhjb29yZHMpOy8vZ2V0dGluZyB0aGUgbG9jYXRpb24gb2YgdGhlIHBpZWNlXG4gICAgcmV0dXJuIGNvb3JkcztcblxuICB9XG5cbiAgJCgnZGl2LnNxdWFyZScpLm9uKCdjbGljaycsIChlKT0+e1xuICAgIGN1cnJlbnRQb3NpdGlvbigpOy8vdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgc3F1YXJlOyBjb29yZHNcbiAgICAvLyBjb25zb2xlLmxvZygnY29vcmRzJywgY29vcmRzKTtcbiAgICAvL3R1cm4gYGUgb3IgZXZlbnRgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgY29uc3QgJHBpZWNlVG9Nb3ZlID0gJChlLnRhcmdldCk7XG5cblxuICAgIC8vaWYgJHRoaXMgaXMgYSBsZWdhbCBzcXVhcmUgdG8gbW92ZSB0by4uLlxuICAgIGlmICgkcGllY2VUb01vdmUuaGFzQ2xhc3MoJ21vdmFibGUnKSkge1xuXG4gICAgICAgICAgLy9nZXQgdGhlIHBpZWNlIHdpdGggdGhlIGNsYXNzICdzZWxlY3RlZCdcbiAgICAgIGNvbnN0ICRzZWxlY3RlZFBpZWNlID0gJCgnZGl2LnBpZWNlLnNlbGVjdGVkJyk7XG5cbiAgICAgICAgICAvL29ubHkgbW92ZSBpZiB0aGVyZSBpcyBleGFjdGx5IG9uZSBzZWxlY3RlZCBwaWVjZVxuICAgICAgaWYgKCRzZWxlY3RlZFBpZWNlLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgLy9nZXQgdGhlIGluZGV4IG9mIHRoZSBzcXVhcmVcbiAgICAgICAgICAgIC8vYW5kIHRyYW5zbGF0ZSBpdCB0byBwaXhlbCBwb3NpdGlvblxuICAgICAgICBjb25zdCBpbmRleCA9ICRwaWVjZVRvTW92ZS5wcmV2QWxsKCkubGVuZ3RoO1xuICAgICAgICBjb25zdCB4ID0gaW5kZXggJSA4O1xuICAgICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgICBjb25zdCBwaXhlbHMgPSBnZXRQaXhlbHMoeCx5KTtcbiAgICAgICAgICAgIC8vYWN0dWFsbHkgZG8gdGhlIG1vdmluZ1xuICAgICAgICBtb3ZlUGllY2VUbygkc2VsZWN0ZWRQaWVjZSxwaXhlbHMudG9wLHBpeGVscy5sZWZ0KTtcbiAgICAgICAgICAgIC8vaW5jcmVtZW50IHRoZSBtb3ZlIGNvdW50ZXJcbiAgICAgICAgaW5jcmVtZW50bW92ZUNvdW50ZXIoKTtcbiAgICAgICAgICAgIC8vdW4tc2VsZWN0IHRoZSBwaWVjZVxuICAgICAgICAkc2VsZWN0ZWRQaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblxuICAgICAgICAgICAgLy9zZXQgdGhlIG5ldyBsZWdhbCBtb3Zlc1xuICAgICAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcbiAgICAgICAgcmVzZXRNb3ZhYmxlcygpO1xuICAgICAgICAvLyBnZXRNb3ZhYmxlU3F1YXJlcygpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgfSk7XG5cblxuICAvLyBNT1JFIEZVTkNUSU9OU1xuICAvL3RoaXMgZnVuY3Rpb24gc2hvdWxkIGRvIHR3byB0aGluZ3Ncbi8vIDEuIHJlbW92ZSB0aGUgZGF0YSBpdGVtIHdpdGgga2V5ICdqdW1wZWRQaWVjZXMnIGZyb20gZXZlcnkgZGl2LnNxdWFyZVxuLy8gMi4gcmVtb3ZlIHRoZSBjbGFzcyAnbW92YWJsZScgZnJvbSBldmVyeSBzcXVhcmVcbiAgZnVuY3Rpb24gcmVzZXRNb3ZhYmxlcygpIHtcbiAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlRGF0YSgnanVtcGVkUGllY2VzJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHRyYW5zbGF0aW5nIGFuIHgseSBjb29yZGluYXRlcyB0byBhIHBpeGVsIHBvc2l0aW9uXG4gIC8vdGhlIGNvbnZlbnRpb24gaXMgdGhhdCB0aGUgc3F1YXJlIGluIHRoZSB1cHBlciBsZWZ0IGNvcm5lciBpcyBhdCBwb3NpdGlvbiAwLDBcbiAgLy90aGUgc3F1YXJlIGluIHRoZSB1cHBlciByaWdodCwgYXQgNywwIGFuZCB0aGUgbG93ZXJcbiAgLy9yaWdodCBhdCA3LDdcbiAgZnVuY3Rpb24gZ2V0UGl4ZWxzKHgseSkge1xuICAgICAgLy90YWtlcyBhbiB4LHkgcG9zaXRpb24sIHJldHVybnNcbiAgICAgIC8vcGl4ZWxzIGZyb20gdGhlIGxlZnQsIHJpZ2h0XG4gICAgcmV0dXJuIHtcbiAgICAgICd0b3AnOiAoeSAqICh3aWR0aCtib3JkZXIpKSsncHgnLFxuICAgICAgJ2xlZnQnOiAoeCAqICh3aWR0aCtib3JkZXIpKSsncHgnXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHR1cm5pbmcgYSBwaXhlbCBwb3NpdGlvblxuICAvL2ludG8gdGhlIHgseSBjb29yZGluYXRlIG9mIGEgc3F1YXJlIG9uIHRoZSBib2FyZFxuICAvL2l0IGZvbGxvd3MgdGhlIHNhbWUgY29vcmRpbmF0ZSBjb252ZW50aW9uIGFzIGdldFBpeGVsc1xuICBmdW5jdGlvbiBnZXRDb29yZHModG9wLGxlZnQpIHtcbiAgICAgIC8vcmV0dXJucyBhbiB4IGFuZCBhIHlcbiAgICAgIC8vZ2l2ZW4gYSB0b3AgYW5kIGxlZnQgcGl4ZWxzXG4gICAgcmV0dXJuIHtcbiAgICAgICd4JzogbGVmdCAvICh3aWR0aCArIGJvcmRlciksXG4gICAgICAneSc6IHRvcCAvICh3aWR0aCArIGJvcmRlcilcbiAgICB9O1xuICB9XG5cblxuXG4gIC8vZnVuY3Rpb24gZm9yIHJldHVybmluZ1xuLy90aGUgc2V0IG9mIGxlZ2FsIG1vdmVzIGdpdmVuIGEgcGllY2Vcbi8vIHRoaXMgYWxzbyBzdG9yZXMganVtcGVkIHBpZWNlcyBpbiBhIGRhdGEgZWxlbWVudCBvZiBlYWNoIHNxdWFyZSB0aGF0IGNhbiBiZSBtb3ZlZCB0b1xuICBmdW5jdGlvbiBnZXRNb3ZhYmxlU3F1YXJlcygkcGllY2UpIHtcblxuICAgIC8vc2VsZWN0IGFsbCBvZiB0aGUgc3F1YXJlc1xuICAgIGNvbnN0ICRzcXVhcmVzID0gJCgnZGl2LnNxdWFyZScpO1xuXG4gICAgLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgICAvL21hcCBjcmVhdGVzIGEgbmV3IG9iamVjdCBmcm9tIGFuIGV4aXN0aW5nIG9uZVxuICAgIC8vdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAgIHZhciB0YWtlblNxdWFyZXMgPSB7fTtcbiAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG5cbiAgICAgICAgICAgIC8vdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGEgcGllY2VcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gJChwaWVjZSkucG9zaXRpb24oKTtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AscG9zaXRpb24ubGVmdCk7XG4gICAgICBjb25zdCBzcXVhcmVJbmRleCA9IGNvb3Jkcy55ICogOCArIGNvb3Jkcy54O1xuICAgICAgdGFrZW5TcXVhcmVzW3NxdWFyZUluZGV4XSA9ICQocGllY2UpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKCRwaWVjZS5wb3NpdGlvbigpLnRvcCwkcGllY2UucG9zaXRpb24oKS5sZWZ0KTtcblxuICAgIC8vbGlnaHRzIG1vdmUgZG93blxuICAgIGNvbnN0IGxpZ2h0VmVjdG9ycyA9IFtcbiAgICAgICAge3g6IDEseTogMX0sXG4gICAgICAgIHt4OiAtMSx5OiAxfVxuICAgIF07XG4gICAgLy9kYXJrcyBtb3ZlIHVwXG4gICAgY29uc3QgZGFya1ZlY3RvcnMgPSBbXG4gICAgICAgIHt4OiAxLHk6IC0xfSxcbiAgICAgICAge3g6IC0xLHk6IC0xfVxuICAgIF07XG4gICAgLy9raW5ncyBtb3ZlIGFueSB3aGljaCB3YXlcbiAgICBjb25zdCBraW5nVmVjdG9ycyA9IGxpZ2h0VmVjdG9ycy5jb25jYXQoZGFya1ZlY3RvcnMpO1xuXG5cbiAgICBsZXQgdmVjdG9ycztcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdraW5nJykpIHtcbiAgICAgIHZlY3RvcnMgPSBraW5nVmVjdG9ycztcbiAgICB9IGVsc2UgaWYgKCRwaWVjZS5oYXNDbGFzcygnbGlnaHQnKSkge1xuICAgICAgdmVjdG9ycyA9IGxpZ2h0VmVjdG9ycztcbiAgICB9IGVsc2Uge1xuICAgICAgdmVjdG9ycyA9IGRhcmtWZWN0b3JzO1xuICAgIH1cblxuICAgIGNvbnN0IG91dE9mQm91bmRzID0gZnVuY3Rpb24oY29vcmRzKSB7XG4gICAgICByZXR1cm4gIShjb29yZHMueCA+PSAwICYmIGNvb3Jkcy54IDwgOCAmJiBjb29yZHMueSA+PSAwICYmIGNvb3Jkcy55IDwgOCk7XG4gICAgfTtcblxuICAgIGxldCAkbGVnYWxTcXVhcmVzID0gJCgpO1xuICAgIGNvbnN0IGJ1aWxkTW92ZXMgPSBmdW5jdGlvbihjb29yZHMsdmVjdG9ycyxqdW1wc09ubHkpIHtcblxuXG4gICAgICBpZiAob3V0T2ZCb3VuZHMoY29vcmRzKSkgcmV0dXJuO1xuXG4gICAgICAgIC8vb3VyIGN1cnJlbnQgc3F1YXJlIGlzIGF0IGNvb3Jkc1xuICAgICAgY29uc3QgJGN1cnJlbnRTcXVhcmUgPSAkc3F1YXJlcy5lcShjb29yZHMueSo4ICsgY29vcmRzLngpO1xuXG4gICAgICAkLmVhY2godmVjdG9ycyxmdW5jdGlvbihpbmRleCx2ZWN0b3IpIHtcblxuXG4gICAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IHtcbiAgICAgICAgICB4OiB2ZWN0b3IueCArIGNvb3Jkcy54LFxuICAgICAgICAgIHk6IHZlY3Rvci55ICsgY29vcmRzLnlcbiAgICAgICAgfTtcblxuXG4gICAgICAgIGlmIChvdXRPZkJvdW5kcyhuZXdDb29yZHMpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG5ld1NxdWFyZUluZGV4ID0gOCpuZXdDb29yZHMueSArIG5ld0Nvb3Jkcy54O1xuICAgICAgICAgICAgLy9pZiB0aGUgc3F1YXJlIGlzIHRha2VuLFxuICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XSkge1xuICAgICAgICAgICAgICAgIC8vaXQgZ2V0cyBpbnRlcmVzdGluZ1xuICAgICAgICAgICAgICAgIC8vb2sgLSBzbyB3ZSBjYW4gb25seSBqdW1wIGlmIHRoZWlyXG4gICAgICAgICAgICAgICAgLy9waWVjZSBpcyBkaWZmZXJlbnQgZnJvbSBvdXJzXG4gICAgICAgICAgaWYgKCRwaWVjZS5oYXNDbGFzcygnZGFyaycpKSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnZGFyaycpKSByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdLmhhc0NsYXNzKCdsaWdodCcpKSByZXR1cm47XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgICBjb25zdCBqdW1wQ29vcmRzID0ge1xuICAgICAgICAgICAgeDogdmVjdG9yLngqMiArIGNvb3Jkcy54LFxuICAgICAgICAgICAgeTogdmVjdG9yLnkqMiArIGNvb3Jkcy55XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAob3V0T2ZCb3VuZHMoanVtcENvb3JkcykpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGp1bXBTcXVhcmVJbmRleCA9IGp1bXBDb29yZHMueSo4ICsganVtcENvb3Jkcy54O1xuICAgICAgICAgICAgICAgIC8vaWYgdGhlIGp1bXAgc3F1YXJlIGlzIGZyZWUuLi5cbiAgICAgICAgICAgICAgICAvL2FkZCBpdCBhbmQgdGhlIGRhdGEtanVtcGVkLXBpZWNlc1xuICAgICAgICAgIGlmICghdGFrZW5TcXVhcmVzW2p1bXBTcXVhcmVJbmRleF0pIHtcbiAgICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShqdW1wU3F1YXJlSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAvL2lmIHdlIGhhdmVuJ3QgYWxyZWFkeSBzZWVuIGl0XG4gICAgICAgICAgICBpZiAoISRuZXdTcXVhcmUuaXMoJGxlZ2FsU3F1YXJlcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hZGQgdGhlIHBhc3NlZCBvdmVyIHNxdWFyZSB0byBpdFxuICAgICAgICAgICAgICAkbGVnYWxTcXVhcmVzID0gJGxlZ2FsU3F1YXJlcy5hZGQoJG5ld1NxdWFyZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYW5kIHRoZSBqdW1wZWQgc3F1YXJlcyBmcm9tIGhvdyB3ZSBnb3QgaGVyZVxuICAgICAgICAgICAgICBsZXQgJGp1bXBlZFBpZWNlcyA9IHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF07XG4gICAgICAgICAgICAgIGlmICgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSkge1xuICAgICAgICAgICAgICAgICRqdW1wZWRQaWVjZXMgPSAkanVtcGVkUGllY2VzLmFkZCgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCRqdW1wZWRQaWVjZXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FuZCByZWN1cnNlLCB3aXRoIGp1bXBzT25seSBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgICBidWlsZE1vdmVzKGp1bXBDb29yZHMsdmVjdG9ycyx0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWp1bXBzT25seSkge1xuICAgICAgICAgIGNvbnN0ICRuZXdTcXVhcmUgPSAkc3F1YXJlcy5lcShuZXdTcXVhcmVJbmRleCk7XG4gICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCQoKSk7XG4gICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuICAgICAgICB9XG5cbiAgICAgIH0pO1xuICAgIH07XG4gICAgYnVpbGRNb3Zlcyhjb29yZHMsdmVjdG9ycyxmYWxzZSk7XG4gICAgcmV0dXJuICRsZWdhbFNxdWFyZXM7XG5cbiAgfS8vZW5kIG9mIG5ldyBnZXRNb3ZhYmxlU3F1YXJlc1xuXG4gIGZ1bmN0aW9uIHNldFVwUGllY2VzKCkge1xuICAgICAgLy9zZWxlY3QgYWxsIHRoZSBkaXZzIHdpdGggY2xhc3MgJ3BpZWNlJ1xuICAgICQoJ3BpZWNlJyk7XG4vL2FkZCB0aGUgJ2xpZ2h0JyBjbGFzcyB0byBoYWxmIG9mIHRoZW1cbiAgICAkKCdkaXYucGllY2U6ZXZlbicpLmFkZENsYXNzKCdsaWdodCcpO1xuLy9qUXVlcnkncyBldmVuIGFuZCBvZGQgc2VsZWN0b3IgbWV0aG9kcyB0byBhc3NpZ24gdGhlIGNsYXNzZXMgLmxpZ2h0IGFuZCAuZGFyay5cbi8vYWRkIHRoZSAnZGFyaycgdG8gdGhlIG90aGVyIGhhbGZcbiAgICAkKCdkaXYucGllY2U6b2RkJykuYWRkQ2xhc3MoJ2RhcmsnKTtcblxuICB9XG5cbiAgZnVuY3Rpb24gbW92ZVBpZWNlVG8oJHBpZWNlLG5ld1RvcCxuZXdMZWZ0KSB7XG4gICAgICAvL3NldCB0aGUgY3NzICd0b3AnIGFuZCAnbGVmdCdcbiAgICAgIC8vYXR0cmlidXRlcyBvZiB0aGUgcGFzc2VkIHBpZWNlXG4gICAgICAvL3RvIHRoZSBhcmd1bWVudHMgbmV3VG9wIGFuZCBuZXdMZWZ0XG4gICAgJHBpZWNlLmNzcygndG9wJywgbmV3VG9wKTtcbiAgICAkcGllY2UuY3NzKCdsZWZ0JywgbmV3TGVmdCk7XG5cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFVwQm9hcmQoKSB7XG4gICAgICAvL2l0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGRpdnMgd2l0aCBjbGFzcyBgc3F1YXJlYFxuICAgICAgLy9maWd1cmUgb3V0IHdoZXRoZXIgZWFjaCBvbmUgc2hvdWxkIGJlXG4gICAgICAvL2xpZ2h0IG9yIGRhcmssIGFuZCBhc3NpZ24gdGhlIHByb3BlciBjbGFzc1xuICAgIGNvbnN0ICRlYWNoU3F1YXJlID0gJCgnZGl2LnNxdWFyZScpO1xuICAgICRlYWNoU3F1YXJlLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xuICAgICAgaWYobGlnaHRPckRhcmsoaW5kZXgpPT09IDApe1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdsaWdodCcpO1xuICAgICAgfWVsc2V7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2RhcmsnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAgIC8vaW5uZXIgaGVscGVyIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBudW1iZXIgYmV0d2VlblxuICAgICAgLy8wIGFuZCA2MyAoaW5jbHVzaXZlKSBhbmQgcmV0dXJucyAxIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlXG4gICAgICAvL2RhcmssIGFuZCAwIGlmIHRoZSBzcXVhcmUgc2hvdWxkIGJlIGxpZ2h0XG4gICAgZnVuY3Rpb24gbGlnaHRPckRhcmsoaW5kZXgpIHtcbiAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDgpO1xuICAgICAgY29uc3Qgb2RkWCA9IHggJSAyO1xuICAgICAgY29uc3Qgb2RkWSA9IHkgJSAyO1xuICAgICAgcmV0dXJuIChvZGRYIF4gb2RkWSk7XG4gICAgfVxuXG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVTZWxlY3QoJHBpZWNlKSB7XG4gICAgICAvL2lmICRwaWVjZSBoYXMgdGhlIGNsYXNzICdzZWxlY3RlZCcscmVtb3ZlIGl0XG4gICAgICAvL2lmICRwaWVjZSBkb2VzIG5vdCBoYXZlIHRoZSBjbGFzcyAnc2VsZWN0ZWQnXG4gICAgICAvL21ha2Ugc3VyZSBubyBvdGhlciBkaXZzIHdpdGggdGhlIGNsYXNzICdwaWVjZSdcbiAgICAgIC8vaGF2ZSB0aGF0IGNsYXNzLCB0aGVuIHNldCAkcGllY2UgdG8gaGF2ZSB0aGUgY2xhc3NcbiAgICBpZigkcGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAkcGllY2UucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgZWxzZSB7XG4gICAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAgIGlmKCQocGllY2UpLmhhc0NsYXNzKCdzZWxlY3RlZCcpKVxuICAgICAgICAgICQocGllY2UpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgfSk7XG4gICAgICAkcGllY2UuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgfVxuXG4gIH0vL2VuZCBvZiB0b2dnbGVTZWxlY3QgZnVuY3Rpb25cblxuICBmdW5jdGlvbiBpbmNyZW1lbnRtb3ZlQ291bnRlcigpIHtcbiAgICAgIC8vZ2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIG1vdmVDb3VudGVyXG4gICAgICAvL3R1cm5zIGl0IGludG8gYSBudW1iZXJcbiAgICAgIC8vaW5jcmVtZW50cyBpdCBieSBvbmVcbiAgICAgIC8vc2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIG1vdmVDb3VudGVyXG4gICAgICAvL3RvIHRoZSBuZXcgbW92ZSBjb3VudFxuICAgICQoJyNtb3ZlQ291bnRlcicpLmh0bWwocGFyc2VJbnQoJCgnI21vdmVDb3VudGVyJykuaHRtbCgpLDEwKSsxKTtcbiAgfVxuXG4gIC8vdGhpcyByZXNldHMgdGhlIGdhbWUgYnkgZWZmZWN0aXZlbHkgcmVsb2FkaW5nIHRoZSBwYWdlIGZyb20gY2FjaGVcbiAgZnVuY3Rpb24gcmVzZXQoKXtcbiAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgfVxuXG5cblxuXG59KTsvL2VuZCBvZiBKUyBsb2FkXG5cblxuLypcblRPRE86XG4xLiBQbGF5ZXIgY2hhbmdlIGZyb20gcGxheWVyIDEgdG8gcGxheWVyIDJcbjIuIEZpZ3VyZSBvdXQgaG93IHRvIHN0b3AgaWxsZWdhbCBtb3Zlcy5cbiAgLW9ubHkgbWFrZSB0d28gcG9zdGl0aW9ucyBhdmFpbGFibGUgYXQgYW55IGdpdmVuIHRpbWVcbiAgLW9uY2UgdGhlIHBpZWNlIGhhcyBtb3ZlZCBpbnRvIGEgcG9zaXRpb24gbWFrZVxuXG4gIC1PbiBjbGljayBvZiBzcWF1cmVcbiAgLWdldCBwaWVjZSBvbiBzcWF1cmUgKGUudGFyZ2V0KVxuICAtY2hlY2sgaWYgcGllY2UgYmVsb25ncyB0byBwMSBvciBwMlxuICAtY2hlY2sgcmVsZXZhbnQgc3F1YXJlc1xuICAgIC5pZiBpbmRleCBvZiBjdXJyZW50U3F1YXJlXG4gICAgLmlmIHNxdWFyZSBpcyBub3QgaW4gdGhlIGZpcnN0IGNvbHVtblxuICAgIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IGxlZnQgYW5kIG1vdmFibGUgY2xhc3MgaWYgZW1wdHlcbiAgICAuaWYgc3F1YXJlIGlzIG5vdCBpbiB0aGUgbGFzdCBjb2x1bW5cbiAgICBjaGVjayBzcXVhcmUgZGlhZ29uYWxseSByaWdodCBhbmQgbW92YWJsZSBjbGFzcyBpZiBlbXB0eVxuICAtb25jZSBwaWVjZSBpcyBtb3ZlZCBvciBpZiB1bi1zZWxlY3RlZCByZW1vdmUgbW92YWJsZSBjbGFzcyBmcm9tIGFsbCBzcXVhcmVzLlxuXG5pbmRleCAocG9zaXRpb24pJSB3aWR0aCA9PT0gMCAuLi5yZXByZXNlbnRzIHRoZSBmaXJzdCBjb2x1bW5cbmluZGV4ICUgd2lkdGggPT09IHdpZHRoLTEgLi4ucmVwcmVzZW50cyB0aGUgbGFzdCBjb2x1bW5cblxuaW5kZXggKyB3aWR0aC0xIGZvciBwbGF5ZXIxIGlzIGdvaW5nIGxlZnQgZGlhZ29uYWxseVxuaW5kZXggKyB3aWR0aC0xIGZvciBwbGF5ZXIxIGlzIGdvaW5nIHJpZ2h0IGRpYWdvbmFsbHlcblxuaW5kZXggLSB3aWR0aCsxIGZvciBwbGF5ZXIyIGlzIGdvaW5nIGxlZnQgZGlhZ29uYWxseVxuaW5kZXggLSB3aWR0aC0xIGZvciBwbGF5ZXIyIGlzIGdvaW5nIHJpZ2h0IGRpYWdvbmFsbHlcblxuXG4zLiBKdW1wIG1vdmVzIHRvIG1ha2UgdGhlIG9wcG9uZW50cyBwaWVjZSBkaXNhcHBlYXIgZnJvbSB0aGUgYm9hcmQgYW5kIHJlc2V0XG4gIHRoZSBwb3NpdG9uXG40LiBLaW5nIG1ha2VyIGZ1bmN0aW9uXG41LiBIb3cgdG8gdGFrZSBpbiB0aGUgdG9wIHJpZ2h0IHBvc2l0aW9uXG42LlJlc2V0IHRoZSBnYW1lIGJldHRlclxuLy9cbi8vdXNpbmcgeCBhbmQgeSB2YWx1ZXMuXG4vL3ggdmFsdWUgb24gdGhlIGZpcnN0Q29sdW1uIHdpbGwgYWx3YXlzIGJlIHplcm8gc2luY2UgdGhlIHN0YXJ0aW5nIGlzIGEgemVybyBiYXNlZCBpbmRleFxuLy95IHZhbHVlIG9uIHRoZSBsYXN0Q29sdW1uIHdpbGwgYWx3YXlzIGJlIHNldmVuIHNpbmNlIHRoZSBsYXN0IGluZGV4IG9uIGEgOCo4IGlzIDdcbi8vZGFya1BpZWNlIG1vdmluZyByaWdodCBpcyB4ICsgMSBhbmQgeSAtIDFcbi8vZGFya1BpZWNlIG1vdmluZyBsZWZ0IGlzIHggLSAxIGFuZCB5IC0gMVxuLy9saWdodFBpZWNlIG1vdmluZyByaWdodCBpcyB4IC0gMSBhbmQgeSArIDFcbi8vbGlnaHRQaWVjZSBtb3ZpbmcgbGVmdCBpcyB4ICsgMSBhbmQgeSArIDFcbi8vQW5kIHRvIGp1bXAgd2lsbCBiZSArMiBzaW5nbGUgbW92ZW1lbnRzLlxuLy9jaGVjayBpZiBlbXB0eS4uLmJ5IGNoZWNraW5nIGlmIGEgc3F1YXJlIGlzIG1vdmFibGUgaS5lLiBnZXRNb3ZhYmxlU3F1YXJlcygpLmFkZENsYXNzKCdtb3ZhYmxlJyk7XG4vL2lmIGVtcHR5XG4vLyBjb25zdCBkYXJrUGllY2VNb3ZlUmlnaHQgPShpbmRleC54ICsgKGluZGV4LnggKyAxKSksIChpbmRleC55ICsgKGluZGV4LnkgLSAxKSk7IC8vSSBuZWVkIHRvIGdldCBhIHNldCBvZiBjb29yZHMgYmFjayBhbmQgbWFrZSB0aGF0IGEgbGVnYWxNb3Zlc1xuXG5cblxuXG4vLyBpZiAoaW5kZXggJSB3aWR0aCA9PT0gMCAmJiAkZGFya1BpZWNlKXtcbi8vICAgaW5kZXggKyB3aWR0aCArIDFcbi8vIH1cbi8vIHRha2UgdGhlIGluZGV4IHggYW5kIHkgdmFsdWUgYXMgaW5kZXggYW5kIGNoZWNrXG4vL2lmIGluZGV4ICUgd2lkdGggPT09IDAgdGhlIGZpcnN0IGNvbHVtbiBvclxuLy9pZiBpbmRleCAlIHdpZHRoID09PSB3aWR0aC0xIHRoZSBsYXN0IGNvbHVtblxuLy9pZiBmaXJzdCBjb2x1bW4gaXMgdHJ1ZSB0aGVuIGNoZWNrIGNvbG9yL3AxIG9yIHAyXG4vL3AxXG4vL2lmIHAxIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IGxlZnQgaWYgZW1wdHkgdXNpbmdcbi8vaW5kZXggKyB3aWR0aCArIDEgYWRkIHRoZSBjbGFzcyAnbW92YWJsZSdcbi8vaWYgbGFzdCBjb2x1bW4gaXMgdHJ1ZSB0aGVuIGNoZWNrIGNvbG9yL3AxIG9yIHAyXG4vL2lmIHAxIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IHJpZ2h0IGlmIGVtcHR5IHVzaW5nXG4vL2luZGV4ICsgd2lkdGgtMSBhZGQgdGhlIGNsYXNzICdtb3ZhYmxlJ1xuLy91c2UgQ1NTIHRvIGhpZ2hsaWdodCB0aGUgbW92YWJsZSBzcXVhdXJlcyAobGVnYWwgbW92ZXMpXG4vL3AyXG4vL2Vsc2UgaXQncyBwMlxuXG4qL1xuIl19
