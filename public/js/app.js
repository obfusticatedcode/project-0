"use strict";$(function(){function e(){var e=$(event.target).position();return k=n(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(f+h)+"px",left:e*(f+h)+"px"}}function n(e,a){return{x:a/(f+h),y:e/(f+h)}}function i(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var i=$(a).position(),o=n(i.top,i.left),s=8*o.y+o.x;t[s]=$(a)});var i,o=n(e.position().top,e.position().left),s=[{x:1,y:1},{x:-1,y:1}],l=[{x:1,y:-1},{x:-1,y:-1}],r=s.concat(l);i=e.hasClass("king")?r:e.hasClass("light")?s:l;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},d=$();return function n(i,o,s){if(!c(i)){var l=a.eq(8*i.y+i.x);$.each(o,function(o,r){var v={x:r.x+i.x,y:r.y+i.y};if(!c(v)){var u=8*v.y+v.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var f={x:2*r.x+i.x,y:2*r.y+i.y};if(c(f))return;var h=8*f.y+f.x;if(!t[h]){var p=a.eq(h);if(!p.is(d)){d=d.add(p);var g=t[u];l.data("jumpedPieces")&&(g=g.add(l.data("jumpedPieces"))),p.data("jumpedPieces",g),n(f,r,!0)}}}else if(!s){var C=a.eq(u);C.data("jumpedPieces",$()),d=d.add(C)}}})}}(o,i,!1),d}function o(e,a,t){e.css("top",a),e.css("left",t)}function s(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function l(){P.html(parseInt(P.html())+1)}function r(e){var a="";a="light"===e?"#lightMoveCount":"#darkMoveCount";var t=parseInt($(a).html());t++,$(a).html(t),console.log(t),t%2==1?(console.log("Hello odd number"),console.log(q)):t%2==0&&(console.log("Hello even number"),console.log(b))}function c(e){e.data("jumpedPieces").remove()}function d(e,a){for(var t=0;t<64;t++)(a<8||a>=56)&&e.addClass("king")}function v(){var e=q.length,a=b.length;return 0===e?(y.text("Player 1 Wins"),y.slideDown("Player 1 Wins")):0===a?(console.log("Player 2 wins"),y.text("Player 2 Wins")):1===a&&1===e?(console.log("It's a draw"),y.text("It's a draw")):void 0}function u(){location.reload()}var f=46,h=2,p=$("div#board"),g=$("div#pieces"),C=$("#reset-button"),m=$("#rules-button"),x=$(".instructions"),y=$("#winner"),k=null;!function(){function e(e){return e%8%2^Math.floor(e/8)%2}for(var a=0;a<64;a++)p.append($("<div/>").addClass("square"));for(var t=0;t<24;t++)g.append($("<div/>").addClass("piece"));$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}(),function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),function(){$("div.piece.dark").each(function(e,a){var n=Math.floor(e/4)+5,i=e%4*2+(1-n%2),s=t(i,n);o($(a),s.top,s.left)})}(),function(){$("div.piece.light").each(function(e,a){var n=Math.floor(e/4),i=e%4*2+(1-n%2),s=t(i,n);o($(a),s.top,s.left)})}(),C.on("click",function(){u()}),m.on("click",function(){x.toggle("slow"),console.log("Clicking here works")}),$("div.square").on("click",function(n){e();var i=$(n.target);if(i.hasClass("movable")){var s=$("div.piece.selected");if(1===s.length){var u=i.prevAll().length,f=u%8,h=Math.floor(u/8),p=t(f,h);o(s,p.top,p.left),c(i),d(s,i.prevAll().length),s.removeClass("selected"),$("div.square").removeClass("movable"),v(),l();r(!0===s.hasClass("light")?"light":"dark"),a()}}});var P=$("#moveCounter");!function(){$("div.piece").on("click",function(e){var t=$(e.target);s(t),a(),t.hasClass("selected")&&i(t).addClass("movable")})}();var b=$("div.piece.light"),q=$("div.piece.dark")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwiZ2V0Q29vcmRzIiwicG9zaXRpb24iLCJldmVudCIsInRhcmdldCIsImNvb3JkcyIsInRvcCIsImxlZnQiLCJyZXNldE1vdmFibGVzIiwicmVtb3ZlRGF0YSIsInJlbW92ZUNsYXNzIiwiZ2V0UGl4ZWxzIiwieCIsInkiLCJ3aWR0aCIsInBpZWNlIiwiYm9yZGVyIiwiZ2V0TW92YWJsZVNxdWFyZXMiLCIkcGllY2UiLCIkc3F1YXJlcyIsImRpcmVjdGlvbiIsImhhc0NsYXNzIiwiaW5kZXgiLCJkYXJrRGlyZWN0aW9uIiwic3F1YXJlSW5kZXgiLCJ0YWtlblNxdWFyZXMiLCJvdXRPZkJvdW5kcyIsImJ1aWxkTW92ZXMiLCJraW5nRGlyZWN0aW9uIiwibGlnaHREaXJlY3Rpb24iLCJuZXdDb29yZHMiLCJuZXdTcXVhcmVJbmRleCIsIiRsZWdhbFNxdWFyZXMiLCJqdW1wU3F1YXJlSW5kZXgiLCJqdW1wc09ubHkiLCIkY3VycmVudFNxdWFyZSIsImVxIiwiZWFjaCIsIiRqdW1wZWRQaWVjZXMiLCJqdW1wQ29vcmRzIiwiJG5ld1NxdWFyZSIsImFkZCIsInNldFVwUGllY2VzIiwiaXMiLCJkYXRhIiwiJGVhY2hTcXVhcmUiLCJuZXdUb3AiLCJuZXdMZWZ0IiwiY3NzIiwiYWRkQ2xhc3MiLCJpbmNyZW1lbnRNb3ZlQ291bnQiLCJjb2xvciIsIndoaWNoQ291bnRlciIsIiRtb3ZlcyIsImh0bWwiLCJsb2ciLCJjb25zb2xlIiwiaW5jcmVtZW50TW92ZUNvdW50ZXIiLCIkbW92ZUNvdW50ZXIiLCIkbGlnaHRQaWVjZXMiLCJwYXJzZUludCIsImNoZWNrS2luZyIsImkiLCIkZGFya1BpZWNlcyIsInBpZWNlc0xlZnQiLCJkYXJrUGllY2VzIiwiJHNxdWFyZSIsIiR3aW5uZXIiLCJyZW1vdmUiLCJsZW5ndGgiLCJsaWdodFBpZWNlcyIsInRleHQiLCJzbGlkZURvd24iLCJyZXNldCIsImxvY2F0aW9uIiwicmVsb2FkIiwiJGJvYXJkIiwiJHBpZWNlcyIsIiRyZXNldEJ1dHRvbiIsIiRydWxlc0J1dHRvbiIsIiRpbnN0cnVjdGlvbnMiLCJsaWdodE9yRGFyayIsIk1hdGgiLCJmbG9vciIsIm9kZFkiLCJ0b2dnbGVTZWxlY3QiLCJhcHBlbmQiLCJ0aGlzIiwicGl4ZWxQb3NpdGlvbiIsIm1vdmVQaWVjZVRvIiwib24iLCJjdXJyZW50UG9zaXRpb24iLCIkc2VsZWN0ZWRQaWVjZSIsImUiLCIkcGllY2VUb01vdmUiLCJwcmV2QWxsIiwicGl4ZWxzIiwicmVtb3ZlQ2FwdHVyZWRQaWVjZXMiLCIkdGhpc1BpZWNlIl0sIm1hcHBpbmdzIjoiWUFzQkVBLEdBQUEsV0ErS0EsUUFBU0MsS0FDUCxHQUFBQyxHQUFBRixFQUFBRyxNQUFBQyxRQUFBRixVQUVBLE9BREFHLEdBQUFKLEVBQUFDLEVBQUFJLElBQUFKLEVBQUFLLE1BS0QsUUFFREMsS0FDQVIsRUFBQSxjQUFBUyxXQUFBLGdCQUFBQyxZQUFBLFdBdEJBLFFBQVNDLEdBQVVDLEVBQUdDLEdBa0NsQixPQUNBUCxJQUFNSixHQUFRWSxFQUFLQyxHQUFGLEtBQ2pCUixLQUFNRixHQUFTSixFQUFTZSxHQUFVVixNQVNoQ00sUUFBRlgsR0FBQUssRUFBQUMsR0FDRUssT0FBT0MsRUFBR04sR0FBQU8sRUFBQUUsR0FGZEgsRUFJQVAsR0FBQVEsRUFBQUUsSUFHSUosUUFBRkssR0FBQUMsR0F6QkYsR0FBTUMsR0FBV25CLEVBQUUsY0FnQ2pCb0IsSUFDRHBCLEdBRkQsYUFFV2tCLEtBQU9HLFNBQVNDLEVBQVVQLEdBR25DSyxHQUFBQSxHQUFZRyxFQUFBQSxHQUFackIsV0FDREcsRUFBQUosRUFBQUMsRUFBQUksSUFBQUosRUFBQUssTUExQk9pQixFQUF5QixFQUFYbkIsRUFBT1EsRUFBUVIsRUFBT08sQ0E0QjVDYSxHQUFpQkQsR0FBWEUsRUFBQUEsSUF4Qk4sSUEyQ0lOLEdBM0NFZixFQUFTSixFQUFVaUIsRUFBT2hCLFdBQVdJLElBQUtZLEVBQU9oQixXQUFXSyxNQTZCNURvQixJQUNK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QXpGLE1BR2hCMEYsRUFBQUgsR0FPSGpDLEVBQUErQixFQUFBRSxFQUFBQyxVQUFBMUIsUUF6Qk11QixFQUFlbEYsWUFBWSxZQTZCL0JMLEVBQU0sY0FBYUgsWUFBRCxXQXZCZDhELElBaUNOUCxHQTFCTVAsSUE0Qk4sSUFBQTBDLEVBQUF2RSxTQUFBLFNBQUEsUUFBQSxRQUVBYixPQW1QRyxJQUFBa0QsR0FBQTFELEVBQUEsaUJBbFZDUSxXQVBGUixFQUFFLGFBQWEwRixHQUFHLFFBQVMsU0FBQ3ZGLEdBV3pCLEdBQUErRixHQUFBbEcsRUFBQUcsRUFBQUMsT0FNTGlGLEdBQUFhLEdBVkkxRixJQVdKc0UsRUFBZ0J6RCxTQUFTLGFBQ3ZCb0QsRUFDQXlCLEdBQUFqRCxTQUFBLGVBeVdDLElBSERVLEdBR1dXLEVBQUFBLG1CQUNUZCxFQUFBeEQsRUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUT0RPOiBcbi8vIDEuIGNvbnZlcnQgdGhpcyBwcm9qZWN0IGludG8gUmVhY3QgYW5kIFR5cGVzY3JpcHRcbi8vIDIuIFVuaXQgdGVzdHNcbi8vIDMuIEZpeCBidWdzXG4vLyA0LiBJbXBsZW1lbnQgdGhlIG1pc3NpbmcgZmVhdHVyZXMuIFxuLy8gIEltcGxlbWVudCBkcmFnZ2luZyBhbmQgZHJvcHBpbmcgcGllY2VzXG4vLyA1LiBSZWRlc2lnbiB0aGUgYXBwXG4vLyA2LiBEZXBsb3kgdGhlIGFwcFxuLy8gNy4gTWFrZSB0aGUgYm9hcmQgcmVzaXphYmxlXG5cbi8vIHN0YXJ0IHdpdGggdGhlIGJvYXJkXG4vLyBhZGQgcGllY2VzIC0gZWFjaCBwaWVjZSB3aWxsIGtub3cgaG93IHRvIG1vdmUgYXJvdW5kIHRoZSBib2FyZFxuLy8gbm9ybWFsIHBpZWNlIGFuZCBraW5nIHBpZWNlXG4vLyBwbGF5ZXJzIDEgYW5kIDJcbi8vIGV4dHJhczogdGltZSBjb250cm9sc1xuLy8gaTE4bmV4dFxuLy8gZm91bmQgMjEgdnVsbmVyYWJpbGl0aWVzICg1IGxvdywgMTEgbW9kZXJhdGUsIDUgaGlnaClcblxuXG4vL2xvYWRpbmcgSlNcbiQoKCkgPT4ge1xuXG4gIC8vR0xPQkFMIFZBUklBQkxFU1xuICBjb25zdCB3aWR0aCA9IDQ2O1xuICBjb25zdCBib3JkZXIgPSAyO1xuICBjb25zdCAkYm9hcmQgPSAkKCdkaXYjYm9hcmQnKTtcbiAgY29uc3QgJHBpZWNlcyA9ICQoJ2RpdiNwaWVjZXMnKTtcbiAgY29uc3QgJHJlc2V0QnV0dG9uID0gJCgnI3Jlc2V0LWJ1dHRvbicpO1xuICBjb25zdCAkcnVsZXNCdXR0b24gPSAkKCcjcnVsZXMtYnV0dG9uJyk7XG4gIGNvbnN0ICRpbnN0cnVjdGlvbnMgPSAkKCcuaW5zdHJ1Y3Rpb25zJyk7XG4gIGNvbnN0ICR3aW5uZXIgPSAkKCcjd2lubmVyJyk7XG5cblxuICBsZXQgY29vcmRzID0gbnVsbDsvL3NldHRpbmcgY29vcmRzIGdsb2JhbGx5IHNvIGl0J3MgY29uc3RhbnRseSB1cGRhdGluZ1xuICAvL3NldCB1cCB0aGUgYm9hcmQgd2l0aCB0aGUgY29ycmVjdCBjbGFzc2VzIGZvciB0aGUgbGlnaHQgYW5kIGRhcmsgc3F1YXJlc1xuICBzZXRVcEJvYXJkKCk7XG4gIC8vc2V0cyB1cCB0aGUgY2xhc3NlcyBmb3IgdGhlIGRpZmZlcmVudCB0eXBlcyBvZiBwaWVjZVxuICBzZXRVcFBpZWNlcygpO1xuICAvL3NldHRpbmcgdXAgdGhlIGRhcmtQaWVjZXNcbiAgZGFya1BpZWNlcygpO1xuICAvLyBzZXR0aW5nIHVwIHRoZSBsaWdodFBpZWNlc1xuICBsaWdodFBpZWNlcygpO1xuXG5cbiAgLy9MSUdIVCBQSUVDRVNcbiAgZnVuY3Rpb24gbGlnaHRQaWVjZXMoKSB7XG4gICAgY29uc3QgJGxpZ2h0UGllY2VzID0gJCgnZGl2LnBpZWNlLmxpZ2h0Jyk7XG4gICAgLy90aGlzIGxvb3AgbW92ZXMgYWxsIHRoZSBsaWdodCBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgICAkbGlnaHRQaWVjZXMuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBpZWNlKSB7XG4gICAgICAvL3R1cm5pbmcgdGhlIGluZGV4IChmcm9tIDAgLSAxMSlcbiAgICAgIC8vaW50byBhIHgseSBzcXVhcmUgY29vcmRpbmF0ZSB1c2luZyBtYXRoc1xuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA0KTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHkgJSAyKTtcblxuICAgICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmF0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICAgIGNvbnN0IHBpeGVsUG9zaXRpb24gPSBnZXRQaXhlbHMoeCwgeSk7XG4gICAgICAvL2FjdHVhbGx5IG1vdmluZyB0aGUgcGllY2UgdG8gaXRzIGluaXRpYWwgcG9zaXRpb25cbiAgICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLCBwaXhlbFBvc2l0aW9uLnRvcCwgcGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgICB9KTtcbiAgfS8vZW5kIG9mIGxpZ2h0UGllY2VzIGZ1bmN0aW9uXG5cblxuICAvL0RBUksgUElFQ0VTXG4gIGZ1bmN0aW9uIGRhcmtQaWVjZXMoKSB7XG4gICAgY29uc3QgJGRhcmtQaWVjZXMgPSAkKCdkaXYucGllY2UuZGFyaycpO1xuICAgIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgZGFyayBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgICAkZGFya1BpZWNlcy5lYWNoKGZ1bmN0aW9uIChpbmRleCwgcGllY2UpIHtcbiAgICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgICAgLy9pbnRvIGEgeCx5IHNxdWFyZSBjb29yZGluYXRlIHVzaW5nIG1hdGhzXG4gICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihpbmRleCAvIDQpICsgNTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHkgJSAyKTtcblxuICAgICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmF0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICAgIGNvbnN0IHBpeGVsUG9zaXRpb24gPSBnZXRQaXhlbHMoeCwgeSk7XG4gICAgICAvL21vdmluZyB0aGUgcGllY2UgdG8gaXRzIGluaXRpYWwgcG9zaXRpb25cbiAgICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLCBwaXhlbFBvc2l0aW9uLnRvcCwgcGl4ZWxQb3NpdGlvbi5sZWZ0KTtcbiAgICB9KTtcbiAgfS8vZW5kIG9mIGRhcmtQaWVjZXMgZnVuY3Rpb25cblxuXG5cbiAgLy9FVkVOVFNcbiAgZnVuY3Rpb24gcGllY2VTZWxlY3QoKSB7XG4gICAgJCgnZGl2LnBpZWNlJykub24oJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAvL3NlbGVjdGVkIHZhcmlhYmxlXG4gICAgICAvL3R1cm4gYHRoaXNgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgICBjb25zdCAkdGhpc1BpZWNlID0gJChldmVudC50YXJnZXQpO1xuICAgICAgLy90b2dnbGluZyB0aGUgJ3NlbGVjdGVkJyBjbGFzcyBvZiB0aGlzIHBpZWNlXG4gICAgICAvL2FuZCBwb3NzaWJsZSBkZXNlbGVjdGluZyBvdGhlciBwaWVjZXNcbiAgICAgIHRvZ2dsZVNlbGVjdCgkdGhpc1BpZWNlKTtcbiAgICAgIHJlc2V0TW92YWJsZXMoKTtcbiAgICAgIC8vZ2V0IHRoZSBsZWdhbCBtb3ZlcyBmb3IgdGhpc1xuICAgICAgaWYgKCR0aGlzUGllY2UuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpIHtcbiAgICAgICAgZ2V0TW92YWJsZVNxdWFyZXMoJHRoaXNQaWVjZSkuYWRkQ2xhc3MoJ21vdmFibGUnKTtcbiAgICAgIH1cbiAgICB9KTsvL2VuZCBvZiBwaWVjZSBjbGljayBldmVudFxuXG4gIH1cblxuICAvLyBCVVRUT05TXG4gIC8vcmVzZXR0aW5nIHRoZSBnYW1lLlxuICAkcmVzZXRCdXR0b24ub24oJ2NsaWNrJywgKCkgPT4ge1xuICAgIHJlc2V0KCk7XG4gICAgLy8gc2V0dGluZyB1cCB0aGUgcGllY2VzIGFmdGVyIGVtcHR5aW5nIHRoZW0uXG4gIH0pO1xuXG4gIC8vaGlkaW5nIGFuZCBzaG93aW5nIHRoZSBydWxlcy5cbiAgJHJ1bGVzQnV0dG9uLm9uKCdjbGljaycsICgpID0+IHtcbiAgICAkaW5zdHJ1Y3Rpb25zLnRvZ2dsZSgnc2xvdycpO1xuICAgIGNvbnNvbGUubG9nKGBDbGlja2luZyBoZXJlIHdvcmtzYCk7XG4gIH0pO1xuXG5cblxuICAkKCdkaXYuc3F1YXJlJykub24oJ2NsaWNrJywgKGUpID0+IHtcblxuICAgIGN1cnJlbnRQb3NpdGlvbigpOy8vdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgc3F1YXJlOyBjb29yZHNcbiAgICAvL3R1cm4gYGUgb3IgZXZlbnRgIGludG8gYSBqUXVlcnkgb2JqZWN0XG4gICAgY29uc3QgJHBpZWNlVG9Nb3ZlID0gJChlLnRhcmdldCk7XG5cblxuICAgIC8vaWYgJCh0aGlzKSBpcyBhIGxlZ2FsIHNxdWFyZSB0byBtb3ZlIHRvLi4uXG4gICAgaWYgKCRwaWVjZVRvTW92ZS5oYXNDbGFzcygnbW92YWJsZScpKSB7XG5cbiAgICAgIC8vZ2V0IHRoZSBwaWVjZSB3aXRoIHRoZSBjbGFzcyAnc2VsZWN0ZWQnXG4gICAgICBjb25zdCAkc2VsZWN0ZWRQaWVjZSA9ICQoJ2Rpdi5waWVjZS5zZWxlY3RlZCcpO1xuICAgICAgLy9vbmx5IG1vdmUgaWYgdGhlcmUgaXMgZXhhY3RseSBvbmUgc2VsZWN0ZWQgcGllY2VcbiAgICAgIGlmICgkc2VsZWN0ZWRQaWVjZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgLy9nZXQgdGhlIGluZGV4IG9mIHRoZSBzcXVhcmVcbiAgICAgICAgLy9hbmQgdHJhbnNsYXRlIGl0IHRvIHBpeGVsIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IGluZGV4ID0gJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHggPSBpbmRleCAlIDg7XG4gICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IGdldFBpeGVscyh4LCB5KTtcbiAgICAgICAgLy9hY3R1YWxseSBkbyB0aGUgbW92aW5nXG4gICAgICAgIG1vdmVQaWVjZVRvKCRzZWxlY3RlZFBpZWNlLCBwaXhlbHMudG9wLCBwaXhlbHMubGVmdCk7XG4gICAgICAgIC8vcmVtb3ZlQ2FwdHVyZWRQaWVjZXNcbiAgICAgICAgcmVtb3ZlQ2FwdHVyZWRQaWVjZXMoJHBpZWNlVG9Nb3ZlKTtcbiAgICAgICAgLy8ucHJldkFsbCgpLmxlbmd0aCBpcyB1c2VkIHRvIGdldCB0aGUgaW5kZXhcbiAgICAgICAgLy9vZiB0aGUgc2VsZWN0ZWQgcGllY2VcbiAgICAgICAgY2hlY2tLaW5nKCRzZWxlY3RlZFBpZWNlLCAkcGllY2VUb01vdmUucHJldkFsbCgpLmxlbmd0aCk7XG4gICAgICAgIC8vZGUtc2VsZWN0IHRoZSBwaWVjZSB0byBlbmQgdGhlIG1vdmVcbiAgICAgICAgJHNlbGVjdGVkUGllY2UucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cbiAgICAgICAgLy9zZXQgdGhlIG5ldyBsZWdhbCBtb3Zlc1xuICAgICAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcblxuICAgICAgICAvLyBURVNULiB0ZXN0aW5nIHRoZSB3aW5uaW5nIGNvbmRpdGlvbnMgYnkgY2hlY2tpbmcgdGhlIG51bWJlciBvZiBwaWVjZXMgbGVmdCBvbiB0aGUgYm9hcmRcbiAgICAgICAgcGllY2VzTGVmdCgpO1xuXG4gICAgICAgIC8vaW5jcmVtZW50IHRoZSBtb3ZlIGNvdW50ZXJcbiAgICAgICAgaW5jcmVtZW50TW92ZUNvdW50ZXIoKTtcblxuICAgICAgICBjb25zdCBjb2xvciA9ICRzZWxlY3RlZFBpZWNlLmhhc0NsYXNzKCdsaWdodCcpID09PSB0cnVlID8gJ2xpZ2h0JyA6ICdkYXJrJztcblxuICAgICAgICBpbmNyZW1lbnRNb3ZlQ291bnQoY29sb3IpO1xuICAgICAgICAvL3Jlc2V0IHRoZSBzcXVhcmVzIHRvIGFsbG93IG1vdmVzXG4gICAgICAgIHJlc2V0TW92YWJsZXMoKTtcblxuICAgICAgfVxuICAgIH1cblxuICB9KTtcblxuXG4gIC8vIE1PUkUgRlVOQ1RJT05TXG4gIC8vdGhpcyBmdW5jdGlvbiByZW1vdmVzIHRoZSBkYXRhIGl0ZW0gd2l0aCBrZXkgJ2p1bXBlZFBpZWNlcycgZnJvbSBldmVyeSBkaXYuc3F1YXJlXG4gIC8vIGFuZCByZW1vdmVzIHRoZSBjbGFzcyAnbW92YWJsZScgZnJvbSBldmVyeSBzcXVhcmVcbiAgLy9jaGVja3MgdGhlIGN1cnJlbnRQb3NpdGlvbiBvZiB0aGUgY2xpY2tlZCBvciBzZWxlY3RlZCBkaXYgYW5kIHJldHVybnMgdGhlIGNvb3Jkcy5cbiAgZnVuY3Rpb24gY3VycmVudFBvc2l0aW9uKCkge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gJChldmVudC50YXJnZXQpLnBvc2l0aW9uKCk7XG4gICAgY29vcmRzID0gZ2V0Q29vcmRzKHBvc2l0aW9uLnRvcCwgcG9zaXRpb24ubGVmdCk7XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfVxuXG5cbiAgZnVuY3Rpb24gcmVzZXRNb3ZhYmxlcygpIHtcbiAgICAkKCdkaXYuc3F1YXJlJykucmVtb3ZlRGF0YSgnanVtcGVkUGllY2VzJykucmVtb3ZlQ2xhc3MoJ21vdmFibGUnKTtcbiAgfVxuXG5cbiAgLy9mdW5jdGlvbiBmb3IgdHJhbnNsYXRpbmcgYW4geCx5IGNvb3JkaW5hdGVzIHRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgLy90aGUgY29udmVudGlvbiBpcyB0aGF0IHRoZSBzcXVhcmUgaW4gdGhlIHVwcGVyIGxlZnQgY29ybmVyIGlzIGF0IHBvc2l0aW9uIDAsMFxuICAvL3RoZSBzcXVhcmUgaW4gdGhlIHVwcGVyIHJpZ2h0LCBhdCA3LDAgYW5kIHRoZSBsb3dlclxuICAvL3JpZ2h0IGF0IDcsN1xuICBmdW5jdGlvbiBnZXRQaXhlbHMoeCwgeSkge1xuICAgIC8vdGFrZXMgYW4geCx5IHBvc2l0aW9uLCByZXR1cm5zXG4gICAgLy9waXhlbHMgZnJvbSB0aGUgbGVmdCwgcmlnaHRcbiAgICByZXR1cm4ge1xuICAgICAgJ3RvcCc6ICh5ICogKHdpZHRoICsgYm9yZGVyKSkgKyAncHgnLFxuICAgICAgJ2xlZnQnOiAoeCAqICh3aWR0aCArIGJvcmRlcikpICsgJ3B4J1xuICAgIH07XG4gIH1cblxuICAvL2Z1bmN0aW9uIGZvciB0dXJuaW5nIGEgcGl4ZWwgcG9zaXRpb25cbiAgLy9pbnRvIHRoZSB4LHkgY29vcmRpbmF0ZSBvZiBhIHNxdWFyZSBvbiB0aGUgYm9hcmRcbiAgLy9pdCBmb2xsb3dzIHRoZSBzYW1lIGNvb3JkaW5hdGUgY29udmVudGlvbiBhcyBnZXRQaXhlbHNcbiAgZnVuY3Rpb24gZ2V0Q29vcmRzKHRvcCwgbGVmdCkge1xuICAgIC8vcmV0dXJucyBhbiB4IGFuZCBhIHlcbiAgICAvL2dpdmVuIGEgdG9wIGFuZCBsZWZ0IHBpeGVsc1xuICAgIHJldHVybiB7XG4gICAgICAneCc6IGxlZnQgLyAod2lkdGggKyBib3JkZXIpLFxuICAgICAgJ3knOiB0b3AgLyAod2lkdGggKyBib3JkZXIpXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHJldHVybmluZyB0aGUgc2V0IG9mIGxlZ2FsIG1vdmVzIGdpdmVuIGEgcGllY2VcbiAgLy8gdGhpcyBhbHNvIHN0b3JlcyBqdW1wZWQgcGllY2VzIGluIGEgZGF0YSBlbGVtZW50IG9mIGVhY2ggc3F1YXJlIHRoYXQgY2FuIGJlIG1vdmVkIHRvXG4gIGZ1bmN0aW9uIGdldE1vdmFibGVTcXVhcmVzKCRwaWVjZSkge1xuXG4gICAgLy9zZWxlY3QgYWxsIG9mIHRoZSBzcXVhcmVzXG4gICAgY29uc3QgJHNxdWFyZXMgPSAkKCdkaXYuc3F1YXJlJyk7XG5cbiAgICAvL3NlbGVjdCB0aGUgb2NjdXBpZWQgb25lcyB1c2luZyB0aGUgalF1ZXJ5IG1hcCgpIG1ldGhvZFxuICAgIC8vbWFwIGNyZWF0ZXMgYSBuZXcgb2JqZWN0IGZyb20gYW4gZXhpc3Rpbmcgb25lXG4gICAgLy91c2luZyBhIHRyYW5zbGF0aW9uIGZ1bmN0aW9uXG4gICAgY29uc3QgdGFrZW5TcXVhcmVzID0ge307XG4gICAgJCgnZGl2LnBpZWNlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBpZWNlKSB7XG5cbiAgICAgIC8vdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGEgcGllY2VcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gJChwaWVjZSkucG9zaXRpb24oKTtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AsIHBvc2l0aW9uLmxlZnQpO1xuICAgICAgY29uc3Qgc3F1YXJlSW5kZXggPSBjb29yZHMueSAqIDggKyBjb29yZHMueDtcbiAgICAgIHRha2VuU3F1YXJlc1tzcXVhcmVJbmRleF0gPSAkKHBpZWNlKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3JkcygkcGllY2UucG9zaXRpb24oKS50b3AsICRwaWVjZS5wb3NpdGlvbigpLmxlZnQpO1xuXG4gICAgLy9saWdodHMgbW92ZSBkb3duIHRoZSBib2FyZFxuICAgIGNvbnN0IGxpZ2h0RGlyZWN0aW9uID0gW1xuICAgICAgeyB4OiAxLCB5OiAxIH0sXG4gICAgICB7IHg6IC0xLCB5OiAxIH1cbiAgICBdO1xuICAgIC8vZGFya3MgbW92ZSB1cCB0aGUgYm9hcmRcbiAgICBjb25zdCBkYXJrRGlyZWN0aW9uID0gW1xuICAgICAgeyB4OiAxLCB5OiAtMSB9LFxuICAgICAgeyB4OiAtMSwgeTogLTEgfVxuICAgIF07XG4gICAgLy9raW5ncyBtb3ZlIGluIGFueSBkaXJlY3Rpb25cbiAgICBjb25zdCBraW5nRGlyZWN0aW9uID0gbGlnaHREaXJlY3Rpb24uY29uY2F0KGRhcmtEaXJlY3Rpb24pO1xuXG4gICAgbGV0IGRpcmVjdGlvbjtcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdraW5nJykpIHtcbiAgICAgIGRpcmVjdGlvbiA9IGtpbmdEaXJlY3Rpb247XG4gICAgfSBlbHNlIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2xpZ2h0JykpIHtcbiAgICAgIGRpcmVjdGlvbiA9IGxpZ2h0RGlyZWN0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXJlY3Rpb24gPSBkYXJrRGlyZWN0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0IG91dE9mQm91bmRzID0gZnVuY3Rpb24gKGNvb3Jkcykge1xuICAgICAgcmV0dXJuICEoY29vcmRzLnggPj0gMCAmJiBjb29yZHMueCA8IDggJiYgY29vcmRzLnkgPj0gMCAmJiBjb29yZHMueSA8IDgpO1xuICAgIH07XG5cbiAgICBsZXQgJGxlZ2FsU3F1YXJlcyA9ICQoKTtcbiAgICBjb25zdCBidWlsZE1vdmVzID0gZnVuY3Rpb24gKGNvb3JkcywgZGlyZWN0aW9uLCBqdW1wc09ubHkpIHtcbiAgICAgIGlmIChvdXRPZkJvdW5kcyhjb29yZHMpKSByZXR1cm47XG4gICAgICAvL2N1cnJlbnQgc3F1YXJlIGlzIGF0IGNvb3Jkc1xuICAgICAgY29uc3QgJGN1cnJlbnRTcXVhcmUgPSAkc3F1YXJlcy5lcShjb29yZHMueSAqIDggKyBjb29yZHMueCk7XG4gICAgICAkLmVhY2goZGlyZWN0aW9uLCBmdW5jdGlvbiAoaW5kZXgsIGRpcmVjdGlvbikge1xuXG4gICAgICAgIGNvbnN0IG5ld0Nvb3JkcyA9IHtcbiAgICAgICAgICB4OiBkaXJlY3Rpb24ueCArIGNvb3Jkcy54LFxuICAgICAgICAgIHk6IGRpcmVjdGlvbi55ICsgY29vcmRzLnlcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAob3V0T2ZCb3VuZHMobmV3Q29vcmRzKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBuZXdTcXVhcmVJbmRleCA9IDggKiBuZXdDb29yZHMueSArIG5ld0Nvb3Jkcy54O1xuICAgICAgICAvL2lmIHRoZSBzcXVhcmUgaXMgdGFrZW4sXG4gICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdKSB7XG5cbiAgICAgICAgICAvL0NhbiBvbmx5IGp1bXAgaWYgcGllY2UgaXMgZGlmZmVyZW50XG4gICAgICAgICAgaWYgKCRwaWVjZS5oYXNDbGFzcygnZGFyaycpKSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnZGFyaycpKSByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0YWtlblNxdWFyZXNbbmV3U3F1YXJlSW5kZXhdLmhhc0NsYXNzKCdsaWdodCcpKSByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QganVtcENvb3JkcyA9IHtcbiAgICAgICAgICAgIHg6IGRpcmVjdGlvbi54ICogMiArIGNvb3Jkcy54LFxuICAgICAgICAgICAgeTogZGlyZWN0aW9uLnkgKiAyICsgY29vcmRzLnlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvdXRPZkJvdW5kcyhqdW1wQ29vcmRzKSkgcmV0dXJuO1xuXG4gICAgICAgICAgY29uc3QganVtcFNxdWFyZUluZGV4ID0ganVtcENvb3Jkcy55ICogOCArIGp1bXBDb29yZHMueDtcbiAgICAgICAgICAvL2lmIHRoZSBqdW1wIHNxdWFyZSBpcyBmcmVlLi4uXG4gICAgICAgICAgLy9hZGQgaXQgYW5kIHRoZSBkYXRhLWp1bXBlZC1waWVjZXNcbiAgICAgICAgICBpZiAoIXRha2VuU3F1YXJlc1tqdW1wU3F1YXJlSW5kZXhdKSB7XG4gICAgICAgICAgICBjb25zdCAkbmV3U3F1YXJlID0gJHNxdWFyZXMuZXEoanVtcFNxdWFyZUluZGV4KTtcbiAgICAgICAgICAgIC8vaWYgd2UgaGF2ZW4ndCBhbHJlYWR5IHNlZW4gaXRcbiAgICAgICAgICAgIGlmICghJG5ld1NxdWFyZS5pcygkbGVnYWxTcXVhcmVzKSkge1xuXG4gICAgICAgICAgICAgIC8vYWRkIHRoZSBwYXNzZWQgb3ZlciBzcXVhcmUgdG8gaXRcbiAgICAgICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuXG4gICAgICAgICAgICAgIC8vYW5kIHRoZSBqdW1wZWQgc3F1YXJlcyBmcm9tIGhvdyB3ZSBnb3QgaGVyZVxuICAgICAgICAgICAgICBsZXQgJGp1bXBlZFBpZWNlcyA9IHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF07XG4gICAgICAgICAgICAgIGlmICgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSkge1xuICAgICAgICAgICAgICAgICRqdW1wZWRQaWVjZXMgPSAkanVtcGVkUGllY2VzLmFkZCgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCAkanVtcGVkUGllY2VzKTtcblxuICAgICAgICAgICAgICAvL2FuZCByZWN1cnNlLCB3aXRoIGp1bXBzT25seSBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgICBidWlsZE1vdmVzKGp1bXBDb29yZHMsIGRpcmVjdGlvbiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFqdW1wc09ubHkpIHtcbiAgICAgICAgICBjb25zdCAkbmV3U3F1YXJlID0gJHNxdWFyZXMuZXEobmV3U3F1YXJlSW5kZXgpO1xuICAgICAgICAgICRuZXdTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJywgJCgpKTtcbiAgICAgICAgICAkbGVnYWxTcXVhcmVzID0gJGxlZ2FsU3F1YXJlcy5hZGQoJG5ld1NxdWFyZSk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgfTtcbiAgICBidWlsZE1vdmVzKGNvb3JkcywgZGlyZWN0aW9uLCBmYWxzZSk7XG4gICAgcmV0dXJuICRsZWdhbFNxdWFyZXM7XG5cbiAgfS8vZW5kIG9mIGdldE1vdmFibGVTcXVhcmVzXG5cbiAgZnVuY3Rpb24gc2V0VXBQaWVjZXMoKSB7XG4gICAgLy9zZWxlY3QgYWxsIHRoZSBkaXZzIHdpdGggY2xhc3MgJ3BpZWNlJ1xuICAgICQoJ3BpZWNlJyk7XG4gICAgLy9hZGQgdGhlICdsaWdodCcgY2xhc3MgdG8gaGFsZiBvZiB0aGVtXG4gICAgJCgnZGl2LnBpZWNlOmV2ZW4nKS5hZGRDbGFzcygnbGlnaHQnKTtcbiAgICAvL2pRdWVyeSdzIGV2ZW4gYW5kIG9kZCBzZWxlY3RvciBtZXRob2RzIHRvIGFzc2lnbiB0aGUgY2xhc3NlcyAubGlnaHQgYW5kIC5kYXJrLlxuICAgIC8vYWRkIHRoZSAnZGFyaycgdG8gdGhlIG90aGVyIGhhbGZcbiAgICAkKCdkaXYucGllY2U6b2RkJykuYWRkQ2xhc3MoJ2RhcmsnKTtcbiAgfVxuXG4gIC8vYWN0dWFsbHkgbW92aW5nIHRoZSBwaWVjZVxuICBmdW5jdGlvbiBtb3ZlUGllY2VUbygkcGllY2UsIG5ld1RvcCwgbmV3TGVmdCkge1xuICAgIC8vc2V0IHRoZSBjc3MgJ3RvcCcgYW5kICdsZWZ0J1xuICAgIC8vYXR0cmlidXRlcyBvZiB0aGUgcGFzc2VkIHBpZWNlXG4gICAgLy90byB0aGUgYXJndW1lbnRzIG5ld1RvcCBhbmQgbmV3TGVmdFxuICAgICRwaWVjZS5jc3MoJ3RvcCcsIG5ld1RvcCk7XG4gICAgJHBpZWNlLmNzcygnbGVmdCcsIG5ld0xlZnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0VXBCb2FyZCgpIHtcblxuICAgIC8vQ3JlYXRpbmcgdGhlIDY0IHNxdWFyZXMgYW5kIGFkZGluZyB0aGVtIHRvIHRoZSBET01cbiAgICBjb25zdCBzcXVhcmVDb3VudCA9IDggKiA4OyAvLzggcm93cyBieSA4IGNvbHVtbnM7IHplcm8gYmFzZWQgaW5kZXhcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNxdWFyZUNvdW50OyBpKyspIHtcbiAgICAgIC8vdGhpcyBsaW5lIGNyZWF0ZXMgYSBuZXcgZGl2IHdpdGggdGhlIGNsYXNzICdzcXVhcmUnXG4gICAgICAvL2FuZCBhcHBlbmRzIGl0IHRvIHRoZSBkaXYgd2l0aCBpZCAnYm9hcmQnXG4gICAgICAkYm9hcmQuYXBwZW5kKCQoJzxkaXYvPicpLmFkZENsYXNzKCdzcXVhcmUnKSk7XG4gICAgfVxuXG4gICAgLy9jcmVhdGluZyB0aGUgMjQgcGllY2VzIGFuZCBhZGRpbmcgdGhlbSB0byB0aGUgRE9NXG4gICAgY29uc3QgcGllY2VDb3VudCA9IDI0O1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaWVjZUNvdW50OyBpKyspIHtcbiAgICAgIC8vdGhpcyBsaW5lIGFwcGVuZHMgYW4gZW1wdHkgZGl2IHdpdGggdGhlIGNsYXNzICdwaWVjZScgdG8gdGhlIGRpdiB3aXRoIGlkICdwaWVjZXMnXG4gICAgICAkcGllY2VzLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygncGllY2UnKSk7XG4gICAgfVxuICAgIC8vaXRlcmF0ZSB0aHJvdWdoIGFsbCBvZiB0aGUgZGl2cyB3aXRoIGNsYXNzIGBzcXVhcmVgXG4gICAgLy9maWd1cmUgb3V0IHdoZXRoZXIgZWFjaCBvbmUgc2hvdWxkIGJlXG4gICAgLy9saWdodCBvciBkYXJrLCBhbmQgYXNzaWduIHRoZSBwcm9wZXIgY2xhc3NcbiAgICBjb25zdCAkZWFjaFNxdWFyZSA9ICQoJ2Rpdi5zcXVhcmUnKTtcbiAgICAkZWFjaFNxdWFyZS5lYWNoKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgaWYgKGxpZ2h0T3JEYXJrKGluZGV4KSA9PT0gMCkge1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdsaWdodCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnZGFyaycpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vaW5uZXIgaGVscGVyIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBudW1iZXIgYmV0d2VlblxuICAgIC8vMCBhbmQgNjMgKGluY2x1c2l2ZSkgYW5kIHJldHVybnMgMSBpZiB0aGUgc3F1YXJlIHNob3VsZCBiZVxuICAgIC8vZGFyaywgYW5kIDAgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmUgbGlnaHRcbiAgICBmdW5jdGlvbiBsaWdodE9yRGFyayhpbmRleCkge1xuICAgICAgY29uc3QgeCA9IGluZGV4ICUgODtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICBjb25zdCBvZGRYID0geCAlIDI7XG4gICAgICBjb25zdCBvZGRZID0geSAlIDI7XG4gICAgICByZXR1cm4gKG9kZFggXiBvZGRZKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHNldFVwQm9hcmQoKVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZVNlbGVjdCgkcGllY2UpIHtcbiAgICAvL2lmICRwaWVjZSBoYXMgdGhlIGNsYXNzICdzZWxlY3RlZCcscmVtb3ZlIGl0XG4gICAgLy9pZiAkcGllY2UgZG9lcyBub3QgaGF2ZSB0aGUgY2xhc3MgJ3NlbGVjdGVkJ1xuICAgIC8vbWFrZSBzdXJlIG5vIG90aGVyIGRpdnMgd2l0aCB0aGUgY2xhc3MgJ3BpZWNlJ1xuICAgIC8vaGF2ZSB0aGF0IGNsYXNzLCB0aGVuIHNldCAkcGllY2UgdG8gaGF2ZSB0aGUgY2xhc3NcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdzZWxlY3RlZCcpKVxuICAgICAgJHBpZWNlLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgIGVsc2Uge1xuICAgICAgJCgnZGl2LnBpZWNlJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIHBpZWNlKSB7XG4gICAgICAgIGlmICgkKHBpZWNlKS5oYXNDbGFzcygnc2VsZWN0ZWQnKSlcbiAgICAgICAgICAkKHBpZWNlKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgIH0pO1xuICAgICAgJHBpZWNlLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgIH1cblxuICB9Ly9lbmQgb2YgdG9nZ2xlU2VsZWN0IGZ1bmN0aW9uXG5cbiAgY29uc3QgJG1vdmVDb3VudGVyID0gJCgnI21vdmVDb3VudGVyJyk7XG4gIGZ1bmN0aW9uIGluY3JlbWVudE1vdmVDb3VudGVyKCkge1xuICAgIC8vZ2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIG1vdmVDb3VudGVyIHR1cm5zIGl0IGludG8gYSBudW1iZXJcbiAgICAvL2luY3JlbWVudHMgaXQgYnkgb25lXG4gICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXJcbiAgICAvL3RvIHRoZSBuZXcgbW92ZSBjb3VudFxuICAgICRtb3ZlQ291bnRlci5odG1sKHBhcnNlSW50KCRtb3ZlQ291bnRlci5odG1sKCkpICsgMSk7XG5cbiAgfVxuXG5cbiAgcGllY2VTZWxlY3QoKTsvLyBwbGF5ZXIgdG8gc2VsZWN0IGEgcGllY2VcbiAgLy8gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyXG4gIC8vdGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHBsYXllcnMgdG8gYmUgY2hhbmdlZC5cbiAgZnVuY3Rpb24gaW5jcmVtZW50TW92ZUNvdW50KGNvbG9yKSB7XG4gICAgLy9nZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbGlnaHRNb3ZlQ291bnQgb3IgZGFya01vdmVDb3VudFxuICAgIC8vdHVybnMgaXQgaW50byBhIG51bWJlciBpbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgIC8vc2V0cyB0aGUgaHRtbCBvZiB0aGUgc3BhbiB3aXRoIGlkIGxpZ2h0TW92ZUNvdW50IG9yIGRhcmtNb3ZlQ291bnQgdG8gdGhlIG5ldyBtb3ZlIGNvdW50XG4gICAgbGV0IHdoaWNoQ291bnRlciA9ICcnO1xuICAgIGNvbG9yID09PSAnbGlnaHQnID8gd2hpY2hDb3VudGVyID0gJyNsaWdodE1vdmVDb3VudCcgOiB3aGljaENvdW50ZXIgPSAnI2RhcmtNb3ZlQ291bnQnO1xuICAgIGxldCAkbW92ZXMgPSBwYXJzZUludCgkKHdoaWNoQ291bnRlcikuaHRtbCgpKTtcbiAgICAkbW92ZXMrKztcblxuICAgICQod2hpY2hDb3VudGVyKS5odG1sKCRtb3Zlcyk7XG4gICAgY29uc29sZS5sb2coJG1vdmVzKTtcbiAgICAvL2lmIHRoZSBudW1iZXIgaXMgZXZlbiB0aGVuIGl0J3MgbGlnaHQncyBtb3ZlIGFuZCBvZGQgaXQncyBkYXJrJ3MgbW92ZS5cbiAgICBpZiAoJG1vdmVzICUgMiA9PT0gMSkge1xuICAgICAgY29uc29sZS5sb2coYEhlbGxvIG9kZCBudW1iZXJgKTtcbiAgICAgIGNvbnNvbGUubG9nKCRkYXJrUGllY2VzKTtcbiAgICB9IGVsc2UgaWYgKCRtb3ZlcyAlIDIgPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKGBIZWxsbyBldmVuIG51bWJlcmApO1xuICAgICAgY29uc29sZS5sb2coJGxpZ2h0UGllY2VzKTtcbiAgICB9XG4gIH0vL2VuZCBvZiBpbmNyZW1lbnRNb3ZlQ291bnQoKVxuXG4gIC8vUExBWUVSIE9ORSBBTkQgUExBWUVSIFRXT1xuICAvL0lmIHRoZSBtb3ZlIGNvdW50IGlzIGV2ZW4sIHRoZW4gcGxheWVyIG9uZSdzIHR1cm4gb3RoZXJ3aXNlIHBsYXllciB0d28ncyB0dXJuXG4gIGNvbnN0ICRsaWdodFBpZWNlcyA9ICQoJ2Rpdi5waWVjZS5saWdodCcpO1xuICBjb25zdCAkZGFya1BpZWNlcyA9ICQoJ2Rpdi5waWVjZS5kYXJrJyk7XG5cbiAgLy8gdGhpcyBmdW5jdGlvbiBnZXRzIHRoZSBqUXVlcnkgb2JqZWN0IHN0b3JlZCBpblxuICAvLyB0aGUgZGF0YSBvYmplY3Qgb2YgJHNxdWFyZSB1bmRlciB0aGUga2V5ICdqdW1wZWRQaWVjZXMnXG4gIC8vIGFuZCByZW1vdmVzIGV2ZXJ5IGVsZW1lbnQgaW4gdGhhdCBqUXVlcnkgc2VsZWN0aW9uXG4gIGZ1bmN0aW9uIHJlbW92ZUNhcHR1cmVkUGllY2VzKCRzcXVhcmUpIHtcbiAgICAkc3F1YXJlLmRhdGEoJ2p1bXBlZFBpZWNlcycpLnJlbW92ZSgpO1xuICB9XG5cbiAgLy8gVGhpcyBmdW5jdGlvbiB0YWtlcyBhICRwaWVjZSBhbmQgdGhlIGluZGV4IG9mIGEgc3F1YXJlXG4gIC8vc3F1YXJlSW5kZXggd2lsbCBiZSBiZXR3ZWVuIDAgLSA2MyAoaW5jbHVzaXZlKS5cbiAgLy8gaWYgdGhlIGluZGV4IHJlZmVycyB0byBhbiBlbGVtZW50IGluIHRoZSBmaXJzdCByb3cgb3IgbGFzdCByb3csXG4gIC8vIHRoZSBjbGFzcyAna2luZycgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSAkcGllY2VcbiAgZnVuY3Rpb24gY2hlY2tLaW5nKCRwaWVjZSwgc3F1YXJlSW5kZXgpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY0OyBpKyspIHtcbiAgICAgIGlmIChzcXVhcmVJbmRleCA8IDggfHwgc3F1YXJlSW5kZXggPj0gNTYpIHtcbiAgICAgICAgJHBpZWNlLmFkZENsYXNzKCdraW5nJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gV0lOTklOR1xuICAvL3dpbm5pbmcgY29uZGl0aW9uczogSWYgb25lIHBsYXllciBvbmx5IGhhcyB0aGVpciBwaWVjZXMgb24gdGhlIGJvYXJkIGxlZnRcbiAgLy90aGV5IHdpbi5cbiAgZnVuY3Rpb24gcGllY2VzTGVmdCgpIHtcbiAgICBjb25zdCBkYXJrUGllY2VzID0gJGRhcmtQaWVjZXMubGVuZ3RoO1xuICAgIGNvbnN0IGxpZ2h0UGllY2VzID0gJGxpZ2h0UGllY2VzLmxlbmd0aDtcbiAgICBpZiAoZGFya1BpZWNlcyA9PT0gMCkge1xuICAgICAgJHdpbm5lci50ZXh0KGBQbGF5ZXIgMSBXaW5zYCk7XG4gICAgICByZXR1cm4gJHdpbm5lci5zbGlkZURvd24oYFBsYXllciAxIFdpbnNgKTtcbiAgICB9IGVsc2UgaWYgKGxpZ2h0UGllY2VzID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhgUGxheWVyIDIgd2luc2ApO1xuICAgICAgcmV0dXJuICR3aW5uZXIudGV4dChgUGxheWVyIDIgV2luc2ApO1xuXG4gICAgfSBlbHNlIGlmIChsaWdodFBpZWNlcyA9PT0gMSAmJiBkYXJrUGllY2VzID09PSAxKSB7Ly9hbmQgNDAgbW92ZXMgYXJlIHBsYXllZCBhZnRlcndhcmRzXG4gICAgICAvL3lldCB0byBjb2RlIHRoaXMgZnVuY3Rpb25cbiAgICAgIGNvbnNvbGUubG9nKGBJdCdzIGEgZHJhd2ApO1xuICAgICAgcmV0dXJuICR3aW5uZXIudGV4dChgSXQncyBhIGRyYXdgKTtcbiAgICB9XG4gIH1cblxuICAvL3RoaXMgcmVzZXRzIHRoZSBnYW1lIGJ5IGVmZmVjdGl2ZWx5IHJlbG9hZGluZyB0aGUgcGFnZSBmcm9tIGNhY2hlXG4gIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICB9XG5cbn0pOy8vZW5kIG9mIEpTIGxvYWRcblxuXG4vKlxuXG5UT0RPOlxuMS4gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyIGZlYXR1cmUgcmVxdWVzdFxuMi4gUmVzZXQgdGhlIGdhbWUgYnkgcHV0dGluZyB0aGUgcGllY2VzIHRvIHRoZSBvcmlnaW5hbCBwb3NpdGlvbiBmZWF0dXJlIHJlcXVlc3RmXG4zLiBXaW4gY29uZGl0aW9ucywgaWYgZWl0aGVyIHBsYXllciBoYXMgcGllY2VzIGxlZnQgb24gdGhlIGJvYXJkIHdoaWxlIHRoZSBvdGhlciBkb2Vzbid0XG4gIHRoZW4gaXQncyBhIHdpbi5cbjQuIENvdWxkIGRvIG1vcmUgc3R5bGluZyB0byBtYWtlIHRoZSBnYW1lIGhhdmUgYSBzbW9vdGhlciBmZWVsLiAoYml0IHZhZ3VlKVxuNS4gUmVmYWN0b3IgbXkgY29kZS5cbiovXG4iXX0=
