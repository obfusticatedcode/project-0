"use strict";$(function(){function e(){var e=$(event.target).position();return m=i(e.top,e.left)}function a(){$("div.square").removeData("jumpedPieces").removeClass("movable")}function t(e,a){return{top:a*(u+f)+"px",left:e*(u+f)+"px"}}function i(e,a){return{x:a/(u+f),y:e/(u+f)}}function n(e){var a=$("div.square"),t={};$("div.piece").each(function(e,a){var n=$(a).position(),s=i(n.top,n.left),o=8*s.y+s.x;t[o]=$(a)});var n=i(e.position().top,e.position().left),s=[{x:1,y:1},{x:-1,y:1}],o=[{x:1,y:-1},{x:-1,y:-1}],r=s.concat(o),l=void 0;l=e.hasClass("king")?r:e.hasClass("light")?s:o;var c=function(e){return!(e.x>=0&&e.x<8&&e.y>=0&&e.y<8)},d=$();return function i(n,s,o){if(!c(n)){var r=a.eq(8*n.y+n.x);$.each(s,function(s,l){var v={x:l.x+n.x,y:l.y+n.y};if(!c(v)){var u=8*v.y+v.x;if(t[u]){if(e.hasClass("dark")){if(t[u].hasClass("dark"))return}else if(t[u].hasClass("light"))return;var f={x:2*l.x+n.x,y:2*l.y+n.y};if(c(f))return;var p=8*f.y+f.x;if(!t[p]){var h=a.eq(p);if(!h.is(d)){d=d.add(h);var C=t[u];r.data("jumpedPieces")&&(C=C.add(r.data("jumpedPieces"))),h.data("jumpedPieces",C),i(f,l,!0)}}}else if(!o){var g=a.eq(u);g.data("jumpedPieces",$()),d=d.add(g)}}})}}(n,l,!1),d}function s(e,a,t){e.css("top",a),e.css("left",t)}function o(e){e.hasClass("selected")?e.removeClass("selected"):($("div.piece").each(function(e,a){$(a).hasClass("selected")&&$(a).removeClass("selected")}),e.addClass("selected"))}function r(){return g.html(parseInt($("#moveCounter").html(),10)+1)}function l(e){e.data("jumpedPieces").remove()}function c(e,a){for(var t=0;t<64;t++)(a<8||a>=56)&&e.addClass("king")}function d(){var e=$("div.piece.light"),a=$("div.piece.dark"),t=a.length,i=e.length;return 0===t?console.log("Player 1 wins"):0===i?console.log("Player 2 wins"):1===i&&1===t?console.log("It's a draw"):void 0}function v(){location.reload()}var u=46,f=2,p=$("div#board"),h=$("div#pieces"),C=$("#reset-button"),g=$("#moveCounter"),m=null;!function(){function e(e){return e%8%2^Math.floor(e/8)%2}for(var a=0;a<64;a++)p.append($("<div/>").addClass("square"));for(var t=0;t<24;t++)h.append($("<div/>").addClass("piece"));$("div.square").each(function(a){0===e(a)?$(this).addClass("light"):$(this).addClass("dark")})}(),function(){$("piece"),$("div.piece:even").addClass("light"),$("div.piece:odd").addClass("dark")}(),function(){$("div.piece.dark").each(function(e,a){var i=Math.floor(e/4)+5,n=e%4*2+(1-i%2),o=t(n,i);s($(a),o.top,o.left)})}(),function(){var e=$("div.piece.light");e.each(function(a,i){console.log(e.length);var n=Math.floor(a/4),o=a%4*2+(1-n%2),r=t(o,n);s($(i),r.top,r.left)})}(),function(){$("div.piece").on("click",function(e){var t=$(e.target);o(t),a(),t.hasClass("selected")&&n(t).addClass("movable")})}(),$("div.square").on("click",function(i){e();var n=$(i.target);if(n.hasClass("movable")){var o=$("div.piece.selected");if(1===o.length){var v=n.prevAll().length,u=v%8,f=Math.floor(v/8),p=t(u,f);s(o,p.top,p.left),l(n),c(o,n.prevAll().length),o.removeClass("selected"),$("div.square").removeClass("movable"),d(),r(),a()}}}),C.on("click",function(){v()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyIkIiwicG9zaXRpb24iLCJjb29yZHMiLCJnZXRDb29yZHMiLCJ0b3AiLCJsZWZ0IiwicmVzZXRNb3ZhYmxlcyIsInJlbW92ZURhdGEiLCJyZW1vdmVDbGFzcyIsImdldFBpeGVscyIsIngiLCJ5Iiwid2lkdGgiLCJib3JkZXIiLCIkc3F1YXJlcyIsImdldE1vdmFibGVTcXVhcmVzIiwiJHBpZWNlIiwicGllY2UiLCJ0YWtlblNxdWFyZXMiLCJsaWdodERpcmVjdGlvbiIsImRhcmtEaXJlY3Rpb24iLCJzcXVhcmVJbmRleCIsImRpcmVjdGlvbiIsIm91dE9mQm91bmRzIiwiJGxlZ2FsU3F1YXJlcyIsImNvbmNhdCIsImhhc0NsYXNzIiwiJGN1cnJlbnRTcXVhcmUiLCJuZXdDb29yZHMiLCJidWlsZE1vdmVzIiwianVtcHNPbmx5IiwibmV3U3F1YXJlSW5kZXgiLCJlYWNoIiwiaW5kZXgiLCJqdW1wQ29vcmRzIiwianVtcFNxdWFyZUluZGV4IiwiJG5ld1NxdWFyZSIsImlzIiwiJGp1bXBlZFBpZWNlcyIsImRhdGEiLCJhZGQiLCJhZGRDbGFzcyIsImVxIiwibW92ZVBpZWNlVG8iLCJuZXdUb3AiLCJuZXdMZWZ0IiwiY3NzIiwiaSIsInRvZ2dsZVNlbGVjdCIsInJlbW92ZUNhcHR1cmVkUGllY2VzIiwiJHNxdWFyZSIsImluY3JlbWVudG1vdmVDb3VudGVyIiwiJG1vdmVDb3VudGVyIiwiaHRtbCIsInBhcnNlSW50IiwiY29uc29sZSIsInJlbW92ZSIsImNoZWNrS2luZyIsIiRyZXNldEJ1dHRvbiIsInJlc2V0IiwicGllY2VzTGVmdCIsIiRsaWdodFBpZWNlcyIsIiRkYXJrUGllY2VzIiwiZGFya1BpZWNlcyIsImxlbmd0aCIsImxpZ2h0UGllY2VzIiwibG9nIiwibG9jYXRpb24iLCJyZWxvYWQiLCIkYm9hcmQiLCIkcGllY2VzIiwiTWF0aCIsImZsb29yIiwibGlnaHRPckRhcmsiLCJhcHBlbmQiLCJ0aGlzIiwicGl4ZWxQb3NpdGlvbiIsIm9uIiwiZXZlbnQiLCIkdGhpc1BpZWNlIiwidGFyZ2V0IiwiJHBpZWNlVG9Nb3ZlIiwiY3VycmVudFBvc2l0aW9uIiwiZSIsIiRzZWxlY3RlZFBpZWNlIiwicHJldkFsbCIsInBpeGVscyJdLCJtYXBwaW5ncyI6IllBQ0FBLEdBQUUsV0FzRkUsUUFBTUMsS0FDTkMsR0FBQUEsR0FBU0MsRUFBVUYsTUFBQUEsUUFBYUEsVUFJakMsT0FIQ0MsR0FBQUMsRUFBQUYsRUFBQUcsSUFBQUgsRUFBQUksTUFrRUYsUUFBQUMsS0FDQU4sRUFBQSxjQUFBTyxXQUFBLGdCQUFBQyxZQUFBLFdBd0JBLFFBQUFDLEdBQUFDLEVBQUFDLEdBR0EsT0FDSVAsSUFBQU8sR0FBQUMsRUFBQUMsR0FBQSxLQUNBUixLQUFBSyxHQUFBRSxFQUFBQyxHQUFBLE1BT0osUUFBQVYsR0FBQUMsRUFBQUMsR0FORSxPQVVBSyxFQUFBTCxHQUFBTyxFQUFBQyxHQUNBRixFQUFNRyxHQUFBQSxFQUFhRCxJQU1uQmIsUUFBRWUsR0FBa0JDLEdBR2xCLEdBQU1mLEdBQVdELEVBQUVpQixjQUpqQkMsSUFVSmxCLEdBQUEsYUFBZUcsS0FBQUEsU0FBVWEsRUFBT2YsR0FHaEMsR0FBTWtCLEdBQUFBLEVBQWlCRixHQUNuQmhCLFdBR0pDLEVBQUFDLEVBQUFGLEVBQUFHLElBQUFILEVBQUFJLE1BQ01lLEVBQ1EsRUFBVmxCLEVBQU1TLEVBRFlULEVBRWJRLENBRVRRLEdBQUFHLEdBQUFyQixFQUFBaUIsSUFHQSxJQUFJSyxHQUFBQSxFQUFKTixFQUFBZixXQUFBRyxJQUFBWSxFQUFBZixXQUFBSSxNQUNBYyxJQUdFRyxFQUFBQSxFQUFBQSxFQUFBQSxJQURLWixHQUVBLEVBQUFDLEVBQUEsSUFaRFMsSUFnQkFHLEVBQUFBLEVBQUFBLEdBQUFBLElBQ0piLEdBQU8sRUFBRVIsR0FBQUEsSUFHUHNCLEVBQWdCeEIsRUFBcEJ5QixPQUFBTCxHQUVFRSxNQUFBQSxFQUVBQSxHQURFTixFQUFBVSxTQUFBLFFBQ0lDLEVBQ0NMLEVBQVBJ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TWlFLEVBQWdCbkUsRUFBQUMsRUFBQUMsRUFFdEJnQyxHQUFZM0MsRUFBRWlCLEdBQWQyRCxFQUFxQkEsSUFBckJBLEVBQXVDQSxXQTRCekM1RSxXQUNFQSxFQUFBLGFBQUE2RSxHQUFBLFFBQUEsU0FBQUMsR0FHQSxHQUFBQyxHQUFBL0UsRUFBQThFLEVBQUFFLE9BR0ExRSxHQUFBQSxHQUNBQSxJQUVFUyxFQUFBQSxTQUFrQmdFLGFBQ25CaEUsRUFBQWdFLEdBQUF0QyxTQUFBLGdCQXNCSHpDLEVBQUEsY0FBTWlGLEdBQUFBLFFBQW1CRCxTQUFBQSxHQUh6QkUsR0FHQSxJQUFNRCxHQUFlakYsRUFBRW1GLEVBQUVILE9BU25CLElBQUFDLEVBQUF2RCxTQUFBLFdBQUEsQ0FHRSxHQUFBMEQsR0FBQXBGLEVBQUEscUJBR0osSUFBVSxJQUFWb0YsRUFBZVosT0FBZixDQUdBN0IsR0FBQUEsR0FBWXlDLEVBQVpDLFVBQWtDakYsT0FDaENNLEVBQUF1QixFQUFBLEVBQ0ZnQixFQUFBQSxLQUFBQSxNQUFxQmdDLEVBQUFBLEdBQ3JCSyxFQUFBN0UsRUFBQUMsRUFBQUMsRUFFQThDLEdBQVUyQixFQUFlSCxFQUFBQSxJQUFBQSxFQUFhSSxNQUV0Q0QsRUFBZTVFLEdBR2ZSLEVBQUVvRixFQUFjNUUsRUFBaEI2RSxVQUFBckIsUUFFQUosRUFBQUEsWUFBQUEsWUFHQTVELEVBQUEsY0FBQVEsWUFBQSxXQUdEb0QsSUF4Q0xULElBK0NBN0MsUUFnU0FvRCxFQUFhbUIsR0FBRyxRQUFTLFdBQ3ZCbEIiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9sb2FkaW5nIEpTXG4kKCgpPT57XG5cbiAgLy9HTE9CQUwgVkFSSUFCTEVTXG4gIGNvbnN0IHdpZHRoID0gNDY7XG4gIGNvbnN0IGJvcmRlciA9IDI7XG4gIGNvbnN0ICRib2FyZCA9ICQoJ2RpdiNib2FyZCcpO1xuICBjb25zdCAkcGllY2VzID0gJCgnZGl2I3BpZWNlcycpO1xuICBjb25zdCAkcmVzZXRCdXR0b24gPSAkKCcjcmVzZXQtYnV0dG9uJyk7XG4gIGNvbnN0ICRtb3ZlQ291bnRlciA9ICQoJyNtb3ZlQ291bnRlcicpO1xuXG4gIGxldCBjb29yZHMgPSBudWxsOy8vc2V0dGluZyBjb29yZHMgZ2xvYmFsbHkgc28gaXQncyBjb25zdGFudGx5IHVwZGF0aW5nXG5cbiAgLy9zZXQgdXAgdGhlIGJvYXJkIHdpdGggdGhlIGNvcnJlY3QgY2xhc3NlcyBmb3IgdGhlIGxpZ2h0IGFuZCBkYXJrIHNxdWFyZXNcbiAgc2V0VXBCb2FyZCgpO1xuICAvL3NldHMgdXAgdGhlIGNsYXNzZXMgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgcGllY2VcbiAgc2V0VXBQaWVjZXMoKTtcbiAgLy9zZXR0aW5nIHVwIHRoZSBkYXJrUGllY2VzXG4gIGRhcmtQaWVjZXMoKTtcbiAgLy9MSUdIVCBQSUVDRVNcbiAgLy8gc2V0dGluZyB1cCB0aGUgbGlnaHRQaWVjZXNcbiAgbGlnaHRQaWVjZXMoKTtcblxuXG5cbiAgZnVuY3Rpb24gbGlnaHRQaWVjZXMoKXtcbiAgICBjb25zdCAkbGlnaHRQaWVjZXMgPSAkKCdkaXYucGllY2UubGlnaHQnKTtcbiAgICAvL3RoaXMgbG9vcCBtb3ZlcyBhbGwgdGhlIGxpZ2h0IHBpZWNlcyB0byB0aGVpciBpbml0aWFsIHBvc2l0aW9uc1xuICAgICRsaWdodFBpZWNlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAvLyBURVNUIGNoZWNraW5nIHRoZSBsZW5ndGhcbiAgICAgIGNvbnNvbGUubG9nKCRsaWdodFBpZWNlcy5sZW5ndGgpO1xuICAgICAgLy90dXJuaW5nIHRoZSBpbmRleCAoZnJvbSAwIC0gMTEpXG4gICAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aFxuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA0KTtcbiAgICAgIGNvbnN0IHggPSAoaW5kZXggJSA0KSAqIDIgKyAoMSAtIHklMik7XG5cbiAgICAgIC8vdHVybmluZyB0aGUgeCx5IGNvb3JkaW5hdGUgaW50byBhIHBpeGVsIHBvc2l0aW9uXG4gICAgICBjb25zdCBwaXhlbFBvc2l0aW9uID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgICAvL2FjdHVhbGx5IG1vdmluZyB0aGUgcGllY2UgdG8gaXRzIGluaXRpYWwgcG9zaXRpb25cbiAgICAgIG1vdmVQaWVjZVRvKCQocGllY2UpLHBpeGVsUG9zaXRpb24udG9wLHBpeGVsUG9zaXRpb24ubGVmdCk7XG4gICAgfSk7XG4gIH0vL2VuZCBvZiBsaWdodFBpZWNlcyBmdW5jdGlvblxuXG5cbiAgLy9EQVJLIFBJRUNFU1xuICBmdW5jdGlvbiBkYXJrUGllY2VzKCl7XG4gICAgY29uc3QgJGRhcmtQaWVjZXMgPSAgICQoJ2Rpdi5waWVjZS5kYXJrJyk7XG4gICAgICAgIC8vdGhpcyBsb29wIG1vdmVzIGFsbCB0aGUgZGFyayBwaWVjZXMgdG8gdGhlaXIgaW5pdGlhbCBwb3NpdGlvbnNcbiAgICAkZGFya1BpZWNlcy5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG4gICAgICAgIC8vdHVybmluZyB0aGUgaW5kZXggKGZyb20gMCAtIDExKVxuICAgICAgICAvL2ludG8gYSB4LHkgc3F1YXJlIGNvb3JkaW5hdGUgdXNpbmcgbWF0aFxuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXgvNCkgKyA1O1xuICAgICAgY29uc3QgeCA9IChpbmRleCAlIDQpICogMiArICgxLXklMik7XG5cbiAgICAgICAgLy90dXJuaW5nIHRoZSB4LHkgY29vcmRpbmF0ZSBpbnRvIGEgcGl4ZWwgcG9zaXRpb25cbiAgICAgIGNvbnN0IHBpeGVsUG9zaXRpb24gPSBnZXRQaXhlbHMoeCx5KTtcbiAgICAgICAgLy9tb3ZpbmcgdGhlIHBpZWNlIHRvIGl0cyBpbml0aWFsIHBvc2l0aW9uXG4gICAgICBtb3ZlUGllY2VUbygkKHBpZWNlKSxwaXhlbFBvc2l0aW9uLnRvcCxwaXhlbFBvc2l0aW9uLmxlZnQpO1xuICAgIH0pO1xuICB9Ly9lbmQgb2YgZGFya1BpZWNlcyBmdW5jdGlvblxuXG5cblxuICAvL0VWRU5UU1xuXG5cbiAgZnVuY3Rpb24gcGllY2VTZWxlY3QoKXtcbiAgICAkKCdkaXYucGllY2UnKS5vbignY2xpY2snLChldmVudCk9PntcbiAgICAgIC8vc2VsZWN0ZWQgdmFyaWFibGVcbiAgICAgIC8vdHVybiBgdGhpc2AgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICAgIGNvbnN0ICR0aGlzUGllY2UgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAvL3RvZ2dsaW5nIHRoZSAnc2VsZWN0ZWQnIGNsYXNzIG9mIHRoaXMgcGllY2VcbiAgICAgIC8vYW5kIHBvc3NpYmxlIGRlc2VsZWN0aW5nIG90aGVyIHBpZWNlc1xuICAgICAgdG9nZ2xlU2VsZWN0KCR0aGlzUGllY2UpO1xuICAgICAgcmVzZXRNb3ZhYmxlcygpO1xuICAgICAgLy9nZXQgdGhlIGxlZ2FsIG1vdmVzIGZvciB0aGlzXG4gICAgICBpZiAoJHRoaXNQaWVjZS5oYXNDbGFzcygnc2VsZWN0ZWQnKSkge1xuICAgICAgICBnZXRNb3ZhYmxlU3F1YXJlcygkdGhpc1BpZWNlKS5hZGRDbGFzcygnbW92YWJsZScpO1xuICAgICAgfVxuICAgIH0pOy8vZW5kIG9mIHBpZWNlIGNsaWNrIGV2ZW50XG4gIH1cblxuICAvLyBURVNUIHBpZWNlU2VsZWN0KClcbiAgcGllY2VTZWxlY3QoKTtcblxuICAvL2NoZWNrcyB0aGUgY3VycmVudFBvc2l0aW9uIG9mIHRoZSBjbGlja2VkIG9yIHNlbGVjdGVkIGRpdiBhbmQgcmV0dXJucyB0aGUgY29vcmRzLlxuICBmdW5jdGlvbiBjdXJyZW50UG9zaXRpb24oKXtcbiAgICBjb25zdCBwb3NpdGlvbiA9ICQoZXZlbnQudGFyZ2V0KS5wb3NpdGlvbigpO1xuICAgIGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AscG9zaXRpb24ubGVmdCk7XG4gICAgLy8gY29uc29sZS5sb2coY29vcmRzKTsvL2dldHRpbmcgdGhlIGxvY2F0aW9uIG9mIHRoZSBwaWVjZVxuICAgIHJldHVybiBjb29yZHM7XG5cbiAgfVxuXG5cblxuICAkKCdkaXYuc3F1YXJlJykub24oJ2NsaWNrJywgKGUpPT57XG4gICAgY3VycmVudFBvc2l0aW9uKCk7Ly90aGUgY3VycmVudFBvc2l0aW9uIG9mIHRoZSBzcXVhcmU7IGNvb3Jkc1xuICAgIC8vIGNvbnNvbGUubG9nKCdjb29yZHMnLCBjb29yZHMpO1xuICAgIC8vdHVybiBgZSBvciBldmVudGAgaW50byBhIGpRdWVyeSBvYmplY3RcbiAgICBjb25zdCAkcGllY2VUb01vdmUgPSAkKGUudGFyZ2V0KTtcblxuXG4gICAgLy9pZiAkKHRoaXMpIGlzIGEgbGVnYWwgc3F1YXJlIHRvIG1vdmUgdG8uLi5cbiAgICBpZiAoJHBpZWNlVG9Nb3ZlLmhhc0NsYXNzKCdtb3ZhYmxlJykpIHtcblxuICAgICAgICAgIC8vZ2V0IHRoZSBwaWVjZSB3aXRoIHRoZSBjbGFzcyAnc2VsZWN0ZWQnXG4gICAgICBjb25zdCAkc2VsZWN0ZWRQaWVjZSA9ICQoJ2Rpdi5waWVjZS5zZWxlY3RlZCcpO1xuXG4gICAgICAgICAgLy9vbmx5IG1vdmUgaWYgdGhlcmUgaXMgZXhhY3RseSBvbmUgc2VsZWN0ZWQgcGllY2VcbiAgICAgIGlmICgkc2VsZWN0ZWRQaWVjZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBpbmRleCBvZiB0aGUgc3F1YXJlXG4gICAgICAgICAgICAvL2FuZCB0cmFuc2xhdGUgaXQgdG8gcGl4ZWwgcG9zaXRpb25cbiAgICAgICAgY29uc3QgaW5kZXggPSAkcGllY2VUb01vdmUucHJldkFsbCgpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgeCA9IGluZGV4ICUgODtcbiAgICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaW5kZXggLyA4KTtcbiAgICAgICAgY29uc3QgcGl4ZWxzID0gZ2V0UGl4ZWxzKHgseSk7XG4gICAgICAgICAgICAvL2FjdHVhbGx5IGRvIHRoZSBtb3ZpbmdcbiAgICAgICAgbW92ZVBpZWNlVG8oJHNlbGVjdGVkUGllY2UscGl4ZWxzLnRvcCxwaXhlbHMubGVmdCk7XG4gICAgICAgICAgLy9yZW1vdmVDYXB0dXJlZFBpZWNlc1xuICAgICAgICByZW1vdmVDYXB0dXJlZFBpZWNlcygkcGllY2VUb01vdmUpO1xuICAgICAgICAvLy5wcmV2QWxsKCkubGVuZ3RoIGlzIHVzZWQgdG8gZ2V0IHRoZSBpbmRleFxuICAgICAgICAvL29mIHRoZSBzZWxlY3RlZCBwaWVjZVxuICAgICAgICBjaGVja0tpbmcoJHNlbGVjdGVkUGllY2UsJHBpZWNlVG9Nb3ZlLnByZXZBbGwoKS5sZW5ndGgpO1xuICAgICAgICAvL2RlLXNlbGVjdCB0aGUgcGllY2UgdG8gZW5kIHRoZSBtb3ZlXG4gICAgICAgICRzZWxlY3RlZFBpZWNlLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXG4gICAgICAgIC8vc2V0IHRoZSBuZXcgbGVnYWwgbW92ZXNcbiAgICAgICAgJCgnZGl2LnNxdWFyZScpLnJlbW92ZUNsYXNzKCdtb3ZhYmxlJyk7XG4gICAgICAgIC8vIFRFU1QuIHRlc3RpbmcgdGhlIHdpbm5pbmcgY29uZGl0aW9uc1xuICAgICAgICBwaWVjZXNMZWZ0KCk7XG4gICAgICAgICAgICAvL2luY3JlbWVudCB0aGUgbW92ZSBjb3VudGVyXG4gICAgICAgIGluY3JlbWVudG1vdmVDb3VudGVyKCk7XG4gICAgICAgIC8vcmVzZXQgdGhlIHNxdWFyZXMgdG8gYWxsb3cgbW92ZXNcbiAgICAgICAgcmVzZXRNb3ZhYmxlcygpO1xuXG4gICAgICB9XG5cbiAgICB9XG5cbiAgfSk7XG5cblxuICAvLyBNT1JFIEZVTkNUSU9OU1xuICAvL3RoaXMgZnVuY3Rpb24gcmVtb3ZlcyB0aGUgZGF0YSBpdGVtIHdpdGgga2V5ICdqdW1wZWRQaWVjZXMnIGZyb20gZXZlcnkgZGl2LnNxdWFyZVxuLy8gYW5kIHJlbW92ZXMgdGhlIGNsYXNzICdtb3ZhYmxlJyBmcm9tIGV2ZXJ5IHNxdWFyZVxuICBmdW5jdGlvbiByZXNldE1vdmFibGVzKCkge1xuICAgICQoJ2Rpdi5zcXVhcmUnKS5yZW1vdmVEYXRhKCdqdW1wZWRQaWVjZXMnKS5yZW1vdmVDbGFzcygnbW92YWJsZScpO1xuICB9XG5cbi8vIFBsYXllciBjaGFuZ2UgZnJvbSBwbGF5ZXIgMSB0byBwbGF5ZXIgMlxuICAvL3RoaXMgZnVuY3Rpb24gYWxsb3dzIHRoZSBwbGF5ZXJzIHRvIGJlIGNoYW5nZWQuXG4gIC8vIGxldCAkbGlnaHRQbGF5ZXIgPSAkKCdkaXYucGllY2UubGlnaHQnKTtcbiAgLy8gJGxpZ2h0UGxheWVyID0gdHJ1ZTtcbiAgLy8gY29uc29sZS5sb2coJGxpZ2h0UGxheWVyKTtcbiAgLy8gbGV0ICRkYXJrUGxheWVyID0gJCgnZGl2LnBpZWNlLmRhcmsnKTtcbiAgLy8gJGRhcmtQbGF5ZXIgPSBmYWxzZTtcbiAgLy8gY29uc29sZS5sb2coJGRhcmtQbGF5ZXIpO1xuICAvLyBjaGFuZ2VQbGF5ZXJUdXJuKCk7XG4gIC8vIGZ1bmN0aW9uIGNoYW5nZVBsYXllclR1cm4oKXtcbiAgLy8gICBpZiAoJGxpZ2h0UGxheWVyKXtcbiAgLy8gICAgIHBpZWNlU2VsZWN0KCk7XG4gIC8vICAgfWVsc2UgaWYgKCRkYXJrUGxheWVyKSB7XG4gIC8vICAgICAkbGlnaHRQbGF5ZXIgPSBmYWxzZTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvL2Z1bmN0aW9uIGZvciB0cmFuc2xhdGluZyBhbiB4LHkgY29vcmRpbmF0ZXMgdG8gYSBwaXhlbCBwb3NpdGlvblxuICAvL3RoZSBjb252ZW50aW9uIGlzIHRoYXQgdGhlIHNxdWFyZSBpbiB0aGUgdXBwZXIgbGVmdCBjb3JuZXIgaXMgYXQgcG9zaXRpb24gMCwwXG4gIC8vdGhlIHNxdWFyZSBpbiB0aGUgdXBwZXIgcmlnaHQsIGF0IDcsMCBhbmQgdGhlIGxvd2VyXG4gIC8vcmlnaHQgYXQgNyw3XG4gIGZ1bmN0aW9uIGdldFBpeGVscyh4LHkpIHtcbiAgICAgIC8vdGFrZXMgYW4geCx5IHBvc2l0aW9uLCByZXR1cm5zXG4gICAgICAvL3BpeGVscyBmcm9tIHRoZSBsZWZ0LCByaWdodFxuICAgIHJldHVybiB7XG4gICAgICAndG9wJzogKHkgKiAod2lkdGgrYm9yZGVyKSkrJ3B4JyxcbiAgICAgICdsZWZ0JzogKHggKiAod2lkdGgrYm9yZGVyKSkrJ3B4J1xuICAgIH07XG4gIH1cblxuICAvL2Z1bmN0aW9uIGZvciB0dXJuaW5nIGEgcGl4ZWwgcG9zaXRpb25cbiAgLy9pbnRvIHRoZSB4LHkgY29vcmRpbmF0ZSBvZiBhIHNxdWFyZSBvbiB0aGUgYm9hcmRcbiAgLy9pdCBmb2xsb3dzIHRoZSBzYW1lIGNvb3JkaW5hdGUgY29udmVudGlvbiBhcyBnZXRQaXhlbHNcbiAgZnVuY3Rpb24gZ2V0Q29vcmRzKHRvcCxsZWZ0KSB7XG4gICAgICAvL3JldHVybnMgYW4geCBhbmQgYSB5XG4gICAgICAvL2dpdmVuIGEgdG9wIGFuZCBsZWZ0IHBpeGVsc1xuICAgIHJldHVybiB7XG4gICAgICAneCc6IGxlZnQgLyAod2lkdGggKyBib3JkZXIpLFxuICAgICAgJ3knOiB0b3AgLyAod2lkdGggKyBib3JkZXIpXG4gICAgfTtcbiAgfVxuXG4gIC8vZnVuY3Rpb24gZm9yIHJldHVybmluZyB0aGUgc2V0IG9mIGxlZ2FsIG1vdmVzIGdpdmVuIGEgcGllY2Vcbi8vIHRoaXMgYWxzbyBzdG9yZXMganVtcGVkIHBpZWNlcyBpbiBhIGRhdGEgZWxlbWVudCBvZiBlYWNoIHNxdWFyZSB0aGF0IGNhbiBiZSBtb3ZlZCB0b1xuICBmdW5jdGlvbiBnZXRNb3ZhYmxlU3F1YXJlcygkcGllY2UpIHtcblxuICAgIC8vc2VsZWN0IGFsbCBvZiB0aGUgc3F1YXJlc1xuICAgIGNvbnN0ICRzcXVhcmVzID0gJCgnZGl2LnNxdWFyZScpO1xuXG4gICAgLy9zZWxlY3QgdGhlIG9jY3VwaWVkIG9uZXMgdXNpbmcgdGhlIGpRdWVyeSBtYXAoKSBtZXRob2RcbiAgICAvL21hcCBjcmVhdGVzIGEgbmV3IG9iamVjdCBmcm9tIGFuIGV4aXN0aW5nIG9uZVxuICAgIC8vdXNpbmcgYSB0cmFuc2xhdGlvbiBmdW5jdGlvblxuICAgIHZhciB0YWtlblNxdWFyZXMgPSB7fTtcbiAgICAkKCdkaXYucGllY2UnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LHBpZWNlKSB7XG5cbiAgICAgICAgICAgIC8vdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGEgcGllY2VcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gJChwaWVjZSkucG9zaXRpb24oKTtcbiAgICAgIGNvbnN0IGNvb3JkcyA9IGdldENvb3Jkcyhwb3NpdGlvbi50b3AscG9zaXRpb24ubGVmdCk7XG4gICAgICBjb25zdCBzcXVhcmVJbmRleCA9IGNvb3Jkcy55ICogOCArIGNvb3Jkcy54O1xuICAgICAgdGFrZW5TcXVhcmVzW3NxdWFyZUluZGV4XSA9ICQocGllY2UpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY29vcmRzID0gZ2V0Q29vcmRzKCRwaWVjZS5wb3NpdGlvbigpLnRvcCwkcGllY2UucG9zaXRpb24oKS5sZWZ0KTtcblxuICAgIC8vbGlnaHRzIG1vdmUgZG93biB0aGUgYm9hcmRcbiAgICBjb25zdCBsaWdodERpcmVjdGlvbiA9IFtcbiAgICAgICAge3g6IDEseTogMX0sXG4gICAgICAgIHt4OiAtMSx5OiAxfVxuICAgIF07XG4gICAgLy9kYXJrcyBtb3ZlIHVwIHRoZSBib2FyZFxuICAgIGNvbnN0IGRhcmtEaXJlY3Rpb24gPSBbXG4gICAgICAgIHt4OiAxLHk6IC0xfSxcbiAgICAgICAge3g6IC0xLHk6IC0xfVxuICAgIF07XG4gICAgLy9raW5ncyBtb3ZlIGluIGFueSBkaXJlY3Rpb25cbiAgICBjb25zdCBraW5nRGlyZWN0aW9uID0gbGlnaHREaXJlY3Rpb24uY29uY2F0KGRhcmtEaXJlY3Rpb24pO1xuXG4gICAgbGV0IGRpcmVjdGlvbjtcbiAgICBpZiAoJHBpZWNlLmhhc0NsYXNzKCdraW5nJykpIHtcbiAgICAgIGRpcmVjdGlvbiA9IGtpbmdEaXJlY3Rpb247XG4gICAgfSBlbHNlIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2xpZ2h0JykpIHtcbiAgICAgIGRpcmVjdGlvbiA9IGxpZ2h0RGlyZWN0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXJlY3Rpb24gPSBkYXJrRGlyZWN0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0IG91dE9mQm91bmRzID0gZnVuY3Rpb24oY29vcmRzKSB7XG4gICAgICByZXR1cm4gIShjb29yZHMueCA+PSAwICYmIGNvb3Jkcy54IDwgOCAmJiBjb29yZHMueSA+PSAwICYmIGNvb3Jkcy55IDwgOCk7XG4gICAgfTtcblxuICAgIGxldCAkbGVnYWxTcXVhcmVzID0gJCgpO1xuICAgIGNvbnN0IGJ1aWxkTW92ZXMgPSBmdW5jdGlvbihjb29yZHMsZGlyZWN0aW9uLGp1bXBzT25seSkge1xuICAgICAgaWYgKG91dE9mQm91bmRzKGNvb3JkcykpIHJldHVybjtcbiAgICAgICAgLy9jdXJyZW50IHNxdWFyZSBpcyBhdCBjb29yZHNcbiAgICAgIGNvbnN0ICRjdXJyZW50U3F1YXJlID0gJHNxdWFyZXMuZXEoY29vcmRzLnkqOCArIGNvb3Jkcy54KTtcbiAgICAgICQuZWFjaChkaXJlY3Rpb24sZnVuY3Rpb24oaW5kZXgsZGlyZWN0aW9uKSB7XG5cbiAgICAgICAgY29uc3QgbmV3Q29vcmRzID0ge1xuICAgICAgICAgIHg6IGRpcmVjdGlvbi54ICsgY29vcmRzLngsXG4gICAgICAgICAgeTogZGlyZWN0aW9uLnkgKyBjb29yZHMueVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChvdXRPZkJvdW5kcyhuZXdDb29yZHMpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG5ld1NxdWFyZUluZGV4ID0gOCpuZXdDb29yZHMueSArIG5ld0Nvb3Jkcy54O1xuICAgICAgICAgICAgLy9pZiB0aGUgc3F1YXJlIGlzIHRha2VuLFxuICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XSkge1xuXG4gICAgICAgICAgICAgICAgLy9DYW4gb25seSBqdW1wIGlmIHBpZWNlIGlzIGRpZmZlcmVudFxuICAgICAgICAgIGlmICgkcGllY2UuaGFzQ2xhc3MoJ2RhcmsnKSkge1xuICAgICAgICAgICAgaWYgKHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF0uaGFzQ2xhc3MoJ2RhcmsnKSkgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGFrZW5TcXVhcmVzW25ld1NxdWFyZUluZGV4XS5oYXNDbGFzcygnbGlnaHQnKSkgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGp1bXBDb29yZHMgPSB7XG4gICAgICAgICAgICB4OiBkaXJlY3Rpb24ueCoyICsgY29vcmRzLngsXG4gICAgICAgICAgICB5OiBkaXJlY3Rpb24ueSoyICsgY29vcmRzLnlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvdXRPZkJvdW5kcyhqdW1wQ29vcmRzKSkgcmV0dXJuO1xuXG4gICAgICAgICAgY29uc3QganVtcFNxdWFyZUluZGV4ID0ganVtcENvb3Jkcy55KjggKyBqdW1wQ29vcmRzLng7XG4gICAgICAgICAgICAgICAgLy9pZiB0aGUganVtcCBzcXVhcmUgaXMgZnJlZS4uLlxuICAgICAgICAgICAgICAgIC8vYWRkIGl0IGFuZCB0aGUgZGF0YS1qdW1wZWQtcGllY2VzXG4gICAgICAgICAgaWYgKCF0YWtlblNxdWFyZXNbanVtcFNxdWFyZUluZGV4XSkge1xuICAgICAgICAgICAgY29uc3QgJG5ld1NxdWFyZSA9ICRzcXVhcmVzLmVxKGp1bXBTcXVhcmVJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIC8vaWYgd2UgaGF2ZW4ndCBhbHJlYWR5IHNlZW4gaXRcbiAgICAgICAgICAgIGlmICghJG5ld1NxdWFyZS5pcygkbGVnYWxTcXVhcmVzKSkge1xuXG4gICAgICAgICAgICAgIC8vYWRkIHRoZSBwYXNzZWQgb3ZlciBzcXVhcmUgdG8gaXRcbiAgICAgICAgICAgICAgJGxlZ2FsU3F1YXJlcyA9ICRsZWdhbFNxdWFyZXMuYWRkKCRuZXdTcXVhcmUpO1xuXG4gICAgICAgICAgICAgIC8vYW5kIHRoZSBqdW1wZWQgc3F1YXJlcyBmcm9tIGhvdyB3ZSBnb3QgaGVyZVxuICAgICAgICAgICAgICBsZXQgJGp1bXBlZFBpZWNlcyA9IHRha2VuU3F1YXJlc1tuZXdTcXVhcmVJbmRleF07XG4gICAgICAgICAgICAgIGlmICgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSkge1xuICAgICAgICAgICAgICAgICRqdW1wZWRQaWVjZXMgPSAkanVtcGVkUGllY2VzLmFkZCgkY3VycmVudFNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG5ld1NxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnLCRqdW1wZWRQaWVjZXMpO1xuXG4gICAgICAgICAgICAgIC8vYW5kIHJlY3Vyc2UsIHdpdGgganVtcHNPbmx5IHNldCB0byB0cnVlXG4gICAgICAgICAgICAgIGJ1aWxkTW92ZXMoanVtcENvb3JkcyxkaXJlY3Rpb24sdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFqdW1wc09ubHkpIHtcbiAgICAgICAgICBjb25zdCAkbmV3U3F1YXJlID0gJHNxdWFyZXMuZXEobmV3U3F1YXJlSW5kZXgpO1xuICAgICAgICAgICRuZXdTcXVhcmUuZGF0YSgnanVtcGVkUGllY2VzJywkKCkpO1xuICAgICAgICAgICRsZWdhbFNxdWFyZXMgPSAkbGVnYWxTcXVhcmVzLmFkZCgkbmV3U3F1YXJlKTtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcbiAgICB9O1xuICAgIGJ1aWxkTW92ZXMoY29vcmRzLGRpcmVjdGlvbixmYWxzZSk7XG4gICAgcmV0dXJuICRsZWdhbFNxdWFyZXM7XG5cbiAgfS8vZW5kIG9mIGdldE1vdmFibGVTcXVhcmVzXG5cbiAgZnVuY3Rpb24gc2V0VXBQaWVjZXMoKSB7XG4gICAgICAvL3NlbGVjdCBhbGwgdGhlIGRpdnMgd2l0aCBjbGFzcyAncGllY2UnXG4gICAgJCgncGllY2UnKTtcbi8vYWRkIHRoZSAnbGlnaHQnIGNsYXNzIHRvIGhhbGYgb2YgdGhlbVxuICAgICQoJ2Rpdi5waWVjZTpldmVuJykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4vL2pRdWVyeSdzIGV2ZW4gYW5kIG9kZCBzZWxlY3RvciBtZXRob2RzIHRvIGFzc2lnbiB0aGUgY2xhc3NlcyAubGlnaHQgYW5kIC5kYXJrLlxuLy9hZGQgdGhlICdkYXJrJyB0byB0aGUgb3RoZXIgaGFsZlxuICAgICQoJ2Rpdi5waWVjZTpvZGQnKS5hZGRDbGFzcygnZGFyaycpO1xuICB9XG5cbiAgLy9hY3R1YWxseSBtb3ZpbmcgdGhlIHBpZWNlXG4gIGZ1bmN0aW9uIG1vdmVQaWVjZVRvKCRwaWVjZSxuZXdUb3AsbmV3TGVmdCkge1xuICAgICAgLy9zZXQgdGhlIGNzcyAndG9wJyBhbmQgJ2xlZnQnXG4gICAgICAvL2F0dHJpYnV0ZXMgb2YgdGhlIHBhc3NlZCBwaWVjZVxuICAgICAgLy90byB0aGUgYXJndW1lbnRzIG5ld1RvcCBhbmQgbmV3TGVmdFxuICAgICRwaWVjZS5jc3MoJ3RvcCcsIG5ld1RvcCk7XG4gICAgJHBpZWNlLmNzcygnbGVmdCcsIG5ld0xlZnQpO1xuXG4gIH1cblxuICBmdW5jdGlvbiBzZXRVcEJvYXJkKCkge1xuXG4gICAgLy9DcmVhdGluZyB0aGUgNjQgc3F1YXJlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICAgIGNvbnN0IHNxdWFyZUNvdW50ID0gOCo4OyAvLzggcm93cyBieSA4IGNvbHVtbnM7IHplcm8gYmFzZWQgaW5kZXhcbiAgICBmb3IgKGxldCBpID0gMDtpPHNxdWFyZUNvdW50O2krKykge1xuICAgIC8vdGhpcyBsaW5lIGNyZWF0ZXMgYSBuZXcgZGl2IHdpdGggdGhlIGNsYXNzICdzcXVhcmUnXG4gICAgLy9hbmQgYXBwZW5kcyBpdCB0byB0aGUgZGl2IHdpdGggaWQgJ2JvYXJkJ1xuICAgICAgJGJvYXJkLmFwcGVuZCgkKCc8ZGl2Lz4nKS5hZGRDbGFzcygnc3F1YXJlJykpO1xuICAgIH1cblxuICAgIC8vY3JlYXRpbmcgdGhlIDI0IHBpZWNlcyBhbmQgYWRkaW5nIHRoZW0gdG8gdGhlIERPTVxuICAgIGNvbnN0IHBpZWNlQ291bnQgPSAyNDtcblxuICAgIGZvciAobGV0IGk9MDtpPHBpZWNlQ291bnQ7aSsrKSB7XG4gICAgICAvL3RoaXMgbGluZSBhcHBlbmRzIGFuIGVtcHR5IGRpdiB3aXRoIHRoZSBjbGFzcyAncGllY2UnIHRvIHRoZSBkaXYgd2l0aCBpZCAncGllY2VzJ1xuICAgICAgJHBpZWNlcy5hcHBlbmQoJCgnPGRpdi8+JykuYWRkQ2xhc3MoJ3BpZWNlJykpO1xuICAgIH1cbiAgICAgIC8vaXRlcmF0ZSB0aHJvdWdoIGFsbCBvZiB0aGUgZGl2cyB3aXRoIGNsYXNzIGBzcXVhcmVgXG4gICAgICAvL2ZpZ3VyZSBvdXQgd2hldGhlciBlYWNoIG9uZSBzaG91bGQgYmVcbiAgICAgIC8vbGlnaHQgb3IgZGFyaywgYW5kIGFzc2lnbiB0aGUgcHJvcGVyIGNsYXNzXG4gICAgY29uc3QgJGVhY2hTcXVhcmUgPSAkKCdkaXYuc3F1YXJlJyk7XG4gICAgJGVhY2hTcXVhcmUuZWFjaChmdW5jdGlvbihpbmRleCl7XG4gICAgICBpZihsaWdodE9yRGFyayhpbmRleCk9PT0gMCl7XG4gICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2xpZ2h0Jyk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnZGFyaycpO1xuICAgICAgfVxuICAgIH0pO1xuICAgICAgLy9pbm5lciBoZWxwZXIgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIG51bWJlciBiZXR3ZWVuXG4gICAgICAvLzAgYW5kIDYzIChpbmNsdXNpdmUpIGFuZCByZXR1cm5zIDEgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmVcbiAgICAgIC8vZGFyaywgYW5kIDAgaWYgdGhlIHNxdWFyZSBzaG91bGQgYmUgbGlnaHRcbiAgICBmdW5jdGlvbiBsaWdodE9yRGFyayhpbmRleCkge1xuICAgICAgY29uc3QgeCA9IGluZGV4ICUgODtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG4gICAgICBjb25zdCBvZGRYID0geCAlIDI7XG4gICAgICBjb25zdCBvZGRZID0geSAlIDI7XG4gICAgICByZXR1cm4gKG9kZFggXiBvZGRZKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHNldFVwQm9hcmQoKVxuXG4gIGZ1bmN0aW9uIHRvZ2dsZVNlbGVjdCgkcGllY2UpIHtcbiAgICAgIC8vaWYgJHBpZWNlIGhhcyB0aGUgY2xhc3MgJ3NlbGVjdGVkJyxyZW1vdmUgaXRcbiAgICAgIC8vaWYgJHBpZWNlIGRvZXMgbm90IGhhdmUgdGhlIGNsYXNzICdzZWxlY3RlZCdcbiAgICAgIC8vbWFrZSBzdXJlIG5vIG90aGVyIGRpdnMgd2l0aCB0aGUgY2xhc3MgJ3BpZWNlJ1xuICAgICAgLy9oYXZlIHRoYXQgY2xhc3MsIHRoZW4gc2V0ICRwaWVjZSB0byBoYXZlIHRoZSBjbGFzc1xuICAgIGlmKCRwaWVjZS5oYXNDbGFzcygnc2VsZWN0ZWQnKSlcbiAgICAgICRwaWVjZS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICBlbHNlIHtcbiAgICAgICQoJ2Rpdi5waWVjZScpLmVhY2goZnVuY3Rpb24oaW5kZXgscGllY2UpIHtcbiAgICAgICAgaWYoJChwaWVjZSkuaGFzQ2xhc3MoJ3NlbGVjdGVkJykpXG4gICAgICAgICAgJChwaWVjZSkucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICB9KTtcbiAgICAgICRwaWVjZS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICB9XG5cbiAgfS8vZW5kIG9mIHRvZ2dsZVNlbGVjdCBmdW5jdGlvblxuXG4gIGZ1bmN0aW9uIGluY3JlbWVudG1vdmVDb3VudGVyKCkge1xuICAgICAgLy9nZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXIgdHVybnMgaXQgaW50byBhIG51bWJlclxuICAgICAgLy9pbmNyZW1lbnRzIGl0IGJ5IG9uZVxuICAgICAgLy9zZXRzIHRoZSBodG1sIG9mIHRoZSBzcGFuIHdpdGggaWQgbW92ZUNvdW50ZXJcbiAgICAgIC8vdG8gdGhlIG5ldyBtb3ZlIGNvdW50XG4gICAgcmV0dXJuICAkbW92ZUNvdW50ZXIuaHRtbChwYXJzZUludCgkKCcjbW92ZUNvdW50ZXInKS5odG1sKCksMTApKzEpO1xuXG4gIH1cblxuXG4vLyB0aGlzIGZ1bmN0aW9uIGdldHMgdGhlIGpRdWVyeSBvYmplY3Qgc3RvcmVkIGluXG4vLyB0aGUgZGF0YSBvYmplY3Qgb2YgJHNxdWFyZSB1bmRlciB0aGUga2V5ICdqdW1wZWRQaWVjZXMnXG4vLyBhbmQgcmVtb3ZlcyBldmVyeSBlbGVtZW50IGluIHRoYXQgalF1ZXJ5IHNlbGVjdGlvblxuICBmdW5jdGlvbiByZW1vdmVDYXB0dXJlZFBpZWNlcygkc3F1YXJlKSB7XG4gICAgJHNxdWFyZS5kYXRhKCdqdW1wZWRQaWVjZXMnKS5yZW1vdmUoKTtcbiAgfVxuXG4gIC8vIFRoaXMgZnVuY3Rpb24gdGFrZXMgYSAkcGllY2UgYW5kIHRoZSBpbmRleCBvZiBhIHNxdWFyZVxuICAvL3NxdWFyZUluZGV4IHdpbGwgYmUgYmV0d2VlbiAwIC0gNjMgKGluY2x1c2l2ZSkuXG4vLyBpZiB0aGUgaW5kZXggcmVmZXJzIHRvIGFuIGVsZW1lbnQgaW4gdGhlIGZpcnN0IHJvdyBvciBsYXN0IHJvdyxcbi8vIHRoZSBjbGFzcyAna2luZycgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSAkcGllY2VcbiAgZnVuY3Rpb24gY2hlY2tLaW5nKCRwaWVjZSxzcXVhcmVJbmRleCkge1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCA2NDsgaSsrKXtcbiAgICAgIGlmIChzcXVhcmVJbmRleCA8IDggfHwgc3F1YXJlSW5kZXggPj0gNTYpe1xuICAgICAgICAkcGllY2UuYWRkQ2xhc3MoJ2tpbmcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuLy93aW5uaW5nIGNvbmRpdGlvbnM6IElmIG9uZSBwbGF5ZXIgb25seSBoYXMgdGhlaXIgcGllY2VzIG9uIHRoZSBib2FyZCBsZWZ0XG4vL3RoZXkgd2luLlxuICBmdW5jdGlvbiBwaWVjZXNMZWZ0KCl7XG4gICAgY29uc3QgJGxpZ2h0UGllY2VzID0gJCgnZGl2LnBpZWNlLmxpZ2h0Jyk7XG4gICAgY29uc3QgJGRhcmtQaWVjZXMgPSAkKCdkaXYucGllY2UuZGFyaycpO1xuICAgIGNvbnN0IGRhcmtQaWVjZXMgPSAkZGFya1BpZWNlcy5sZW5ndGg7XG4gICAgY29uc3QgbGlnaHRQaWVjZXMgPSAkbGlnaHRQaWVjZXMubGVuZ3RoO1xuICAgIGlmIChkYXJrUGllY2VzID09PSAwKSB7XG4gICAgICByZXR1cm4gY29uc29sZS5sb2coYFBsYXllciAxIHdpbnNgKTtcbiAgICB9IGVsc2UgaWYobGlnaHRQaWVjZXMgPT09IDApIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhgUGxheWVyIDIgd2luc2ApO1xuICAgIH0gZWxzZSBpZiAobGlnaHRQaWVjZXMgPT09IDEgJiYgZGFya1BpZWNlcyA9PT0gMSl7Ly9hbmQgNDAgbW92ZXMgYXJlIHBsYXllZCBhZnRlcndhcmRzXG4gICAgICAvL3lldCB0byBjb2RlIHRoaXMgZnVuY3Rpb25cbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhgSXQncyBhIGRyYXdgKTtcbiAgICB9XG5cbiAgfVxuXG4gIC8vcmVzZXR0aW5nIHRoZSBnYW1lLlxuICAkcmVzZXRCdXR0b24ub24oJ2NsaWNrJywgKCk9PntcbiAgICByZXNldCgpO1xuICAgIC8vIHNldHRpbmcgdXAgdGhlIHBpZWNlcyBhZnRlciBlbXB0eWluZyB0aGVtLlxuICB9KTtcblxuICAvL3RoaXMgcmVzZXRzIHRoZSBnYW1lIGJ5IGVmZmVjdGl2ZWx5IHJlbG9hZGluZyB0aGUgcGFnZSBmcm9tIGNhY2hlXG4gIGZ1bmN0aW9uIHJlc2V0KCl7XG4gICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gIH1cblxufSk7Ly9lbmQgb2YgSlMgbG9hZFxuXG5cbi8qXG5cblRPRE86XG4xLiBQbGF5ZXIgY2hhbmdlIGZyb20gcGxheWVyIDEgdG8gcGxheWVyIDJcbjIuIFJlc2V0IHRoZSBnYW1lIGJ5IHB1dHRpbmcgdGhlIHBpZWNlcyB0byB0aGUgb3JpZ2luYWwgcG9zaXRpb25cbjMuIFdpbiBjb25kaXRpb25zLCBpZiBlaXRoZXIgcGxheWVyIGhhcyBwaWVjZXMgbGVmdCBvbiB0aGUgYm9hcmQgd2hpbGUgdGhlIG90aGVyIGRvZXNuJ3RcbiAgdGhlbiBpdCdzIGEgd2luLlxuNC5cblxuXG5UT0RPOlxuMS4gUGxheWVyIGNoYW5nZSBmcm9tIHBsYXllciAxIHRvIHBsYXllciAyXG4yLiBGaWd1cmUgb3V0IGhvdyB0byBzdG9wIGlsbGVnYWwgbW92ZXMuXG4gIC1vbmx5IG1ha2UgdHdvIHBvc3RpdGlvbnMgYXZhaWxhYmxlIGF0IGFueSBnaXZlbiB0aW1lXG4gIC1vbmNlIHRoZSBwaWVjZSBoYXMgbW92ZWQgaW50byBhIHBvc2l0aW9uIG1ha2VcbjMuIEp1bXAgbW92ZXMgdG8gbWFrZSB0aGUgb3Bwb25lbnRzIHBpZWNlIGRpc2FwcGVhciBmcm9tIHRoZSBib2FyZCBhbmQgcmVzZXRcbiAgdGhlIHBvc2l0b25cbjQuIEtpbmcgbWFrZXIgZnVuY3Rpb25cbjUuIEhvdyB0byB0YWtlIGluIHRoZSB0b3AgcmlnaHQgcG9zaXRpb25cbjYuUmVzZXQgdGhlIGdhbWUgYmV0dGVyXG5cbi1PbiBjbGljayBvZiBzcWF1cmVcbi1nZXQgcGllY2Ugb24gc3FhdXJlIChlLnRhcmdldClcbi1jaGVjayBpZiBwaWVjZSBiZWxvbmdzIHRvIHAxIG9yIHAyXG4tY2hlY2sgcmVsZXZhbnQgc3F1YXJlc1xuICAuaWYgaW5kZXggb2YgY3VycmVudFNxdWFyZVxuICAuaWYgc3F1YXJlIGlzIG5vdCBpbiB0aGUgZmlyc3QgY29sdW1uXG4gIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IGxlZnQgYW5kIG1vdmFibGUgY2xhc3MgaWYgZW1wdHlcbiAgLmlmIHNxdWFyZSBpcyBub3QgaW4gdGhlIGxhc3QgY29sdW1uXG4gIGNoZWNrIHNxdWFyZSBkaWFnb25hbGx5IHJpZ2h0IGFuZCBtb3ZhYmxlIGNsYXNzIGlmIGVtcHR5XG4tb25jZSBwaWVjZSBpcyBtb3ZlZCBvciBpZiB1bi1zZWxlY3RlZCByZW1vdmUgbW92YWJsZSBjbGFzcyBmcm9tIGFsbCBzcXVhcmVzLlxuXG5pbmRleCAocG9zaXRpb24pJSB3aWR0aCA9PT0gMCAuLi5yZXByZXNlbnRzIHRoZSBmaXJzdCBjb2x1bW5cbmluZGV4ICUgd2lkdGggPT09IHdpZHRoLTEgLi4ucmVwcmVzZW50cyB0aGUgbGFzdCBjb2x1bW5cblxuaW5kZXggKyB3aWR0aC0xIGZvciBwbGF5ZXIxIGlzIGdvaW5nIGxlZnQgZGlhZ29uYWxseVxuaW5kZXggKyB3aWR0aC0xIGZvciBwbGF5ZXIxIGlzIGdvaW5nIHJpZ2h0IGRpYWdvbmFsbHlcblxuaW5kZXggLSB3aWR0aCsxIGZvciBwbGF5ZXIyIGlzIGdvaW5nIGxlZnQgZGlhZ29uYWxseVxuaW5kZXggLSB3aWR0aC0xIGZvciBwbGF5ZXIyIGlzIGdvaW5nIHJpZ2h0IGRpYWdvbmFsbHlcbi8vXG4vL3VzaW5nIHggYW5kIHkgdmFsdWVzLlxuLy94IHZhbHVlIG9uIHRoZSBmaXJzdENvbHVtbiB3aWxsIGFsd2F5cyBiZSB6ZXJvIHNpbmNlIHRoZSBzdGFydGluZyBpcyBhIHplcm8gYmFzZWQgaW5kZXhcbi8veSB2YWx1ZSBvbiB0aGUgbGFzdENvbHVtbiB3aWxsIGFsd2F5cyBiZSBzZXZlbiBzaW5jZSB0aGUgbGFzdCBpbmRleCBvbiBhIDgqOCBpcyA3XG4vL2RhcmtQaWVjZSBtb3ZpbmcgcmlnaHQgaXMgeCArIDEgYW5kIHkgLSAxXG4vL2RhcmtQaWVjZSBtb3ZpbmcgbGVmdCBpcyB4IC0gMSBhbmQgeSAtIDFcbi8vbGlnaHRQaWVjZSBtb3ZpbmcgcmlnaHQgaXMgeCAtIDEgYW5kIHkgKyAxXG4vL2xpZ2h0UGllY2UgbW92aW5nIGxlZnQgaXMgeCArIDEgYW5kIHkgKyAxXG4vL0FuZCB0byBqdW1wIHdpbGwgYmUgKzIgc2luZ2xlIG1vdmVtZW50cy5cbi8vY2hlY2sgaWYgZW1wdHkuLi5ieSBjaGVja2luZyBpZiBhIHNxdWFyZSBpcyBtb3ZhYmxlIGkuZS4gZ2V0TW92YWJsZVNxdWFyZXMoKS5hZGRDbGFzcygnbW92YWJsZScpO1xuLy9pZiBlbXB0eVxuLy8gY29uc3QgZGFya1BpZWNlTW92ZVJpZ2h0ID0oaW5kZXgueCArIChpbmRleC54ICsgMSkpLCAoaW5kZXgueSArIChpbmRleC55IC0gMSkpOyAvL0kgbmVlZCB0byBnZXQgYSBzZXQgb2YgY29vcmRzIGJhY2sgYW5kIG1ha2UgdGhhdCBhIGxlZ2FsTW92ZXNcblxuXG5cblxuLy8gaWYgKGluZGV4ICUgd2lkdGggPT09IDAgJiYgJGRhcmtQaWVjZSl7XG4vLyAgIGluZGV4ICsgd2lkdGggKyAxXG4vLyB9XG4vLyB0YWtlIHRoZSBpbmRleCB4IGFuZCB5IHZhbHVlIGFzIGluZGV4IGFuZCBjaGVja1xuLy9pZiBpbmRleCAlIHdpZHRoID09PSAwIHRoZSBmaXJzdCBjb2x1bW4gb3Jcbi8vaWYgaW5kZXggJSB3aWR0aCA9PT0gd2lkdGgtMSB0aGUgbGFzdCBjb2x1bW5cbi8vaWYgZmlyc3QgY29sdW1uIGlzIHRydWUgdGhlbiBjaGVjayBjb2xvci9wMSBvciBwMlxuLy9wMVxuLy9pZiBwMSBjaGVjayBzcXVhcmUgZGlhZ29uYWxseSBsZWZ0IGlmIGVtcHR5IHVzaW5nXG4vL2luZGV4ICsgd2lkdGggKyAxIGFkZCB0aGUgY2xhc3MgJ21vdmFibGUnXG4vL2lmIGxhc3QgY29sdW1uIGlzIHRydWUgdGhlbiBjaGVjayBjb2xvci9wMSBvciBwMlxuLy9pZiBwMSBjaGVjayBzcXVhcmUgZGlhZ29uYWxseSByaWdodCBpZiBlbXB0eSB1c2luZ1xuLy9pbmRleCArIHdpZHRoLTEgYWRkIHRoZSBjbGFzcyAnbW92YWJsZSdcbi8vdXNlIENTUyB0byBoaWdobGlnaHQgdGhlIG1vdmFibGUgc3F1YXVyZXMgKGxlZ2FsIG1vdmVzKVxuLy9wMlxuLy9lbHNlIGl0J3MgcDJcblxuKi9cbiJdfQ==
